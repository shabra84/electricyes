!function e(t,n,i){function a(r,s){if(!n[r]){if(!t[r]){var l="function"==typeof require&&require;if(!s&&l)return l(r,!0);if(o)return o(r,!0);var c=new Error("Cannot find module '"+r+"'");throw c.code="MODULE_NOT_FOUND",c}var d=n[r]={exports:{}};t[r][0].call(d.exports,function(e){var n=t[r][1][e];return a(n?n:e)},d,d.exports,e,t,n,i)}return n[r].exports}for(var o="function"==typeof require&&require,r=0;r<i.length;r++)a(i[r]);return a}({1:[function(require,module,exports){!function(jQuery){"use strict";function toCSS(jss,options){function jsonToCSS(e,t){e&&!result[e]&&(result[e]={});for(var n in t){var i=t[n];if(i instanceof Array)for(var a=i,o=0;o<a.length;o++)addProperty(e,n,a[o]);else switch(typeof i){case"number":case"string":addProperty(e,n,i);break;case"object":var r=n.charAt(n.length-1);if(!e||"_"!==r&&"-"!==r)jsonToCSS(makeSelectorName(e,n),i);else{var s=i;for(var l in s)for(var c=l.split(/\s*,\s*/),d=0;d<c.length;d++){var u=s[l];if(u instanceof Array)for(var p=u,h=0;h<p.length;h++)addProperty(e,n+c[d],p[h]);else addProperty(e,n+c[d],s[l])}}}}}function makePropertyName(e){return e.replace(/_/g,"-")}function makeSelectorName(e,t){for(var n=[],i=t.split(/\s*,\s*/),a=e.split(/\s*,\s*/),o=0;o<a.length;o++)for(var r=a[o],s=0;s<i.length;s++){var l=i[s];"&"===l.charAt(0)?n.push(r+l.substr(1)):n.push(r?r+" "+l:l)}return n.join(", ")}function addProperty(e,t,n){"number"!=typeof n||options.useRawValues||(n+="px");for(var i=t.split(/\s*,\s*/),a=0;a<i.length;a++){var o=makePropertyName(i[a]);result[e][o]?result[e][o].push(n):result[e][o]=[n]}}var result={};if("string"==typeof jss)try{eval("var jss = {"+jss+"}")}catch(e){return"/*\nUnable to parse JSS: "+e+"\n*/"}jsonToCSS("",jss);var ret="";for(var a in result){var css=result[a];ret+=a+" {\n";for(var i in css)for(var values=css[i],j=0;j<values.length;j++)ret+="\t"+i+": "+values[j]+";\n";ret+="}\n"}return ret}var defaults={truncateFirst:!1,container:null,containerName:"injectCSSContainer",useRawValues:!1};jQuery.injectCSS=function(e,t){t=jQuery.extend({},defaults,t),t.media=t.media||"all";var n=t.container&&jQuery(t.container)||jQuery("#"+t.containerName);n.length||(n=jQuery("<style></style>").appendTo("head").attr({media:t.media,id:t.containerName,type:"text/css"}));var i=n[0],a=void 0!==i.styleSheet&&void 0!==i.styleSheet.cssText,o="";return t.truncateFirst||(o+=a?i.styleSheet.cssText:n.text()),o+=toCSS(e,t),a?i.styleSheet.cssText=o:n.text(o),n}}(jQuery)},{}],2:[function(e,t,n){!function(e,n){"use strict";"object"==typeof t&&"object"==typeof t.exports?t.exports=n(e,document):"function"==typeof define&&define.amd?define([],function(){return n(e,document)}):e.plyr=n(e,document)}("undefined"!=typeof window?window:this,function(e,t){"use strict";function n(){var e,n,i,a=navigator.userAgent,o=navigator.appName,r=""+parseFloat(navigator.appVersion),s=parseInt(navigator.appVersion,10),l=!1,c=!1,d=!1,u=!1;return-1!==navigator.appVersion.indexOf("Windows NT")&&-1!==navigator.appVersion.indexOf("rv:11")?(l=!0,o="IE",r="11"):-1!==(n=a.indexOf("MSIE"))?(l=!0,o="IE",r=a.substring(n+5)):-1!==(n=a.indexOf("Chrome"))?(d=!0,o="Chrome",r=a.substring(n+7)):-1!==(n=a.indexOf("Safari"))?(u=!0,o="Safari",r=a.substring(n+7),-1!==(n=a.indexOf("Version"))&&(r=a.substring(n+8))):-1!==(n=a.indexOf("Firefox"))?(c=!0,o="Firefox",r=a.substring(n+8)):(e=a.lastIndexOf(" ")+1)<(n=a.lastIndexOf("/"))&&(o=a.substring(e,n),r=a.substring(n+1),o.toLowerCase()===o.toUpperCase()&&(o=navigator.appName)),-1!==(i=r.indexOf(";"))&&(r=r.substring(0,i)),-1!==(i=r.indexOf(" "))&&(r=r.substring(0,i)),s=parseInt(""+r,10),isNaN(s)&&(r=""+parseFloat(navigator.appVersion),s=parseInt(navigator.appVersion,10)),{name:o,version:s,isIE:l,isFirefox:c,isChrome:d,isSafari:u,isIos:/(iPad|iPhone|iPod)/g.test(navigator.platform),isIphone:/(iPhone|iPod)/g.test(navigator.userAgent),isTouch:"ontouchstart"in t.documentElement}}function i(e,t){var n=e.media;if("video"===e.type)switch(t){case"video/webm":return!(!n.canPlayType||!n.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/no/,""));case"video/mp4":return!(!n.canPlayType||!n.canPlayType('video/mp4; codecs="avc1.42E01E, mp4a.40.2"').replace(/no/,""));case"video/ogg":return!(!n.canPlayType||!n.canPlayType('video/ogg; codecs="theora"').replace(/no/,""))}else if("audio"===e.type)switch(t){case"audio/mpeg":return!(!n.canPlayType||!n.canPlayType("audio/mpeg;").replace(/no/,""));case"audio/ogg":return!(!n.canPlayType||!n.canPlayType('audio/ogg; codecs="vorbis"').replace(/no/,""));case"audio/wav":return!(!n.canPlayType||!n.canPlayType('audio/wav; codecs="1"').replace(/no/,""))}return!1}function a(e){if(!t.querySelectorAll('script[src="'+e+'"]').length){var n=t.createElement("script");n.src=e;var i=t.getElementsByTagName("script")[0];i.parentNode.insertBefore(n,i)}}function o(e,t){return Array.prototype.indexOf&&-1!==e.indexOf(t)}function r(e,t,n){return e.replace(new RegExp(t.replace(/([.*+?\^=!:${}()|\[\]\/\\])/g,"\\$1"),"g"),n)}function s(e,t){e.length||(e=[e]);for(var n=e.length-1;n>=0;n--){var i=n>0?t.cloneNode(!0):t,a=e[n],o=a.parentNode,r=a.nextSibling;return i.appendChild(a),r?o.insertBefore(i,r):o.appendChild(i),i}}function l(e){e&&e.parentNode.removeChild(e)}function c(e,t){e.insertBefore(t,e.firstChild)}function d(e,t){for(var n in t)e.setAttribute(n,K["boolean"](t[n])&&t[n]?"":t[n])}function u(e,n,i){var a=t.createElement(e);d(a,i),c(n,a)}function p(e){return e.replace(".","")}function h(e,t,n){if(e)if(e.classList)e.classList[n?"add":"remove"](t);else{var i=(" "+e.className+" ").replace(/\s+/g," ").replace(" "+t+" ","");e.className=i+(n?" "+t:"")}}function m(e,t){return!!e&&(e.classList?e.classList.contains(t):new RegExp("(\\s|^)"+t+"(\\s|$)").test(e.className))}function f(e,n){var i=Element.prototype;return(i.matches||i.webkitMatchesSelector||i.mozMatchesSelector||i.msMatchesSelector||function(e){return-1!==[].indexOf.call(t.querySelectorAll(e),this)}).call(e,n)}function g(e,t,n,i,a){n&&b(e,t,function(t){n.apply(e,[t])},a),b(e,t,function(t){i.apply(e,[t])},a)}function v(e,t,n,i,a){var o=t.split(" ");if(K["boolean"](a)||(a=!1),e instanceof NodeList)for(var r=0;r<e.length;r++)e[r]instanceof Node&&v(e[r],arguments[1],arguments[2],arguments[3]);else for(var s=0;s<o.length;s++)e[i?"addEventListener":"removeEventListener"](o[s],n,a)}function b(e,t,n,i){e&&v(e,t,n,!0,i)}function _(e,t,n,i){e&&v(e,t,n,!1,i)}function y(e,t,n,i){if(e&&t){K["boolean"](n)||(n=!1);var a=new CustomEvent(t,{bubbles:n,detail:i});e.dispatchEvent(a)}}function I(e,t){if(e)return t=K["boolean"](t)?t:!e.getAttribute("aria-pressed"),e.setAttribute("aria-pressed",t),t}function E(e,t){return 0===e||0===t||isNaN(e)||isNaN(t)?0:(e/t*100).toFixed(2)}function w(){var e=arguments;if(e.length){if(1===e.length)return e[0];for(var t=Array.prototype.shift.call(e),n=e.length,i=0;i<n;i++){var a=e[i];for(var o in a)a[o]&&a[o].constructor&&a[o].constructor===Object?(t[o]=t[o]||{},w(t[o],a[o])):t[o]=a[o]}return t}}function x(e){return e.match(/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/)?RegExp.$2:e}function k(e){return e.match(/^.*(vimeo.com\/|video\/)(\d+).*/)?RegExp.$2:e}function C(){var e={supportsFullScreen:!1,isFullScreen:function(){return!1},requestFullScreen:function(){},cancelFullScreen:function(){},fullScreenEventName:"",element:null,prefix:""},n="webkit o moz ms khtml".split(" ");if(K.undefined(t.cancelFullScreen))for(var i=0,a=n.length;i<a;i++){if(e.prefix=n[i],!K.undefined(t[e.prefix+"CancelFullScreen"])){e.supportsFullScreen=!0;break}if(!K.undefined(t.msExitFullscreen)&&t.msFullscreenEnabled){e.prefix="ms",e.supportsFullScreen=!0;break}}else e.supportsFullScreen=!0;return e.supportsFullScreen&&(e.fullScreenEventName="ms"===e.prefix?"MSFullscreenChange":e.prefix+"fullscreenchange",e.isFullScreen=function(e){switch(K.undefined(e)&&(e=t.body),this.prefix){case"":return t.fullscreenElement===e;case"moz":return t.mozFullScreenElement===e;default:return t[this.prefix+"FullscreenElement"]===e}},e.requestFullScreen=function(e){return K.undefined(e)&&(e=t.body),""===this.prefix?e.requestFullScreen():e[this.prefix+("ms"===this.prefix?"RequestFullscreen":"RequestFullScreen")]()},e.cancelFullScreen=function(){return""===this.prefix?t.cancelFullScreen():t[this.prefix+("ms"===this.prefix?"ExitFullscreen":"CancelFullScreen")]()},e.element=function(){return""===this.prefix?t.fullscreenElement:t[this.prefix+"FullscreenElement"]}),e}function S(v,S){function L(e,t,n,i){y(e,t,n,w({},i,{plyr:He}))}function O(t,n){S.debug&&e.console&&(n=Array.prototype.slice.call(n),K.string(S.logPrefix)&&S.logPrefix.length&&n.unshift(S.logPrefix),console[t].apply(console,n))}function F(){return{url:S.iconUrl,absolute:0===S.iconUrl.indexOf("http")||Ue.browser.isIE&&!e.svg4everybody}}function z(){var e=[],t=F(),n=(t.absolute?"":t.url)+"#"+S.iconPrefix;return o(S.controls,"play-large")&&e.push('<button type="button" data-plyr="play" class="plyr__play-large">','<svg><use xlink:href="'+n+'-play" /></svg>','<span class="plyr__sr-only">'+S.i18n.play+"</span>","</button>"),e.push('<div class="plyr__controls">'),o(S.controls,"restart")&&e.push('<button type="button" data-plyr="restart">','<svg><use xlink:href="'+n+'-restart" /></svg>','<span class="plyr__sr-only">'+S.i18n.restart+"</span>","</button>"),o(S.controls,"rewind")&&e.push('<button type="button" data-plyr="rewind">','<svg><use xlink:href="'+n+'-rewind" /></svg>','<span class="plyr__sr-only">'+S.i18n.rewind+"</span>","</button>"),o(S.controls,"play")&&e.push('<button type="button" data-plyr="play">','<svg><use xlink:href="'+n+'-play" /></svg>','<span class="plyr__sr-only">'+S.i18n.play+"</span>","</button>",'<button type="button" data-plyr="pause">','<svg><use xlink:href="'+n+'-pause" /></svg>','<span class="plyr__sr-only">'+S.i18n.pause+"</span>","</button>"),o(S.controls,"fast-forward")&&e.push('<button type="button" data-plyr="fast-forward">','<svg><use xlink:href="'+n+'-fast-forward" /></svg>','<span class="plyr__sr-only">'+S.i18n.forward+"</span>","</button>"),o(S.controls,"progress")&&(e.push('<span class="plyr__progress">','<label for="seek{id}" class="plyr__sr-only">Seek</label>','<input id="seek{id}" class="plyr__progress--seek" type="range" min="0" max="100" step="0.1" value="0" data-plyr="seek">','<progress class="plyr__progress--played" max="100" value="0" role="presentation"></progress>','<progress class="plyr__progress--buffer" max="100" value="0">',"<span>0</span>% "+S.i18n.buffered,"</progress>"),S.tooltips.seek&&e.push('<span class="plyr__tooltip">00:00</span>'),e.push("</span>")),o(S.controls,"current-time")&&e.push('<span class="plyr__time">','<span class="plyr__sr-only">'+S.i18n.currentTime+"</span>",'<span class="plyr__time--current">00:00</span>',"</span>"),o(S.controls,"duration")&&e.push('<span class="plyr__time">','<span class="plyr__sr-only">'+S.i18n.duration+"</span>",'<span class="plyr__time--duration">00:00</span>',"</span>"),o(S.controls,"mute")&&e.push('<button type="button" data-plyr="mute">','<svg class="icon--muted"><use xlink:href="'+n+'-muted" /></svg>','<svg><use xlink:href="'+n+'-volume" /></svg>','<span class="plyr__sr-only">'+S.i18n.toggleMute+"</span>","</button>"),o(S.controls,"volume")&&e.push('<span class="plyr__volume">','<label for="volume{id}" class="plyr__sr-only">'+S.i18n.volume+"</label>",'<input id="volume{id}" class="plyr__volume--input" type="range" min="'+S.volumeMin+'" max="'+S.volumeMax+'" value="'+S.volume+'" data-plyr="volume">','<progress class="plyr__volume--display" max="'+S.volumeMax+'" value="'+S.volumeMin+'" role="presentation"></progress>',"</span>"),o(S.controls,"captions")&&e.push('<button type="button" data-plyr="captions">','<svg class="icon--captions-on"><use xlink:href="'+n+'-captions-on" /></svg>','<svg><use xlink:href="'+n+'-captions-off" /></svg>','<span class="plyr__sr-only">'+S.i18n.toggleCaptions+"</span>","</button>"),o(S.controls,"fullscreen")&&e.push('<button type="button" data-plyr="fullscreen">','<svg class="icon--exit-fullscreen"><use xlink:href="'+n+'-exit-fullscreen" /></svg>','<svg><use xlink:href="'+n+'-enter-fullscreen" /></svg>','<span class="plyr__sr-only">'+S.i18n.toggleFullscreen+"</span>","</button>"),e.push("</div>"),e.join("")}function P(){if(Ue.supported.full&&("audio"!==Ue.type||S.fullscreen.allowAudio)&&S.fullscreen.enabled){var e=V.supportsFullScreen;e||S.fullscreen.fallback&&!W()?(We((e?"Native":"Fallback")+" fullscreen enabled"),e||h(Ue.container,S.classes.fullscreen.fallback,!0),h(Ue.container,S.classes.fullscreen.enabled,!0)):We("Fullscreen not supported and fallback disabled"),Ue.buttons&&Ue.buttons.fullscreen&&I(Ue.buttons.fullscreen,!1),q()}}function B(){if("video"===Ue.type){G(S.selectors.captions)||Ue.videoContainer.insertAdjacentHTML("afterbegin",'<div class="'+p(S.selectors.captions)+'"></div>'),Ue.usingTextTracks=!1,Ue.media.textTracks&&(Ue.usingTextTracks=!0);for(var e,t="",n=Ue.media.childNodes,i=0;i<n.length;i++)"track"===n[i].nodeName.toLowerCase()&&("captions"!==(e=n[i].kind)&&"subtitles"!==e||(t=n[i].getAttribute("src")));if(Ue.captionExists=!0,""===t?(Ue.captionExists=!1,We("No caption track found")):We("Caption track found; URI: "+t),Ue.captionExists){for(var a=Ue.media.textTracks,o=0;o<a.length;o++)a[o].mode="hidden";if(U(),(Ue.browser.isIE&&Ue.browser.version>=10||Ue.browser.isFirefox&&Ue.browser.version>=31)&&(We("Detected browser with known TextTrack issues - using manual fallback"),Ue.usingTextTracks=!1),Ue.usingTextTracks){We("TextTracks supported");for(var r=0;r<a.length;r++){var s=a[r];"captions"!==s.kind&&"subtitles"!==s.kind||b(s,"cuechange",function(){this.activeCues[0]&&"text"in this.activeCues[0]?R(this.activeCues[0].getCueAsHTML()):R()})}}else if(We("TextTracks not supported so rendering captions manually"),Ue.currentCaption="",Ue.captions=[],""!==t){var l=new XMLHttpRequest;l.onreadystatechange=function(){if(4===l.readyState)if(200===l.status){var e,t=[],n=l.responseText,i="\r\n";-1===n.indexOf(i+i)&&(i=-1!==n.indexOf("\r\r")?"\r":"\n"),t=n.split(i+i);for(var a=0;a<t.length;a++){e=t[a],Ue.captions[a]=[];var o=e.split(i),r=0;-1===o[r].indexOf(":")&&(r=1),Ue.captions[a]=[o[r],o[r+1]]}Ue.captions.shift(),We("Successfully loaded the caption file via AJAX")}else qe(S.logPrefix+"There was a problem loading the caption file via AJAX")},l.open("get",t,!0),l.send()}}else h(Ue.container,S.classes.captions.enabled)}}function R(e){var n=G(S.selectors.captions),i=t.createElement("span");n.innerHTML="",K.undefined(e)&&(e=""),K.string(e)?i.innerHTML=e.trim():i.appendChild(e),n.appendChild(i),n.offsetHeight}function H(e){function t(e,t){var n=[];n=e.split(" --> ");for(var a=0;a<n.length;a++)n[a]=n[a].replace(/(\d+:\d+:\d+\.\d+).*/,"$1");return i(n[t])}function n(e){return t(e,1)}function i(e){if(null===e||void 0===e)return 0;var t=[],n=[];return t=e.split(","),n=t[0].split(":"),Math.floor(60*n[0]*60)+Math.floor(60*n[1])+Math.floor(n[2])}if(!Ue.usingTextTracks&&"video"===Ue.type&&Ue.supported.full&&(Ue.subcount=0,e=K.number(e)?e:Ue.media.currentTime,Ue.captions[Ue.subcount])){for(;n(Ue.captions[Ue.subcount][0])<e.toFixed(1);)if(Ue.subcount++,Ue.subcount>Ue.captions.length-1){Ue.subcount=Ue.captions.length-1;break}Ue.media.currentTime.toFixed(1)>=function(e){return t(e,0)}(Ue.captions[Ue.subcount][0])&&Ue.media.currentTime.toFixed(1)<=n(Ue.captions[Ue.subcount][0])?(Ue.currentCaption=Ue.captions[Ue.subcount][1],R(Ue.currentCaption)):R()}}function U(){if(Ue.buttons.captions){h(Ue.container,S.classes.captions.enabled,!0);var e=Ue.storage.captionsEnabled;K["boolean"](e)||(e=S.captions.defaultActive),e&&(h(Ue.container,S.classes.captions.active,!0),I(Ue.buttons.captions,!0))}}function j(e){return Ue.container.querySelectorAll(e)}function G(e){return j(e)[0]}function W(){try{return e.self!==e.top}catch(e){return!0}}function q(){var e=j("input:not([disabled]), button:not([disabled])"),t=e[0],n=e[e.length-1];b(Ue.container,"keydown",function(e){9===e.which&&Ue.isFullscreen&&(e.target!==n||e.shiftKey?e.target===t&&e.shiftKey&&(e.preventDefault(),n.focus()):(e.preventDefault(),t.focus()))})}function Y(e,t){if(K.string(t))u(e,Ue.media,{src:t});else if(t.constructor===Array)for(var n=t.length-1;n>=0;n--)u(e,Ue.media,t[n])}function X(){if(S.loadSprite){var e=F();e.absolute?(We("AJAX loading absolute SVG sprite"+(Ue.browser.isIE?" (due to IE)":"")),T(e.url,"sprite-plyr")):We("Sprite will be used as external resource directly")}var n=S.html;We("Injecting custom controls"),n||(n=z()),n=r(n=r(n,"{seektime}",S.seekTime),"{id}",Math.floor(1e4*Math.random())),S.title&&(n=r(n,"{title}",S.title));var i;if(K.string(S.selectors.controls.container)&&(i=t.querySelector(S.selectors.controls.container)),K.htmlElement(i)||(i=Ue.container),i.insertAdjacentHTML("beforeend",n),S.tooltips.controls)for(var a=j([S.selectors.controls.wrapper," ",S.selectors.labels," .",S.classes.hidden].join("")),o=a.length-1;o>=0;o--){var s=a[o];h(s,S.classes.hidden,!1),h(s,S.classes.tooltip,!0)}}function J(){try{return Ue.controls=G(S.selectors.controls.wrapper),Ue.buttons={},Ue.buttons.seek=G(S.selectors.buttons.seek),Ue.buttons.play=j(S.selectors.buttons.play),Ue.buttons.pause=G(S.selectors.buttons.pause),Ue.buttons.restart=G(S.selectors.buttons.restart),Ue.buttons.rewind=G(S.selectors.buttons.rewind),Ue.buttons.forward=G(S.selectors.buttons.forward),Ue.buttons.fullscreen=G(S.selectors.buttons.fullscreen),Ue.buttons.mute=G(S.selectors.buttons.mute),Ue.buttons.captions=G(S.selectors.buttons.captions),Ue.progress={},Ue.progress.container=G(S.selectors.progress.container),Ue.progress.buffer={},Ue.progress.buffer.bar=G(S.selectors.progress.buffer),Ue.progress.buffer.text=Ue.progress.buffer.bar&&Ue.progress.buffer.bar.getElementsByTagName("span")[0],Ue.progress.played=G(S.selectors.progress.played),Ue.progress.tooltip=Ue.progress.container&&Ue.progress.container.querySelector("."+S.classes.tooltip),Ue.volume={},Ue.volume.input=G(S.selectors.volume.input),Ue.volume.display=G(S.selectors.volume.display),Ue.duration=G(S.selectors.duration),Ue.currentTime=G(S.selectors.currentTime),Ue.seekTime=j(S.selectors.seekTime),!0}catch(e){return qe("It looks like there is a problem with your controls HTML"),Q(!0),!1}}function Z(){h(Ue.container,S.selectors.container.replace(".",""),Ue.supported.full)}function Q(e){e&&o(S.types.html5,Ue.type)?Ue.media.setAttribute("controls",""):Ue.media.removeAttribute("controls")}function ee(e){var t=S.i18n.play;if(K.string(S.title)&&S.title.length&&(t+=", "+S.title,Ue.container.setAttribute("aria-label",S.title)),Ue.supported.full&&Ue.buttons.play)for(var n=Ue.buttons.play.length-1;n>=0;n--)Ue.buttons.play[n].setAttribute("aria-label",t);K.htmlElement(e)&&e.setAttribute("title",S.i18n.frameTitle.replace("{title}",S.title))}function te(){var t=null;Ue.storage={},D.supported&&S.storage.enabled&&(e.localStorage.removeItem("plyr-volume"),(t=e.localStorage.getItem(S.storage.key))&&(/^\d+(\.\d+)?$/.test(t)?ne({volume:parseFloat(t)}):Ue.storage=JSON.parse(t)))}function ne(t){D.supported&&S.storage.enabled&&(w(Ue.storage,t),e.localStorage.setItem(S.storage.key,JSON.stringify(Ue.storage)))}function ie(){if(Ue.media){if(Ue.supported.full&&(h(Ue.container,S.classes.type.replace("{0}",Ue.type),!0),o(S.types.embed,Ue.type)&&h(Ue.container,S.classes.type.replace("{0}","video"),!0),h(Ue.container,S.classes.stopped,S.autoplay),h(Ue.container,S.classes.isIos,Ue.browser.isIos),h(Ue.container,S.classes.isTouch,Ue.browser.isTouch),"video"===Ue.type)){var e=t.createElement("div");e.setAttribute("class",S.classes.videoWrapper),s(Ue.media,e),Ue.videoContainer=e}o(S.types.embed,Ue.type)&&ae()}else qe("No media element found!")}function ae(){var n,i=t.createElement("div"),o=Ue.type+"-"+Math.floor(1e4*Math.random());switch(Ue.type){case"youtube":n=x(Ue.embedId);break;case"vimeo":n=k(Ue.embedId);break;default:n=Ue.embedId}for(var r=j('[id^="'+Ue.type+'-"]'),s=r.length-1;s>=0;s--)l(r[s]);if(h(Ue.media,S.classes.videoWrapper,!0),h(Ue.media,S.classes.embedWrapper,!0),"youtube"===Ue.type)Ue.media.appendChild(i),i.setAttribute("id",o),K.object(e.YT)?re(n,i):(a(S.urls.youtube.api),e.onYouTubeReadyCallbacks=e.onYouTubeReadyCallbacks||[],e.onYouTubeReadyCallbacks.push(function(){re(n,i)}),e.onYouTubeIframeAPIReady=function(){e.onYouTubeReadyCallbacks.forEach(function(e){e()})});else if("vimeo"===Ue.type)if(Ue.supported.full?Ue.media.appendChild(i):i=Ue.media,i.setAttribute("id",o),K.object(e.Vimeo))se(n,i);else{a(S.urls.vimeo.api);var c=e.setInterval(function(){K.object(e.Vimeo)&&(e.clearInterval(c),se(n,i))},50)}else if("soundcloud"===Ue.type){var u=t.createElement("iframe");u.loaded=!1,b(u,"load",function(){u.loaded=!0}),d(u,{src:"https://w.soundcloud.com/player/?url=https://api.soundcloud.com/tracks/"+n,id:o}),i.appendChild(u),Ue.media.appendChild(i),e.SC||a(S.urls.soundcloud.api);var p=e.setInterval(function(){e.SC&&u.loaded&&(e.clearInterval(p),le.call(u))},50)}}function oe(){Ue.supported.full&&(Be(),Re()),ee(G("iframe"))}function re(t,n){Ue.embed=new e.YT.Player(n.id,{videoId:t,playerVars:{autoplay:S.autoplay?1:0,controls:Ue.supported.full?0:1,rel:0,showinfo:0,iv_load_policy:3,cc_load_policy:S.captions.defaultActive?1:0,cc_lang_pref:"en",wmode:"transparent",modestbranding:1,disablekb:1,origin:"*"},events:{onError:function(e){L(Ue.container,"error",!0,{code:e.data,embed:e.target})},onReady:function(t){var n=t.target;Ue.media.play=function(){n.playVideo(),Ue.media.paused=!1},Ue.media.pause=function(){n.pauseVideo(),Ue.media.paused=!0},Ue.media.stop=function(){n.stopVideo(),Ue.media.paused=!0},Ue.media.duration=n.getDuration(),Ue.media.paused=!0,Ue.media.currentTime=0,Ue.media.muted=n.isMuted(),"function"==typeof n.getVideoData&&(S.title=n.getVideoData().title),Ue.supported.full&&Ue.media.querySelector("iframe").setAttribute("tabindex","-1"),oe(),L(Ue.media,"timeupdate"),L(Ue.media,"durationchange"),e.clearInterval(je.buffering),je.buffering=e.setInterval(function(){Ue.media.buffered=n.getVideoLoadedFraction(),(null===Ue.media.lastBuffered||Ue.media.lastBuffered<Ue.media.buffered)&&L(Ue.media,"progress"),Ue.media.lastBuffered=Ue.media.buffered,1===Ue.media.buffered&&(e.clearInterval(je.buffering),L(Ue.media,"canplaythrough"))},200)},onStateChange:function(t){var n=t.target;switch(e.clearInterval(je.playing),t.data){case 0:Ue.media.paused=!0,L(Ue.media,"ended");break;case 1:Ue.media.paused=!1,Ue.media.seeking&&L(Ue.media,"seeked"),Ue.media.seeking=!1,L(Ue.media,"play"),L(Ue.media,"playing"),je.playing=e.setInterval(function(){Ue.media.currentTime=n.getCurrentTime(),L(Ue.media,"timeupdate")},100),Ue.media.duration!==n.getDuration()&&(Ue.media.duration=n.getDuration(),L(Ue.media,"durationchange"));break;case 2:Ue.media.paused=!0,L(Ue.media,"pause")}L(Ue.container,"statechange",!1,{code:t.data})}}})}function se(n,i){var a=function(e){return Object.keys(e).map(function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])}).join("&")}({loop:S.loop,autoplay:S.autoplay,byline:!1,portrait:!1,title:!1,speed:!0,transparent:0}),o=t.createElement("iframe"),r="https://player.vimeo.com/video/"+n+"?"+a;o.setAttribute("src",r),o.setAttribute("allowfullscreen",""),i.appendChild(o),Ue.embed=new e.Vimeo.Player(o),Ue.media.play=function(){Ue.embed.play(),Ue.media.paused=!1},Ue.media.pause=function(){Ue.embed.pause(),Ue.media.paused=!0},Ue.media.stop=function(){Ue.embed.stop(),Ue.media.paused=!0},Ue.media.paused=!0,Ue.media.currentTime=0,oe(),Ue.embed.getCurrentTime().then(function(e){Ue.media.currentTime=e,L(Ue.media,"timeupdate")}),Ue.embed.getDuration().then(function(e){Ue.media.duration=e,L(Ue.media,"durationchange")}),Ue.embed.on("loaded",function(){K.htmlElement(Ue.embed.element)&&Ue.supported.full&&Ue.embed.element.setAttribute("tabindex","-1")}),Ue.embed.on("play",function(){Ue.media.paused=!1,L(Ue.media,"play"),L(Ue.media,"playing")}),Ue.embed.on("pause",function(){Ue.media.paused=!0,L(Ue.media,"pause")}),Ue.embed.on("timeupdate",function(e){Ue.media.seeking=!1,Ue.media.currentTime=e.seconds,L(Ue.media,"timeupdate")}),Ue.embed.on("progress",function(e){Ue.media.buffered=e.percent,L(Ue.media,"progress"),1===parseInt(e.percent)&&L(Ue.media,"canplaythrough")}),Ue.embed.on("seeked",function(){Ue.media.seeking=!1,L(Ue.media,"seeked"),L(Ue.media,"play")}),Ue.embed.on("ended",function(){Ue.media.paused=!0,L(Ue.media,"ended")})}function le(){Ue.embed=e.SC.Widget(this),Ue.embed.bind(e.SC.Widget.Events.READY,function(){Ue.media.play=function(){Ue.embed.play(),Ue.media.paused=!1},Ue.media.pause=function(){Ue.embed.pause(),Ue.media.paused=!0},Ue.media.stop=function(){Ue.embed.seekTo(0),Ue.embed.pause(),Ue.media.paused=!0},Ue.media.paused=!0,Ue.media.currentTime=0,Ue.embed.getDuration(function(e){Ue.media.duration=e/1e3,oe()}),Ue.embed.getPosition(function(e){Ue.media.currentTime=e,L(Ue.media,"timeupdate")}),Ue.embed.bind(e.SC.Widget.Events.PLAY,function(){Ue.media.paused=!1,L(Ue.media,"play"),L(Ue.media,"playing")}),Ue.embed.bind(e.SC.Widget.Events.PAUSE,function(){Ue.media.paused=!0,L(Ue.media,"pause")}),Ue.embed.bind(e.SC.Widget.Events.PLAY_PROGRESS,function(e){Ue.media.seeking=!1,Ue.media.currentTime=e.currentPosition/1e3,L(Ue.media,"timeupdate")}),Ue.embed.bind(e.SC.Widget.Events.LOAD_PROGRESS,function(e){Ue.media.buffered=e.loadProgress,L(Ue.media,"progress"),1===parseInt(e.loadProgress)&&L(Ue.media,"canplaythrough")}),Ue.embed.bind(e.SC.Widget.Events.FINISH,function(){Ue.media.paused=!0,L(Ue.media,"ended")})})}function ce(){"play"in Ue.media&&Ue.media.play()}function de(){"pause"in Ue.media&&Ue.media.pause()}function ue(e){return K["boolean"](e)||(e=Ue.media.paused),e?ce():de(),e}function pe(e){K.number(e)||(e=S.seekTime),me(Ue.media.currentTime-e)}function he(e){K.number(e)||(e=S.seekTime),me(Ue.media.currentTime+e)}function me(e){var t=0,n=Ue.media.paused,i=fe();K.number(e)?t=e:K.object(e)&&o(["input","change"],e.type)&&(t=e.target.value/e.target.max*i),t<0?t=0:t>i&&(t=i),Ae(t);try{Ue.media.currentTime=t.toFixed(4)}catch(e){}if(o(S.types.embed,Ue.type)){switch(Ue.type){case"youtube":Ue.embed.seekTo(t);break;case"vimeo":Ue.embed.setCurrentTime(t.toFixed(0));break;case"soundcloud":Ue.embed.seekTo(1e3*t)}n&&de(),L(Ue.media,"timeupdate"),Ue.media.seeking=!0,L(Ue.media,"seeking")}We("Seeking to "+Ue.media.currentTime+" seconds"),H(t)}function fe(){var e=parseInt(S.duration),t=0;return null===Ue.media.duration||isNaN(Ue.media.duration)||(t=Ue.media.duration),isNaN(e)?t:e}function ge(){h(Ue.container,S.classes.playing,!Ue.media.paused),h(Ue.container,S.classes.stopped,Ue.media.paused),Ke(Ue.media.paused)}function ve(){A={x:e.pageXOffset||0,y:e.pageYOffset||0}}function be(){e.scrollTo(A.x,A.y)}function _e(e){var n=V.supportsFullScreen;if(n){if(!e||e.type!==V.fullScreenEventName)return V.isFullScreen(Ue.container)?V.cancelFullScreen():(ve(),V.requestFullScreen(Ue.container)),void(Ue.isFullscreen=V.isFullScreen(Ue.container));Ue.isFullscreen=V.isFullScreen(Ue.container)}else Ue.isFullscreen=!Ue.isFullscreen,t.body.style.overflow=Ue.isFullscreen?"hidden":"";h(Ue.container,S.classes.fullscreen.active,Ue.isFullscreen),q(Ue.isFullscreen),Ue.buttons&&Ue.buttons.fullscreen&&I(Ue.buttons.fullscreen,Ue.isFullscreen),L(Ue.container,Ue.isFullscreen?"enterfullscreen":"exitfullscreen",!0),!Ue.isFullscreen&&n&&be()}function ye(e){if(K["boolean"](e)||(e=!Ue.media.muted),I(Ue.buttons.mute,e),Ue.media.muted=e,0===Ue.media.volume&&Ie(S.volume),o(S.types.embed,Ue.type)){switch(Ue.type){case"youtube":Ue.embed[Ue.media.muted?"mute":"unMute"]();break;case"vimeo":case"soundcloud":Ue.embed.setVolume(Ue.media.muted?0:parseFloat(S.volume/S.volumeMax))}L(Ue.media,"volumechange")}}function Ie(e){var t=S.volumeMax,n=S.volumeMin;if(K.undefined(e)&&(e=Ue.storage.volume),(null===e||isNaN(e))&&(e=S.volume),e>t&&(e=t),e<n&&(e=n),Ue.media.volume=parseFloat(e/t),Ue.volume.display&&(Ue.volume.display.value=e),o(S.types.embed,Ue.type)){switch(Ue.type){case"youtube":Ue.embed.setVolume(100*Ue.media.volume);break;case"vimeo":case"soundcloud":Ue.embed.setVolume(Ue.media.volume)}L(Ue.media,"volumechange")}0===e?Ue.media.muted=!0:Ue.media.muted&&e>0&&ye()}function Ee(e){var t=Ue.media.muted?0:Ue.media.volume*S.volumeMax;K.number(e)||(e=S.volumeStep),Ie(t+e)}function we(e){var t=Ue.media.muted?0:Ue.media.volume*S.volumeMax;K.number(e)||(e=S.volumeStep),Ie(t-e)}function xe(){var e=Ue.media.muted?0:Ue.media.volume*S.volumeMax;Ue.supported.full&&(Ue.volume.input&&(Ue.volume.input.value=e),Ue.volume.display&&(Ue.volume.display.value=e)),ne({volume:e}),h(Ue.container,S.classes.muted,0===e),Ue.supported.full&&Ue.buttons.mute&&I(Ue.buttons.mute,0===e)}function ke(e){Ue.supported.full&&Ue.buttons.captions&&(K["boolean"](e)||(e=-1===Ue.container.className.indexOf(S.classes.captions.active)),Ue.captionsEnabled=e,I(Ue.buttons.captions,Ue.captionsEnabled),h(Ue.container,S.classes.captions.active,Ue.captionsEnabled),L(Ue.container,Ue.captionsEnabled?"captionsenabled":"captionsdisabled",!0),ne({captionsEnabled:Ue.captionsEnabled}))}function Ce(e){var t="waiting"===e.type;clearTimeout(je.loading),je.loading=setTimeout(function(){h(Ue.container,S.classes.loading,t),Ke(t)},t?250:0)}function Se(e){if(Ue.supported.full){var t=Ue.progress.played,n=0,i=fe();if(e)switch(e.type){case"timeupdate":case"seeking":if(Ue.controls.pressed)return;n=E(Ue.media.currentTime,i),"timeupdate"===e.type&&Ue.buttons.seek&&(Ue.buttons.seek.value=n);break;case"playing":case"progress":t=Ue.progress.buffer,n=function(){var e=Ue.media.buffered;return e&&e.length?E(e.end(0),i):K.number(e)?100*e:0}()}Te(t,n)}}function Te(e,t){if(Ue.supported.full){if(K.undefined(t)&&(t=0),K.undefined(e)){if(!Ue.progress||!Ue.progress.buffer)return;e=Ue.progress.buffer}K.htmlElement(e)?e.value=t:e&&(e.bar&&(e.bar.value=t),e.text&&(e.text.innerHTML=t))}}function Ne(e,t){if(t){isNaN(e)&&(e=0),Ue.secs=parseInt(e%60),Ue.mins=parseInt(e/60%60),Ue.hours=parseInt(e/60/60%60);var n=parseInt(fe()/60/60%60)>0;Ue.secs=("0"+Ue.secs).slice(-2),Ue.mins=("0"+Ue.mins).slice(-2),t.innerHTML=(n?Ue.hours+":":"")+Ue.mins+":"+Ue.secs}}function $e(){if(Ue.supported.full){var e=fe()||0;!Ue.duration&&S.displayDuration&&Ue.media.paused&&Ne(e,Ue.currentTime),Ue.duration&&Ne(e,Ue.duration),Me()}}function Ve(e){Ne(Ue.media.currentTime,Ue.currentTime),e&&"timeupdate"===e.type&&Ue.media.seeking||Se(e)}function Ae(e){K.number(e)||(e=0);var t=E(e,fe());Ue.progress&&Ue.progress.played&&(Ue.progress.played.value=t),Ue.buttons&&Ue.buttons.seek&&(Ue.buttons.seek.value=t)}function Me(e){var t=fe();if(S.tooltips.seek&&Ue.progress.container&&0!==t){var n=Ue.progress.container.getBoundingClientRect(),i=0,a=S.classes.tooltip+"--visible";if(e)i=100/n.width*(e.pageX-n.left);else{if(!m(Ue.progress.tooltip,a))return;i=Ue.progress.tooltip.style.left.replace("%","")}i<0?i=0:i>100&&(i=100),Ne(t/100*i,Ue.progress.tooltip),Ue.progress.tooltip.style.left=i+"%",e&&o(["mouseenter","mouseleave"],e.type)&&h(Ue.progress.tooltip,a,"mouseenter"===e.type)}}function Ke(t){if(S.hideControls&&"audio"!==Ue.type){var n=0,i=!1,a=t,r=m(Ue.container,S.classes.loading);if(K["boolean"](t)||(t&&t.type?(i="enterfullscreen"===t.type,a=o(["mousemove","touchstart","mouseenter","focus"],t.type),o(["mousemove","touchmove"],t.type)&&(n=2e3),"focus"===t.type&&(n=3e3)):a=m(Ue.container,S.classes.hideControls)),e.clearTimeout(je.hover),a||Ue.media.paused||r){if(h(Ue.container,S.classes.hideControls,!1),Ue.media.paused||r)return;Ue.browser.isTouch&&(n=3e3)}a&&Ue.media.paused||(je.hover=e.setTimeout(function(){(!Ue.controls.pressed&&!Ue.controls.hover||i)&&h(Ue.container,S.classes.hideControls,!0)},n))}}function De(e){K.object(e)&&"sources"in e&&e.sources.length?(h(Ue.container,S.classes.ready,!1),de(),Ae(),Te(),ze(),Pe(function(){if(Ue.embed=null,l(Ue.media),"video"===Ue.type&&Ue.videoContainer&&l(Ue.videoContainer),Ue.container&&Ue.container.removeAttribute("class"),"type"in e&&(Ue.type=e.type,"video"===Ue.type)){var n=e.sources[0];"type"in n&&o(S.types.embed,n.type)&&(Ue.type=n.type)}switch(Ue.supported=N(Ue.type),Ue.type){case"video":Ue.media=t.createElement("video");break;case"audio":Ue.media=t.createElement("audio");
break;case"youtube":case"vimeo":case"soundcloud":Ue.media=t.createElement("div"),Ue.embedId=e.sources[0].src}c(Ue.container,Ue.media),K["boolean"](e.autoplay)&&(S.autoplay=e.autoplay),o(S.types.html5,Ue.type)&&(S.crossorigin&&Ue.media.setAttribute("crossorigin",""),S.autoplay&&Ue.media.setAttribute("autoplay",""),"poster"in e&&Ue.media.setAttribute("poster",e.poster),S.loop&&Ue.media.setAttribute("loop","")),h(Ue.container,S.classes.fullscreen.active,Ue.isFullscreen),h(Ue.container,S.classes.captions.active,Ue.captionsEnabled),Z(),o(S.types.html5,Ue.type)&&Y("source",e.sources),ie(),o(S.types.html5,Ue.type)&&("tracks"in e&&Y("track",e.tracks),Ue.media.load()),(o(S.types.html5,Ue.type)||o(S.types.embed,Ue.type)&&!Ue.supported.full)&&(Be(),Re()),S.title=e.title,ee()},!1)):qe("Invalid source format")}function Le(){h(G("."+S.classes.tabFocus),S.classes.tabFocus,!1)}function Oe(){function n(){var e=ue(),t=Ue.buttons[e?"play":"pause"],n=Ue.buttons[e?"pause":"play"];if(n&&(n=n.length>1?n[n.length-1]:n[0]),n){var i=m(t,S.classes.tabFocus);setTimeout(function(){n.focus(),i&&(h(t,S.classes.tabFocus,!1),h(n,S.classes.tabFocus,!0))},100)}}function i(){var e=t.activeElement;return e=e&&e!==t.body?t.querySelector(":focus"):null}function a(e){return e.keyCode?e.keyCode:e.which}function r(e){for(var t in Ue.buttons){var n=Ue.buttons[t];if(K.nodeList(n))for(var i=0;i<n.length;i++)h(n[i],S.classes.tabFocus,n[i]===e);else h(n,S.classes.tabFocus,n===e)}}function s(e){var t=a(e),n="keydown"===e.type,i=n&&t===c;if(K.number(t))if(n){switch(o([48,49,50,51,52,53,54,56,57,32,75,38,40,77,39,37,70,67],t)&&(e.preventDefault(),e.stopPropagation()),t){case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:i||function(){var e=Ue.media.duration;K.number(e)&&me(e/10*(t-48))}();break;case 32:case 75:i||ue();break;case 38:Ee();break;case 40:we();break;case 77:i||ye();break;case 39:he();break;case 37:pe();break;case 70:_e();break;case 67:i||ke()}!V.supportsFullScreen&&Ue.isFullscreen&&27===t&&_e(),c=t}else c=null}var l=Ue.browser.isIE?"change":"input";if(S.keyboardShorcuts.focused){var c=null;S.keyboardShorcuts.global&&b(e,"keydown keyup",function(e){var t=a(e),n=i();1!==$().length||!o([48,49,50,51,52,53,54,56,57,75,77,70,67],t)||K.htmlElement(n)&&f(n,S.selectors.editable)||s(e)}),b(Ue.container,"keydown keyup",s)}b(e,"keyup",function(e){var t=a(e),n=i();9===t&&r(n)}),b(t.body,"click",Le);for(var d in Ue.buttons){var u=Ue.buttons[d];b(u,"blur",function(){h(u,"tab-focus",!1)})}g(Ue.buttons.play,"click",S.listeners.play,n),g(Ue.buttons.pause,"click",S.listeners.pause,n),g(Ue.buttons.restart,"click",S.listeners.restart,me),g(Ue.buttons.rewind,"click",S.listeners.rewind,pe),g(Ue.buttons.forward,"click",S.listeners.forward,he),g(Ue.buttons.seek,l,S.listeners.seek,me),g(Ue.volume.input,l,S.listeners.volume,function(){Ie(Ue.volume.input.value)}),g(Ue.buttons.mute,"click",S.listeners.mute,ye),g(Ue.buttons.fullscreen,"click",S.listeners.fullscreen,_e),V.supportsFullScreen&&b(t,V.fullScreenEventName,_e),g(Ue.buttons.captions,"click",S.listeners.captions,ke),b(Ue.progress.container,"mouseenter mouseleave mousemove",Me),S.hideControls&&(b(Ue.container,"mouseenter mouseleave mousemove touchstart touchend touchcancel touchmove enterfullscreen",Ke),b(Ue.controls,"mouseenter mouseleave",function(e){Ue.controls.hover="mouseenter"===e.type}),b(Ue.controls,"mousedown mouseup touchstart touchend touchcancel",function(e){Ue.controls.pressed=o(["mousedown","touchstart"],e.type)}),b(Ue.controls,"focus blur",Ke,!0)),b(Ue.volume.input,"wheel",function(e){e.preventDefault();var t=e.webkitDirectionInvertedFromDevice,n=S.volumeStep/5;(e.deltaY<0||e.deltaX>0)&&(t?we(n):Ee(n)),(e.deltaY>0||e.deltaX<0)&&(t?Ee(n):we(n))})}function Fe(){if(b(Ue.media,"timeupdate seeking",Ve),b(Ue.media,"timeupdate",H),b(Ue.media,"durationchange loadedmetadata",$e),b(Ue.media,"ended",function(){"video"===Ue.type&&S.showPosterOnEnd&&("video"===Ue.type&&R(),me(),Ue.media.load())}),b(Ue.media,"progress playing",Se),b(Ue.media,"volumechange",xe),b(Ue.media,"play pause ended",ge),b(Ue.media,"waiting canplay seeked",Ce),S.clickToPlay&&"audio"!==Ue.type){var e=G("."+S.classes.videoWrapper);if(!e)return;e.style.cursor="pointer",b(e,"click",function(){S.hideControls&&Ue.browser.isTouch&&!Ue.media.paused||(Ue.media.paused?ce():Ue.media.ended?(me(),ce()):de())})}S.disableContextMenu&&b(Ue.media,"contextmenu",function(e){e.preventDefault()}),b(Ue.media,S.events.concat(["keyup","keydown"]).join(" "),function(e){L(Ue.container,e.type,!0)})}function ze(){if(o(S.types.html5,Ue.type)){for(var e=Ue.media.querySelectorAll("source"),t=0;t<e.length;t++)l(e[t]);Ue.media.setAttribute("src",S.blankUrl),Ue.media.load(),We("Cancelled network requests")}}function Pe(n,i){function a(){clearTimeout(je.cleanUp),K["boolean"](i)||(i=!0),K["function"](n)&&n.call(Ge),i&&(Ue.init=!1,Ue.container.parentNode.replaceChild(Ge,Ue.container),Ue.container=null,t.body.style.overflow="",_(t.body,"click",Le),L(Ge,"destroyed",!0))}if(!Ue.init)return null;switch(Ue.type){case"youtube":e.clearInterval(je.buffering),e.clearInterval(je.playing),Ue.embed.destroy(),a();break;case"vimeo":Ue.embed.unload().then(a),je.cleanUp=e.setTimeout(a,200);break;case"video":case"audio":Q(!0),a()}}function Be(){if(!Ue.supported.full)return qe("Basic support only",Ue.type),l(G(S.selectors.controls.wrapper)),l(G(S.selectors.buttons.play)),void Q(!0);var e=!j(S.selectors.controls.wrapper).length;e&&X(),J()&&(e&&Oe(),Fe(),Q(),P(),B(),Ie(),xe(),Ve(),ge(),$e())}function Re(){e.setTimeout(function(){L(Ue.media,"ready")},0),h(Ue.media,M.classes.setup,!0),h(Ue.container,S.classes.ready,!0),Ue.media.plyr=He,S.autoplay&&ce()}var He,Ue=this,je={};Ue.media=v;var Ge=v.cloneNode(!0),We=function(){O("log",arguments)},qe=function(){O("warn",arguments)};return We("Config",S),He={getOriginal:function(){return Ge},getContainer:function(){return Ue.container},getEmbed:function(){return Ue.embed},getMedia:function(){return Ue.media},getType:function(){return Ue.type},getDuration:fe,getCurrentTime:function(){return Ue.media.currentTime},getVolume:function(){return Ue.media.volume},isMuted:function(){return Ue.media.muted},isReady:function(){return m(Ue.container,S.classes.ready)},isLoading:function(){return m(Ue.container,S.classes.loading)},isPaused:function(){return Ue.media.paused},on:function(e,t){return b(Ue.container,e,t),this},play:ce,pause:de,stop:function(){de(),me()},restart:me,rewind:pe,forward:he,seek:me,source:function(e){if(K.undefined(e)){var t;switch(Ue.type){case"youtube":t=Ue.embed.getVideoUrl();break;case"vimeo":Ue.embed.getVideoUrl.then(function(e){t=e});break;case"soundcloud":Ue.embed.getCurrentSound(function(e){t=e.permalink_url});break;default:t=Ue.media.currentSrc}return t||""}De(e)},poster:function(e){"video"===Ue.type&&Ue.media.setAttribute("poster",e)},setVolume:Ie,togglePlay:ue,toggleMute:ye,toggleCaptions:ke,toggleFullscreen:_e,toggleControls:Ke,isFullscreen:function(){return Ue.isFullscreen||!1},support:function(e){return i(Ue,e)},destroy:Pe},function(){if(Ue.init)return null;if(V=C(),Ue.browser=n(),K.htmlElement(Ue.media)){te();var e=v.tagName.toLowerCase();"div"===e?(Ue.type=v.getAttribute("data-type"),Ue.embedId=v.getAttribute("data-video-id"),v.removeAttribute("data-type"),v.removeAttribute("data-video-id")):(Ue.type=e,S.crossorigin=null!==v.getAttribute("crossorigin"),S.autoplay=S.autoplay||null!==v.getAttribute("autoplay"),S.loop=S.loop||null!==v.getAttribute("loop")),Ue.supported=N(Ue.type),Ue.supported.basic&&(Ue.container=s(v,t.createElement("div")),Ue.container.setAttribute("tabindex",0),Z(),We(Ue.browser.name+" "+Ue.browser.version),ie(),(o(S.types.html5,Ue.type)||o(S.types.embed,Ue.type)&&!Ue.supported.full)&&(Be(),Re(),ee()),Ue.init=!0)}}(),Ue.init?He:null}function T(e,n){var i=new XMLHttpRequest;if(!K.string(n)||!K.htmlElement(t.querySelector("#"+n))){var a=t.createElement("div");a.setAttribute("hidden",""),K.string(n)&&a.setAttribute("id",n),t.body.insertBefore(a,t.body.childNodes[0]),"withCredentials"in i&&(i.open("GET",e,!0),i.onload=function(){a.innerHTML=i.responseText},i.send())}}function N(e){var i=n(),a=i.isIE&&i.version<=9,o=i.isIos,r=i.isIphone,s=!!t.createElement("audio").canPlayType,l=!!t.createElement("video").canPlayType,c=!1,d=!1;switch(e){case"video":d=(c=l)&&!a&&!r;break;case"audio":d=(c=s)&&!a;break;case"vimeo":c=!0,d=!a&&!o;break;case"youtube":c=!0,d=!a&&!o,o&&!r&&i.version>=10&&(d=!0);break;case"soundcloud":c=!0,d=!a&&!r;break;default:d=(c=s&&l)&&!a}return{basic:c,full:d}}function $(e){if(K.string(e)?e=t.querySelector(e):K.undefined(e)&&(e=t.body),K.htmlElement(e)){var n=e.querySelectorAll("."+M.classes.setup),i=[];return Array.prototype.slice.call(n).forEach(function(e){K.object(e.plyr)&&i.push(e.plyr)}),i}return[]}var V,A={x:0,y:0},M={enabled:!0,debug:!1,autoplay:!1,loop:!1,seekTime:10,volume:10,volumeMin:0,volumeMax:10,volumeStep:1,duration:null,displayDuration:!0,loadSprite:!0,iconPrefix:"plyr",iconUrl:"https://cdn.plyr.io/2.0.17/plyr.svg",blankUrl:"https://cdn.plyr.io/static/blank.mp4",clickToPlay:!0,hideControls:!0,showPosterOnEnd:!1,disableContextMenu:!0,keyboardShorcuts:{focused:!0,global:!1},tooltips:{controls:!1,seek:!0},selectors:{html5:"video, audio",embed:"[data-type]",editable:"input, textarea, select, [contenteditable]",container:".plyr",controls:{container:null,wrapper:".plyr__controls"},labels:"[data-plyr]",buttons:{seek:'[data-plyr="seek"]',play:'[data-plyr="play"]',pause:'[data-plyr="pause"]',restart:'[data-plyr="restart"]',rewind:'[data-plyr="rewind"]',forward:'[data-plyr="fast-forward"]',mute:'[data-plyr="mute"]',captions:'[data-plyr="captions"]',fullscreen:'[data-plyr="fullscreen"]'},volume:{input:'[data-plyr="volume"]',display:".plyr__volume--display"},progress:{container:".plyr__progress",buffer:".plyr__progress--buffer",played:".plyr__progress--played"},captions:".plyr__captions",currentTime:".plyr__time--current",duration:".plyr__time--duration"},classes:{setup:"plyr--setup",ready:"plyr--ready",videoWrapper:"plyr__video-wrapper",embedWrapper:"plyr__video-embed",type:"plyr--{0}",stopped:"plyr--stopped",playing:"plyr--playing",muted:"plyr--muted",loading:"plyr--loading",hover:"plyr--hover",tooltip:"plyr__tooltip",hidden:"plyr__sr-only",hideControls:"plyr--hide-controls",isIos:"plyr--is-ios",isTouch:"plyr--is-touch",captions:{enabled:"plyr--captions-enabled",active:"plyr--captions-active"},fullscreen:{enabled:"plyr--fullscreen-enabled",fallback:"plyr--fullscreen-fallback",active:"plyr--fullscreen-active"},tabFocus:"tab-focus"},captions:{defaultActive:!1},fullscreen:{enabled:!0,fallback:!0,allowAudio:!1},storage:{enabled:!0,key:"plyr"},controls:["play-large","play","progress","current-time","mute","volume","captions","fullscreen"],i18n:{restart:"Restart",rewind:"Rewind {seektime} secs",play:"Play",pause:"Pause",forward:"Forward {seektime} secs",played:"played",buffered:"buffered",currentTime:"Current time",duration:"Duration",volume:"Volume",toggleMute:"Toggle Mute",toggleCaptions:"Toggle Captions",toggleFullscreen:"Toggle Fullscreen",frameTitle:"Player for {title}"},types:{embed:["youtube","vimeo","soundcloud"],html5:["video","audio"]},urls:{vimeo:{api:"https://player.vimeo.com/api/player.js"},youtube:{api:"https://www.youtube.com/iframe_api"},soundcloud:{api:"https://w.soundcloud.com/player/api.js"}},listeners:{seek:null,play:null,pause:null,restart:null,rewind:null,forward:null,mute:null,volume:null,captions:null,fullscreen:null},events:["ready","ended","progress","stalled","playing","waiting","canplay","canplaythrough","loadstart","loadeddata","loadedmetadata","timeupdate","volumechange","play","pause","error","seeking","seeked","emptied"],logPrefix:"[Plyr]"},K={object:function(e){return null!==e&&"object"==typeof e},array:function(e){return null!==e&&"object"==typeof e&&e.constructor===Array},number:function(e){return null!==e&&("number"==typeof e&&!isNaN(e-0)||"object"==typeof e&&e.constructor===Number)},string:function(e){return null!==e&&("string"==typeof e||"object"==typeof e&&e.constructor===String)},"boolean":function(e){return null!==e&&"boolean"==typeof e},nodeList:function(e){return null!==e&&e instanceof NodeList},htmlElement:function(e){return null!==e&&e instanceof HTMLElement},"function":function(e){return null!==e&&"function"==typeof e},undefined:function(e){return null!==e&&void 0===e}},D={supported:function(){try{t.localStorage.setItem("___test","OK");var e=t.localStorage.getItem("___test");return t.localStorage.removeItem("___test"),"OK"===e}catch(t){return!1}return!1}()};return{setup:function(e,n){function i(e,t){m(t,M.classes.hook)||a.push({target:e,media:t})}var a=[],o=[],r=[M.selectors.html5,M.selectors.embed].join(",");if(K.string(e)?e=t.querySelectorAll(e):K.htmlElement(e)?e=[e]:K.nodeList(e)||K.array(e)||K.string(e)||(K.undefined(n)&&K.object(e)&&(n=e),e=t.querySelectorAll(r)),K.nodeList(e)&&(e=Array.prototype.slice.call(e)),!N().basic||!e.length)return!1;for(var s=0;s<e.length;s++){var l=e[s],c=l.querySelectorAll(r);if(c.length)for(var d=0;d<c.length;d++)i(l,c[d]);else f(l,r)&&i(l,l)}return a.forEach(function(e){var t=e.target,i=e.media,a={};try{a=JSON.parse(t.getAttribute("data-plyr"))}catch(e){}var r=w({},M,n,a);if(!r.enabled)return null;var s=new S(i,r);if(K.object(s)){if(r.debug){var l=r.events.concat(["setup","statechange","enterfullscreen","exitfullscreen","captionsenabled","captionsdisabled"]);b(s.getContainer(),l.join(" "),function(e){console.log([r.logPrefix,"event:",e.type].join(" "),e.detail.plyr)})}y(s.getContainer(),"setup",!0,{plyr:s}),o.push(s)}}),o},supported:N,loadSprite:T,get:$}}),function(){function e(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var n=document.createEvent("CustomEvent");return n.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),n}"function"!=typeof window.CustomEvent&&(e.prototype=window.Event.prototype,window.CustomEvent=e)}()},{}],3:[function(e,t,n){!function(){function e(t,i){if(t=t?t:"",i=i||{},t instanceof e)return t;if(!(this instanceof e))return new e(t,i);var a=n(t);this._originalInput=t,this._r=a.r,this._g=a.g,this._b=a.b,this._a=a.a,this._roundA=P(100*this._a)/100,this._format=i.format||a.format,this._gradientType=i.gradientType,this._r<1&&(this._r=P(this._r)),this._g<1&&(this._g=P(this._g)),this._b<1&&(this._b=P(this._b)),this._ok=a.ok,this._tc_id=F++}function n(e){var t={r:0,g:0,b:0},n=1,a=!1,r=!1;return"string"==typeof e&&(e=K(e)),"object"==typeof e&&(e.hasOwnProperty("r")&&e.hasOwnProperty("g")&&e.hasOwnProperty("b")?(t=i(e.r,e.g,e.b),a=!0,r="%"===String(e.r).substr(-1)?"prgb":"rgb"):e.hasOwnProperty("h")&&e.hasOwnProperty("s")&&e.hasOwnProperty("v")?(e.s=V(e.s),e.v=V(e.v),t=s(e.h,e.s,e.v),a=!0,r="hsv"):e.hasOwnProperty("h")&&e.hasOwnProperty("s")&&e.hasOwnProperty("l")&&(e.s=V(e.s),e.l=V(e.l),t=o(e.h,e.s,e.l),a=!0,r="hsl"),e.hasOwnProperty("a")&&(n=e.a)),n=x(n),{ok:a,format:e.format||r,r:B(255,R(t.r,0)),g:B(255,R(t.g,0)),b:B(255,R(t.b,0)),a:n}}function i(e,t,n){return{r:255*k(e,255),g:255*k(t,255),b:255*k(n,255)}}function a(e,t,n){e=k(e,255),t=k(t,255),n=k(n,255);var i,a,o=R(e,t,n),r=B(e,t,n),s=(o+r)/2;if(o==r)i=a=0;else{var l=o-r;switch(a=s>.5?l/(2-o-r):l/(o+r),o){case e:i=(t-n)/l+(t<n?6:0);break;case t:i=(n-e)/l+2;break;case n:i=(e-t)/l+4}i/=6}return{h:i,s:a,l:s}}function o(e,t,n){function i(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e}var a,o,r;if(e=k(e,360),t=k(t,100),n=k(n,100),0===t)a=o=r=n;else{var s=n<.5?n*(1+t):n+t-n*t,l=2*n-s;a=i(l,s,e+1/3),o=i(l,s,e),r=i(l,s,e-1/3)}return{r:255*a,g:255*o,b:255*r}}function r(e,t,n){e=k(e,255),t=k(t,255),n=k(n,255);var i,a,o=R(e,t,n),r=B(e,t,n),s=o,l=o-r;if(a=0===o?0:l/o,o==r)i=0;else{switch(o){case e:i=(t-n)/l+(t<n?6:0);break;case t:i=(n-e)/l+2;break;case n:i=(e-t)/l+4}i/=6}return{h:i,s:a,v:s}}function s(e,t,n){e=6*k(e,360),t=k(t,100),n=k(n,100);var i=z.floor(e),a=e-i,o=n*(1-t),r=n*(1-a*t),s=n*(1-(1-a)*t),l=i%6,c=[n,r,o,o,s,n][l],d=[s,n,n,r,o,o][l],u=[o,o,s,n,n,r][l];return{r:255*c,g:255*d,b:255*u}}function l(e,t,n,i){var a=[$(P(e).toString(16)),$(P(t).toString(16)),$(P(n).toString(16))];return i&&a[0].charAt(0)==a[0].charAt(1)&&a[1].charAt(0)==a[1].charAt(1)&&a[2].charAt(0)==a[2].charAt(1)?a[0].charAt(0)+a[1].charAt(0)+a[2].charAt(0):a.join("")}function c(e,t,n,i){var a=[$(A(i)),$(P(e).toString(16)),$(P(t).toString(16)),$(P(n).toString(16))];return a.join("")}function d(t,n){n=0===n?0:n||10;var i=e(t).toHsl();return i.s-=n/100,i.s=C(i.s),e(i)}function u(t,n){n=0===n?0:n||10;var i=e(t).toHsl();return i.s+=n/100,i.s=C(i.s),e(i)}function p(t){return e(t).desaturate(100)}function h(t,n){n=0===n?0:n||10;var i=e(t).toHsl();return i.l+=n/100,i.l=C(i.l),e(i)}function m(t,n){n=0===n?0:n||10;var i=e(t).toRgb();return i.r=R(0,B(255,i.r-P(255*-(n/100)))),i.g=R(0,B(255,i.g-P(255*-(n/100)))),i.b=R(0,B(255,i.b-P(255*-(n/100)))),e(i)}function f(t,n){n=0===n?0:n||10;var i=e(t).toHsl();return i.l-=n/100,i.l=C(i.l),e(i)}function g(t,n){var i=e(t).toHsl(),a=(P(i.h)+n)%360;return i.h=a<0?360+a:a,e(i)}function v(t){var n=e(t).toHsl();return n.h=(n.h+180)%360,e(n)}function b(t){var n=e(t).toHsl(),i=n.h;return[e(t),e({h:(i+120)%360,s:n.s,l:n.l}),e({h:(i+240)%360,s:n.s,l:n.l})]}function _(t){var n=e(t).toHsl(),i=n.h;return[e(t),e({h:(i+90)%360,s:n.s,l:n.l}),e({h:(i+180)%360,s:n.s,l:n.l}),e({h:(i+270)%360,s:n.s,l:n.l})]}function y(t){var n=e(t).toHsl(),i=n.h;return[e(t),e({h:(i+72)%360,s:n.s,l:n.l}),e({h:(i+216)%360,s:n.s,l:n.l})]}function I(t,n,i){n=n||6,i=i||30;var a=e(t).toHsl(),o=360/i,r=[e(t)];for(a.h=(a.h-(o*n>>1)+720)%360;--n;)a.h=(a.h+o)%360,r.push(e(a));return r}function E(t,n){n=n||6;for(var i=e(t).toHsv(),a=i.h,o=i.s,r=i.v,s=[],l=1/n;n--;)s.push(e({h:a,s:o,v:r})),r=(r+l)%1;return s}function w(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[e[n]]=n);return t}function x(e){return e=parseFloat(e),(isNaN(e)||e<0||e>1)&&(e=1),e}function k(e,t){T(e)&&(e="100%");var n=N(e);return e=B(t,R(0,parseFloat(e))),n&&(e=parseInt(e*t,10)/100),z.abs(e-t)<1e-6?1:e%t/parseFloat(t)}function C(e){return B(1,R(0,e))}function S(e){return parseInt(e,16)}function T(e){return"string"==typeof e&&e.indexOf(".")!=-1&&1===parseFloat(e)}function N(e){return"string"==typeof e&&e.indexOf("%")!=-1}function $(e){return 1==e.length?"0"+e:""+e}function V(e){return e<=1&&(e=100*e+"%"),e}function A(e){return Math.round(255*parseFloat(e)).toString(16)}function M(e){return S(e)/255}function K(e){e=e.replace(L,"").replace(O,"").toLowerCase();var t=!1;if(U[e])e=U[e],t=!0;else if("transparent"==e)return{r:0,g:0,b:0,a:0,format:"name"};var n;return(n=G.rgb.exec(e))?{r:n[1],g:n[2],b:n[3]}:(n=G.rgba.exec(e))?{r:n[1],g:n[2],b:n[3],a:n[4]}:(n=G.hsl.exec(e))?{h:n[1],s:n[2],l:n[3]}:(n=G.hsla.exec(e))?{h:n[1],s:n[2],l:n[3],a:n[4]}:(n=G.hsv.exec(e))?{h:n[1],s:n[2],v:n[3]}:(n=G.hsva.exec(e))?{h:n[1],s:n[2],v:n[3],a:n[4]}:(n=G.hex8.exec(e))?{a:M(n[1]),r:S(n[2]),g:S(n[3]),b:S(n[4]),format:t?"name":"hex8"}:(n=G.hex6.exec(e))?{r:S(n[1]),g:S(n[2]),b:S(n[3]),format:t?"name":"hex"}:!!(n=G.hex3.exec(e))&&{r:S(n[1]+""+n[1]),g:S(n[2]+""+n[2]),b:S(n[3]+""+n[3]),format:t?"name":"hex"}}function D(e){var t,n;return e=e||{level:"AA",size:"small"},t=(e.level||"AA").toUpperCase(),n=(e.size||"small").toLowerCase(),"AA"!==t&&"AAA"!==t&&(t="AA"),"small"!==n&&"large"!==n&&(n="small"),{level:t,size:n}}var L=/^\s+/,O=/\s+$/,F=0,z=Math,P=z.round,B=z.min,R=z.max,H=z.random;e.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var e=this.toRgb();return(299*e.r+587*e.g+114*e.b)/1e3},getLuminance:function(){var e,t,n,i,a,o,r=this.toRgb();return e=r.r/255,t=r.g/255,n=r.b/255,i=e<=.03928?e/12.92:Math.pow((e+.055)/1.055,2.4),a=t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4),o=n<=.03928?n/12.92:Math.pow((n+.055)/1.055,2.4),.2126*i+.7152*a+.0722*o},setAlpha:function(e){return this._a=x(e),this._roundA=P(100*this._a)/100,this},toHsv:function(){var e=r(this._r,this._g,this._b);return{h:360*e.h,s:e.s,v:e.v,a:this._a}},toHsvString:function(){var e=r(this._r,this._g,this._b),t=P(360*e.h),n=P(100*e.s),i=P(100*e.v);return 1==this._a?"hsv("+t+", "+n+"%, "+i+"%)":"hsva("+t+", "+n+"%, "+i+"%, "+this._roundA+")"},toHsl:function(){var e=a(this._r,this._g,this._b);return{h:360*e.h,s:e.s,l:e.l,a:this._a}},toHslString:function(){var e=a(this._r,this._g,this._b),t=P(360*e.h),n=P(100*e.s),i=P(100*e.l);return 1==this._a?"hsl("+t+", "+n+"%, "+i+"%)":"hsla("+t+", "+n+"%, "+i+"%, "+this._roundA+")"},toHex:function(e){return l(this._r,this._g,this._b,e)},toHexString:function(e){return"#"+this.toHex(e)},toHex8:function(){return c(this._r,this._g,this._b,this._a)},toHex8String:function(){return"#"+this.toHex8()},toRgb:function(){return{r:P(this._r),g:P(this._g),b:P(this._b),a:this._a}},toRgbString:function(){return 1==this._a?"rgb("+P(this._r)+", "+P(this._g)+", "+P(this._b)+")":"rgba("+P(this._r)+", "+P(this._g)+", "+P(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:P(100*k(this._r,255))+"%",g:P(100*k(this._g,255))+"%",b:P(100*k(this._b,255))+"%",a:this._a}},toPercentageRgbString:function(){return 1==this._a?"rgb("+P(100*k(this._r,255))+"%, "+P(100*k(this._g,255))+"%, "+P(100*k(this._b,255))+"%)":"rgba("+P(100*k(this._r,255))+"%, "+P(100*k(this._g,255))+"%, "+P(100*k(this._b,255))+"%, "+this._roundA+")"},toName:function(){return 0===this._a?"transparent":!(this._a<1)&&(j[l(this._r,this._g,this._b,!0)]||!1)},toFilter:function(t){var n="#"+c(this._r,this._g,this._b,this._a),i=n,a=this._gradientType?"GradientType = 1, ":"";if(t){var o=e(t);i=o.toHex8String()}return"progid:DXImageTransform.Microsoft.gradient("+a+"startColorstr="+n+",endColorstr="+i+")"},toString:function(e){var t=!!e;e=e||this._format;var n=!1,i=this._a<1&&this._a>=0,a=!t&&i&&("hex"===e||"hex6"===e||"hex3"===e||"name"===e);return a?"name"===e&&0===this._a?this.toName():this.toRgbString():("rgb"===e&&(n=this.toRgbString()),"prgb"===e&&(n=this.toPercentageRgbString()),"hex"!==e&&"hex6"!==e||(n=this.toHexString()),"hex3"===e&&(n=this.toHexString(!0)),"hex8"===e&&(n=this.toHex8String()),"name"===e&&(n=this.toName()),"hsl"===e&&(n=this.toHslString()),"hsv"===e&&(n=this.toHsvString()),n||this.toHexString())},clone:function(){return e(this.toString())},_applyModification:function(e,t){var n=e.apply(null,[this].concat([].slice.call(t)));return this._r=n._r,this._g=n._g,this._b=n._b,this.setAlpha(n._a),this},lighten:function(){return this._applyModification(h,arguments)},brighten:function(){return this._applyModification(m,arguments)},darken:function(){return this._applyModification(f,arguments)},desaturate:function(){return this._applyModification(d,arguments)},saturate:function(){return this._applyModification(u,arguments)},greyscale:function(){return this._applyModification(p,arguments)},spin:function(){return this._applyModification(g,arguments)},_applyCombination:function(e,t){return e.apply(null,[this].concat([].slice.call(t)))},analogous:function(){return this._applyCombination(I,arguments)},complement:function(){return this._applyCombination(v,arguments)},monochromatic:function(){return this._applyCombination(E,arguments)},splitcomplement:function(){return this._applyCombination(y,arguments)},triad:function(){return this._applyCombination(b,arguments)},tetrad:function(){return this._applyCombination(_,arguments)}},e.fromRatio=function(t,n){if("object"==typeof t){var i={};for(var a in t)t.hasOwnProperty(a)&&("a"===a?i[a]=t[a]:i[a]=V(t[a]));t=i}return e(t,n)},e.equals=function(t,n){return!(!t||!n)&&e(t).toRgbString()==e(n).toRgbString()},e.random=function(){return e.fromRatio({r:H(),g:H(),b:H()})},e.mix=function(t,n,i){i=0===i?0:i||50;var a,o=e(t).toRgb(),r=e(n).toRgb(),s=i/100,l=2*s-1,c=r.a-o.a;a=l*c==-1?l:(l+c)/(1+l*c),a=(a+1)/2;var d=1-a,u={r:r.r*a+o.r*d,g:r.g*a+o.g*d,b:r.b*a+o.b*d,a:r.a*s+o.a*(1-s)};return e(u)},e.readability=function(t,n){var i=e(t),a=e(n);return(Math.max(i.getLuminance(),a.getLuminance())+.05)/(Math.min(i.getLuminance(),a.getLuminance())+.05)},e.isReadable=function(t,n,i){var a,o,r=e.readability(t,n);switch(o=!1,a=D(i),a.level+a.size){case"AAsmall":case"AAAlarge":o=r>=4.5;break;case"AAlarge":o=r>=3;break;case"AAAsmall":o=r>=7}return o},e.mostReadable=function(t,n,i){var a,o,r,s,l=null,c=0;i=i||{},o=i.includeFallbackColors,r=i.level,s=i.size;for(var d=0;d<n.length;d++)a=e.readability(t,n[d]),a>c&&(c=a,l=e(n[d]));return e.isReadable(t,l,{level:r,size:s})||!o?l:(i.includeFallbackColors=!1,e.mostReadable(t,["#fff","#000"],i))};var U=e.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},j=e.hexNames=w(U),G=function(){var e="[-\\+]?\\d+%?",t="[-\\+]?\\d*\\.\\d+%?",n="(?:"+t+")|(?:"+e+")",i="[\\s|\\(]+("+n+")[,|\\s]+("+n+")[,|\\s]+("+n+")\\s*\\)?",a="[\\s|\\(]+("+n+")[,|\\s]+("+n+")[,|\\s]+("+n+")[,|\\s]+("+n+")\\s*\\)?";return{rgb:new RegExp("rgb"+i),rgba:new RegExp("rgba"+a),hsl:new RegExp("hsl"+i),hsla:new RegExp("hsla"+a),hsv:new RegExp("hsv"+i),hsva:new RegExp("hsva"+a),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}}();"undefined"!=typeof t&&t.exports?t.exports=e:"function"==typeof define&&define.amd?define(function(){return e}):window.tinycolor=e}()},{}],4:[function(e,t,n){var i=e("./facade/design/design");t.exports=function(){function e(){function e(e,n){var i=$("#"+n.id)[0];if(i){var a=$(i).children("image")[0];t(i,e),a&&t(a,e)}}function n(e,n){var i=$("#"+n.id)[0];i&&t(i,e)}i.on("image.create.optimize_resolution",_.partial(n,!0)),i.on("image.create.resize_external",_.partial(n,!0)),i.on("image.create.source.url",_.partial(n,!1)),i.on("image.create.optimus_resolution",_.partial(n,!1)),i.on("image.update.optimize_resolution",_.partial(n,!0)),i.on("image.update.resize_external",_.partial(n,!0)),i.on("image.update.source.url",_.partial(n,!1)),i.on("image.update.optimus_resolution",_.partial(n,!1)),i.on("background.update.updating_source",_.partial(n,!0)),i.on("background.update.source",_.partial(n,!1)),i.on("flipping_image",_.partial(n,!0)),i.on("flipped_image",_.partial(n,!1)),i.on("icon.update.fetch_content",_.partial(e,!0)),i.on("icon.update.content",_.partial(e,!1)),i.on("logo.update.fetch_content",_.partial(e,!0)),i.on("logo.update.content",_.partial(e,!1)),i.on("icon.update.optimize_resolution",_.partial(e,!0)),i.on("icon.update.resolution_optimized",_.partial(e,!1)),i.on("logo.update.optimize_resolution",_.partial(e,!0)),i.on("logo.update.resolution_optimized",_.partial(e,!1)),i.on("video.create.optimize_resolution",_.partial(n,!0)),i.on("video.create.resolution_optimized",_.partial(n,!1)),i.on("video.update.optimize_resolution",_.partial(n,!0)),i.on("video.update.resolution_optimized",_.partial(n,!1))}function t(e,t){function i(){var e=r.attr("id")+"-loader";l=$("<div>").attr("id",e).addClass("svg-loader").append($("<div>").addClass("animation")).appendTo("#content"),r.data("svg-loader",l),r.on("change, move",o),s[r.attr("id")]=r}var r=$(e),l=a(r);return t?(l||i(),void o.call(e)):void n(r)}function n(e){var t=a(e);e.removeData("svg-loader"),e.off("change, move",o),t&&t.remove(),s=_.omit(s,e.attr("id"))}function a(e){if(e.parent().is(".background")){var t=$("#"+e.attr("id")+"-loader");return t.length?t:null}return e.data("svg-loader")}function o(){var e=this;if(INKIVE.C.IS_MOBILE){var t=a($(e));t.css("display","none"),l(e)}else r(e)}function r(e){function t(){var e=$("#canvasBackground").offset();s=e.top,l=e.left}function n(){var t=$(e).attr("transform"),n=/translate\((-?[\d|.]+),(-?[\d|.]+)\)/g;t&&t.replace(n,function(e,t,n){s+=parseInt(n)*c,l+=parseInt(t)*c})}function i(){s+=d.y*c,l+=d.x*c}function o(){var e=5,t=-28;r.children(".animation").css({top:0+e,left:d.width*c+t})}var r=a($(e));if(e&&r){r.css("display","block");var s=0,l=0,c=INKIVE.EditorFacade.handle("zoom","get"),d=svgedit.utilities.getBBox(e);t(),n(),$(e).parent().is(".background")?d=svgedit.utilities.getBBox($("#canvasBackground")[0]):i(),r.css({top:s,left:l,width:d.width*c,height:d.height*c});var u=svgedit.utilities.getRotationAngle(e);u&&r.css("transform","rotate("+u+"deg)"),o()}}var s={},l=_.debounce(r,600);return{toggle:t,initialize:e,show:function(e){t(e,!0)},hide:function(e){t(e,!1)},hideAll:function(){_.each(s,n)}}}()},{"./facade/design/design":34}],5:[function(e,t,n){function i(e,t){if(!_.contains(s,t)&&e){if(!_.isFunction(e)){var n=o[t];e=function(){this.trackEvent(n)}}this[t]=_.partial(a,e,r.prototype[t])}}function a(e,t){var n=_.rest(arguments,2);e.apply(this,n),t.apply(this,n)}var o,r,s=["eventCategory","eventAction","eventLabel","eventValue","fieldsObject"];t.exports=function(e,t){r=t,o=e;var n={trackEvent:function(t){var n={hitType:"event"};_.each(s,function(t){e[t]&&(n[t]=e[t])}),INKIVE.C.IS_DEV||"undefined"!=typeof ga&&ga("send",_.extend(n,t))}};return _.each(o,i,n),t.extend?t.extend(n):_.extend({},t,n)}},{}],6:[function(e,t,n){var i;INKIVE.C.IS_DEV||window.addEventListener("error",function(e){if(i!==t){var t=e.filename+" ["+e.lineno+"]: "+e.message;ga("send","exception",{exDescription:t}),i=t}},!1)},{}],7:[function(e,t,n){function i(){
this.version=e("./version"),this.util=INKIVE.Helpers,_.bindAll(this,"propagate")}function a(e,t){var n=e.match(/(\w+)\.get\.svg_(\d+)/)?e:r.camelize(e);n=s.androidMethodName(n),t=s.androidParameters(_.extend({cmd:n},{params:t})),l.version.isApp("webrand")||l.version.isApp("pdf")||!l.version.isLowerThan("1.0.3")?Android.trigger(JSON.stringify(t)):Android[n].apply(window.Android,t)}function o(e,t){var n=e.match(/(\w+)\.get\.svg_(\d+)/)?e:r.camelize(e);n=s.iosMethodName(n),c.Trigger(s.iosParameters(_.extend({cmd:n},{params:t})))}var r=e("../utils/humps"),s=e("./legacy-support");i.prototype=_.extend({},Backbone.Events),i.prototype.initialize=function(){function t(){var t=this.propagate,n=e("../factory/shapes");this.factories={shapes:{get:function(){n.get.apply(n,arguments).then(_.partial(t,"factory","shapes_data"))},getCategories:function(){n.getCategories().then(_.partial(t,"factory","shapes_categories"))}}}}function n(){var t=e("../facade/project/project");t.on("all",_.partial(this.propagate,"project")),this.project={call:t.handle,get:function(){return t.get.apply(t,arguments)}}}function i(){var t=e("../facade/design/design"),n=s.supportsCreateReturn(this);t.on("all",_.partial(this.propagate,"design")),this.design={set:t.set,create:function(){var e=t.create.apply(t,arguments);if(n)return e},call:function(){var e=t.handle.apply(t,arguments);return window.Android?void l.propagate("design","call",e):JSON.stringify(e)},get:function(e,n){var i=t.get.apply(t,arguments);if(l.version.isApp("webrand")||l.version.isApp("pdf")||!window.Android||!l.version.isLowerThan("2.2.6"))return window.Android?i:JSON.stringify(i);var a="get";l.version.isLowerThan("1.1.3")||(a+="."+e,a+=n?"."+n:""),l.propagate("design",a,i)}}}function a(){var t=e("../facade/restrictions/restrictions");this.permissions={getDefaults:function(){return window.Android&&(l.version.isApp("webrand")||l.version.isApp("pdf")||!l.version.isLowerThan("2.2.6"))?t.getAllDefaultPermissions():JSON.stringify(t.getAllDefaultPermissions())},getByElement:function(e){return window.Android&&(l.version.isApp("webrand")||l.version.isApp("pdf")||!l.version.isLowerThan("2.2.6"))?t.getAllElementPermissions(e):JSON.stringify(t.getAllElementPermissions(e))}}}function o(){var t=e("../utils/advice"),n=e("../facade/editor/editor"),i=e("../factory/images");t.on("all",_.partial(this.propagate,"editor.advice")),n.on("all",_.partial(this.propagate,"editor")),this.editor={setImagesData:_.bind(i.setImagesData,i),call:function(){var e=n.handle.apply(n,arguments);return window.Android?void l.propagate("editor","call",e):JSON.stringify(e)},get:function(e,t){var i=n.get.apply(n,arguments);if(l.version.isApp("webrand")||l.version.isApp("pdf")||!window.Android||!l.version.isLowerThan("2.2.6"))return window.Android?i:JSON.stringify(i);var a="get";(l.version.isApp("webrand")||l.version.isApp("pdf")||!l.version.isLowerThan("1.1.3"))&&(a+="."+e,a+=t?"."+t:""),l.propagate("editor",a,i)}}}function r(){function t(e,n,a){var o=_.isObject(e);o?_.each(e,function(e,i){t(e,n,a?a+"."+i:i)}):i[n][a]=e}var n=e("./support.json"),i={element:{},editor:{}};window.Android?(t(n.editor,"editor"),t(n.element,"element"),this.getSupported=function(){l.propagate("supported","get",JSON.stringify({editor:i.editor,element:i.element,fonts:INKIVE.C.FONT_LIST}))}):this.supported=JSON.stringify(_.extend(n,{fonts:INKIVE.C.FONT_LIST}))}s.supportsDesignFacade(this)&&i.call(this),s.supportsEditorFacade(this)&&o.call(this),s.supportsProjectFacade(this)&&n.call(this),s.supportsRestrictionsFacade(this)&&a.call(this),t.call(this),r.call(this),this.getFontUrl=INKIVE.FontsFactory.getFontUrl,s.events(this)},i.prototype.propagate=function(e,t,n){this.callBoth(e+"."+t,n)},i.prototype.callBoth=function(e,t){return!!INKIVE.C.IS_MOBILE_APP&&(window.Android&&a(e,t),window.Android||o(e,t),!0)},i.prototype.callIOS=function(e,t){var n=INKIVE.C.IS_MOBILE_APP&&!window.Android;return n&&o(e,t),n},i.prototype.callAndroid=function(e,t){var n=INKIVE.C.IS_MOBILE_APP&&window.Android;return n&&a(e,t),n};var l=new i;t.exports=l;var c={Trigger:function(e){var t=$('<iframe src="inkive://www.awesome.com/notyourbusiness.php?event='+encodeURIComponent(JSON.stringify(e))+'" width="0" height="0" border="0" style="display:none;" ></iframe>').appendTo("body");setTimeout(function(){t.remove()},1e3)}}},{"../facade/design/design":34,"../facade/editor/editor":76,"../facade/project/project":89,"../facade/restrictions/restrictions":94,"../factory/images":102,"../factory/shapes":130,"../utils/advice":477,"../utils/humps":482,"./legacy-support":9,"./support.json":10,"./version":11}],8:[function(e,t,n){function i(e,t){var n=t.match(/Check$/)||t.match(/CheckOnce$/);if(!n){var i=o[t+"Check"],s=o[t+"CheckOnce"];s?s.call(this)&&(this[t]=e):i?this[t]=_.partial(a,i,e,r.prototype[t]):this[t]=e}}function a(e,t,n){var i=e.call(this);i&&t.apply(this,_.rest(arguments,3)),i||n&&n.apply(this,_.rest(arguments,3))}var o,r;t.exports=function(t,n){if(INKIVE.C.IS_MOBILE_APP){r=n,o=t;var a={appBridge:e("./bridge")};return _.each(o,i,a),n.extend?n.extend(a):_.extend({},n,a)}return n}},{"./bridge":7}],9:[function(e,t,n){function i(t,n){var i=e("./bridge"),a=_.where(t[i.version.getApp()],{funcName:n});return _.any(a,function(e){if(i.version.isLowerThan(e.usedBefore))return console.log("We will use: "+e.oldName),n=e.oldName,!0}),n}function a(t,n){var i=e("./bridge"),a=_.where(t[i.version.getApp()],{funcName:n.cmd});return _.any(a,function(e){if(i.version.isLowerThan(e.usedBefore))return n=e.map(n),!0}),n}var o={android:{desygner:[],webrand:[]},ios:{webrand:[],desygner:[{funcName:"sendFacebookCredentials",oldName:"auth_facebook",usedBefore:"1.1.2"},{funcName:"sendInstagramCredentials",oldName:"auth_instagram",usedBefore:"1.1.2"},{funcName:"editorLoaded",oldName:"editor_loaded",usedBefore:"1.1.2"},{funcName:"showTeam",oldName:"show_team",usedBefore:"1.1.2"},{funcName:"catchFile",oldName:"catch_file",usedBefore:"1.1.2"},{funcName:"closeEditor",oldName:"close_overlay",usedBefore:"1.1.2"},{funcName:"shareWithFb",oldName:"share_with_fb",usedBefore:"1.1.2"},{funcName:"design.template.update",oldName:"design.template.updated",usedBefore:"1.2"},{funcName:"design.template.update.designed",oldName:"design.template.updated.designed",usedBefore:"1.2"}]}},r={ios:{webrand:[],desygner:[{funcName:"openInNewWindow",usedBefore:"1.1.2",map:function(e){return{cmd:e.cmd,url:e.params.url}}},{funcName:"editor_loaded",usedBefore:"1.1.2",map:function(e){return{cmd:e.cmd,book_id:e.params.book_id}}}]},android:{webrand:[],desygner:[{funcName:"catchFile",usedBefore:"1.0.3",map:function(e){return[e.params.url]}},{funcName:"photoUpload",usedBefore:"1.0.3",map:function(e){return[e.params.size_name]}},{funcName:"editorLoaded",usedBefore:"1.0.3",map:function(e){return[e.params.book_id]}},{funcName:"showTeam",usedBefore:"1.0.3",map:function(e){return[e.params.x,e.params.y]}}]}};t.exports={androidMethodName:_.partial(i,o.android),iosMethodName:_.partial(i,o.ios),androidParameters:_.partial(a,r.android),iosParameters:_.partial(a,r.ios),supportsCreateReturn:function(e){return window.Android&&!e.version.isLowerThan("2.2.1")||!window.Android||e.version.isApp("webrand")||e.version.isApp("pdf")},supportsRestrictionsFacade:function(e){return window.Android&&!e.version.isLowerThan("2.2")||!window.Android&&!e.version.isLowerThan("2.3")||e.version.isApp("webrand")||e.version.isApp("pdf")},supportsDesignFacade:function(e){return window.Android&&e.version.isGreaterThan("1.0.2")||!window.Android&&e.version.isGreaterThan("1.1.1")||e.version.isApp("webrand")||e.version.isApp("pdf")},supportsEditorFacade:function(e){return window.Android&&!e.version.isLowerThan("1.1")||!window.Android&&!e.version.isLowerThan("1.2")||e.version.isApp("webrand")||e.version.isApp("pdf")},supportsProjectFacade:function(e){return window.Android&&!e.version.isLowerThan("1.1")||!window.Android&&!e.version.isLowerThan("1.2")||e.version.isApp("webrand")||e.version.isApp("pdf")},events:function(e){var t=$("#ik-editor");e.on=_.bind(t.on,t),e.off=_.bind(t.off,t),e.once=_.bind(t.one,t),e.trigger=_.bind(t.trigger,t)}}},{"./bridge":7}],10:[function(e,t,n){t.exports={editor:{layers:!0},element:{"default":{duplicate:!0,remove:!0,unlock:!0,lock:!0,deselect:!0,rotate:!0,opacity:!0,resize:!0,send:{forward:!0,backward:!0}},text:{content:!0,fontfamily:!0,fontsize:!0,color:!0,bold:!0,italic:!0,underline:!0,bullets:!0,align:{left:!0,center:!0,right:!0,full:!0},spacing:{line:!0,word:!0,letter:!0},link:!1,unlink:!1},image:{crop:!0,filter:!1,lock_image:!1,unlock_image:!1,link:!1,unlink:!1},sticker:{fill:{color:!0},stroke:{color:!1,width:!1},flip:{horizontal:!0,vertical:!0},link:!1,unlink:!1},group:{ungroup:!0,link:!1,unlink:!1},multiselect:{duplicate:!0,remove:!0,group:!0},shape:{fill:{color:!0},stroke:{color:!0,width:!0},flip:{horizontal:!0,vertical:!0},image_box:!0,link:!1,unlink:!1}}}},{}],11:[function(e,t,n){function i(e){if(a=a||r.get("ver"),typeof e+typeof a!="stringstring")return!1;for(var t=e.split("."),n=a.split("."),i=0,o=Math.max(t.length,n.length);i<o;i++){if(t[i]&&!n[i]&&parseInt(t[i])>0||parseInt(t[i])>parseInt(n[i]))return 1;if(n[i]&&!t[i]&&parseInt(n[i])>0||parseInt(t[i])<parseInt(n[i]))return-1}return 0}var a,o,r=e("../utils/cookie-storage"),s="desygner";t.exports={isEqual:function(e){return 0===i(e)},isLowerThan:function(e){return i(e)>0},isGreaterThan:function(e){return i(e)<0},get:function(){return a=a||r.get("ver")},getApp:function(){return o=o||r.get("app_name")||s},isApp:function(e){return o=o||r.get("app_name")||s,e===o}}},{"../utils/cookie-storage":480}],12:[function(e,t,n){function i(){window.indexedDB=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,window.IDBTransaction=window.IDBTransaction||window.webkitIDBTransaction||window.msIDBTransaction,window.IDBKeyRange=window.IDBKeyRange||window.webkitIDBKeyRange||window.msIDBKeyRange}var a="history",o=60;t.exports=i,i.prototype.initialize=function(){return _.bindAll(this,"openDB","deleteDB","getVersion","storeVersion","deleteVersion","isLastDBVersion","cleanOldVersions","iterateCurrentPageVersions"),this},i.prototype.openDB=function(){var e=$.Deferred(),t=window.indexedDB.open("history");return t.onsuccess=_.bind(function(){this.db=t.result,this.db.onerror=function(e){console.error("Database error: "+e.target.errorCode)},e.resolve()},this),t.onupgradeneeded=_.bind(function(e){var t=e.target.result,n=t.createObjectStore("versions",{keyPath:"version",autoIncrement:!0});n.createIndex("parent","parent",{unique:!1}),n.createIndex("project","project",{unique:!1}),n.createIndex("page","page",{unique:!1}),n.createIndex("timestamp","timestamp",{unique:!1})},this),e.promise()},i.prototype.deleteDB=function(){var e=$.Deferred(),t=indexedDB.deleteDatabase(a);try{this.db.close()}catch(n){}return t.onsuccess=_.bind(e.resolve,e),t.onerror=_.bind(e.reject,e),t.onblocked=_.bind(e.rejectWith,e,"Couldn't delete database due to the operation being blocked"),e.promise()},i.prototype.cleanOldVersions=function(){var e=$.Deferred(),t=moment(),n=this._getDBRecordStore();return n.openCursor().onsuccess=_.bind(function(i){var a=i.target.result,r=a&&a.value;a?!r.timestamp||moment(r.timestamp).add(o,"minutes")<t?this.deleteVersion(r.version,n).then(_.bind(a["continue"],a)):a["continue"]():e.resolve()},this),e.promise()},i.prototype.deleteVersion=function(e,t){t=t||this._getDBRecordStore();var n=$.Deferred(),i=t["delete"](e);return i.onsuccess=function(e){n.resolve()},i.onerror=function(e){INKIVE.C.IS_DEV&&console.error(e.target.errorCode),n.rejectWith(e.target.errorCode)},n.promise()},i.prototype.storeVersion=function(e){var t=$.Deferred(),n=this._getDBRecordStore(),i=n.add(e);return i.onsuccess=_.bind(function(e){t.resolve(i.result)},this),t.promise()},i.prototype.getVersion=function(e){var t=$.Deferred();return this._getDBRecordStore().get(e).onsuccess=function(e){e.target.result&&t.resolve(INKIVE.Helpers.imagesSanitize.base64Load(e.target.result.svg)),e.target.result||t.reject()},t.promise()},i.prototype.iterateCurrentPageVersions=function(e){var t=this._getDBRecordStore(),n=t.index("project"),i=IDBKeyRange.only(INKIVE.C.BOOK.encodedId);n.openCursor(i).onsuccess=function(t){var n=t.target.result,i=n&&n.value,a=n&&i.page!==INKIVE.Tool._current_page_number;a||e(n),a&&n["continue"]()}},i.prototype.isLastDBVersion=function(){return!0},i.prototype._getDBRecordStore=function(){var e=this.db.transaction(["versions"],"readwrite");return e.onerror=function(){console.error("DB transaction error",arguments)},e.objectStore("versions")}},{}],13:[function(e,t,n){function i(){}var a,o=e("./dbDriver"),r=!0,s=!1,l={"default":e("./processors/default"),"design.sticker.create":e("./processors/sticker-create"),"design.image.update":e("./processors/image-update"),"design.logo.update":e("./processors/logo-update"),"design.icon.update":e("./processors/logo-update"),resize:e("./processors/crop-exception"),move:e("./processors/move")};i.prototype=_.extend({},Backbone.Events),i.prototype.initialize=function(e,t){function n(){this.initialized=!0,this._pushLocalVersion(t)}this.initialized||this.initializing||(this.initializing=!0,a={},this.processVersion=function(){s=!1,e.apply(null,arguments)},_.bindAll(this,"undo","redo","reload","onChange","_onError","_addVersionHistory","_triggerDefaultEvent"),this.driver=new o,this.driver.initialize().openDB().then(_.bind(function(){var e=this.driver.isLastDBVersion();e&&this.driver.cleanOldVersions().then(_.bind(n,this)),e||this.driver.deleteDB().then(this.driver.openDB).then(_.bind(n,this))},this)))},i.prototype._triggerDefaultEvent=function(e){_.size(a)&&this.trigger(e,{current:this.currentVersion,history:a,isEnabled:r})},i.prototype.reload=function(e){this.initialized&&(a={},this._loadStoredVersions(e).then(_.bind(function(){_.size(a)?this._triggerDefaultEvent("reload"):(this.currentVersion=void 0,this._pushLocalVersion(e).then(_.partial(this._triggerDefaultEvent,"reload")))},this)))},i.prototype.onChange=function(e,t,n){if(r&&this.initialized)try{INKIVE.hasEditorUnsavedChanges=!0;var i=l[e]?e:"default";l[i].call(this,e,t,n).then(_.partial(this._triggerDefaultEvent,"change"),$.noop)}catch(a){console.error(a),_.defer(this._onError)}},i.prototype.undo=function(){var e=r&&!s&&this.currentVersion&&a[this.currentVersion]&&a[this.currentVersion].parent;e&&(s=!0,this.currentVersion=a[this.currentVersion].parent,this.driver.getVersion(this.currentVersion).then(this.processVersion,this._onError),this._triggerDefaultEvent("undo"))},i.prototype.redo=function(e){var t=r&&!s&&this.currentVersion&&a[this.currentVersion]&&a[this.currentVersion].children.length;t&&(s=!0,this.currentVersion=a[this.currentVersion].children[0],this.driver.getVersion(this.currentVersion).then(this.processVersion,this._onError),this._triggerDefaultEvent("redo"))},i.prototype._pushLocalVersion=function(e){var t=$.Deferred();return this.driver.storeVersion({svg:INKIVE.Helpers.imagesSanitize.base64Sanitize(e),timestamp:new Date,parent:this.currentVersion,project:INKIVE.C.BOOK.encodedId,page:INKIVE.Tool._current_page_number}).then(_.bind(function(e){this._addVersionHistory(e),t.resolve()},this)),t.promise()},i.prototype._loadStoredVersions=function(e){function t(t){o[t.version]={version:t.version,parent:t.parent,children:[]},this.currentVersion<t.version&&INKIVE.Helpers.areEqual(e,t.svg)&&(this.currentVersion=t.version)}function n(){this.currentVersion>-1&&(a=o,_.each(a,function(e){"undefined"!=typeof e.parent&&a[e.parent]&&(a[e.parent].children=[e.version])},this)),i.resolve()}var i=$.Deferred(),o={};return this.currentVersion=-1,this.driver.iterateCurrentPageVersions(_.bind(function(e){e?(t.call(this,e.value),e["continue"]()):n.call(this)},this)),i.promise()},i.prototype._addVersionHistory=function(e){if("undefined"!=typeof this.currentVersion){if(!a[this.currentVersion])throw"Current version not found";a[this.currentVersion].children=[e]}a[e]={version:e,parent:this.currentVersion,children:[]},this.currentVersion=e},i.prototype._onError=function(e){r=!1,s=!1,this._triggerDefaultEvent("error"),this.driver.deleteDB()},t.exports=new i},{"./dbDriver":12,"./processors/crop-exception":14,"./processors/default":15,"./processors/image-update":16,"./processors/logo-update":17,"./processors/move":18,"./processors/sticker-create":19}],14:[function(e,t,n){var i=e("./default");t.exports=function(e,t){var n=!_.all(t.elements,function(e){return $(e).is(".layoutClipperImage")});if(!n){var a=$.Deferred();return a.reject(),a.promise()}return i.apply(this,arguments)}},{"./default":15}],15:[function(e,t,n){t.exports=function(e,t,n){return this._pushLocalVersion(n)}},{}],16:[function(e,t,n){var i=e("./default");t.exports=function(e,t){var n=!t.source||!t.source.url||t.source.smart_load!==!1;if(!n){var a=$.Deferred();return a.reject(),a.promise()}return i.apply(this,arguments)}},{"./default":15}],17:[function(e,t,n){var i=e("./default");t.exports=function(e,t){var n=!t.thumb_src||t.smart_load!==!1;if(!n){var a=$.Deferred();return a.reject(),a.promise()}return i.apply(this,arguments)}},{"./default":15}],18:[function(e,t,n){var i=e("./default");t.exports=function(e,t){var n=INKIVE.Tool.getInstance().editor,a=n.canvas,o=!_.all(t.elements,function(e){return $(e).is(".layoutClipperImage")})&&!a._t.layout_prvElem;if(!o){var r=$.Deferred();return r.reject(),r.promise()}return i.apply(this,arguments)}},{"./default":15}],19:[function(e,t,n){var i=e("./default");t.exports=function(e,t){var n=$("#"+t.id);if(n.is("image")){var a=$.Deferred();return a.reject(),a.promise()}return i.apply(this,arguments)}},{"./default":15}],20:[function(e,t,n){var i=e("../facade/restrictions/restrictions"),a=e("./helper/overwritable").OverOutHandler,o=e("./helper/overwritable").getElementOnCoords;t.exports=function(e){var t=new a(e,"ghost-icon");return{outIcon:t.out,updateIconDimensions:function(e){t.updateContentDimensions(e.elem)},dragIcon:function(n){var a=$(e.svgroot).find(".element.icon"),r=o(a,n.x,n.y,e.canvas.getZoom());if(r){var s=!i.canChange(r,"replace")||i.getElementRestrictions(r.getAttribute("id"),"source").length;s&&e.canvas.call("advice.show","restriction-icon-replace"),s||t.over(r,n.thumb)}else t.getGhostElement()&&t.out();return r}}}},{"../facade/restrictions/restrictions":94,"./helper/overwritable":22}],21:[function(e,t,n){var i=e("../facade/restrictions/restrictions"),a=e("./helper/overwritable").OverOutHandler,o=e("./helper/overwritable").getElementOnCoords;t.exports=function(e){var t=new a(e,"ghost-logo");return{outLogo:t.out,updateLogoDimensions:function(e){t.updateContentDimensions(e.elem)},dragLogo:function(n){var a=$(e.svgroot).find(".element.logo"),r=o(a,n.x,n.y,e.canvas.getZoom());if(r){var s=!i.canChange(r,"replace")||i.getElementRestrictions(r.getAttribute("id"),"source").length;s&&e.canvas.call("advice.show","restriction-logo-replace"),s||t.over(r,n.thumb)}else t.getGhostElement()&&t.out();return r}}}},{"../facade/restrictions/restrictions":94,"./helper/overwritable":22}],22:[function(e,t,n){t.exports.getElementOnCoords=function(e,t,n,i){return _.find(e,function(e){var a=svgedit.utilities.getBBox(e);return a.x*i<t&&t<(a.x+a.width)*i&&a.y*i<n&&n<(a.y+a.height)*i})},t.exports.OverOutHandler=function(e,t){function n(e){var t=$(e).children("g")[0],n=$(e).children("image")[0],i=n.getBBox(),a=t.getBBox(),o=i.width/i.height,r=a.width/a.height,l=r>o?i.width/a.width:i.height/a.height;s(t,l,l,i.x,i.y)}function i(e,t){c==e&&l||(l&&l.remove(),c&&r(c,1),c=e,o(e,t),r(e,0))}function a(){r(c,1),l.remove(),l=null,c=null}function o(n,i){var a=e.canvas.getZoom(),o=svgedit.utilities.getBBox(n),r=$("#svgcontent")[0];l=document.createElementNS(svgedit.NS.SVG,"image"),e.canvas.assignAttributes(l,{id:t,x:(parseFloat(r.getAttribute("x"))+o.x)*a,y:(parseFloat(r.getAttribute("y"))+o.y)*a,width:o.width*a,height:o.height*a,"xlink:href":i});var s=$("#svgpanel")[0];s.appendChild(l)}function r(e,t){svgedit.utilities.assignAttributes(e,{opacity:t},100)}function s(t,n,i,a,o){var r=e.svgroot.createSVGTransform(),s=e.svgroot.createSVGTransform(),l=e.svgroot.createSVGTransform(),c=svgedit.transformlist.getTransformList(t);r.setTranslate(0,0),s.setScale(n,i),l.setTranslate(0,0),c.appendItem(r),c.appendItem(s),c.appendItem(l),e.canvas.recalculateDimensions(t,t.getBBox()),r=e.svgroot.createSVGTransform(),r.setTranslate(a,o),c.appendItem(r),e.canvas.recalculateDimensions(t)}var l,c;return{out:a,over:i,updateContentDimensions:n,getGhostElement:function(){return l}}}},{}],23:[function(e,t,n){function i(){this.handlers={}}var a=e("../../utils/humps");i.prototype=_.extend({},Backbone.Events),i.prototype.initialize=function(){_.bindAll(this,"propagate","handle"),this.editor=INKIVE.Tool.getInstance().editor,this.canvas=this.editor.canvas,_.each(this.handlers,function(e,t){e.initialize(),e.on("all",_.partial(this.propagate,t))},this)},i.prototype.handle=function(e,t,n){function i(e,t){this.handlers[e]&&_.isFunction(this.handlers[e][o])&&(t||this.handlers[e][o](n),t&&this.handlers[e][o](t,n))}var o=a.camelize(e);if(_.isString(e)&&_.isFunction(this[o]))return this[o](t,n);if(t){if(o=a.camelize(t),_.isString(e)&&this.handlers[e]&&_.isFunction(this.handlers[e][o]))return this.handlers[e][o](n);if(_.isString(e)&&_.isFunction(this[o]))return this[o](e)}if(_.isString(t)||n){var r=$("#"+e)[0],s=this.handlers[e]?e:this.getType(r);return i.call(this,s,r)}n=t;var l=_.toArray(this.canvas.getSelectedElems());_.each(l,function(e){i.call(this,this.getType(e),e)},this),this.canvas.selectOnly(l)},i.prototype.propagate=function(e,t,n){this.trigger(t?e+"."+t:e,n)},i.prototype.getType=function(e,t){if(!e&&t&&(e=$("#svg_background_image[data-old-id="+t+"]")[0]),e)return $(e).parent().is(".background")?"background":$(e).is(".video")?"video":$(e).is(".logo")?"logo":$(e).is(".icon")?"icon":$(e).is(".textarea")?"text":$(e).is(".sticker")?"sticker":$(e).is(".group")?"group":$(e).is("#svgroot")?"root":"image"===e.nodeName?$(e).parent().is(".clipperImage")?"imageclipper":"image":"shape"},i.prototype.trigger=function(e,t){if(INKIVE.C.IS_DEV){var n=new Date;n=n.getHours()+":"+n.getMinutes()+":"+n.getSeconds();var i=_.isString(t)&&t.length>120?t.substring(0,120)+" ...":t;INKIVE.C.DEBUG&&console.log(n+": "+e,i)}Backbone.Events.trigger.apply(this,arguments)},t.exports=i},{"../../utils/humps":482}],24:[function(e,t,n){function i(){}t.exports=i,i.prototype=_.extend({},Backbone.Events),i.prototype.initialize=function(){this.editor=INKIVE.Tool.getInstance().editor,this.canvas=this.editor.canvas,this.mandatory=[],this.defaults={position:{x:100,y:100},rotation:0,size:{width:100,height:100},opacity:1},_.bindAll(this,"create","getDefinedData")},i.prototype.getDefinedData=function(e,t){for(var n,i=t.split("."),a=this.defaults;i.length>0;)n=i.shift(),"undefined"!=typeof e&&(e=e[n]),"undefined"!=typeof a&&(a=a[n]);return"undefined"==typeof e?a:e}},{}],25:[function(e,t,n){function i(){}var a=e("./element");t.exports=i,i.prototype=new a,i.prototype.constructor=i,i.prototype.initialize=function(){a.prototype.initialize.call(this),_.bindAll(this,"updateContent"),_.extend(this.defaults,{content:null})},i.prototype.updateContent=function(e,t){var n=Base64.decode(t.content),i=INKIVE.Helpers.getStickerFromString(n,t.sticker_id);if(i){var a=e.getAttribute("id");i.classList=_(e.classList).without("selected").join(" "),this.editor.replaceElement(e,i),i.setAttribute("id",a)}}},{"./element":24}],26:[function(e,t,n){function i(){}t.exports=i,i.prototype=_.extend({},Backbone.Events),i.prototype.constructor=i,i.prototype.initialize=function(){var e=INKIVE.Tool.getInstance().editor;this.canvas=e.canvas},i.prototype.create=function(e){e&&e.link?this.canvas.groupSelectedElements("a",INKIVE.Helpers.isUrlValid(e.link)?e.link:"http://"+e.link):this.canvas.groupSelectedElements();var t=this.canvas.getSelectedElems()[0];return this.trigger("",t.getAttribute("id")),t.getAttribute("id")}},{}],27:[function(e,t,n){function i(){}var a=e("./logo"),o=e("./abstract/element"),r=e("../../../factory/images");t.exports=i,i.prototype=new o,i.prototype.constructor=i,i.prototype.create=function(e){e.thumb_src=e.is_vector?e.thumb_src:r.getVersionUrl(e.thumb_src,"thumb");var t=this._createIconContainer(e),n=_.bind(function(){this.trigger("",t.getAttribute("id"))},this);return e.is_vector?(e.content||this.fetchContent(t,e),e.content&&this.updateContent(t,e),this.once("content",n)):(this._smartImageLoad(t,e),this.once("resolution_optimized",n)),this.canvas.selectOnly([t]),t.getAttribute("id")},i.prototype._createIconContainer=function(e){var t=this.canvas.addSvgElementFromJson({element:"g",attr:{id:this.canvas.getNextId(),"class":"element icon"}});return this._appendImageIcon(t,e),t},i.prototype.updateContent=function(e,t){var n=INKIVE.Helpers.getStickerFromString(t.content);n.classList=[],e.appendChild(n),$(e).children("image")[0].setAttribute("opacity",0),this.canvas.runExtensions("updateIconDimensions",{elem:e}),this.trigger("content",e.getAttribute("id"),t)},i.prototype.initialize=a.prototype.initialize,i.prototype._smartImageLoad=a.prototype._smartImageLoad,i.prototype.fetchContent=a.prototype.fetchContent,i.prototype._appendImageIcon=a.prototype._appendImageLogo,i.prototype.getAddData=a.prototype.getAddData},{"../../../factory/images":102,"./abstract/element":24,"./logo":29}],28:[function(e,t,n){function i(){}var a=e("./abstract/element"),o=e("../setters/image"),r=e("../../../factory/images");t.exports=i,i.prototype=_.extend(new a,o.prototype),i.prototype.constructor=i,i.prototype.initialize=function(){a.prototype.initialize.call(this),this.mandatory=["source.url"],_.extend(this.defaults,{placeholder:!0,source:{url:"https://static.inkive.com/assets/img/placeholders/imageplaceholder_new.svg",smart_load:!0,external_resize:!1}})},i.prototype.create=function(t){function n(){var e=o.getAttribute("id");a&&this.resizeExternalPhoto(o,t),a?this.trigger("",e):t.source.base_64?(this.updateSourceBase64(o,t),this.once("source.base_64",_.partial(this.trigger,"",e))):(this.getDefinedData(t,"source.smart_load")&&this.onVersionData(o,t),this.once("source.url",_.partial(this.trigger,"",e)))}var i=e("../../editor/editor"),a="undefined"==typeof t.source.external_resize?this.isExternal(t):t.source.external_resize,o=this.canvas.addElement("image",this.getAddData(t)),r=o.getAttribute("id");return i.once("image.rename."+r,_.bind(function(e){o=$("#"+e.id)[0],n.call(this)},this)),i.handle(r,"crop",{quiet:!0,scale:1}),o.getAttribute("id")},i.prototype.onVersionData=function(e,t){r.storeImageData(t.source.url),o.prototype.onVersionData.apply(this,arguments)},i.prototype.getSize=function(e,t){return{width:this.getDefinedData(t,"size.width"),height:this.getDefinedData(t,"size.height")}},i.prototype.getAddData=function(e){var t=_.bind(this.getDefinedData,this,e),n=t("source.url"),i=r.getVersionUrl(n,"thumb")||n;return{url:i,x:t("position.x"),y:t("position.y"),width:t("size.width"),height:t("size.height")}}},{"../../../factory/images":102,"../../editor/editor":76,"../setters/image":59,"./abstract/element":24}],29:[function(e,t,n){function i(){}var a=e("./abstract/element"),o=e("../../../factory/images");t.exports=i,i.prototype=new a,i.prototype.constructor=i,i.prototype.initialize=function(){a.prototype.initialize.call(this),this.mandatory=["thumb_src"],_.extend(this.defaults,{is_vector:!1,thumb_src:null})},i.prototype.create=function(e){var t=this._createLogoContainer(e),n=_.bind(function(){this.trigger("",t.getAttribute("id"))},this);return e.is_vector?(e.content||this.fetchContent(t,e),e.content&&this.updateContent(t,e),this.once("content",n)):(this._smartImageLoad(t,e),this.once("resolution_optimized",n)),this.canvas.selectOnly([t]),t.getAttribute("id")},i.prototype.fetchContent=function(e,t){var n=t.thumb_src.split(".");n.pop(),n.push("svg"),n=n.join(".");var i=new XMLHttpRequest;i.open("GET",n,!0),i.send(),i.onload=_.bind(function(){t.content=i.responseText,this.updateContent(e,t)},this),this.trigger("fetch_content",e.getAttribute("id"))},i.prototype._createLogoContainer=function(e){var t=this.canvas.addSvgElementFromJson({element:"g",attr:{id:this.canvas.getNextId(),"class":"element logo"}});return this._appendImageLogo(t,e),t},i.prototype._smartImageLoad=function(e,t){var n=$(e).children("image")[0],i=svgedit.utilities.getBBox(n);this.trigger("optimize_resolution",e.getAttribute("id")),o.smartLoad(t.thumb_src,i,_.bind(function(i,a){var o=i===INKIVE.C.Status.success||t.thumb_src;t.thumb_src=i===INKIVE.C.Status.success?a.src:t.thumb_src,o&&(n&&n.setAttribute("xlink:href",t.thumb_src),this.trigger("resolution_optimized",e.getAttribute("id")))},this))},i.prototype.updateContent=function(e,t){var n=INKIVE.Helpers.getStickerFromString(t.content);n.classList=[],e.appendChild(n),$(e).children("image")[0].setAttribute("opacity",0),this.canvas.runExtensions("updateLogoDimensions",{elem:e}),this.trigger("content",e.getAttribute("id"),t)},i.prototype._appendImageLogo=function(e,t){t=this.getAddData(t);var n=t.width>t.height?t.width:t.height,i=this.canvas.addSvgElementFromJson({element:"image",attr:{x:t.x,y:t.y,id:this.canvas.getNextId(),width:n,height:n,"xlink:href":t.url}});e.appendChild(i)},i.prototype.getAddData=function(e){var t=_.bind(this.getDefinedData,this,e);return{x:t("position.x"),y:t("position.y"),url:t("thumb_src"),width:t("size.width"),height:t("size.height")}}},{"../../../factory/images":102,"./abstract/element":24}],30:[function(e,t,n){function i(){}var a=e("./abstract/graphic"),o=e("../../../factory/shapes"),r=e("../setters/abstract/element");t.exports=i,i.prototype=new a,i.prototype.constructor=i,i.prototype.initialize=function(){a.prototype.initialize.call(this),_.extend(this.defaults,{shape_id:null})},i.prototype.create=function(e){var t;return e.content&&(t=this._create(e)),e.shape_id&&this.load(e),t},i.prototype.load=function(e){var t=e.shape_id.split("_");o.get(t[0],t[1]).then(_.bind(function(t){e.content=t.path,this._create(e)},this))},i.prototype._create=function(e){var t=this.canvas.addSvgElementFromJson({element:"path",curStyles:!0,attr:this.getAddData(e)});return $(t).addClass("element"),this.setSize(t,e.size?e:{size:{width:this.getDefinedData(e,"size.width"),height:this.getDefinedData(e,"size.height")}}),this.setPosition(t,{position:{x:this.getDefinedData(e,"position.x"),y:this.getDefinedData(e,"position.y")}}),this.trigger("",t.getAttribute("id")),"undefined"==typeof e.selected||e.selected||this.canvas.clearSelection(),t.getAttribute("id")},i.prototype.setSize=r.prototype.updateSize,i.prototype.setPosition=function(t,n){var i=n.position,a=t.getBBox(),o=e("../../editor/editor"),r=o.handle("zoom","get");this.canvas.clearSelection(),this.canvas.selectOnly([t]),this.canvas.moveSelectedElements((i.x-a.x)*r,(i.y-a.y)*r)},i.prototype.getAddData=function(e){return{d:e.content,id:this.canvas.getNextId(),opacity:this.getDefinedData(e,"opacity")}}},{"../../../factory/shapes":130,"../../editor/editor":76,"../setters/abstract/element":53,"./abstract/graphic":25}],31:[function(e,t,n){function i(){}var a=e("./abstract/graphic");t.exports=i,i.prototype=new a,i.prototype.constructor=i,i.prototype.initialize=function(){a.prototype.initialize.call(this),this.mandatory=["sticker_id"],_.extend(this.defaults,{sticker_id:null,thumb_src:"https://static.inkive.com/assets/img/placeholders/imageplaceholder_new.svg"})},i.prototype.create=function(e){var t=this.canvas.addElement("sticker",this.getAddData(e));return e.svg_url?this.fetchSvgUrlContent(t,e):(e.content||!e.sticker_id||this.fetchContent(t,e),e.content&&this.updateContent(t,e)),this.trigger("",t.getAttribute("id")),("undefined"==typeof e.selected||e.selected)&&this.canvas.selectOnly([t]),t.getAttribute("id")},i.prototype.fetchContent=function(e,t){var n=_.partial(this.updateContent,e);INKIVE.Helpers.api("search/sticker","GET",{id:t.sticker_id},_.bind(function(i){this.canvas.clearSelection(),n(_.extend(t,{content:i.content})),("undefined"==typeof t.selected||t.selected)&&this.canvas.selectOnly([document.getElementById(e.id)]),this.trigger("",e.getAttribute("id"));
},this))},i.prototype.fetchSvgUrlContent=function(e,t){var n=_.partial(this.updateContent,e);$.ajax({url:t.svg_url,dataType:"text",success:_.bind(function(i){this.canvas.clearSelection(),n(_.extend(t,{content:Base64.encode(i)})),("undefined"==typeof t.selected||t.selected)&&this.canvas.selectOnly([document.getElementById(e.id)]),this.trigger("",e.getAttribute("id"))},this)})},i.prototype.getAddData=function(e){var t=_.bind(this.getDefinedData,this,e);return{x:t("position.x"),y:t("position.y"),url:t("thumb_src"),width:t("size.width"),height:t("size.height"),favouiritesId:e.sticker_id}}},{"./abstract/graphic":25}],32:[function(e,t,n){function i(){}var a=e("./abstract/element"),o=e("../setters/text");t.exports=i,i.prototype=new a,i.prototype.constructor=i,i.prototype.initialize=function(){a.prototype.initialize.call(this),this.mandatory=["text"],_.extend(this.defaults,{content:null,font:{family:"Lato",size:"21",weight:null,style:null},decoration:null})},i.prototype.create=function(e){var t=this.getAddData(e),n=this.canvas.addElement("textarea",t);return o.prototype._processFontFamily.call(this,n,{family:t.text.font_family}),this.trigger("",n.getAttribute("id")),("undefined"==typeof e.selected||e.selected)&&this.canvas.selectOnly([n]),n.getAttribute("id")},i.prototype.getAddData=function(e){var t=_.bind(this.getDefinedData,this,e);return{x:t("position.x"),y:t("position.y"),width:t("size.width"),text:{font_size:t("font.size"),font_family:"'"+t("font.family").replace(/\'/g,"\\'")+"'",font_weight:t("font.weight"),font_style:t("font.style"),text_decoration:t("decoration"),textContent:t("content")}}}},{"../setters/text":72,"./abstract/element":24}],33:[function(e,t,n){function i(){}var a=e("../getters/video"),o=e("../setters/video"),r=e("./abstract/element"),s=e("../../../factory/images");t.exports=i,i.prototype=new r,i.prototype.constructor=i,i.prototype.initialize=function(){r.prototype.initialize.call(this),this.mandatory=["thumb_src"],_.extend(this.defaults,{source:null,thumb_src:null})},i.prototype.create=function(e){e.source=this._getYoutubeCode(e.source),e.thumb_src=e.thumb_src||"http://img.youtube.com/vi/"+e.source+"/mqdefault.jpg";var t=this._createVideoContainer(e),n=!s.isAmazonImage(e.thumb_src);return n&&this._resizeExternalThumbnail(t,e),n||this._smartImageLoad(t,e),this.trigger("",t.getAttribute("id")),t.getAttribute("id")},i.prototype._createVideoContainer=function(e){var t=this.canvas.addSvgElementFromJson({element:"a",attr:{id:this.canvas.getNextId(),"class":"element video","xlink:href":"https://www.youtube.com/watch?v="+e.source}});return this._appendVideoThumbnail(t,e),this._appendVideoCoords(t,e),this._appendPlayIcon(t),t},i.prototype._resizeExternalThumbnail=o.prototype._resizeExternalThumbnail,i.prototype._matchBoxToImage=o.prototype._matchBoxToImage,i.prototype._matchImageToBox=o.prototype._matchImageToBox,i.prototype.updateSize=o.prototype.updateSize,i.prototype._smartImageLoad=o.prototype._smartImageLoad,i.prototype._appendPlayIcon=o.prototype._appendPlayIcon,i.prototype._appendVideoThumbnail=function(e,t){t=this.getAddData(t);var n=this.canvas.addSvgElementFromJson({element:"image",attr:{x:t.x,y:t.y,id:this.canvas.getNextId(),width:t.width,height:t.height,"xlink:href":t.url}});e.appendChild(n)},i.prototype._appendVideoCoords=function(e,t){var n=this.canvas.addSvgElementFromJson({element:"title",attr:{id:this.canvas.getNextId()}});t=this.getAddData(t),$(n).addClass("coords"),n.textContent=Math.floor4(t.x)+" "+Math.floor4(t.y)+" "+Math.floor4(t.width)+" "+Math.floor4(t.height),e.appendChild(n)},i.prototype.getAddData=function(e){var t=_.bind(this.getDefinedData,this,e);return{x:t("position.x"),y:t("position.y"),url:t("thumb_src"),width:t("size.width"),height:t("size.height")}},i.prototype._getYoutubeCode=a.prototype._getYoutubeCode},{"../../../factory/images":102,"../getters/video":47,"../setters/video":73,"./abstract/element":24}],34:[function(e,t,n){function i(){}var a=e("./facade"),o=e("../../utils/humps"),r=e("../../factory/images");i.prototype=new a,i.prototype.constructor=i,i.prototype.initialize=function(){a.prototype.initialize.call(this),_.bindAll(this,"set","get","create","preview")},i.prototype.preview=function(t,n){function i(){return{size:{width:this.canvas.getResolution().w,height:this.canvas.getResolution().h},position:{x:0,y:0}}}var a;e("../editor/editor");t=t||"full",n=n||{};var o=$("#svgcontent"),r="full"===t?i.call(this):this.get(t);switch(t){case"full":a=o[0];break;case"background":a=o.children("g.background").children(":not(title)").last()[0];break;default:a=$("#"+t)[0]}if(!a||!r)return void this.propagate("exception",t,null,"Element not found");var s=document.createElement("canvas"),l=r.size.width/r.size.height,c=n.maxwidth||800,d=n.maxheight||256,u=l*d>c?c/l:d,p=l*u,h='<svg xmlns="http://www.w3.org/2000/svg" xlinkns="http://www.w3.org/1999/xlink"';h+=' height="'+u+'" width="'+p+'" x="0" y="0"',h+=' viewBox="'+r.position.x+", "+r.position.y+", "+r.size.width+", "+r.size.height+'">',n.background&&(h+='<rect fill="'+n.background+'" height="'+r.size.height+'" width="'+r.size.width+'" x="'+r.position.x+'" y="'+r.position.y+'"></rect>'),h+=(new XMLSerializer).serializeToString(a)+"</svg>",h=this.canvas.svgCanvasToString($(h)[0]);try{canvg(s,h,{useCORS:!0,ignoreDimensions:!1,renderCallback:_.bind(function(){var e=n.format||(n.background?"jpeg":"png"),i=n.quality||.6,a=s.toDataURL("image/"+e,"jpg"===e?i:null);n.isdownload&&(t="download"),this.propagate("preview",t,null,a)},this)})}catch(m){this.propagate("exception",t,null,m)}},i.prototype["delete"]=function(e,t){this.preSelect(e)&&(_.each(this.canvas.getSelectedElems(),function(e){var n=o.camelize("delete_"+this.getType(e));this[n]&&this[n](e,t)},this),this.canvas.deleteSelectedElements(),this.trigger("delete"))},i.prototype.deleteImage=function(e){var t=e.getAttribute("xlink:href"),n=r.getImageUrl(e);!n&&INKIVE.Helpers.isDataURL(t)&&r.blacklistImage(e)},i.prototype.deleteBackground=function(e,t){if("color"===t||"image"===t){var n=$("#svgcontent").find("g.background"),e=n.find("image"===t?t:"rect");this.canvas.selectOnly(e),this.canvas.deleteSelectedElements()}},i.prototype.duplicate=function(e){this.canvas.cloneSelectedElements(20,20),this.trigger("duplicate")},i.prototype.sendForward=function(e){this.preSelect(e)&&(this.canvas.moveUpDownSelected("Up"),this.trigger("send_forward"))},i.prototype.sendBackward=function(e){this.preSelect(e)&&(this.canvas.moveUpDownSelected("Down"),this.trigger("send_backward"))},i.prototype.sendTop=function(e){this.preSelect(e)&&(this.canvas.moveToTopSelectedElement(),this.trigger("send_top"))},i.prototype.sendBottom=function(e){this.preSelect(e)&&(this.canvas.moveToBottomSelectedElement(),this.trigger("send_bottom"))},i.prototype.preSelect=function(e){if(e){var t="background"===e?$("#svgcontent").children("g.background").children(":not(title)").last()[0]:$("#"+e)[0];if(!t)return!1;this.canvas.selectOnly([t])}return this.canvas.getSelectedElems().length>0},t.exports=new i},{"../../factory/images":102,"../../utils/humps":482,"../editor/editor":76,"./facade":35}],35:[function(e,t,n){function i(){this.handlers={sticker:e("./handlers/sticker"),shape:e("./handlers/shape"),group:e("./handlers/group"),image:e("./handlers/image"),background:e("./handlers/background")},_.each(o,function(e,t){var n={};_.each(e,function(e,t){n[t]=new e}),this[t]=n},this)}var a=e("../abstract/facade"),o={creators:{sticker:e("./creators/sticker"),shape:e("./creators/shape"),image:e("./creators/image"),group:e("./creators/group"),text:e("./creators/text"),icon:e("./creators/icon"),logo:e("./creators/logo"),video:e("./creators/video")},setters:{sticker:e("./setters/sticker"),shape:e("./setters/shape"),image:e("./setters/image"),background:e("./setters/background"),text:e("./setters/text"),group:e("./setters/group"),template:e("./setters/template"),icon:e("./setters/icon"),logo:e("./setters/logo"),video:e("./setters/video")},getters:{template:e("./getters/template"),text:e("./getters/text"),image:e("./getters/image"),sticker:e("./getters/sticker"),background:e("./getters/background"),group:e("./getters/group"),shape:e("./getters/shape"),icon:e("./getters/icon"),logo:e("./getters/logo"),video:e("./getters/video")}};i.prototype=new a,i.prototype.constructor=i,i.prototype.initialize=function(){a.prototype.initialize.call(this),_.invoke(this.getters,"initialize"),_.each(this.setters,function(e,t){e.initialize(),e.on("all",_.partial(this.propagate,t+".update"))},this),_.each(this.creators,function(e,t){e.initialize(),e.on("all",_.partial(this.propagate,t+".create"))},this)},i.prototype.get=function(t,n){function i(e){var i=this.getters[t]?t:this.getType(e);if(this.getters[i]){var o=e?this.getters[i].get(e,n):this.getters[i].get(n);if(n)return o;var r=t;e&&(r=$(e).parent().is("g.background")?"background":e.getAttribute("id"));var s=a.getElementName(r),l=a.getAllElementPermissions(r);return _.extend(o,{type:i,name:s,permissions:l})}}var a=e("../restrictions/restrictions");if("undefined"==typeof t){var o=$("#svgcontent").children("g.main").children();o=_.filter(o,function(e){return e.getBBox});var r=$("#svgcontent").children("g.background");return(r.children("rect").length||r.children("image").length)&&o.unshift(r.children()[0]),_.map(o,i,this).reverse()}return i.call(this,$("#"+t)[0])},i.prototype.create=function(e,t){if(this.creators[e])return this.creators[e].create(t)},i.prototype.set=function(e,t){function n(n,i){this.setters[n]?(i||this.setters[n].set(t),i&&this.setters[n].set(i,t)):this.propagate("exception",e,null,t)}var i=!_.isString(e)&&!t;if(i){t=e;var a=_.toArray(this.canvas.getSelectedElems());_.each(a,function(e){var t=this.getType(e);n.call(this,this.getType(e),"background"!==t&&e)},this)}else{var o=$("#"+e)[0],r=this.setters[e]?e:this.getType(o,e);n.call(this,r,o)}},i.prototype.propagate=function(e,t,n,i){n&&(i=_.extend(i||{},{id:n}),this.trigger(n+(t?"."+t:""),i)),this.trigger(e+(t?"."+t:""),i)},t.exports=i},{"../abstract/facade":23,"../restrictions/restrictions":94,"./creators/group":26,"./creators/icon":27,"./creators/image":28,"./creators/logo":29,"./creators/shape":30,"./creators/sticker":31,"./creators/text":32,"./creators/video":33,"./getters/background":38,"./getters/group":39,"./getters/icon":40,"./getters/image":41,"./getters/logo":42,"./getters/shape":43,"./getters/sticker":44,"./getters/template":45,"./getters/text":46,"./getters/video":47,"./handlers/background":48,"./handlers/group":49,"./handlers/image":50,"./handlers/shape":51,"./handlers/sticker":52,"./setters/background":56,"./setters/group":57,"./setters/icon":58,"./setters/image":59,"./setters/logo":60,"./setters/shape":69,"./setters/sticker":70,"./setters/template":71,"./setters/text":72,"./setters/video":73}],36:[function(e,t,n){function i(){}var a=e("./getter");t.exports=i,i.prototype=new a,i.prototype.constructor=i,i.prototype.initialize=function(){this.editor=INKIVE.Tool.getInstance().editor,this.canvas=this.editor.canvas,this.structure={id:null,z_index:null,position:{x:null,y:null},rotation:null,size:{width:null,height:null},opacity:null,locked:null}},i.prototype.getId=function(){function e(){var e,t=this.editor||INKIVE.Tool.getInstance().editor;do e=t.getNextId();while($("#"+e).length);return this.element.setAttribute("id",e),e}return this.element.getAttribute("id")||e.call(this)},i.prototype.getRotation=function(){return this.canvas.getRotationAngle(this.element)},i.prototype.getOpacity=function(){var e=parseFloat(this.element.getAttribute("opacity"));return _.isNaN(e)?1:e},i.prototype.getPositionX=function(){try{this.bb=this.bb||this.element.getBBox()}catch(e){}return this.bb?this.bb.x:0},i.prototype.getPositionY=function(){try{this.bb=this.bb||this.element.getBBox()}catch(e){}return this.bb?this.bb.y:0},i.prototype.getSizeWidth=function(){try{this.bb=this.bb||this.element.getBBox()}catch(e){}return this.bb?this.bb.width:0},i.prototype.getSizeHeight=function(){try{this.bb=this.bb||this.element.getBBox()}catch(e){}return this.bb?this.bb.height:0},i.prototype.getLocked=function(){return $(this.element).hasClass("locked")}},{"./getter":37}],37:[function(e,t,n){function i(){}var a=e("../../../../utils/humps");t.exports=i,i.prototype=_.extend({},Backbone.Events),i.prototype.initialize=function(){this.structure={}},i.prototype.get=function(e,t){function n(e){return e.split("..").length>1}function i(e){return!n(e)}this.element=e,this.bb=this.element&&this.element.getBBox(),t=t||"",this.data={},this.collections={},this.processData={};var a=this.getChainAttributes(t),o=_.bind(this.processModels,this,t);return _.each(_.filter(a,n),this.processCollections,this),_.each(_.filter(a,i),o,this),this.addCollectionResults(t),this.data},i.prototype.processCollections=function(e){function t(){var e="get_"+i.replace(/\./g,"_"),t=a.camelize(e);this.collections[i]={},this.processData[i]=this[t]?this[t]():[],_.each(this.processData[i],function(e,t){this.collections[i][t]={}},this)}var n=e.split(".."),i=n[0],o=n[1];this.collections[i]||t.call(this);var r=this.collections[i],s=a.camelize("get_"+i.replace(/\./g,"_")+"_"+o.replace(/\./g,"_")),l=a.camelize("get_"+o.replace(/\./g,"_"));_.each(this.processData[i],function(e,t){if(this[s]||e[l]){var e=e[l]?e[l](t):this[s](e,t);this.addDataResult(o,e,r[t])}},this)},i.prototype.addCollectionResults=function(e){var t=new RegExp(e+"[.]?");_.each(this.collections,function(e,n){this.addDataResult(n.replace(t,""),e)},this)},i.prototype.processModels=function(e,t){var n="get_"+t.replace(/\./g,"_"),i=a.camelize(n),o=new RegExp(e+"[.]?");this[i]&&this.addDataResult(t.replace(o,""),this[i]())},i.prototype.addDataResult=function(e,t,n){var i,a=_.compact(e.split("..")[0].split(".")),o=n||this.data;if(!a.length)return void(n?n=t:this.data=t);for(;a.length>1;)i=a.shift(),o[i]||(o[i]={}),o=o[i];o[a.shift()]=t},i.prototype.getChainAttributes=function(e,t){t=t||this.getChainEnd(e);var n=[];return"undefined"!=typeof t&&!_.isObject(t)&&n.push(e),_.each(t,function(i,a){e&&(a=e+"."+(_.isArray(t)?"":a)),i?n=_.union(n,this.getChainAttributes(a,i)):n.push(a)},this),n},i.prototype.getChainEnd=function(e){for(var t,n=_.compact(e.split(".")),i=this.structure;n.length>0;){if(t=n.shift(),"undefined"==typeof i)return;i=i[t]}return i}},{"../../../../utils/humps":482}],38:[function(e,t,n){function i(){}var a=e("./abstract/getter"),o=e("../../../../../bower_components/tinycolor/tinycolor");t.exports=i,i.prototype=new a,i.prototype.constructor=i,i.prototype.initialize=function(){a.prototype.initialize.call(this),this.editor=INKIVE.Tool.getInstance().editor,this.canvas=this.editor.canvas,this.structure={color:null,source:null,background_id:null,image_opacity:null,id:null,flipped:null,position:{x:null,y:null},size:{width:null,height:null}}},i.prototype.get=function(e,t){return a.prototype.get.call(this,$("#svgcontent > .background")[0],t)},i.prototype.getColor=function(){var e=$(this.element).find("rect")[0],t=o(e?e.getAttribute("fill"):"");return t.isValid()&&t.getAlpha()?t.toString():null},i.prototype.getSource=function(){var e=$(this.element).find("image")[0];if(!e)return null;var t=e.getAttribute("xlink:href");return INKIVE.Helpers.isDataURL(t)?"<data>":t},i.prototype.getImageOpacity=function(){var e=$(this.element).find("image")[0];return e?e.getAttribute("opacity"):null},i.prototype.getId=function(){return"background"},i.prototype.getFlipped=function(){var e=$(this.element).find("image");return{vertical:e.hasClass(INKIVE.C.FLIP_IMAGE.VERTICAL),horizontal:e.hasClass(INKIVE.C.FLIP_IMAGE.HORIZONTAL)}},i.prototype.getBackgroundId=function(){var e=$(this.element).find("image")[0];if(!e)return null;var t=e.getAttribute("class");if(t){var n=t.match(/favourites-background-image-id-(\d+)/);return n&&n[1]}},i.prototype.getPositionX=function(){return 0},i.prototype.getPositionY=function(){return 0},i.prototype.getSizeWidth=function(){return this.canvas.contentW},i.prototype.getSizeHeight=function(){return this.canvas.contentH}},{"../../../../../bower_components/tinycolor/tinycolor":3,"./abstract/getter":37}],39:[function(e,t,n){function i(){}var a=e("./abstract/element"),o=e("../../abstract/facade");t.exports=i,i.prototype=new a,i.prototype.constructor=i,i.prototype.initialize=function(){var e=INKIVE.Tool.getInstance().editor;this.canvas=e.canvas,this.structure={id:null,position:{x:null,y:null},size:{width:null,height:null},elements:null,rotation:null,opacity:null,locked:null,link:null}},i.prototype.getLink=function(){return svgedit.utilities.getHref(this.element)},i.prototype.getElements=function(){return _.chain($(this.element).children()).sortBy(function(e){return-$(e).index()}).map(function(e){return{id:e.getAttribute("id"),type:this.getType(e)}},this).value()},i.prototype.getType=o.prototype.getType},{"../../abstract/facade":23,"./abstract/element":36}],40:[function(e,t,n){function i(){}var a=e("./logo");t.exports=a,i.prototype=new a,i.prototype.constructor=i},{"./logo":42}],41:[function(e,t,n){function i(){}var a=e("./abstract/element"),o=e("./shape");t.exports=i,i.prototype=new a,i.prototype.constructor=i,i.prototype.initialize=function(){a.prototype.initialize.call(this),this.structure=_.extend(this.structure,{source:{url:null},flipped:null,filter:{},crop_area:[{position:{x:null,y:null},size:{width:null,height:null},type:null}]})},i.prototype.getSourceUrl=function(){var e=this.element.getAttribute("xlink:href");return INKIVE.Helpers.isDataURL(e)?"<data>":e},i.prototype.getFlipped=function(){return{vertical:$(this.element).hasClass(INKIVE.C.FLIP_IMAGE.VERTICAL),horizontal:$(this.element).hasClass(INKIVE.C.FLIP_IMAGE.HORIZONTAL)}},i.prototype.getCropArea=function(){var e,t={},n=this.element.getAttribute("clip-path");return n?(e=n.match(/url\(\"?([^\"\)]*)\"?\)/)[1],$(e).children(".layoutClipper").each(function(e,n){t[e]=new o,t[e].element=n}),t):t}},{"./abstract/element":36,"./shape":43}],42:[function(e,t,n){function i(){}var a=e("./abstract/element"),o=e("./sticker"),r=e("../../../factory/images");t.exports=i,i.prototype=new a,i.prototype.constructor=i,i.prototype.initialize=function(){a.prototype.initialize.call(this),this.stickerGetter=new o,this.stickerGetter.initialize(),this.structure=_.extend(this.structure,{is_vector:null,thumb_src:null,shapes:[{type:null,fill:{color:null},stroke:{color:null,width:null,dasharray:null}}]})},i.prototype.get=function(e){var t=$(e).children("g")[0];$(e).is("image")?e:$(e).children("image")[0];this.element=e,this.bb=e.getBBox(),this.stickerGetter.element=t,this.stickerGetter.bb=t&&t.getBBox(),this.stickerGetter.data=this.data={},this.stickerGetter.collections=this.collections={},this.stickerGetter.processData=this.processData={};var n=this.structure;t||(this.structure=_.omit(this.structure,"texts","shapes"));var i=a.prototype.get.apply(this,arguments);return this.structure=n,i},i.prototype.getIsVector=function(){return!!this.stickerGetter.element},i.prototype.getThumbSrc=function(){var e=$(this.element).is("image")?this.element:$(this.element).children("image")[0];return e?r.getOriginalUrl(e.getAttribute("xlink:href")):null},i.prototype.getShapes=function(){return this.stickerGetter.getShapes()}},{"../../../factory/images":102,"./abstract/element":36,"./sticker":44}],43:[function(e,t,n){function i(){}var a=e("./abstract/element"),o=(e("./text"),e("../../../../../bower_components/tinycolor/tinycolor"));t.exports=i,i.prototype=new a,i.prototype.constructor=i,i.prototype.initialize=function(){a.prototype.initialize.call(this),this.structure=_.extend(this.structure,{type:null,fill:{color:null},stroke:{color:null,width:null,dasharray:null,linejoin:null,linecap:null}})},i.prototype.getType=function(){return this.element.nodeName},i.prototype.getFillColor=function(e){e=_.isElement(e)?e:this.element;var t=o(e.getAttribute("fill"));return t.isValid()&&t.getAlpha()?t.toString():null},i.prototype.getStrokeColor=function(){if(this.element.getAttribute("stroke")||this.element.getAttribute("stroke-width")){var e=o(this.element.getAttribute("stroke")||"#000");if(e.isValid()&&e.getAlpha())return e.toString()}},i.prototype.getStrokeWidth=function(){if(this.element.getAttribute("stroke"))return parseInt(this.element.getAttribute("stroke-width"))||1},i.prototype.getStrokeDasharray=function(){return this.element.getAttribute("stroke-dasharray")},i.prototype.getStrokeLinejoin=function(){return this.element.getAttribute("stroke-linejoin")},i.prototype.getStrokeLinecap=function(){return this.element.getAttribute("stroke-linecap")},i.prototype.getSizeWidth=function(){var e=a.prototype.getSizeWidth.call(this);return e||"line"!==this.element.nodeName?e:this.getStrokeWidth()},i.prototype.getSizeHeight=function(){var e=a.prototype.getSizeHeight.call(this);return e||"line"!==this.element.nodeName?e:this.getStrokeWidth()}},{"../../../../../bower_components/tinycolor/tinycolor":3,"./abstract/element":36,"./text":46}],44:[function(e,t,n){function i(){}var a=e("./abstract/element"),o=e("./text"),r=e("./shape");t.exports=i,i.prototype=new a,i.prototype.constructor=i,i.prototype.initialize=function(){a.prototype.initialize.call(this),this.supportedSubElements=["image","ellipse","line","rect","text","polygon","circle","ellipse","path","g"],this.structure=_.extend(this.structure,{texts:[{id:null,content:null,decoration:null,color:null,anchor:null,font:{family:null,weight:null,style:null}}],shapes:[{type:null,fill:{color:null},stroke:{color:null,width:null,dasharray:null}}]})},i.prototype.getTexts=function(){return _.map($(this.element).find(".textarea"),function(e){var t=new o;return t.element=e,t.textarea=(new INKIVE.Text.Textarea).setDOM(e),t.text=t.textarea.text,t})},i.prototype.getShapes=function(){var e={};return _.each(this.getElements(),function(t,n){e[n]=new r,e[n].element=t}),e},i.prototype.getElementsWithColor=function(e){function t(e,t){var a=$(e).closest("g")[0],o=a&&$.contains(a,e)&&a.getAttribute("fill"),r=!o&&_.contains(i,e.tagName);(e.getAttribute("fill")||r)&&(n[t]=e)}e=e||this.element;var n={},i=["path","line","polygon","rect","circle","ellipse"];return _.each(this.getElements(e),t),n},i.prototype.getElements=function(e){e=e||this.element;var t=[e];return _.each($(e).children(),function(e){if(_.contains(this.supportedSubElements,e.tagName)){var n="g"===e.tagName,i=$(e).hasClass("textarea");n&&!i?t=_.union(t,this.getElements(e)):$(e).is("rect.background")||t.push(e)}},this),t}},{"./abstract/element":36,"./shape":43,"./text":46}],45:[function(e,t,n){function i(){}var a=e("./abstract/getter");t.exports=i,i.prototype=new a,i.prototype.constructor=i,i.prototype.initialize=function(){this.editor=INKIVE.Tool.getInstance().editor,this.canvas=this.editor.canvas,this.structure={size:{width:null,height:null},format:{id:null},grid:{index_in_set:null,number_of_photos:null},designed:{id:null},restricted:{base_page:null}}},i.prototype.get=function(e,t){return t?a.prototype.get.call(this,e,t):a.prototype.get.call(this,$("#svgcontent")[0],e)},i.prototype.getSizeWidth=function(){return this.canvas.contentW},i.prototype.getSizeHeight=function(){return this.canvas.contentH},i.prototype.getDesignedId=function(){return this.getClassExpData(/layout-id-(\d+)/)},i.prototype.getFormatId=function(){return this.getClassExpData(/format-id-(\d+)/)},i.prototype.getGridIndexInSet=function(){return this.getClassExpData(/grid-id-[\d+]-(\d+)/)},i.prototype.getGridNumberOfPhotos=function(){return this.getClassExpData(/grid-id-(\d+)-[\d+]/)},i.prototype.getRestrictedBasePage=function(){return this.getClassExpData(/base-page-(\d+)/)},i.prototype.getClassExpData=function(e){var t,n=$(this.element).children("g.main"),i=n.attr("class");return i&&_.any(i.split(" "),function(n){var i=n.match(e);if(i)return t=i[1]}),t}},{"./abstract/getter":37}],46:[function(e,t,n){function i(){}var a=e("./abstract/element");t.exports=i,i.prototype=new a,i.prototype.constructor=i,i.prototype.initialize=function(){a.prototype.initialize.call(this),this.structure=_.extend(this.structure,{color:null,anchor:null,content:null,decoration:null,bullet_points:null,auto_adjustable:null,font:{family:null,size:null,weight:null,style:null},spacing:{letter:null,word:null,line:null},stroke:{width:null,color:null,dasharray:null}})},i.prototype.get=function(e){return this.textarea=(new INKIVE.Text.Textarea).setDOM(e),this.text=this.textarea.text,a.prototype.get.apply(this,arguments)},i.prototype.getStrokeColor=function(){return this.text.stroke},i.prototype.getStrokeWidth=function(){return this.text.stroke_width},i.prototype.getStrokeDasharray=function(){return this.text.stroke_dasharray},i.prototype.getSpacingWord=function(){return this.text.word_spacing},i.prototype.getSpacingLine=function(){return this.text.line_spacing},i.prototype.getFontFamily=function(){return this.text.font_family},i.prototype.getFontSize=function(){return this.text.font_size},i.prototype.getFontWeight=function(){return this.text.font_weight},i.prototype.getFontStyle=function(){return this.text.font_style},i.prototype.getDecoration=function(){return this.text.text_decoration},i.prototype.getAnchor=function(){return this.text.text_anchor},i.prototype.getColor=function(){return this.text.fill},i.prototype.getBulletPoints=function(){return this.text.bullets},i.prototype.getAutoAdjustable=function(){return this.text.auto_adjustable},i.prototype.getSpacingLetter=function(){var e=this.text.letter_spacing;return _.isArray(this.text.letter_spacing)&&(e=this.text.letter_spacing.length<2?0:_.reduce(this.text.letter_spacing,function(e,t){return e+parseFloat(t)},0)/(this.text.letter_spacing.length-1)),parseInt(e)},i.prototype.getContent=function(){var e=new RegExp(String.fromCharCode(160),"g");return this.text.textContent.replace(e," ")}},{"./abstract/element":36}],47:[function(e,t,n){function i(){}var a=e("./abstract/element"),o=e("../../../factory/images");t.exports=i,i.prototype=new a,i.prototype.constructor=i,i.prototype.initialize=function(){a.prototype.initialize.call(this),this.structure=_.extend(this.structure,{source:null,thumb_src:null,autoplay:null,movetonext:null,controls:null,fullscreen:null,loop:null,mute:null})},i.prototype.getSource=function(){var e=this.element.getAttribute("xlink:href");return e?this._getYoutubeCode(e):null},i.prototype.getThumbSrc=function(){var e=$(this.element).children("image")[0];if(!e)return null;var t=e.getAttribute("xlink:href");return o.getVersionUrl(t,"thumb")},i.prototype.getAutoplay=function(){return $(this.element).is(".autoplay")},i.prototype.getMovetonext=function(){return $(this.element).is(".movetonext")},i.prototype.getControls=function(){return $(this.element).is(".controls")},i.prototype.getFullscreen=function(){return $(this.element).is(".fullscreen")},i.prototype.getLoop=function(){return $(this.element).is(".loop")},i.prototype.getMute=function(){return $(this.element).is(".mute")},i.prototype._getYoutubeCode=function(e){if(!e)return e;var t=/(youtu\.be\/|youtube\.com\/(watch\?(.*&)?v=|(embed|v)\/))([^\?&"'>]+)/,n=e.match(t),i=n&&n.length>4&&n[5];return i||(n=e.trim().match(/^[a-zA-Z0-9_-]{11}$/),i=n&&n[0]),i}},{"../../../factory/images":102,"./abstract/element":36}],48:[function(e,t,n){t.exports=_.extend({initialize:function(){this.tool=INKIVE.Tool.getInstance(),this.editor=this.tool.editor,this.canvas=this.editor.canvas},flipVertical:function(e){return $("#"+e.id+"-loader").length?void this.canvas.call("advice.show","image-flip-disabled"):(this.canvas.selectOnly([e]),void INKIVE.DesignFacade.set({flipped:{vertical:!0}}))},flipHorizontal:function(e){return $("#"+e.id+"-loader").length?void this.canvas.call("advice.show","image-flip-disabled"):(this.canvas.selectOnly([e]),void INKIVE.DesignFacade.set({flipped:{horizontal:!0}}))}},Backbone.Events)},{}],49:[function(e,t,n){t.exports=_.extend({initialize:function(){var e=INKIVE.Tool.getInstance();this.canvas=e.editor.canvas},ungroup:function(e){this.canvas.selectOnly([e]),this.canvas.ungroupSelectedElement(),this.trigger("ungroup")}},Backbone.Events)},{}],50:[function(e,t,n){t.exports=_.extend({initialize:function(){this.tool=INKIVE.Tool.getInstance(),this.editor=this.tool.editor,this.canvas=this.editor.canvas},flipVertical:function(e){return $("#"+e.id+"-loader").length?void this.canvas.call("advice.show","image-flip-disabled"):(this.canvas.selectOnly([e]),void INKIVE.DesignFacade.set({flipped:{vertical:!0}}))},flipHorizontal:function(e){return $("#"+e.id+"-loader").length?void this.canvas.call("advice.show","image-flip-disabled"):(this.canvas.selectOnly([e]),void INKIVE.DesignFacade.set({flipped:{horizontal:!0}}))}},Backbone.Events)},{}],51:[function(e,t,n){t.exports=_.extend({initialize:function(){this.tool=INKIVE.Tool.getInstance(),this.editor=this.tool.editor,this.canvas=this.editor.canvas},flipVertical:function(e){this.canvas.selectOnly([e]),this.canvas.setFlip("v"),this.trigger("flip_vertical")},flipHorizontal:function(e){this.canvas.selectOnly([e]),this.canvas.setFlip("h"),this.trigger("flip_horizontal")},convertToImageBox:function(e){var t=this.canvas.getBBox(e),n=this.canvas.copyElem(e);n.removeAttribute("stroke"),n.removeAttribute("stroke-width"),n.removeAttribute("stroke-dasharray"),n.removeAttribute("stroke-linejoin"),n.removeAttribute("stroke-linecap"),n.removeAttribute("stroke-opacity"),n.removeAttribute("fill"),n.setAttribute("fill-opacity","1"),this.canvas.deleteSelectedElements(),n.removeAttribute("id");this.canvas.runExtensions("addLayoutBox",{elem:n,clipPathBB:t});INKIVE.Tool.autoSave(n)}},Backbone.Events)},{}],52:[function(e,t,n){t.exports=_.extend({initialize:function(){this.tool=INKIVE.Tool.getInstance(),this.editor=this.tool.editor,this.canvas=this.editor.canvas},flipVertical:function(e){this.canvas.selectOnly([e]),this.canvas.setFlip("v"),this.trigger("flip_vertical")},flipHorizontal:function(e){this.canvas.selectOnly([e]),this.canvas.setFlip("h"),this.trigger("flip_horizontal")},explode:function(e){if("g"===e.tagName&&$(e).hasClass("sticker")&&e.childNodes.length>1){var t=e.parentNode,n=e.nextSibling;$(e).find(".textarea, .layoutBox").length>0?this._explodeSubelement(e,t,n):this._explode(e,t,n),this.canvas.clearSelection(),this.trigger("explode")}},_explodeSubelement:function(e,t,n){_.each($(e).find(".textarea, .layoutBox"),function(i){if(i=t.insertBefore(i,n),this._updateClasses(i),$(i).hasClass("layoutBox")){var a=$("#svgcontent>defs").get(0);if(!a){var o=$("#svgcontent").get(0);a=window.document.createElementNS(svgedit.NS.SVG,"defs"),o.insertBefore(a,o.firstChild)}$(e).find("defs clippath").each(function(t,n){var i=n.parentNode;a.insertBefore(n,a.firstChild),e.removeChild(i)})}},this),this.canvas.clearSelection()},_explode:function(e,t,n){for(;e.firstChild;){var i=e.firstChild;if($(i).is("rect.background"))i.parentNode.removeChild(i);else{for(var a=0;a<i.childNodes.length;a++){var o=i.childNodes[a];if("g"!=o.tagName&&"rect"!=o.tagName){var r=o.parentNode,s=o.nextSibling;s&&r.insertBefore(o,s),s||r.appendChild(o)}}if(!i.childNodes.length&&"g"!=i.tagName){var l=document.createElementNS(svgedit.NS.SVG,"g");l.appendChild(i),i=l}i=t.insertBefore(i,n),this._updateClasses(i)}}},_updateClasses:function(e){var t=$(e).find("text").length?"textarea":$(e).is("image[clip-path]")?"layoutBox":"sticker";svgedit.utilities.assignAttributes(e,{"class":"element "+t}),svgedit.utilities.assignAttributes(e,{id:this.canvas.getNextId()})}},Backbone.Events)},{}],53:[function(e,t,n){function i(){this.handledAttributes=["position","rotation","opacity","size","locked"]}var a=e("../../../../utils/humps");t.exports=i,i.prototype=_.extend({},Backbone.Events),i.prototype.initialize=function(){this.editor=INKIVE.Tool.getInstance().editor,this.canvas=this.editor.canvas,_.bindAll(this,"set")},i.prototype.set=function(e,t){_.each(t,function(n,i){if(_.contains(this.handledAttributes,i)){var o=a.camelize("update_"+i);this[o](e,t)}},this),this.trigger("",e.getAttribute("id"),t)},i.prototype.selectElement=function(e){var t=_.compact(_.toArray(this.canvas.getSelectedElems()));1===t.length&&t[0]===e||(this.canvas.clearSelection(),this.canvas.selectOnly([e]));
},i.prototype.updatePosition=function(t,n){var i=n.position,a=t.getBBox(),o=e("../../../editor/editor"),r=o.handle("zoom","get");this.selectElement(t),this.canvas.moveSelectedElements((i.x-a.x)*r,(i.y-a.y)*r),this.trigger("position",t.getAttribute("id"),{position:i})},i.prototype.updateRotation=function(e,t){this.selectElement(e),this.canvas.setRotationAngle(t.rotation),this.trigger("rotation",e.getAttribute("id"),{rotation:t.rotation})},i.prototype.updateOpacity=function(e,t){this.updateAttributeNoUndo(e,"opacity",t.opacity),this.trigger("opacity",e.getAttribute("id"),{opacity:t.opacity})},i.prototype.updateLocked=function(e,t){$(e).toggleClass("locked",t.locked),this.trigger("locked",e.getAttribute("id"),{locked:t.locked})},i.prototype.updateSize=function(e,t){var n=t.size;if(n.width||n.height){var i=$("#svgroot").get(0),a=e.getBBox(),o=i.createSVGTransform(),r=i.createSVGTransform(),s=i.createSVGTransform(),l=svgedit.transformlist.getTransformList(e);if(!n.width||!n.height){var c=a.width/a.height;n.width||(n.width=n.height*c),n.height||(n.height=n.width/c)}var d=a.x+a.width/2,u=a.y+a.height/2;o.setTranslate(d,u),r.setScale(n.width/a.width,n.height/a.height),s.setTranslate(-d,-u),l.appendItem(o),l.appendItem(r),l.appendItem(s),svgedit.recalculate.recalculateDimensions(e,a)}},i.prototype.updateAttributeNoUndo=function(e,t,n){this.canvas.changeSelectedAttributeNoUndo(t,n,[e])}},{"../../../../utils/humps":482,"../../../editor/editor":76}],54:[function(e,t,n){function i(){}var a=e("./element");t.exports=i,i.prototype=new a,i.prototype.constructor=i},{"./element":53}],55:[function(e,t,n){var i=e("../../creators/sticker");t.exports={setCheckOnce:function(){return!window.Android&&this.appBridge.version.isApp("desygner")&&this.appBridge.version.isEqual("1.1.3")},set:function(e){this.stickerCreator||(this.stickerCreator=new i,this.stickerCreator.initialize()),this.stickerCreator.create(e)}}},{"../../creators/sticker":31}],56:[function(e,t,n){function i(){this.handledAttributes=["color","source","image_opacity","base_64","flipped"]}var a=e("../../../utils/humps"),o=e("./abstract/element"),r=e("./image"),s=(e("../getters/background"),e("../../../factory/images"));t.exports=i,i.prototype=new o,i.prototype.constructor=i,i.prototype.set=function(e){_.each(e,function(t,n){if(_.contains(this.handledAttributes,n)){var i=a.camelize("update_"+n);this[i](e)}},this)},i.prototype.updateBase64=function(e){e.source=e.base_64,e.from_base_64=!1,e.smart_load=!1,this.updateSource(e)},i.prototype.updateSource=function(e){this.backgroundSourceLoaded=!1,e.source.url&&this._sanitizeSourceUrl(e);var t=_.isString(e.source)&&"undefined"==typeof e.from_base_64&&INKIVE.Helpers.isDataURL(e.source);t&&(e.from_base_64=!0),e.source.base_64&&this._sanitizeSourceBase64(e);var n=this.isExternal(e),i=$("#svgcontent").children("g.background").find("image");if(this.lastSource=e.source=INKIVE.Helpers.getCORSSecureUrl(e.source),i.length&&null===INKIVE.ImagesFactory.getImageUrl(i[0]))INKIVE.ImagesFactory.setImageUrl(i.get(0),e.source),this.backgroundSourceLoaded=!0,this._triggerSourceEvent(i.attr("id"),e);else{if(i.attr("xlink:href")===e.source||i.attr("data-original-href")===e.source)return;e.attrs||i.removeAttr("class"),this._loadLowResolutionBackground(i[0],e).then(_.bind(function(t){this._triggerSourceEvent(t.getAttribute("id"),e,"updating_source"),n&&this.resizeExternalPhoto(t,e),n||this.onVersionData(t,e)},this))}},i.prototype._sanitizeSourceUrl=function(e){e.source=e.source.url,e.smart_load=e.source.smart_load},i.prototype._sanitizeSourceBase64=function(e){e.base_64=e.source.base_64,e.source=e.source.base_64,e.smart_load=!1},i.prototype.onVersionData=function(e,t){if(this._isSameBackground(t)){var n="undefined"==typeof t.smart_load||t.smart_load,i=this._getBackgroundSize(t.attrs);s.smartLoad(t.source,i,_.bind(function(i,a){if(this._isSameBackground(t)){if(this.lastSource=t.source=i===INKIVE.C.Status.success?a.src:t.source,$(e).removeClass("resizing"),n||!e){var o=this._createImageBackground(t);n&&this.updateResolution(o,t)}else{this.backgroundSourceLoaded=!0;var r=INKIVE.Helpers.getCORSSecureUrl(t.source),s=t.previous_image_flipped?t.previous_image_flipped:INKIVE.DesignFacade.get("background").flipped;s&&(s.horizontal||s.vertical)?this.updateFlipped({flipped:s},r):svgedit.utilities.assignAttributes(e,{"xlink:href":r})}this.updateImageOpacity(t,e),t.base_64&&!t.from_base_64&&INKIVE.ImagesFactory.setImageUrl($("#svgcontent").children("g.background").find("image").get(0),null),this.backgroundSourceLoaded&&this._triggerSourceEvent(e.getAttribute("id"),t)}},this))}},i.prototype._createImageBackground=function(e){var t=this.canvas.addElement("background",{type:"image",data:e.source,attrs:e.attrs,old_image_id:e.old_image_id});return this._preloadBackgroundImage(e).then(_.bind(function(n){if(this._isSameBackground(e)){if(!e.attrs){var i=this._getBackgroundSize(n);e.attrs={x:(this.canvas.contentW-i.width)/2,y:(this.canvas.contentH-i.height)/2,width:i.width,height:i.height}}t.setAttribute("x",e.attrs.x),t.setAttribute("y",e.attrs.y),t.setAttribute("width",e.attrs.width),t.setAttribute("height",e.attrs.height)}},this)),t},i.prototype.updateColor=function(e){this.editor.replaceBackground({type:"color",data:e.color});this.trigger("color",null,{color:e.color})},i.prototype.updateResolution=function(e,t){s.smartLoad(t.source,this._getBackgroundSize.call(this),_.bind(function(n,i){if(this._isSameBackground(t)&&n===INKIVE.C.Status.success){this.lastSource=t.source=i.src;var a=INKIVE.Helpers.getCORSSecureUrl(t.source),o=t.previous_image_flipped?t.previous_image_flipped:INKIVE.DesignFacade.get("background").flipped;o&&(o.horizontal||o.vertical)?this.updateFlipped({flipped:o},a):svgedit.utilities.assignAttributes(e,{"xlink:href":a}),this.backgroundSourceLoaded=!0,t.from_base_64&&INKIVE.ImagesFactory.setImageUrl(e,null),this._triggerSourceEvent(e.id,t)}},this))},i.prototype.updateImageOpacity=function(e,t){"undefined"!=typeof e.image_opacity&&(t=t||$("g.background image").get(0),t&&svgedit.utilities.assignAttributes(t,{opacity:e.image_opacity}))},i.prototype.updateFlipped=function(e,t){var n=$("g.background image").get(0);this.canvas.setFlipImage(n.id,e.flipped,t),this.trigger("flipped",n.getAttribute("id"),e)},i.prototype._triggerSourceEvent=function(e,t,n){n=n||"source";var i={id:e,source:!INKIVE.Helpers.isDataURL(t.source)&&t.source};if(this.trigger(n,null,i),!t.is_initial_load&&this.backgroundSourceLoaded){var a=t.old_image_id;if(a){var o=INKIVE.ImagesFactory.getImageUrl(a,t.source);o&&INKIVE.ImagesFactory.setImageUrl($("#"+e).get(0),o)}this.trigger("source.loaded",null,i)}},i.prototype._isSameBackground=function(e){return this.lastSource===e.source},i.prototype._preloadBackgroundImage=function(e){function t(){i.resolve(n)}var n=new Image,i=$.Deferred();return n.src=INKIVE.Helpers.getCORSSecureUrl(e.source),n.onload=_.bind(t,this),i.promise()},i.prototype._getBackgroundSize=function(e){if(!e)return{width:this.canvas.contentW,height:this.canvas.contentH};var t=this.canvas.contentW/e.width,n=this.canvas.contentH/e.height;return t>n?{width:this.canvas.contentW,height:e.height*t}:{height:this.canvas.contentH,width:e.width*n}},i.prototype.isExternal=function(e){return r.prototype.isExternal.call(this,{source:{url:e.source}})},i.prototype.resizeExternalPhoto=function(e,t){this._preloadBackgroundImage(t).then(_.bind(function(n){function i(){var e=this._getBackgroundSize(n),t="https://s3.amazonaws.com/thumb/",i=s.getRightSizeUrl(t,e),a=_.last(_.compact(i.split("/")))||"web";return"thumb"===a&&(a="mobile"),"original"===a&&(a="largweb"),a}var a=i.call(this),o={book_id:INKIVE.C.BOOK.id,photo_url:s.getOriginalUrl(t.source)||t.source,platform:a},r=INKIVE.C.BASE_URL+"inkive/resizeexternalsearchphoto";$(e).addClass("resizing"),this.trigger("resize_external",e.getAttribute("id")),$.api(r,"POST",o,_.bind(function(n){if(this._isSameBackground(t)){if("success"===n.STATUS){var i={thumb:n.MESSAGE.replace("/"+a+"/","/thumb/"),mobile:n.MESSAGE.replace("/"+a+"/","/mobile/"),tab:n.MESSAGE.replace("/"+a+"/","/tab/"),web:n.MESSAGE.replace("/"+a+"/","/web/"),largeweb:n.MESSAGE.replace("/"+a+"/","/largeweb/"),original:n.MESSAGE.replace("/"+a+"/","/original/")};this.lastSource=t.source=n.MESSAGE,s.addImageData(i,s.defaultAmazonDataNames)}this.onVersionData(e,t)}},this))},this))},i.prototype._loadLowResolutionBackground=function(e,t){function n(){if(!t.attrs){var n=this._getBackgroundSize(i);t.attrs={x:(this.canvas.contentW-n.width)/2,y:(this.canvas.contentH-n.height)/2,width:n.width,height:n.height}}var r=$("#svgcontent").children("g.background").find("image")[0];if(r){var s=INKIVE.Helpers.getCORSSecureUrl(a),l=t.previous_image_flipped?t.previous_image_flipped:INKIVE.DesignFacade.get("background").flipped;l&&(l.horizontal||l.vertical)?this.updateFlipped({flipped:l},s):svgedit.utilities.assignAttributes(r,{"xlink:href":s}),r.setAttribute("x",t.attrs.x),r.setAttribute("y",t.attrs.y),r.setAttribute("width",t.attrs.width),r.setAttribute("height",t.attrs.height)}o.resolve(e)}var i=new Image,a=s.getVersionUrl(t.source,"thumb"),o=$.Deferred();return e=e||this.canvas.addElement("background",{type:"image",data:a,attrs:t.attrs}),i.src=a,i.onload=_.bind(n,this),i.onerror=_.bind(o.resolve,o,e),o.promise()}},{"../../../factory/images":102,"../../../utils/humps":482,"../getters/background":38,"./abstract/element":53,"./image":59}],57:[function(e,t,n){function i(){this.handledAttributes=["rotation","opacity","locked"]}var a=e("./abstract/element");t.exports=i,i.prototype=new a,i.prototype.constructor=i},{"./abstract/element":53}],58:[function(e,t,n){function i(){this.handledAttributes=_.union(["shapes","thumb_src","is_vector"],this.handledAttributes),this.supportedSubElements=["image","ellipse","line","rect","text","polygon","circle","ellipse","path","g"]}var a=e("./logo"),o=e("../creators/icon");t.exports=i,i.prototype=new a,i.prototype.constructor=i,i.prototype.updateContent=o.prototype.updateContent},{"../creators/icon":27,"./logo":60}],59:[function(e,t,n){function i(){this.handledAttributes=_.union(["source","flipped"],this.handledAttributes)}var a=e("./abstract/element"),o=e("../../../factory/images");t.exports=i,i.prototype=new a,i.prototype.constructor=i,i.prototype.updateSource=function(e,t){var n="undefined"==typeof t.source.external_resize?this.isExternal(t):t.source.external_resize,i="undefined"==typeof t.source.smart_load||t.source.smart_load;n&&this.resizeExternalPhoto(e,t),this.removeFlippedAttributesIfNewImage(e,t),n||(t.source.base_64?this.updateSourceBase64(e,t):((!i||t.source.preload)&&this.updateSourceUrl(e,t),i&&this.onVersionData(e,t)));var a=_.extend(_.clone(t.source),{url:!INKIVE.Helpers.isDataURL(t.source.url)&&t.source.url});this.trigger("source",e.getAttribute("id"),{source:a})},i.prototype.isExternal=function(e){var t=INKIVE.Helpers.dataURLToBlob(e.source.url);return e.source.url&&!t&&!o.isAmazonImage(e.source.url)&&!e.source.url.match(/imageplaceholder\.svg$/)&&!e.source.url.match(/imageplaceholder_new\.svg$/)},i.prototype.updateFlipped=function(e,t,n){this.canvas.setFlipImage(e.id,t.flipped,n),this.trigger("flipped",e.getAttribute("id"),t)},i.prototype.updateSourceBase64=function(e,t){var n="undefined"==typeof t.source.smart_load||t.source.smart_load;if(e.getAttribute("xlink:href")==t.source.base_64)return void this.trigger("optimus_resolution",e.getAttribute("id"));if(svgedit.utilities.assignAttributes(e,{"xlink:href":t.source.base_64}),INKIVE.ImagesFactory.setImageUrl(e,null),n){var i=new Image;i.onload=_.bind(this._onImage,this,e,t,i),i.src=t.source.base_64}else this.trigger("source.base_64",e.getAttribute("id"),{source:{base_64:"<data>"}})},i.prototype.updateSourceUrl=function(e,t){var n="undefined"==typeof t.source.smart_load||t.source.smart_load,i=!0;if(e.getAttribute("xlink:href")==INKIVE.Helpers.getCORSSecureUrl(t.source.url))return void this.trigger("optimus_resolution",e.getAttribute("id"));if(null===INKIVE.ImagesFactory.getImageUrl(e)){var a=$(e).data("original-href"),r=a&&!INKIVE.Helpers.isDataURL(a),s=$(e).attr("xlink:href");r&&$(e).attr("xlink:href",a),INKIVE.ImagesFactory.setImageUrl(e,t.source.url),r&&$(e).attr("xlink:href",s)}else{var l=o.getOriginalUrl(t.source.url),c=o.getOriginalUrl(e.getAttribute("xlink:href")),d=l===c,u=INKIVE.DesignFacade.get(e.id)||{},p=INKIVE.Helpers.getCORSSecureUrl(t.source.url),h=u.flipped;if(h&&(h.horizontal||h.vertical)?this.updateFlipped(e,u,p):svgedit.utilities.assignAttributes(e,{"xlink:href":p}),(n||t.source.external_resize||t.keep_box_size)&&!d){i=!1;var m=new Image;m.onload=_.bind(this._onImage,this,e,t,m),m.src=INKIVE.Helpers.getCORSSecureUrl(t.source.url)}}i&&this.trigger("source.url",e.getAttribute("id"),{source:{url:!INKIVE.Helpers.isDataURL(t.source.url)&&t.source.url}})},i.prototype._onImage=function(e,t,n){function i(){var t=o(c<d);$(e).removeClass("layoutBox"),this.updateSize(e,{size:t}),$(e).addClass("layoutBox");var n=e.getBBox(),i=(l.width-n.width)/2,a=(l.height-n.height)/2;e.setAttribute("x",l.x+i),e.setAttribute("y",l.y+a)}function a(){var t=o(c>d);this.updateSize(e,{size:t})}function o(e){return e?{width:l.width,height:l.width/c}:{width:l.height*c,height:l.height}}var r=svgedit.utilities.getClipPath(e),s=r&&r.childNodes[0];try{var l=s?s.getBBox():e.getBBox(),c=n.width/n.height,d=l.width/l.height;t.keep_box_size||a.call(this),t.keep_box_size&&i.call(this);var u=t.source.base_64?{base_64:"<data>"}:{url:!INKIVE.Helpers.isDataURL(t.source.url)&&t.source.url};this.trigger("source."+Object.keys(u)[0],e.getAttribute("id"),{source:u})}catch(p){}},i.prototype.onVersionData=function(e,t){var n=this.getSize(e,t);this.trigger("optimize_resolution",e.getAttribute("id")),o.smartLoad(t.source.url,n,_.bind(function(n,i){var a=n===INKIVE.C.Status.success||t.source.url;t.source.url=n===INKIVE.C.Status.success?i.src:t.source.url,$(e).removeClass("resizing"),a&&this.updateSourceUrl(e,t)},this))},i.prototype.getSize=function(e,t){return{width:t.size?t.width:e.getAttribute("width"),height:t.size?t.height:e.getAttribute("height")}},i.prototype.resizeExternalPhoto=function(e,t){function n(){var n=this.getSize(e,t),i="https://s3.amazonaws.com/thumb/",a=o.getRightSizeUrl(i,n),r=_.last(_.compact(a.split("/")))||"web";return"thumb"===r&&(r="mobile"),"original"===r&&(r="largweb"),r}var i=n.call(this),a={book_id:INKIVE.C.BOOK.id,photo_url:o.getOriginalUrl(t.source.url)||t.source.url,platform:i},r=INKIVE.C.BASE_URL+"inkive/resizeexternalsearchphoto";$(e).addClass("resizing"),this.trigger("resize_external",e.getAttribute("id")),$.api(r,"POST",a,_.bind(function(n){if("success"===n.STATUS){var a={thumb:n.MESSAGE.replace("/"+i+"/","/thumb/"),mobile:n.MESSAGE.replace("/"+i+"/","/mobile/"),tab:n.MESSAGE.replace("/"+i+"/","/tab/"),web:n.MESSAGE.replace("/"+i+"/","/web/"),largeweb:n.MESSAGE.replace("/"+i+"/","/largeweb/"),original:n.MESSAGE.replace("/"+i+"/","/original/")};t.source.url=n.MESSAGE,o.addImageData(a,o.defaultAmazonDataNames)}this.onVersionData(e,t)},this))},i.prototype.removeFlippedAttributesIfNewImage=function(e,t){var n=$(e).attr("data-original-href"),i=t.source.base_64?t.source.base_64:t.source.url;n&&!INKIVE.Helpers.isDataURL(n)&&n!==i&&($(e).removeAttr("data-original-href"),$(e).removeClass(INKIVE.C.FLIP_IMAGE.HORIZONTAL),$(e).removeClass(INKIVE.C.FLIP_IMAGE.VERTICAL))}},{"../../../factory/images":102,"./abstract/element":53}],60:[function(e,t,n){function i(){this.handledAttributes=_.union(["shapes","thumb_src","is_vector"],this.handledAttributes),this.supportedSubElements=["image","ellipse","line","rect","text","polygon","circle","ellipse","path","g"]}var a=e("./abstract/graphic"),o=e("../creators/logo"),r=e("./sticker"),s=e("../getters/sticker"),l=e("../../../factory/images");t.exports=i,i.prototype=new a,i.prototype.constructor=i,i.prototype.updateIsVector=$.noop,i.prototype.updateThumbSrc=function(e,t){var n=$(e).is("image")?e:$(e).children("image")[0],i=$(e).children("g")[0],a=t.is_vector?t.thumb_src:l.getVersionUrl(t.thumb_src,"thumb"),o="undefined"==typeof t.smart_load||t.smart_load;i&&i.remove(),svgedit.utilities.assignAttributes(n,{opacity:1,"xlink:href":a},100),t.is_vector?(t.content||this.fetchContent(e,t),t.content&&this.updateContent(e,t)):(o&&this._smartImageLoad(e,t),o||this.trigger("resolution_optimized",e.getAttribute("id"))),t.thumb_src=l.getOriginalUrl(t.thumb_src),this.trigger("thumb_src",e.getAttribute("id"),t)},i.prototype._smartImageLoad=o.prototype._smartImageLoad,i.prototype.updateContent=o.prototype.updateContent,i.prototype.fetchContent=o.prototype.fetchContent,i.prototype.updateShapes=function(e,t){return r.prototype.updateShapes.call(this,$(e).children("g")[0],t)},i.prototype.getElements=s.prototype.getElements,i.prototype.getElementsWithColor=s.prototype.getElementsWithColor},{"../../../factory/images":102,"../creators/logo":29,"../getters/sticker":44,"./abstract/graphic":54,"./sticker":70}],61:[function(e,t,n){var i=[e("./text/date"),e("./text/email"),e("./text/numeric"),e("./text/swearing"),e("./text/currencies"),e("./text/character_number"),e("./text/dictionary")];t.exports={updateContent:function(t,n){var a=e("../../../restrictions/restrictions"),o=_.partial(a.getElementRestrictions,t.getAttribute("id"));try{var r=n.content,s=this.textarea.text.textContent;_.each(i,function(e){r=e(o,r)});var l=null,c=INKIVE.Tool.calculateStringContentDifference(s,r),d=c.added-c.removed,u=n.force_redraw||d<=0,p=c.position+c.added;u||_.any(this.textarea.text.strings,_.bind(function(e,t){var n=e.textContent,i=this.textarea.text.strings.length-1;if(e.isEol&&t!==i&&(n+="\n"),t===i||r.indexOf(n)===-1&&n.trim())return l=t,!0},this)),this.textarea.text.setValues({firstDiffLinePosition:l,textContent:r.replace(/ /g,String.fromCharCode(160)),newLetters:d,cursorPosition:p}),this.trigger("content",t.getAttribute("id"),value)}catch(h){var m=e("../../../../utils/advice");h=_.isArray(h)?h:[h],_.each(h,function(e){m.show("restriction-text-"+e.message.replace(/_/g,"-"),e.params)})}},contentCompliesWithRestrictions:function(e,t){var n=function(e){return _.compact([t[e]])};try{var a=e.replace(/ /g,String.fromCharCode(160));return _.each(i,function(e){a=e(n,a)}),!0}catch(o){return!1}}}},{"../../../../utils/advice":477,"../../../restrictions/restrictions":94,"./text/character_number":62,"./text/currencies":63,"./text/date":64,"./text/dictionary":65,"./text/email":66,"./text/numeric":67,"./text/swearing":68}],62:[function(e,t,n){t.exports=function(e,t){var n=e("character_number");if(n.length){var i=[];for(var a in n){var o=_.extend({value:t},n[a]),r=_.isNumber(n[a].max)&&n[a].max<t.length||_.isNumber(n[a].min)&&n[a].min>t.length;r&&i.push({message:"character_number_range",params:o})}if(i.length)throw i}return t}},{}],63:[function(e,t,n){t.exports=function(e,t){var n=e("currencies");if(n.length){var i=t.match(/[\d+|\\.|\\,]/g),a=[];if(!i)throw{message:"currency_format",params:_.extend({value:t},n[0])};i=parseFloat(i.join(""));var o="\\d+|\\s+|\\.|\\,"+_.map(n,function(e){return e.currency}).join("|");for(var r in n){var s=_.extend({value:t},n[r]),l=_.isNumber(n[r].max)&&n[r].max<i||_.isNumber(n[r].min)&&n[r].min>i;t.indexOf(n[r].currency)<0&&a.push({message:"currency_format",params:s}),l&&a.push({message:"currency_range",params:s})}if(a.length)throw a;t=t.match(new RegExp("["+o+"]","g")).join("").replace(/\s+/," ")}return t}},{}],64:[function(e,t,n){t.exports=function(e,t){function n(e){var n=e.dateformat,i=e.daterange?{value:t,end:moment(e.daterange.end,"MM/DD/YY").format(n),start:moment(e.daterange.start,"MM/DD/YY").format(n),example:moment(e.daterange.start,"MM/DD/YY").format(n)}:{value:t,example:moment().format(n)};return _.extend(i,e)}function i(e){return moment(t.replace(/\s/g," "),e.dateformat,!0).isValid()}function a(e){var n=moment(e.daterange.start,"MM/DD/YY"),i=moment(e.daterange.end,"MM/DD/YY"),a=moment(t.replace(/\s/g," "),e.dateformat,!0);return a>=n&&a<=i}var o=e("date"),r=[];if(o.length){for(var s in o)i(o[s])||r.push({message:"date_format",params:n(o[s])}),o[s].daterange&&!a(o[s])&&r.push({message:"date_range",params:n(o[s])});if(r.length)throw r}return t}},{}],65:[function(e,t,n){t.exports=function(e,t){function n(e){return _.contains(e.list,t.replace(/\s/g," "))}var i=e("dictionary");if(i.length&&!_.any(i,n))throw{message:"dictionary_not_found",params:{value:t}};return t}},{}],66:[function(e,t,n){t.exports=function(e,t){var n=e("email"),i=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;if(n.length&&!i.test(t))throw{message:"email",params:{value:t}};return t}},{}],67:[function(e,t,n){t.exports=function(e,t){var n=t,i=e("numeric");if(i.length){if(isNaN(t))throw{message:"number_nan",params:_.extend({value:n})};t=parseFloat(t);for(var a in i)if(i[a].max<t||i[a].min>t)throw{message:"number_out_of_range",params:_.extend({value:n},i[a])}}return t.toString()}},{}],68:[function(e,t,n){var i=e("../../../../../factory/swearing");t.exports=function(e,t){var n=e("swearing");if(n.length)for(var a in n)if(i.matchSwearing(n[a].filter,t))throw{message:"swearing",params:_.extend({value:t},n[a])};return t}},{"../../../../../factory/swearing":131}],69:[function(e,t,n){function i(){this.handledAttributes=_.union(["fill","stroke"],this.handledAttributes)}var a=e("./abstract/graphic");t.exports=i,i.prototype=new a,i.prototype.constructor=i,i.prototype.updateFill=function(e,t){this.updateAttributeNoUndo(e,"fill",t.fill.color),this.trigger("fill",e.getAttribute("id"),{fill:t.fill})},i.prototype.updateStroke=function(e,t){var n=t.stroke;"undefined"!=typeof n.color&&this.updateAttributeNoUndo(e,"stroke",n.color),"undefined"!=typeof n.width&&this.updateAttributeNoUndo(e,"stroke-width",n.width),"undefined"!=typeof n.dasharray&&this.updateAttributeNoUndo(e,"stroke-dasharray",n.dasharray),"undefined"!=typeof n.linejoin&&this.updateAttributeNoUndo(e,"stroke-linejoin",n.linejoin),"undefined"!=typeof n.linecap&&this.updateAttributeNoUndo(e,"stroke-linecap",n.linecap),this.trigger("stroke",e.getAttribute("id"),{stroke:t.stroke})}},{"./abstract/graphic":54}],70:[function(e,t,n){function i(){this.handledAttributes=_.union(["texts","shapes","content","text_content"],this.handledAttributes),this.supportedSubElements=["image","ellipse","line","rect","text","polygon","circle","ellipse","path","g"]}var a=e("./abstract/graphic"),o=e("../creators/abstract/graphic"),r=e("./shape"),s=e("./text"),l=e("../getters/sticker"),c=e("../../../app/decorate");t.exports=i,i.prototype=new a,i.prototype.constructor=i,i.prototype.updateContent=o.prototype.updateContent,i.prototype.updateTextContent=function(e,t){var n=new s,i=$(e).find(".textarea.active");n.initialize(),_.each(i,function(e){n.set(e,{content:t.text_content,force_redraw:!0})})},i.prototype.updateTexts=function(e,t){var n=new s,i=$(e).find(".textarea");n.initialize(),_.each(t.texts,function(e,t){n.set(i[t],e)}),this.trigger("texts",e.getAttribute("id"),{texts:t.texts})},i.prototype.updateShapes=function(e,t){var n=new r,i=this.getElements(e);n.initialize(),_.each(t.shapes,function(e,t){if(i[t]){var a=this.getElementsWithColor(i[t]);_.each(a,function(t){n.set(t,e)})}},this),this.trigger("shapes",e.getAttribute("id"),{shapes:t.shapes})},i.prototype.getElements=l.prototype.getElements,i.prototype.getElementsWithColor=l.prototype.getElementsWithColor,i.prototype=c(e("./app/sticker"),i.prototype)},{"../../../app/decorate":8,"../creators/abstract/graphic":25,"../getters/sticker":44,"./abstract/graphic":54,"./app/sticker":55,"./shape":69,"./text":72}],71:[function(e,t,n){function i(){this.handledAttributes=["keep_stage_size","resize_content","restricted.id","restricted.page","restricted.keep_permissions","size.format_id","size.width","size.height","size.unit","grid.index_in_set","grid.number_of_photos","designed.id","designed.content"]}var a=e("./abstract/element");e("../../../factory/images");t.exports=i,i.prototype=new a,i.prototype.constructor=i,i.prototype.set=function(e){var t=e.designed&&(e.designed.id||e.designed.content),n=e.grid&&e.grid.index_in_set&&e.grid.number_of_photos,i=e.restricted&&e.restricted.id,a=n||t;i&&this.setRestrictedTemplate(e),t&&this.setDesignedTemplate(e),n&&this.setGridTemplate(e),a||e.size&&this.updateSize(e),this.trigger("",null,e)},i.prototype.setRestrictedTemplate=function(t){function n(n,i){if(i&&n&&"false"!=n.success&&n.pageContent){var a=INKIVE.ImagesFactory.setImagesData(n.images);_.each(a,function(e){e.stored=!0}),this.editor.loadSvgString(n.pageContent,_.bind(function(){var n=e("../../editor/editor");n.handle("zoom","fit"),t.restricted.keep_permissions&&$("#svgcontent").children("g.main").addClass("base-page-"+t.restricted.page),this.trigger("restricted",null,{restricted:t.restricted})},this))}}INKIVE.Helpers.api("page/by_pagenumber","GET",{page:t.restricted.page||1,scrapbook_id:t.restricted.id},_.bind(n,this))},i.prototype.setDesignedTemplate=function(e){function t(t){e.format={id:t.format_id},e.designed.id=e.designed.id||e.designed.content.id,e.keep_stage_size||(e.size={width:t.format_width,height:t.format_height},this.updateSize(e)),this.onSVGData(e,{defs:Base64.decode(t.defs),content:Base64.decode(t.content),background:Base64.decode(t.background)},t),this.trigger("designed",null,{designed:e.designed})}e.designed.content?t.call(this,e.designed.content):INKIVE.Helpers.api("search/layout","GET",{id:e.designed.id},_.bind(t,this))},i.prototype.setGridTemplate=function(e){var t=INKIVE.Helpers.convertUnitsToPixels,n=INKIVE.C.BASE_URL+"grid/fetch/"+e.grid.index_in_set,i=e.size?e.size.unit?t(e.size.width,e.size.unit):parseInt(e.size.width):this.canvas.contentW,a=e.size?e.size.unit?t(e.size.height,e.size.unit):parseInt(e.size.height):this.canvas.contentHeight,o={width:i,height:a,number_of_photos:e.grid.number_of_photos};INKIVE.Helpers.sendCmd(n,o,_.bind(function(t){var n=o.width==this.canvas.contentW&&o.height==this.canvas.contentH;t=$.parseJSON(t),n||this.updateSize(e),"SUCCESS"===t.STATUS&&this.onSVGData(e,{defs:t.MESSAGE.defs,content:t.MESSAGE.svg}),this.trigger("grid",null,{grid:e.grid})},this))},i.prototype.updateSize=function(t){function n(e){var t=i[0],n=a[0];if(n&&t){var o=_.union(_.toArray(n.classList),_.toArray(t.classList));_.each(o,function(i){e?i.match(e)&&n.classList.remove(i):(i.match(/format-id-[\d+]/)&&n.classList.remove(i),i.match(/layout-id-[\d+]/)&&n.classList.remove(i),i.match(/du-[\w+]/)&&t.classList.remove(i),i.match(/dw-[\d|\.]+/)&&t.classList.remove(i),i.match(/dh-[\d|\.]+/)&&t.classList.remove(i))})}}var i=$("#svgcontent"),a=i.children("g.main"),o=e("../../editor/editor"),r=INKIVE.Helpers.convertUnitsToPixels,s="undefined"==typeof t.resize_content?!t.restricted&&!t.grid&&!t.designed:t.resize_content,l=t.size.unit?r(t.size.width,t.size.unit):parseInt(t.size.width),c=t.size.unit?r(t.size.height,t.size.unit):parseInt(t.size.height),d=this.canvas.contentW,u=this.canvas.contentH;l==d&&c==u||(this.canvas.contentW=l,this.canvas.contentH=c,n(),t.size.unit&&i.addClass("du-"+t.size.unit),i.addClass("dw-"+t.size.width),i.addClass("dh-"+t.size.height),o.handle("zoom","fit"),s&&this._resizeCanvasContent({height:u,width:d}),this.trigger("size",null,{size:t.size})),t.size.format_id&&(n(/format-id-[\d+]/),a.addClass("format-id-"+t.size.format_id))},i.prototype.onSVGData=function(e,t,n){function i(t){e.designed&&e.designed.id&&t.addClass("layout-id-"+e.designed.id),e.grid&&e.grid.index_in_set&&e.grid.number_of_photos&&t.addClass("grid-id-"+e.grid.number_of_photos+"-"+e.grid.index_in_set),e.keep_stage_size||e.format&&e.format.id&&t.addClass("format-id-"+e.format.id)}function a(e){e.firstChild&&a(e.firstChild),e.nextSibling&&a(e.nextSibling),3===e.nodeType&&e.nodeValue.match(/(\r\n|\r|\n)+/g)&&e.remove()}this.editor.addElement("layout",$.extend({keep:e.setCurrentPage},t)),i($("#svgcontent > g.main")),a($("#svgcontent")[0]),INKIVE.Helpers.converterCurrentPage(),e.keep_stage_size&&this._resizeCanvasContent({height:n.format_height,width:n.format_width,unit:n.unit})},i.prototype._resizeCanvasContent=function(e){var t=INKIVE.Helpers.convertUnitsToPixels;INKIVE.Helpers.converterLayoutSizeChange(this.canvas.contentW,this.canvas.contentH,t(e.width,e.unit),t(e.height,e.unit))}},{"../../../factory/images":102,"../../editor/editor":76,"./abstract/element":53}],72:[function(e,t,n){function i(){this.textAttributes=["content","font","spacing","stroke","decoration","color","anchor","bullet_points","auto_adjustable","text_content"],this.handledAttributes=_.union(this.textAttributes,this.handledAttributes)}var a=e("./abstract/element"),o=e("../../restrictions/decorate");t.exports=i,i.prototype=new a,i.prototype.constructor=i,i.prototype.set=function(e,t){this.textarea=t.textarea||(new INKIVE.Text.Textarea).setDOM(e),a.prototype.set.apply(this,arguments),this.textarea.render(this.canvas)},i.prototype.updateStroke=function(e,t){t=t.stroke,"undefined"!=typeof t.width&&(this.textarea.text.setValues({stroke_width:t.width}),this.trigger("stroke.width",e.getAttribute("id"),t.width)),"undefined"!=typeof t.color&&(this.textarea.text.setValues({stroke:t.color}),this.trigger("stroke.color",e.getAttribute("id"),t.color)),"undefined"!=typeof t.dasharray&&(this.textarea.text.setValues({stroke_dasharray:t.dasharray}),this.trigger("stroke.dasharray",e.getAttribute("id"),t.dasharray)),this.trigger("stroke",e.getAttribute("id"),t)},i.prototype.updateSpacing=function(t,n){var i="undefined"!=typeof n.decoration&&"underline"!==n.decoration,a="underline"===this.textarea.text.text_decoration&&!i;if(n=n.spacing,a&&(n.letter||n.word)&&e("../../../utils/advice").show("spacing-and-underline"),!("undefined"==typeof n.letter||a&&n.letter)){var o=n.letter;if(_.isArray(this.textarea.text.letter_spacing)){var r=_.reduce(this.textarea.text.letter_spacing,function(e,t){return e+parseFloat(t)},0)/(this.textarea.text.letter_spacing.length-1),s=o/r;o=_.map(this.textarea.text.letter_spacing,function(e){return parseFloat(e)*s})}this.textarea.text.setValues({letter_spacing:o}),this.trigger("spacing.letter",t.getAttribute("id"),n.letter)}"undefined"==typeof n.word||a&&n.word||(this.textarea.text.setValues({word_spacing:n.word}),this.trigger("spacing.word",t.getAttribute("id"),n.word)),"undefined"!=typeof n.line&&(this.textarea.text.setValues({line_spacing:n.line}),this.trigger("spacing.line",t.getAttribute("id"),n.line)),this.trigger("spacing",t.getAttribute("id"),n)},i.prototype.updateFont=function(e,t){t=t.font,"undefined"!=typeof t.family&&(this.textarea.text.setValues({font_family:"'"+t.family.replace(/\'/g,"\\'")+"'"}),this._processFontFamily(e,t),this.trigger("font.family",e.getAttribute("id"),t.family)),"undefined"!=typeof t.size&&(this.textarea.text.setValues({font_size:t.size}),this.trigger("font.size",e.getAttribute("id"),t.size)),"undefined"!=typeof t.weight&&(this.textarea.text.setValues({font_weight:t.weight}),this.trigger("font.weight",e.getAttribute("id"),t.weight)),"undefined"!=typeof t.style&&(this.textarea.text.setValues({font_style:t.style}),this.trigger("font_style",e.getAttribute("id"),t.style)),this.trigger("font",e.getAttribute("id"),t)},i.prototype._processFontFamily=function(t,n){var i=e("../../../factory/fonts");i.isLoadedFont(n.family)||(INKIVE.SVGElementLoading.show(t),i.refreshCustomFonts().then(function(){$.fontSpy(n.family,{success:_.partial(INKIVE.SVGElementLoading.hide,t),failure:_.partial(INKIVE.SVGElementLoading.hide,t),timeOut:5e3})}))},i.prototype.updateBulletPoints=function(e,t){var n="start"==this.textarea.text.text_anchor;n||this.updateAnchor(e,{anchor:"start"}),this.textarea.text.setValues({bullets:t.bullet_points}),this.trigger("bullet_points",e.getAttribute("id"),t.bullet_points)},i.prototype.updateAutoAdjustable=function(e,t){this.textarea.text.setValues({auto_adjustable:t.auto_adjustable}),this.trigger("auto_adjustable",e.getAttribute("id"),t.auto_adjustable)},i.prototype.updateTextContent=function(e,t){t.content=t.text_content,this.updateContent(e,t)},i.prototype.updateContent=function(e,t){
var n=null,i=t.content,a=this.textarea.text.textContent,o=INKIVE.Tool.calculateStringContentDifference(a,i),r=o.added-o.removed,s=t.force_redraw||r<=0||i.length<300,l=o.position+o.added,c=i.split("\n");s||_.any(this.textarea.text.strings,_.bind(function(e,t){var i=e.isBlank?"":e.textContent,a=this.textarea.text.strings.length-1;if(c[t]!==i||t===a)return n=t,!0},this)),this.textarea.text.setValues({firstDiffLinePosition:n,textContent:i.replace(/ /g,String.fromCharCode(160)),newLetters:r,cursorPosition:l}),this.trigger("content",e.getAttribute("id"),i)},i.prototype.updateDecoration=function(t,n){var i=n.spacing,a=i&&"undefined"!=typeof i.letter&&!i.letter,o=i&&"undefined"!=typeof i.word&&!i.word,r=this.textarea.text.letter_spacing&&!a||this.textarea.text.word_spacing&&!o;r&&"underline"===n.decoration?e("../../../utils/advice").show("spacing-and-underline"):(this.textarea.text.setValues({text_decoration:n.decoration}),this.trigger("decoration",t.getAttribute("id"),n.decoration))},i.prototype.updateAnchor=function(e,t){this.textarea.text.setValues({text_anchor:t.anchor}),this.trigger("anchor",e.getAttribute("id"),t.anchor)},i.prototype.updateColor=function(e,t){this.textarea.text.setValues({fill:t.color}),this.trigger("color",e.getAttribute("id"),t.color)},i.prototype=o(e("./restrictions/text"),i.prototype)},{"../../../factory/fonts":100,"../../../utils/advice":477,"../../restrictions/decorate":90,"./abstract/element":53,"./restrictions/text":61}],73:[function(e,t,n){function i(){this.handledAttributes=_.union(["source","thumb_src","autoplay","movetonext","controls","fullscreen","loop","mute"],this.handledAttributes)}function a(e,t,n){return e?{width:t.width,height:t.width/n}:{width:t.height*n,height:t.height}}var o=e("./abstract/element"),r=(e("../creators/video"),e("../getters/video")),s=e("../../../factory/images");t.exports=i,i.prototype=new o,i.prototype.constructor=i,i.prototype.updateAutoplay=function(e,t){$(e).toggleClass("autoplay",t.autoplay)},i.prototype.updateMovetonext=function(e,t){$(e).toggleClass("movetonext",t.movetonext)},i.prototype.updateControls=function(e,t){$(e).toggleClass("controls",t.controls)},i.prototype.updateFullscreen=function(e,t){$(e).toggleClass("fullscreen",t.fullscreen)},i.prototype.updateLoop=function(e,t){$(e).toggleClass("loop",t.loop)},i.prototype.updateMute=function(e,t){$(e).toggleClass("mute",t.mute)},i.prototype.updateThumbSrc=function(e,t){if(!t.source){var n=$(e).children("image")[0];svgedit.utilities.assignAttributes(n,{"xlink:href":t.thumb_src},100),this._smartImageLoad(e,t),this.trigger("thumb_src",e.getAttribute("id"),t)}},i.prototype.updateSource=function(e,t){t.source=this._getYoutubeCode(t.source),t.thumb_src=t.thumb_src||"http://img.youtube.com/vi/"+t.source+"/mqdefault.jpg";var n=!s.isAmazonImage(t.thumb_src);svgedit.utilities.assignAttributes(e,{"xlink:href":"https://www.youtube.com/watch?v="+t.source},100),n&&this._resizeExternalThumbnail(e,t),n||this._smartImageLoad(e,t),this.trigger("source",e.getAttribute("id"),t)},i.prototype._smartImageLoad=function(e,t){var n=$(e).children("image")[0],i=svgedit.utilities.getBBox(n);this.trigger("optimize_resolution",e.getAttribute("id")),s.smartLoad(t.thumb_src,i,_.bind(function(i,a){var o=i===INKIVE.C.Status.success||t.thumb_src;t.thumb_src=i===INKIVE.C.Status.success?a.src:t.thumb_src,o&&(n&&n.setAttribute("xlink:href",t.thumb_src),this.trigger("resolution_optimized",e.getAttribute("id"),t))},this))},i.prototype._resizeExternalThumbnail=function(e,t){function n(n){var i={photo_url:n,platform:"tab"},a=INKIVE.C.BASE_URL+"inkive/resizeexternalsearchphoto";$.api(a,"POST",i,_.bind(function(n){if("success"===n.STATUS){var i={thumb:n.MESSAGE.replace("/tab/","/thumb/"),mobile:n.MESSAGE.replace("/tab/","/mobile/"),tab:n.MESSAGE,web:n.MESSAGE.replace("/tab/","/web/"),largeweb:n.MESSAGE.replace("/tab/","/largeweb/"),original:n.MESSAGE.replace("/tab/","/original/")};s.addImageData(i,s.defaultAmazonDataNames)}var a=_.bind(this._matchImageToBox,this,e,t);!function o(e){var t=new Image;t.src=e||n.MESSAGE,t.onload=_.partial(a,t),t.onerror=function(){setTimeout(_.partial(o,n.MESSAGE.replace("/tab/","/original/")),1e3)}}()},this))}var i="https://www.googleapis.com/youtube/v3/videos?id="+t.source+"&key="+INKIVE.C.YOUTUBE_KEY+"&fields=items(snippet(thumbnails))&part=snippet",a=new Image;return a.src=t.thumb_src,a.onload=_.bind(this._matchBoxToImage,this,e,t,a),n=_.bind(n,this),$(e).addClass("resizing"),this.trigger("optimize_resolution",e.getAttribute("id")),$.ajax({url:i,dataType:"jsonp",success:function(e){var t=e.items[0].snippet.thumbnails,i=t.maxres||t.standard||t.high||t.medium||t["default"];n(i.url)},error:function(e,t,n){$.post(INKIVE.C.BASE_URL+"api/errortrack/log",{data:"[Youtube Video] "+t+" | "+n,is_critical:!0})}})},i.prototype.updateSize=function(e,t){var n=$(e).find("title")[0];o.prototype.updateSize.apply(this,arguments);var i=svgedit.utilities.getBBox($(e).children("image")[0]);$(e).children("path").remove(),this._appendPlayIcon(e),n.textContent=Math.floor4(i.x)+" "+Math.floor4(i.y)+" "+Math.floor4(i.width)+" "+Math.floor4(i.height)},i.prototype._matchImageToBox=function(e,t,n){function i(t){var i=(this.canvas.getBBox(n),this.canvas.addSvgElementFromJson({element:"rect",curStyles:!1,attr:{x:o.x,y:o.y,id:this.canvas.getNextId(),width:o.width,height:o.height}}));$(l).remove(),l=this.canvas.runExtensions("addLayoutBox",{elem:i,clipPathBB:o,"xlink:href":n.src}),l.setAttribute("width",c.width),l.setAttribute("height",c.height),l.setAttribute("x",o.x-(c.width-o.width)/2),l.setAttribute("y",o.y-(c.height-o.height)/2),$(l).addClass("layoutBox").removeClass("element"),$(e).prepend(l)}var o=e.getBBox(),r=n.width/n.height,s=o.width/o.height,l=$(e).children("image")[0];$(e).removeClass("resizing");var c=a(r<s,o,r);i.call(this),t.thumb_src=n.src,this.trigger("resolution_optimized",e.getAttribute("id"),t)},i.prototype._matchBoxToImage=function(e,t,n){var i=e.getBBox(),o=n.width/n.height,r=i.width/i.height,s=a(o>r,i,o);this.updateSize(e,{size:s})},i.prototype._appendPlayIcon=function(e){var t=svgedit.utilities.getBBox(e),n=Math.floor4(t.x+t.width/2),i=Math.floor4(t.y+t.height/2),a=t.width>t.height?t.height:t.width;a*=.2,n-=a/4,i-=a/2;var o=this.canvas.addSvgElementFromJson({element:"path",attr:{id:this.canvas.getNextId(),d:"M "+(a+n)+","+(a/2+i)+" "+n+","+(a+i)+" "+n+","+i+" z",fill:"#FFF"}});e.appendChild(o)},i.prototype._getYoutubeCode=r.prototype._getYoutubeCode},{"../../../factory/images":102,"../creators/video":33,"../getters/video":47,"./abstract/element":53}],74:[function(e,t,n){t.exports={_close:function(){function e(){this.isClosing=!1,INKIVE.Modal.togglePageLoader(!1),this.appBridge.callBoth("close_editor")}INKIVE.Helpers.api("inkive/close","GET",{scrapbook:INKIVE.C.BOOK.id},_.bind(e,this))}}},{}],75:[function(e,t,n){t.exports={_onSavedCheckOnce:function(){return this.appBridge.version.isApp("webrand")||this.appBridge.version.isApp("pdf")||!window.Android&&!this.appBridge.version.isLowerThan("2.2.1")||window.Android&&!this.appBridge.version.isLowerThan("2.1")},_onSaved:function(e,t,n){t?(e.resolve(),this.trigger("saved")):(INKIVE.Modal.togglePageLoader(!1),e.reject(),this.trigger("Forbidden"===n?"403":"saving.error"))}}},{}],76:[function(e,t,n){function i(){this.isClosing=!1,this.handlers={align:e("./handlers/align"),zoom:e("./handlers/zoom"),page:e("./handlers/page"),cache:e("./handlers/cache"),history:e("./handlers/history"),image:e("./handlers/image"),background:e("./handlers/background"),download:e("./handlers/download"),tool_mode:e("./handlers/tool-mode")},this.getters={log_info:e("./getters/logs"),page:e("./getters/page")}}var a=e("../abstract/facade"),o=e("../../app/decorate"),r=e("../design/getters/sticker"),s=e("../../utils/cookie-storage"),l=e("../../core/history/history"),c=e("../../utils/humps");i.prototype=new a,i.prototype.constructor=i,i.prototype.initialize=function(e){a.prototype.initialize.call(this),this.handlers.zoom.curConfig=e,_.bindAll(this,"get","close","deselectAll","_close","_doubleTap"),this.tool=INKIVE.Tool.getInstance(),this.editor=this.tool.editor,this.initSelectEvent(),this.editor.gesture.on("double_click",this._doubleTap),l.on("all",_.partial(this.propagate,"history"))},i.prototype.initSelectEvent=function(){function e(e,t){return e&&t.length===e.length&&_.all(t,function(t){return _.any(e,function(e){return t.getAttribute("id")===e.getAttribute("id")})})}var t=this.canvas;t.bind("editor.sub_selected",_.bind(function(t,n){n=_.compact(n),e(this.subElements,n)||this._select(n)},this)),t.bind("editor.elem_selected",_.bind(function(e,t){this.subElements.length&&this._select(_.compact(t))},this)),t.bind("editor.selected",_.bind(function(n,i){i=_.compact(i),e(this.selectedElements,i)||(t.runExtensions("selectedChanged",{elems:i}),this._select(i))},this))},i.prototype.get=function(e,t){var n=c.camelize("get_"+e);return this[n]?this[n](t):this.getters[e]?this.getters[e].get(t):void 0},i.prototype.select=function(e){function t(e){return $(e).closest(".subelement").length}e=_.isArray(e)?e:[e];var n=_.chain(e).map(function(e){return $("#"+e)[0]}).filter(t).value(),i=_.map(e,function(e){if("background"===e)return $("#svgcontent").children("g.background").children(":not(title)").last()[0];var n=$("#"+e);return t(n[0])?n.parents(".element")[0]:n[0]});this.canvas.selectOnly(i),n.length&&(_.each(n,function(e){$(e).addClass("active")}),this._select(n))},i.prototype.deselectAll=function(){this.subElements=[],this.selectedElements=[],this.canvas.clearSelection()},i.prototype.closeCrop=function(e){var t=$(".clipperImage .layoutClipperImage");this.canvas.runExtensions("cropLayoutContent",{elem:t[0],layout:$("#"+t.data("old-id"))[0],hasChanges:!0}),this.trigger(("background"===e?"background":"image")+".crop.end")},i.prototype.cancelCrop=function(e){var t=$(".clipperImage .layoutClipperImage");this.canvas.runExtensions("cropLayoutContent",{elem:t[0],layout:$("#"+t.data("old-id"))[0],hasChanges:!1}),this.trigger(("background"===e?"background":"image")+".crop.cancel")},i.prototype.close=function(e){if(!this.isClosing){var t=this.editor.getSvgString(),n=Base64.decode(INKIVE.C.BOOK.name).trim().toLowerCase(),i=INKIVE.Helpers.projectIsLinkedToRestrictions();if(this.isSavingProjectName)this.off("project.name.saved").once("project.name.saved",this.close);else if(i||INKIVE.EditorModeManager.isMode("logo")||INKIVE.C.IS_MOBILE_APP||"new project"!==n&&""!==n)if(INKIVE.C.IS_MOBILE_APP){this.isClosing=!0;var a=!INKIVE.Helpers.areEqual(t,this.handle("cache","get"));a||this._close(),a&&this.handlers.page.save().then(this._close,_.bind(function(){this.isClosing=!1},this))}else{var o,r=_.bind(function(){this.isClosing=!0,INKIVE.Modal.togglePageLoader(!0),INKIVE.disableWindowExitConfirm=!0,this.handlers.page._getChangesToSave(e).then(_.bind(function(t){t||this._close(),t&&this.handlers.page.save(e,t).then(this._close,_.bind(function(){this.isClosing=!1},this))},this))},this);$("#ik-download-notification").is(":visible")?o="modal.close_confirm_dialog_downloading":INKIVE.hasEditorUnsavedChanges&&(o="modal.close_confirm_dialog"),o?INKIVE.Modal.alertMessage(INKIVE.TemplatesHelper("alert_span",{text:INKIVE.TranslateHelper.translate(o)}),{callback:[r,$.noop]}):r()}else $('body > header [data-value="project-name"] span').text("").focus(),this.canvas.call("advice.show","project-name")}},i.prototype.convertToImageBox=function(){var e=this.canvas.getSelectedElems()[0],t=this.canvas.getBBox(e),n=["stroke","stroke-width","stroke-dasharray","stroke-linejoin","stroke-linecap","stroke-opacity","fill"],i=this.canvas.copyElem(e);_.each(n,i.removeAttribute,i),i.setAttribute("fill-opacity","1"),this.canvas.deleteSelectedElements(),i.removeAttribute("id");this.canvas.runExtensions("addLayoutBox",{elem:i,clipPathBB:t});INKIVE.Tool.autoSave(i),this.trigger("convert_to_image_box")},i.prototype.getSelection=function(){function t(e,t){var n,i=this.getType(e);if("sticker"===i){var a=new r;a.element=e,_.any(a.getTexts(),function(e,i){if(e.element===t)return n={type:"text",index:i}})}return n}var n=e("../design/design"),i=e("../restrictions/restrictions");return this.subElements=[],_.compact(_.map(this.canvaSelectedElements,_.bind(function(e){if(e){if($(e).is(".subelement")){var a=e;e=$(e).parents(".element")[0];var o=t.call(this,e,a);this.subElements.push(a)}var r=$(e).is(".background")?"background":e.getAttribute("id"),s=$(e).attr("data-old-id");s&&$("#"+s).length&&(r=$(e).attr("data-old-id"));var l=n.get(r);return _.extend(l,{permissions:l?i.getAllElementPermissions(l.id):[]},{inner_element:o})}},this)))},i.prototype.setWorkareaBackgroundColor=function(e){e=e||{};var t=_.contains(e.color,"#")?e.color:"#"+e.color;$("#canvas-panel").css("background-color",t),this.trigger("set_workarea_background_color",t)},i.prototype._close=function(){function e(){var e,t=window.location.href;t=t.slice(t.indexOf("?")+1).split("&");for(var n=0;n<t.length;n++)if(e=t[n].split("="),"referrer"===e[0])return decodeURIComponent(e[1])}INKIVE.Helpers.api("inkive/close","GET",{scrapbook:INKIVE.C.BOOK.id},_.bind(function(){if(this.isClosing=!1,INKIVE.C.IS_MOBILE_APP&&INKIVE.Modal.togglePageLoader(!1),INKIVE.EditorModeManager.isMode("restrict")||INKIVE.EditorModeManager.isMode("brand_template")){var t=s.get("company_domain");t?window.location=INKIVE.C.WE_BRAND.replace(/(http[s?]:\/\/)/,"$1"+t+".")+e():document.referrer&&(document.referrer.match(/\.desygner.com/)||INKIVE.C.IS_DEV)?window.location=document.referrer:window.location=INKIVE.C.WE_BRAND+e()}else INKIVE.EditorModeManager.isMode("logo")?window.location=BASE_URL+"library":window.location=BASE_URL},this))},i.prototype._select=function(e){this.canvaSelectedElements=_.sortBy(e,function(e){return-$(e).index()}),this.selectedElements=_.compact(_.map(e,function(e){return $(e).is(".subelement")?$(e).parents(".element")[0]:e})),this.trigger("select",this.getSelection())},i.prototype._doubleTap=function(t){var n=e("../design/design"),i=this.canvas.getSelectedElems(),a=e("../restrictions/restrictions");this.trigger("double_tap",_.map(i,_.bind(function(e){var i,o=this.getType(e);if("sticker"===o){var s=$(t.target).closest("g.textarea")[0];if(s){var l=new r;l.element=e,_.any(l.getTexts(),function(e,t){if(e.element===s)return i={type:"text",index:t}})}}var c=n.get($(e).is(".background")?"background":e.getAttribute("id"));return _.extend(c,{permissions:a.getAllElementPermissions(c.id)},{inner_element:i})},this)))},t.exports=o(e("./app/editor"),new i)},{"../../app/decorate":8,"../../core/history/history":13,"../../utils/cookie-storage":480,"../../utils/humps":482,"../abstract/facade":23,"../design/design":34,"../design/getters/sticker":44,"../restrictions/restrictions":94,"./app/editor":74,"./getters/logs":77,"./getters/page":78,"./handlers/align":79,"./handlers/background":80,"./handlers/cache":81,"./handlers/download":82,"./handlers/history":83,"./handlers/image":84,"./handlers/page":85,"./handlers/tool-mode":86,"./handlers/zoom":87}],77:[function(e,t,n){t.exports={get:function(){var e=$("#svgcontent").html(),t=INKIVE.Tool.getInstance();return{project_id:INKIVE.C.BOOK.id,svg_save_string:t.getSaveString(),is_ready_to_save:t.isReadyToSave(),dom_svgcontent:!!e,design_id:INKIVE.Tool._current_design_id,page_number:INKIVE.Tool._current_page_number,image_cache:INKIVE.ImagesFactory.imagesData,images_inlined:INKIVE.ImagesFactory.inlinedImages,svg_string:e||t.editor.getSvgString()}}}},{}],78:[function(e,t,n){t.exports={get:function(e){return"id"===e?parseInt(INKIVE.Tool._current_design_id):"current"===e?parseInt(INKIVE.Tool._current_page_number):"total"===e?parseInt(INKIVE.C.BOOK.num_pages):{id:parseInt(INKIVE.Tool._current_design_id),has_changes:this._hasChanges(),current:parseInt(INKIVE.Tool._current_page_number),total:parseInt(INKIVE.C.BOOK.num_pages)}},_hasChanges:function(){var e=INKIVE.Tool.getInstance(),t=INKIVE.RestrictionsFactory&&!INKIVE.RestrictionsFactory.isAllSaved();return!!t||!INKIVE.Helpers.areEqual(e.editor.getSvgString(),INKIVE.EditorFacade.handle("cache","get"))}}},{}],79:[function(e,t,n){t.exports=_.extend({initialize:function(){var e=INKIVE.Tool.getInstance();this.editor=e.editor,this.canvas=this.editor.canvas,this.svgroot=$("#svgroot").get(0)},verticalMiddle:function(){this._doAlign(function(e,t){return{x:0,y:e.y+e.height/2-(t.y+t.height/2)}})},horizontalMiddle:function(e){this._doAlign(function(e,t){return{x:e.x+e.width/2-(t.x+t.width/2),y:0}})},left:function(){this._doAlign(function(e,t){return{x:e.x-t.x,y:0}})},right:function(){this._doAlign(function(e,t){return{x:e.x+e.width-(t.x+t.width),y:0}})},top:function(){this._doAlign(function(e,t){return{x:0,y:e.y-t.y}})},bottom:function(){this._doAlign(function(e,t){return{x:0,y:e.y+e.height-(t.y+t.height)}})},_doAlign:function(e){var t=_.toArray(this.canvas.getSelectedElems());if(t.length){var n,i=t.length;if(i>2)i--,n=this._getBBox(t[i]);else{n=svgedit.utilities.getBBox($("#canvasBackground").get(0));var a=Math.min(.05*n.width,.05*n.height),o=this._getBBox(t[0]);(o.height+a>n.height||o.width+a>n.width)&&(a=0),n.x+=a,n.y+=a,n.width-=2*a,n.height-=2*a}for(var r=0;r<i;r++)this._setPosition(t[r],e(n,this._getBBox(t[r])));this.trigger()}},_getBBox:function(e){var t=this.canvas.getZoom(),n=INKIVE.Helpers.getSelectedCoordinates(e);return{x:n.x1/t,y:n.y1/t,width:(n.x2-n.x1)/t,height:(n.y3-n.y1)/t}},_setPosition:function(e,t){var n=this.svgroot.createSVGTransform(),i=svgedit.transformlist.getTransformList(e);n.setTranslate(t.x,t.y),i.appendItem(n),svgedit.recalculate.recalculateDimensions(e),this.canvas.selectorManager.requestSelector(e).resize()}},Backbone.Events)},{}],80:[function(e,t,n){t.exports=_.extend({initialize:function(){this.tool=INKIVE.Tool.getInstance(),this.editor=this.tool.editor,this.canvas=this.editor.canvas},crop:function(){var t=$("#svgcontent").find(".background").find("image").get(0);if(t){var n=e("../editor"),i=n.handle("zoom","get");this.trigger("crop.start",{id:t.getAttribute("id")}),_.defer(_.bind(function(){this._fitZoomToImageSize(n,t),this.canvas.runExtensions("backgroundReposition",{layout:t,callback:_.bind(function(){this.trigger("crop.end",{id:t.getAttribute("id")}),n.handle("zoom","set",{zoom:i})},this)})},this))}},_fitZoomToImageSize:function(e,t){var n=svgedit.utilities.getBBox(t);n&&(e.handle("zoom","center",{x:n.x+n.height/2,y:n.y+n.width/2}),e.handle("zoom","fit",n))}},Backbone.Events)},{"../editor":76}],81:[function(e,t,n){var i={};t.exports=_.extend({initialize:function(){},clear:function(){i={},this.trigger("cleared")},set:function(e){e.design_id=e.design_id||INKIVE.Tool._current_design_id,i[e.design_id]=e.data},get:function(e){return e=e||{design_id:INKIVE.Tool._current_design_id},i[e.design_id]},remove:function(e){var t={};e=e||{design_id:INKIVE.Tool._current_design_id},_.each(i,function(n,i){if(i!=e.design_id){var a=i>e.design_id?parseInt(i)-1:i;t[a]=n}}),i=t,this.trigger("removed")},add:function(e){var t={};e=e||{design_id:INKIVE.Tool._current_design_id},_.each(i,function(n,i){var a=i>=e.design_id?parseInt(i)+1:i;t[a]=n}),i=t}},Backbone.Events)},{}],82:[function(e,t,n){t.exports=_.extend({initialize:function(){this.tool=INKIVE.Tool.getInstance(),this.editor=this.tool.editor,this.canvas=this.editor.canvas},pdf:function(){return this.displayModal("pdf")},jpeg:function(){return this.displayModal("jpeg")},png:function(){return this.displayModal("png")},displayModal:function(e){var t=_.bind(this._download,this),n=INKIVE.TranslateHelper.translate,i=new INKIVE.ModalDownload({format:e,contentW:this.canvas.contentW,contentH:this.canvas.contentH}),a=INKIVE.Modal.modalWindow(i.getFormHtml(),{width:600,headerIcon:"icon-cloud-download",headerTitle:n("modal.title.download_format",{format:e.toUpperCase()}),buttons:[{title:n("modal.buttons.download"),onClick:function(){t($(this),a,i)}}]})},_download:function(e,t,n){function i(n){n?(t.close(),INKIVE.C.IS_MOBILE&&a.onMobileBackMenu()):e.removeClass("disabled"),o.close()}var a=this.tool;e.addClass("disabled");var o=INKIVE.Modal.alertMessage(INKIVE.TemplatesHelper("alert_bold",{message:"modal.alert.preparing_file"}),{skip:!1,loader:!0});INKIVE.EditorFacade.handle("page","save").then(function(){n.download(i)})}},Backbone.Events)},{}],83:[function(e,t,n){var i=e("../../../core/history/history");t.exports=_.extend({initialize:$.noop,undo:function(){i.undo()},redo:function(){i.redo()}},Backbone.Events)},{"../../../core/history/history":13}],84:[function(e,t,n){t.exports=_.extend({initialize:function(){this.tool=INKIVE.Tool.getInstance(),this.editor=this.tool.editor,this.canvas=this.editor.canvas},filter:function(e){INKIVE.C.IS_MOBILE_APP||$("<div>").filterpicker({$svgImageElement:$(e)}).trigger("click")},setAsBackground:function(t){var n=e("../../design/design"),i=n.get(t.id),a=t.getAttribute("xlink:href");if((i.flipped.horizontal||i.flipped.vertical)&&(a=t.getAttribute("data-original-href")),$(t).hasClass("layoutBox")){$(t).removeClass("layoutBox");var o=svgedit.utilities.getClipPath(t);o&&$(o).parent()[0].removeChild(o)}this.canvas.deleteSelectedElements(),n.set("background",{source:a,previous_image_flipped:i.flipped,old_image_id:t.id})},crop:function(t,n){n=n||{};var i=e("../../restrictions/restrictions");if(i.canChange(t,"crop")){if(!$(t).hasClass("layoutBox")){t=this._convertToLayoutBox(t,n),this.canvas.call("advice.show","convert-to-layout-box");var a=10,o=setInterval(function(){$("symbol#arrow circle").attr("fill",a%2?"#ffdd17":"#ffffff"),a--||clearInterval(o)},400);this.canvas.addToSelection([t],!0)}if(!n.quiet){var r=e("../editor"),s=r.handle("zoom","get");this.trigger("crop.start",{id:t.getAttribute("id")}),_.defer(_.bind(function(){this._fitZoomToImageSize(r,t),this.canvas.runExtensions("showLayoutClipper",{layout:t,callback:_.bind(function(){this.trigger("crop.end",{id:t.getAttribute("id")}),r.handle("zoom","set",{zoom:s})},this)})},this))}}},_convertToLayoutBox:function(e,t){var n=this.canvas.getBBox(e),i=t.clip_path||n,a=e.getAttribute("id"),o=e.getAttribute("xlink:href"),r=this.canvas.addSvgElementFromJson({element:"rect",curStyles:!1,attr:{x:i.x,y:i.y,id:this.canvas.getNextId(),width:i.width,height:i.height}});$(e).remove(),e=this.canvas.runExtensions("addLayoutBox",{elem:r,clipPathBB:i,"xlink:href":o});var s=t.scale||1.2,l=n.width*s,c=n.height*s;return this.trigger("rename."+a,{id:e.getAttribute("id")}),e.setAttribute("width",l),e.setAttribute("height",c),e.setAttribute("x",n.x-(l-n.width)/2),e.setAttribute("y",n.y-(c-n.height)/2),$(e).addClass("layoutBox"),e},_fitZoomToImageSize:function(e,t){function n(){var e=t.getBoundingClientRect(),n=$("#svgcanvas")[0].getBoundingClientRect();return e.width<n.width&&e.height<n.height}var i=svgedit.utilities.getBBox(t);n()||e.handle("zoom","fit",svgedit.utilities.getBBox(t)),i&&e.handle("zoom","center",{x:i.x+i.height/2,y:i.y+i.width/2})}},Backbone.Events)},{"../../design/design":34,"../../restrictions/restrictions":94,"../editor":76}],85:[function(e,t,n){var i,a=e("../../../app/decorate"),o=e("../../../ui/editor-mode-manager"),r=e("../../../factory/company").instance;t.exports=a(e("../app/page"),_.extend({initialize:function(){this.savingDeferred=null,this.tool=INKIVE.Tool.getInstance(),this.editor=this.tool.editor,this.canvas=this.editor.canvas},unload:function(t){var n=e("../editor");t=t||{},t.page_number=t.page_number||INKIVE.Tool._current_page_number,t.remove_from_cache&&n.handle("cache","remove",{page_number:t.page_number}),INKIVE.Tool._current_page_number==t.page_number&&(INKIVE.Tool._current_design_id=null,INKIVE.Tool._current_page_number=0),this.trigger("unloaded")},moveTo:function(t){function n(){this._moveTo(t.page_number).then(function(){t.quiet||INKIVE.Modal.togglePageLoader(!1),a.resolve()})}var i=INKIVE.Tool._current_page_number&&t.save!==!1,a=$.Deferred();if(this.canvas.clearSelection(),!t.page_number&&t.design_id){var o=e("../../project/project"),r=o.get("design",{design_id:t.design_id});t.page_number=r.page_number}INKIVE.Modal.closeAllPageLoaders();var s=t.design_id?t.design_id==INKIVE.Tool._current_design_id:t.page_number==INKIVE.Tool._current_page_number;return s?(INKIVE.C.IS_MOBILE&&$("#pages-panel").height()&&this.tool.onMobileBackMenu(),a.resolve(),a.promise()):(t.quiet||INKIVE.Modal.togglePageLoader(!0),i||n.call(this),i&&this.save({quiet:!0}).then(_.bind(n,this)),a.promise())},save:function(e,t){return this.savingDeferred?this.savingDeferred.promise():(this.savingDeferred=$.Deferred(),this._isLegacySave()?this._handleLegacySave():this._getChangesToSave(e,t).then(_.bind(function(t){t||this._handleNothingToSave(),t&&this._handleDefaultPageSave(t,e)},this)),this.savingDeferred.promise())},loadVersion:function(e){if(e&&e.version_id){e.design_id=e.design_id||INKIVE.Tool._current_design_id;var t=INKIVE.ProjectFacade.get("design",{design_id:e.design_id});INKIVE.EditorFacade.handle("cache","remove",{design_id:e.design_id}),this.tool.load(t.page_number,_.bind(this.trigger,this,"load_version",e),e.version_id)}},_getChangesToSave:function(e,t){function n(){function e(){i.is_draft||a(),i.is_draft&&t()}function t(){if(INKIVE.Modal.lockStatus)return a();var e=INKIVE.Modal.modalWindow(INKIVE.TemplatesHelper("alert_span",{text:INKIVE.TranslateHelper.translate("modal.alert.draft")}),{width:600,skip:!1,headerIcon:"icon-news",headerTitle:"modal.title.draft_template",buttons:[{title:INKIVE.TranslateHelper.translate("modal.buttons.remove_draft"),onClick:function(){e.close(),i.is_draft=!1,d=!0,a()}},{title:INKIVE.TranslateHelper.translate("modal.buttons.keep_draft"),onClick:function(){e.close(),a()}}]})}i&&e(),i||r.get("templates",INKIVE.C.BOOK.encodedId).then(function(t){i=t,e()})}function a(){var e=!c&&(u||p||d);o.resolve(e?{undraft:d,design:u,restrictions:p}:null)}var o=$.Deferred(),s=this.editor.getSvgString(),l=this.canvas.getCurrentDrawing().getCurrentLayer(),c=l&&"clipperImage"==l.getAttribute("class"),d=t&&t.undraft,u=!INKIVE.Helpers.areEqual(s,INKIVE.EditorFacade.handle("cache","get")),p=INKIVE.RestrictionsFactory&&!INKIVE.RestrictionsFactory.isAllSaved();return c||INKIVE.C.BOOK.book_type!=INKIVE.C.BOOK_TYPE.TEMPLATE?a():e&&e.confirm_draft?n():a(),o.promise()},_isLegacySave:function(){return _.contains(["template","sticker","banner","placeholder"],o.getMode())},_handleLegacySave:function(){this.tool.save(null,_.bind(function(){var e=this.savingDeferred;this.savingDeferred=null,e.resolve()},this))},_handleNothingToSave:function(){_.defer(_.bind(function(){this.savingDeferred=null},this)),this.savingDeferred.resolve(),this.trigger("already_saved"),this.editor.canvas.call("advice.show","already-saved")},_handleDefaultPageSave:function(e,t){function n(e){var t=this.savingDeferred;this.savingDeferred=null,e||t.reject(),e&&t.resolve()}var i=[];if(t=t||{quiet:!1},this.trigger("saving"),e.design){var a=$.Deferred();i.push(a.promise()),this.tool.savePage(t.quiet,_.bind(this._onSaved,this,a))}e.restrictions&&i.push(INKIVE.RestrictionsFactory.save()),e.undraft&&i.push(r._undraft()),$.when.apply($,i).then(_.debounce(_.bind(n,this,!0),0),_.debounce(_.bind(n,this,!1),0))},_onSaved:function(e,t,n){if(t)this.trigger("saved"),INKIVE.hasEditorUnsavedChanges=!1,e.resolve();else{if("Permission is not granted"===n){if(!$("#loginPopup").length){INKIVE.Modal.toggleLock(!1);var i=new INKIVE.ModalLogin({});INKIVE.Modal.modalWindow(i.getFormHtml(),{width:500,headerTitle:"general.close"})}}else INKIVE.Modal.alertMessage(INKIVE.TemplatesHelper("alert_default",{message:"modal.alert.save",try_again:!0}));e.reject()}},_moveTo:function(e){var t=$.Deferred();return this.tool.load(e,_.bind(function(){this.trigger("move_to"),INKIVE.C.IS_MOBILE&&this.tool.updateCurrentPageInfo(),INKIVE.C.IS_MOBILE&&$("#pages-panel").height()&&this.tool.onMobileBackMenu(),t.resolve()},this)),t.promise()}},Backbone.Events))},{"../../../app/decorate":8,"../../../factory/company":98,"../../../ui/editor-mode-manager":162,"../../project/project":89,"../app/page":75,"../editor":76}],86:[function(e,t,n){t.exports=_.extend({initialize:function(){this.tool=INKIVE.Tool.getInstance(),this.editor=this.tool.editor},select:function(){this.editor.setMode("select")},fhpath:function(){this.editor.setMode("fhpath")},square:function(){this.editor.setMode("square")},rect:function(){this.editor.setMode("rect")},circle:function(){this.editor.setMode("circle")},ellipse:function(){this.editor.setMode("ellipse")},line:function(){this.editor.setMode("line")}},Backbone.Events)},{}],87:[function(e,t,n){t.exports=_.extend({initialize:function(){this.tool=INKIVE.Tool.getInstance(),this.editor=this.tool.editor,this.canvas=this.editor.canvas,this.zoomIncrement=.1,this.zoomLowLimit=.3,this.zoomHightLimit=4},get:function(){return this.canvas.getZoom()},set:function(e){e&&this.canvas.setZoom(e.zoom)},fit:function(e){var t=this.getFitZoom(e);this.canvas.setZoom(this.getForcedZoomLimits(t))},center:function(e){var t=this.canvas.getZoom(),n={top:e.y*t,left:e.x*t},i={top:$(this.curConfig.workarea).height()/2,left:$(this.curConfig.workarea).width()/2},a=$("#ik-editor > .antiscroll-inner");a.scrollTop(n.top-i.top),a.scrollLeft(n.left-i.left)},original:function(){this.canvas.setZoom(1)},"in":function(){var e=this.getFitZoom(),t=this.canvas.getZoom()+this.zoomIncrement*e;this.canvas.setZoom(this.getForcedZoomLimits(t))},out:function(){var e=this.getFitZoom(),t=this.canvas.getZoom()-this.zoomIncrement*e;this.canvas.setZoom(this.getForcedZoomLimits(t))},getForcedZoomLimits:function(e){var t=this.getZoomProportions(),n=this.zoomIncrement*t.avg*this.canvas.getZoom();return t.avg*e>=this.zoomHightLimit?e-=n:t.hight*e<=this.zoomLowLimit&&e<1&&(e+=n),e},getZoomProportions:function(){var e=$(this.curConfig.workarea).width(),t=$(this.curConfig.workarea).height(),n=this.canvas.contentW/e,i=this.canvas.contentH/t;return{low:n<i?n:i,hight:n>i?n:i,avg:(n+i)/2}},getFitZoom:function(e){e=e||{width:this.canvas.contentW,height:this.canvas.contentH};var t=$(this.curConfig.workarea).width(),n=$(this.curConfig.workarea).height(),i=INKIVE.C.IS_MOBILE?5:90,a=parseFloat(e.width)+i,o=parseFloat(e.height)+i,r=t/a,s=n/o;return r>s?s:r}},Backbone.Events)},{}],88:[function(e,t,n){var i=e("../../editor/editor"),a=e("../../design/design"),o=e("../../../factory/formats");t.exports=_.extend({initialize:function(){_.bindAll(this,"_onAdd","add","_onRemove","remove"),this.tool=INKIVE.Tool.getInstance(),this.editor=this.tool.editor},copy:function(t){function n(){INKIVE.Helpers.api("page/page_copy","POST",{design:s.design_id,append:t.append||!1,scrapbook_id:INKIVE.C.BOOK.id},c)}function a(e){t.silent||(INKIVE.Modal.toggleLock(e),INKIVE.Modal.togglePageLoader(e))}function o(n){var o=e("../../../factory/restrictions"),c=INKIVE.C.BOOK.book_type==INKIVE.C.BOOK_TYPE.TEMPLATE;n&&"success"==n.status?(INKIVE.C.BOOK.num_pages++,this.trigger("copied",_.extend({stay:t.stay,append:t.append,based_on:s.design_id,page_number:s.page_number},n)),t.stay&&l.resolve(n),t.stay||i.handle("page","move_to",{save:!1,design_id:n.design_id}).then(function(){c||r(n),c&&o.copyRestrictions(s.page_number).then(_.partial(r,n))})):(a(!1),INKIVE.Modal.alertMessage(INKIVE.TemplatesHelper("alert_default",{message:"modal.alert.copy",more_info:n.message})))}function r(e){a(!1),l.resolve(e)}t||(t={});var s,l=$.Deferred(),c=_.bind(o,this),d="undefined"==typeof t.save||t.save;return a(!0),this._getDesignWithDesignId(t).then(function(e){s=e,d&&i.handle("page","save").then(n),d||n()}),l.promise()},remove:function(t){t||(t={});var n=$.Deferred();return this._getDesignWithDesignId(t).then(_.bind(function(i){e("../project");t.design_id=i.design_id,t.page_number=i.page_number;var a={design:t.design_id,scrapbookId:INKIVE.C.BOOK.id},o=_.partial(this._onRemove,t,n),r=_.partial(INKIVE.Helpers.api,"page/page","DELETE",a,o);this.editor.canvas.clearSelection(),t.quiet&&r(),t.quiet||INKIVE.Modal.alertMessage(INKIVE.TemplatesHelper("alert_span",{text:1==INKIVE.C.BOOK.num_pages?INKIVE.TranslateHelper.translate("modal.alert.can_delete_last"):INKIVE.TranslateHelper.translate("modal.alert.delete_page",{page_number:t.page_number,
is_current_page:INKIVE.Tool._current_design_id==t.design_id})}),{callback:[r,function(){n.reject()}]})},this)),n.promise()},_getDesignWithDesignId:function(t){var n,i=$.Deferred(),a=e("../project");if(t.page_number)a.get("design_id",{page_number:t.page_number}).then(function(e){n=a.get("design",{design_id:e}),i.resolve(n)});else{var o=t.design_id||INKIVE.Tool._current_design_id;n=a.get("design",{design_id:o}),n&&i.resolve(n),n||a.refreshPageInfo().then(function(){n=a.get("design",{design_id:o}),i.resolve(n)})}return i.promise()},_onRemove:function(e,t,n){n&&"success"==n.status?(this.trigger("removing",e),1!=INKIVE.C.BOOK.num_pages||INKIVE.C.IS_MOBILE_APP?(INKIVE.C.BOOK.num_pages--,INKIVE.Tool._current_design_id==e.design_id?(i.handle("page","unload",{remove_from_cache:!0}),i.handle("page","move_to",{save:!1,page_number:e.page_number>INKIVE.C.BOOK.num_pages?e.page_number-1:e.page_number}).then(_.bind(function(){t.resolve(),this.trigger("removed",e)},this))):(t.resolve(),this.trigger("removed",e))):window.location=INKIVE.EditorModeManager.isMode("logo")?BASE_URL+"library":BASE_URL):t.reject()},add:function(e){var t=$.Deferred(),n=this.editor.canvas;e=_.extend({page_number:parseInt(INKIVE.C.BOOK.num_pages)+1,size:o.getCurrentSize()},e);var i=INKIVE.C.BASE_URL+"api/page/add",a={scrapbook_id:INKIVE.C.BOOK.id,page:e.page_number,width:e.size.width,height:e.size.height};return n.clearSelection(),INKIVE.Modal.togglePageLoader(!0),$.get(i,a,_.partial(this._onAdd,e,t)),t.promise()},_onAdd:function(e,t,n){INKIVE.Modal.togglePageLoader(!1),"success"==n.status?(INKIVE.C.BOOK.num_pages++,this.trigger("added",_.extend(n,e)),i.handle("page","move_to",{page_number:n.page_number}).then(_.debounce(function(){a.set("template",{size:e.size}),t.resolve()},0))):t.reject()}},Backbone.Events)},{"../../../factory/formats":101,"../../../factory/restrictions":122,"../../design/design":34,"../../editor/editor":76,"../project":89}],89:[function(e,t,n){function i(){this.handlers={design:e("./handlers/design")},this.pageData={},this.loadPageInfo(),this._initListeners()}var a=e("../abstract/facade"),o=e("../editor/editor"),r=e("../../utils/humps");i.prototype=new a,i.prototype.constructor=i,i.prototype.get=function(e,t){var n=r.camelize("get_"+e);return this[n]?this[n](t):this.getters[e]?this.getters[e].get(t):void 0},i.prototype.checkDesignId=function(){var e=this.pageData[INKIVE.Tool._current_page_number-1];e?e.design_id?e.design_id!=INKIVE.Tool._current_design_id&&$.post(INKIVE.C.BASE_URL+"api/errortrack/log",{is_critical:!0,data:"[PageOrder] Design id missmatch "+INKIVE.C.BOOK.id+", expected: "+INKIVE.Tool._current_design_id+", got: "+e.design_id+", page number: "+INKIVE.Tool._current_page_number}):e.design_id=INKIVE.Tool._current_design_id:$.post(INKIVE.C.BASE_URL+"api/errortrack/log",{is_critical:!0,data:"[PageOrder] Design id not found "+INKIVE.C.BOOK.id+", expected: "+INKIVE.Tool._current_design_id+", page number: "+INKIVE.Tool._current_page_number})},i.prototype.getDesignId=function(e){var t=$.Deferred(),n=this.getDesign(e);return n&&n.design_id?t.resolve(n.design_id):this.refreshPageInfo().then(_.bind(function(){var n=this.getDesign(e);t.resolve(n.design_id)},this)),t.promise()},i.prototype.getMasterBucket=function(){return this.masterBucket},i.prototype.getDesign=function(e){var t=this.getDesigns();return e.page_number?t[e.page_number-1]:_.find(t,function(t){return t.design_id==e.design_id})},i.prototype.getDesigns=function(){return _.map(this.pageData,function(e,t){return _.extend(_.clone(e),{page_number:t+1})})},i.prototype._initListeners=function(){o.on("page.saved",_.bind(function(){var e=this.pageData[INKIVE.Tool._current_page_number-1];e&&(e.last_mod=Date.now())},this)),this.on("design.removing",_.bind(function(e){var t=this.getDesign({design_id:e.design_id}),n=parseInt(t.page_number);this.pageData&&this.pageData.length>=n&&this.pageData.splice(n-1,1)},this)),this.on("design.added",_.bind(function(e){this.pageData&&this.pageData.splice(e.page_number-1,0,{design_id:e.design_id,size_width:e.size.width,size_height:e.size.height,size_unit:e.size.unit})},this)),this.on("design.copied",_.bind(function(e){var t=this.getDesign({design_id:e.based_on});this.pageData&&this.pageData.splice(e.page_number-1,0,_.extend(t,{design_id:e.design_id,based_on:e.based_on}))},this))},i.prototype.getInfo=function(e){e&&e.forceReload&&(this.pageInfoDeferred=null);var t=$.Deferred(),n=this.loadPageInfo();return n.then(_.bind(function(){this.trigger("get_info",this.pageInfo),t.resolve(this.pageInfo)},this)),t.promise()},i.prototype.loadPageInfo=function(){if(!this.pageInfoDeferred){this.pageInfoDeferred=$.Deferred();var e=INKIVE.C.BASE_URL+"inkive/doescoverpageexist";$.api(e,"POST",{scrapbook_id:INKIVE.C.BOOK.id},_.bind(function(e){this.pageData=e.page_info,this.pageInfo=e,this.masterBucket=INKIVE.Helpers.getBucketUrl(e.master_bucket),INKIVE.C.BOOK.num_pages=parseInt(e.num_pages),this.pageInfoDeferred.resolve()},this))}return this.pageInfoDeferred.promise()},i.prototype.refreshPageInfo=function(){this.pageInfoDeferred=null;var e=this.loadPageInfo();return e.then(_.bind(this.trigger,this,"refresh_page_info")),e},t.exports=new i},{"../../utils/humps":482,"../abstract/facade":23,"../editor/editor":76,"./handlers/design":88}],90:[function(e,t,n){function i(e,t){var n=t.match(/Check$/)||t.match(/CheckOnce$/);if(!n){var i=o[t+"Check"],s=o[t+"CheckOnce"];s?s.call(this)&&(this[t]=e):i?this[t]=_.partial(a,i,e,r.prototype[t]):this[t]=e}}function a(e,t,n){var i=e.call(this);i&&t.apply(this,_.rest(arguments,3)),i||n&&n.apply(this,_.rest(arguments,3))}var o,r;t.exports=function(e,t){if(INKIVE.C.BOOK.book_type==INKIVE.C.BOOK_TYPE.RESTRICTED_DESIGN){r=t,o=e;var n={_parentObject:r};return _.each(o,i,n),t.extend?t.extend(n):_.extend({},t,n)}return t}},{}],91:[function(e,t,n){function i(){}var a=e("../../factory/user-info"),o=(e("./menu-actions.json"),e("../../factory/swearing")),r=e("../../factory/company").instance;i.prototype.initialize=function(){return this.initializeDeferred?this.initializeDeferred:(this.initializeDeferred=$.Deferred(),a.get().then(_.bind(function(e){var t={username:e.user_token,password:e.user_hash};r.initialize().then(_.bind(this.loadDesignInfo,this,t)).then(_.bind(this.loadTemplatePermissions,this)).then(this.initializeDeferred.resolve)},this)),this.initializeDeferred.promise())},i.prototype.loadDesignInfo=function(e){var t=Backbone.Model.extend({url:INKIVE.C.WE_BRAND+"api/brand/designs/"+INKIVE.C.BOOK.encodedId}),n=new t;return n.credentials=e,n.fetch()},i.prototype.loadTemplatePermissions=function(e){var t=_.bind(r.getContainer,r,"templates",e.template);return this.templatePermissions=t("templatepermissions","me"),this.elementsPermissions=t("elementpermissions"),$.when(this.templatePermissions.fetch(),this.elementsPermissions.fetch().then(_.bind(function(e){var t=[];return this.elementsPermissions.each(function(e){var n=JSON.parse(e.get("restrictions"));n.swearing&&_.each(n.swearing.filter,function(e){_.contains(t,e)||t.push(e)})}),o.preloadSweringLists(t)},this)))},i.prototype.constructor=i,t.exports=i},{"../../factory/company":98,"../../factory/swearing":131,"../../factory/user-info":132,"./menu-actions.json":93}],92:[function(e,t,n){t.exports={initialize:function(e){this.canvas=INKIVE.Tool.getInstance().editor.canvas,this.permissionsFactory=e},restrictMovement:function(e,t,n){var i=t[0];return i?{x:i.horizontal?n.x:0,y:i.vertical?n.y:0}:n},restrictMargin:function(e,t,n){var i=t[0];if(!i)return n;var a=i.size,o=svgedit.utilities.getBBox(e),r=n.x,s=n.y;return o.x+n.x<a?r=a-o.x:o.x+o.width+n.x>this.canvas.contentW-a&&(r=this.canvas.contentW-a-o.x-o.width),o.y+n.y<a?s=a-o.y:o.y+o.height+n.y>this.canvas.contentH-a&&(s=this.canvas.contentH-a-o.y-o.height),{x:r,y:s}}}},{}],93:[function(e,t,n){t.exports={background:{BACKGROUND_REMOVE:["basic.image","basic.color"],BACKGROUND_COLOR_IMAGE:["basic.color","basic.image"],BACKGROUND_COLOR:["basic.color"],BACKGROUND_OPACITY:["opacity"],BACKGROUND_REPOSITION:["basic.image"],BACKGROUND_FLIP:["flip"],TRANSFORM:["flip"]},video:{INCREASE:["video_size"],DECREASE:["video_size"],UNLOCK:["video_position"],DUPLICATE:["video_duplication"],REMOVE:["video_deletion"],LOCK:["video_position"],ALIGNMENT:["video_position"],VIDEO_SOURCE:["video_replace"],VIDEO_AUTOPLAY:["video_flags"],VIDEO_MUTE:["video_flags"],VIDEO_MOVE_TO_NEXT:["video_flags"],VIDEO_CONTROLS:["video_flags"],VIDEO_FULLSCREEN:["video_flags"],VIDEO_LOOP:["video_flags"]},logo:{INCREASE:["logo_size"],DECREASE:["logo_size"],UNLOCK:["logo_position"],DUPLICATE:["logo_duplication"],REMOVE:["logo_deletion"],TEXT_FONTFAMILY:["logo_font_family"],TEXT_FONTSIZE:["logo_font_size"],OPACITY:["logo_opacity"],FILL_COLOR:["logo_colour"],TEXT_BOLD:["logo_decoration"],TEXT_ITALIC:["logo_decoration"],TEXT_UNDERLINE:["logo_decoration"],TEXT_CASE:["logo_change_content","logo_decoration"],TEXT_BULLETS:["logo_decoration"],TEXT_ALIGN:["logo_alignment"],LOCK:["logo_position"],ORDER:["logo_z_index"],ROTATE_LEFT:["logo_rotation"],ROTATE_RIGHT:["logo_rotation"],ROTATE:["logo_rotation"],TEXT_TYPING:["logo_change_content"],ALIGNMENT:["logo_position"],TEXT_SPACING:["logo_spacing"]},icon:{INCREASE:["logo_size"],DECREASE:["logo_size"],UNLOCK:["logo_position"],DUPLICATE:["logo_duplication"],REMOVE:["logo_deletion"],TEXT_FONTFAMILY:["logo_font_family"],TEXT_FONTSIZE:["logo_font_size"],OPACITY:["logo_opacity"],FILL_COLOR:["logo_colour"],TEXT_BOLD:["logo_decoration"],TEXT_ITALIC:["logo_decoration"],TEXT_UNDERLINE:["logo_decoration"],TEXT_CASE:["logo_change_content","logo_decoration"],TEXT_BULLETS:["logo_decoration"],TEXT_ALIGN:["logo_alignment"],LOCK:["logo_position"],ORDER:["logo_z_index"],ROTATE_LEFT:["logo_rotation"],ROTATE_RIGHT:["logo_rotation"],ROTATE:["logo_rotation"],TEXT_TYPING:["logo_change_content"],ALIGNMENT:["logo_position"],TEXT_SPACING:["logo_spacing"]},text:{INCREASE:["text_size"],DECREASE:["text_size"],UNLOCK:["text_position"],DUPLICATE:["text_duplication"],REMOVE:["text_deletion"],TEXT_FONTFAMILY:["text_font_family"],TEXT_FONTSIZE:["text_font_size"],OPACITY:["text_opacity"],FILL_COLOR:["text_colour"],TEXT_BOLD:["text_decoration"],TEXT_ITALIC:["text_decoration"],TEXT_UNDERLINE:["text_decoration"],TEXT_CASE:["text_change_content","text_decoration"],TEXT_BULLETS:["text_decoration"],TEXT_ALIGN:["text_alignment"],LOCK:["text_position"],ORDER:["text_z_index"],ROTATE_LEFT:["text_rotation"],ROTATE_RIGHT:["text_rotation"],ROTATE:["text_rotation"],TEXT_TYPING:["text_change_content"],REMOVE_STYLE:["remove_style"],ALIGNMENT:["text_position"],TEXT_SPACING:["text_spacing"]},image:{INCREASE:["image_size"],DECREASE:["image_size"],UNLOCK:["image_position"],DUPLICATE:["image_duplication"],REMOVE:["image_deletion"],IMAGE_REPOSITION:["image_crop"],IMAGE_FILTER:["image_filter"],OPACITY:["image_opacity"],LOCK:["image_position"],ORDER:["image_z_index"],ROTATE_LEFT:["image_rotation"],ROTATE_RIGHT:["image_rotation"],ROTATE:["image_rotation"],FLIP_IMAGE_H:["image_rotation"],FLIP_IMAGE_V:["image_rotation"],FLIP_IMAGE:["image_rotation"],ALIGNMENT:["image_position"],SET_BACKGROUND:["set_background"]},vector:{INCREASE:["vector_size"],DECREASE:["vector_size"],UNLOCK:["vector_position"],DUPLICATE:["vector_duplication"],REMOVE:["vector_deletion"],OPACITY:["vector_opacity"],FILL_COLOR:["vector_colour"],STROKE_COLOR:["vector_stroke"],STROKE:["vector_stroke"],FLIP_H:["vector_rotation"],FLIP_V:["vector_rotation"],FLIP:["vector_rotation"],LOCK:["vector_position"],ORDER:["vector_z_index"],ROTATE_LEFT:["vector_rotation"],ROTATE_RIGHT:["vector_rotation"],ROTATE:["vector_rotation"],ALIGNMENT:["vector_position"]},"default":{INCREASE:["element_size"],DECREASE:["element_size"],UNLOCK:["element_position"],DUPLICATE:["element_duplication"],REMOVE:["element_deletion"],GROUP_UNGROUP:["element_ungrouping"],OPACITY:["element_opacity"],LOCK:["element_position"],ORDER:["element_z_index"],ROTATE_LEFT:["element_rotation"],ROTATE_RIGHT:["element_rotation"],ROTATE:["element_rotation"],ALIGNMENT:["element_position"],GROUP_GROUP:["element_grouping"],IMAGE_BOX:["image_content"],FILL_COLOR:["element_colour"],STROKE_COLOR:["vector_stroke"],STROKE:["vector_stroke"],FLIP_H:["element_rotation"],FLIP_V:["element_rotation"],FLIP:["element_rotation"]},root:{ROOT_DRAWING:["function_draw"],ROOT_SHAPES:["vector_add"],ROOT_FRAMES:["image_add"],ROOT_TEXT:["text_add"]}}},{}],94:[function(e,t,n){function i(){this.initialized=!1,this.shownRestrictionMessages={},this.handlers={logo:e("./handlers/vector"),vector:e("./handlers/vector")}}var a=e("./factory"),o=e("./menu-actions.json"),r=(e("../abstract/facade"),e("../design/design"));i.prototype.initialize=function(){if(this.initialized)return this.initialized;_.bindAll(this,"canChange","isFunctionalityAllowed","isActionAllowed","applyRestriction","getElementRestrictions","getAllElementPermissions","elementHasRestrictions"),this.initialized=!0;var e=this.handlers,t=this.factory=new a;return this.initialized=this.factory.initialize(),this.initialized.then(function(){_(e).each(function(e){e.initialize(t)})}),this.initialized},i.prototype.applyPreLoadRestrictions=function(e){return this.initialized?e:e},i.prototype.applyPostLoadRestrictions=function(e){return this.initialized?e:e},i.prototype.isFunctionalityAllowed=function(e){return!this.initialized||this.factory.templatePermissions.get(e)},i.prototype.filterMenuOptions=function(e,t){function n(e){function t(e,t){return _.any(s,function(n){return n[e]&&(!t||n[e][t])})}return _.all(o[a][e],function(e){return e=e.split("."),t(e[0],e[1])})}function i(t){return"TEXT_EDITING"===t||"TEXT_CASE"===t?this.isInlineTextAllowed(e):"VIDEO_SOURCE"===t?this.isVideoSourceReplacementAllowed(e):!!r||(!o[a]||this.isActionAllowed(o[a][t],e))}if(!this.initialized)return t;var a=this.getElementType(e),r="image"===a&&$(e).is(".layoutClipperImage");switch(a){case"background":var s=this.getAllElementPermissions("background");return _(t).filter(n,this);case"root":return _.filter(t,_.bind(function(e){return this.isFunctionalityAllowed(o[a][e])},this));default:return _(t).filter(i,this)}},i.prototype.applyRestriction=function(e,t,n){if(!this.initialized)return n;var i=this.getElementType(e),a="restrict"+t.charAt(0).toUpperCase()+t.slice(1),o=this.getElementRestrictions(e.getAttribute("id"),t);return this.handlers[i]&&this.handlers[i][a]?this.handlers[i][a](e,o,n):n},i.prototype.canChange=function(e,t){return t=this.getElementType(e)+"_"+t,this.isActionAllowed(t,e)},i.prototype.isVideoSourceReplacementAllowed=function(e){return this.isActionAllowed("video_replace",e)&&_(this.getAllElementPermissions(e.getAttribute("id"))).all(function(e){return e.basic&&1===_.size(e)||!_.size(e)})},i.prototype.isInlineTextAllowed=function(e){return this.isActionAllowed("text_change_content",e)&&_(this.getAllElementPermissions(e.getAttribute("id"))).all(function(e){return e.basic&&1===_.size(e)||!_.size(e)})},i.prototype.isActionAllowed=function(e,t){function n(e){return _.any(e,function(e){return _.any(a,function(t){return"undefined"!=typeof t[e]})})}function i(e){return _.any(a,function(t){return _.every(e,function(e){return"undefined"==typeof t[e]||t[e]})})}if(!this.initialized||!t)return!0;e=_.isArray(e)?e:[e];var a=this.getElementRestrictions(_.isString(t)?t:t.getAttribute("data-element-restriction-id")||t.getAttribute("id"));return n.call(this,e)?i(e):_.every(e,function(e){return this.factory.templatePermissions.get(e)},this)},i.prototype.getElementType=function(e){return this.getType(r.getType(e))},i.prototype.getType=function(e){return"sticker"===e||"shape"===e?"vector":e},i.prototype.getElementName=function(e){if(this.initialized&&e){var t=this.getPermissionsPage(),n=this.factory.elementsPermissions.filter({element_id:e,page_number:t}),i=_.find(n,function(e){return!!e.get("name")});if(i)return i.get("name")}},i.prototype.getAllElementPermissions=function(e){if(!this.initialized||!e)return[];var t=this.getPermissionsPage();return _.chain(this.factory.elementsPermissions.filter({element_id:e,page_number:t})).map(function(e){return JSON.parse(e.get("restrictions"))}).compact().value()},i.prototype.getAllDefaultPermissions=function(){return this.initialized&&this.factory.templatePermissions?this.factory.templatePermissions.toJSON():{}},i.prototype.getElementRestrictions=function(e,t){if(!this.initialized)return[];t=t||"basic";var n=this.getPermissionsPage();return _.chain(this.factory.elementsPermissions.filter({element_id:e,page_number:n})).map(function(e){return JSON.parse(e.get("restrictions"))[t]}).compact().value()},i.prototype.getPermissionsPage=function(){return parseInt(r.get("template","restricted").base_page||INKIVE.Tool._current_page_number)},i.prototype.elementHasRestrictions=function(e){function t(e){var t=i.date.dateformat,n=i.date.daterange[e];return t&&(n=moment(n,"MM/DD/YY").format(t)),n}if(this.shownRestrictionMessages[e.id])return!0;var n,i=this.getAllElementPermissions(e.id)[0];return!!i&&(i.character_number&&(i.character_number.min||i.character_number.max)&&(n=INKIVE.TranslateHelper.translate("restriction_info.text_character_number_range",{min:i.character_number.min,max:i.character_number.max})),i.currencies&&(i.currencies.min?n=INKIVE.TranslateHelper.translate("restriction_info.text_currency_range",{min:i.currencies.min,max:i.currencies.max,currency:i.currencies.currency}):i.currencies.currency&&(n=INKIVE.TranslateHelper.translate("restriction_info.text_currency_symbol",{currency:i.currencies.currency}))),i.date&&i.date.daterange&&(n=INKIVE.TranslateHelper.translate("restriction_info.text_date",{start:t("start"),end:t("end")})),n?(toastr.info(n),this.shownRestrictionMessages[e.id]=n,!0):void 0)},i.prototype.constructor=i,t.exports=new i},{"../abstract/facade":23,"../design/design":34,"./factory":91,"./handlers/vector":92,"./menu-actions.json":93}],95:[function(e,t,n){function i(e,t){var n=t.match(/Check$/)||t.match(/CheckOnce$/);if(!n){var i=o[t+"Check"],s=o[t+"CheckOnce"];s?s.call(this)&&(this[t]=e):i?this[t]=_.partial(a,i,e,r.prototype[t]):this[t]=e}}function a(e,t,n){var i=e.call(this);i&&t.apply(this,_.rest(arguments,3)),i||n&&n.apply(this,_.rest(arguments,3))}var o,r;t.exports=function(e,t){if(INKIVE.Helpers.projectIsLinkedToRestrictions()){r=t,o=e;var n={};return _.each(o,i,n),t.extend?t.extend(n):_.extend({},t,n)}return t}},{}],96:[function(e,t,n){function i(){this.baseUrl=INKIVE.C.BASE_URL+"api/"}t.exports=i,i.prototype=_.extend({},Backbone.Events),i.prototype.api=function(e,t,n){n=n||t?"POST":"GET";var i=$.Deferred();return $.ajax({type:n,url:this.baseUrl+e,data:t,success:function(e){i.resolve(e)},error:function(){i.reject("API call error")}}),i.promise()},i.prototype.init=function(){function e(e){return _.isArray(e)?_.toArray($.extend(!0,{},e)):$.extend(!0,{},e)}var t=$.Deferred();return this.data?t.resolve(e(this.data)):this.api(this.resource).then(_.bind(function(n){this.data=n,t.resolve(e(n))},this),function(e){t.reject(e+" | API Init error")}),t.promise()}},{}],97:[function(e,t,n){var i=(e("../user-info"),e("../library"));t.exports={initialize:function(){var e=$.Deferred();return i.get("fonts").then(_.bind(this._onDataLoaded,this,e)),e}}},{"../library":103,"../user-info":132}],98:[function(e,t,n){function i(){}var a,o,r=e("./user-info"),s={},l={},c=INKIVE.C.IS_DEV?"https://s3.amazonaws.com/virginia-testing.webrand.com/":"https://s3.amazonaws.com/virginia.webrand.com/";i.prototype.initialize=_.memoize(function(){return this.initCache().then(_.bind(this.initCredentials,this)).then(_.bind(this.initProject,this))}),i.prototype.initCache=function(){function e(){var e="api/brand/companies/desygner/version";return $.ajax({method:"GET",url:c+e+"?"+(new Date).getTime()})}var t=$.Deferred();return e().then(_.bind(function(e){this.cachedVersions=e,t.resolve()},this),t.resolve),t.promise()},i.prototype.initCredentials=function(){var e=$.Deferred();return r.get().then(_.bind(function(t){this.credentials={username:t.user_token,password:t.user_hash},e.resolve()},this)),e.promise()},i.prototype.initProject=function(){var e=$.Deferred(),t=INKIVE.C.BOOK.book_type==INKIVE.C.BOOK_TYPE.TEMPLATE?"api/brand/templates/"+INKIVE.C.BOOK.encodedId:"api/brand/designs/"+INKIVE.C.BOOK.encodedId,n=Backbone.Model.extend({url:INKIVE.C.WE_BRAND+t});return o=new n,o.credentials=this.credentials,o.fetch().then(_.bind(function(t){a=t;var n=t.is_resizable&&!t.is_resized;n&&this._initialTemplateResize(t.format).then(e.resolve),n||e.resolve()},this)),e.promise()},i.prototype._undraft=function(){var e=$.Deferred();return this._get("formats",a.format).then(_.bind(function(t){o.url=this.getResourceUrl(["campaigns",t.campaign,"templates",INKIVE.C.BOOK.encodedId]),o.set({is_draft:!1,name:Base64.decode(INKIVE.C.BOOK.name)}).save().then(e.resolve)},this)),e.promise()},i.prototype._initialTemplateResize=function(t){function n(){INKIVE.Tool._current_page_number<h?p.handle("page","move_to",{page_number:INKIVE.Tool._current_page_number+1}).then(function(){r(),a()}):i()}function i(){function e(){s.close(),d.resolve()}var t=1===h;e=_.after(2,e),o.url=this.getResourceUrl(["campaigns",l.campaign,"templates",INKIVE.C.BOOK.encodedId]),o.set("is_resized",!0),o.save().then(e),t&&p.handle("page","save").then(e),t||p.handle("page","move_to",{page_number:1}).then(e)}function a(){u.once("template.update",n),u.set("template",{size:l})}function r(){function e(){INKIVE.Modal.toggleLock(!1);var e=INKIVE.Tool._current_page_number||1,t=['<b style="font-weight: 400">',INKIVE.TranslateHelper.translate("modal.alert.resize_page",{page:e,from:h,percent:Math.floor((e-1)/h*100)}),"</b>"];s=INKIVE.Modal.alertMessage(t.join(""),{skip:!1,loader:!0}),INKIVE.Modal.toggleLock(!0)}s&&s.close(e),s||e()}var s,l,c,d=$.Deferred(),u=e("../facade/design/design"),p=e("../facade/editor/editor"),h=INKIVE.C.BOOK.num_pages;return i=_.bind(i,this),r(),this._get("formats",t).then(function(e){var t=INKIVE.Tool.getInstance();l=e,c={width:t.editor.canvas.contentW,height:t.editor.canvas.contentH},INKIVE.Tool._current_page_number=0,n()}),d.promise()},i.prototype.getCompany=function(){var e=$.Deferred(),t=INKIVE.Helpers.isWeBrandProject();return t||e.resolve(),t&&this.initialize().then(function(){e.resolve(a.company)}),e.promise()},i.prototype.dropCache=function(e,t){var n=this.getResourceUrl(arguments);l=_(l).omit(n)},i.prototype.get=function(e,t){var n=($.Deferred(),arguments);return this.initialize().then(_.bind(function(){return this._get.apply(this,n)},this))},i.prototype._get=function(e,t){var n=$.Deferred(),i=this.getResourceUrl(arguments),a=this.getContainer.apply(this,arguments);return l[i]||(l[i]=a.fetch()),l[i].then(function(){n.resolve(a.toJSON())}),n.promise()},i.prototype.getContainer=function(e,t){var n=this.getResourceUrl(arguments),i=arguments.length%2,a=s[n]?s[n]:this.createResourceContainer(n,i);return a},i.prototype.getResourceUrl=function(e){for(var t="api/brand/companies/"+a.company.id,n=0;n<e.length;n+=2)t+=e[n+1]?"/"+e[n]+"/"+e[n+1]:"/"+e[n];return this.getEndpointUrl(t)},i.prototype.getEndpointUrl=function(e){var t=1;if(a.company.id!==t)return INKIVE.C.WE_BRAND+e;var n=e.replace("companies/"+t+"/","companies/desygner/");return this.cachedVersions&&this.cachedVersions[n]?INKIVE.Helpers.getCORSSecureUrl(c+this.cachedVersions[n].key+"?"+this.cachedVersions[n].version):INKIVE.C.WE_BRAND+e},i.prototype.createResourceContainer=function(e,t){var n=t?Backbone.Collection.extend({url:e}):Backbone.Model.extend({url:e}),i=new n;return 0===e.indexOf(INKIVE.C.WE_BRAND)&&(i.credentials=this.credentials),s[e]=i,i},t.exports={factory:i,instance:new i}},{"../facade/design/design":34,"../facade/editor/editor":76,"./user-info":132}],99:[function(e,t,n){function i(){}var a=e("./company").factory;i.prototype=new a,i.prototype.constructor=i,i.prototype.initialize=function(){return this.initCache()},i.prototype.getResourceUrl=function(e){for(var t="api/brand/companies/desygner",n=0;n<e.length;n+=2)t+=e[n+1]?"/"+e[n]+"/"+e[n+1]:"/"+e[n];return this.getEndpointUrl(t)},t.exports=new i},{"./company":98}],100:[function(e,t,n){function i(e,t){function n(){switch(t){case"normal":return 400;case"bold":return 700}if("bolder"==t){var n=_.max(e.support.variants);return n>700?n:800}if("lighter"==t){var i=_.min(e.support.variants);return i<400?i:300}return t}return t=n(),{b:e.support.b,bi:e.support.bi,i:_.contains(e.support.variants,t+"italic"),variants:e.support.variants}}function a(e){return _(f).find(function(t){return t.family==e||"'"+t.family.replace(/\'/g,"\\'")+"'"==e||t.family.replace(/\'/g,"\\'")==e})}function o(e){var t=$('<style type="text/css">');_.each(e,function(e){e&&e.data&&e.data.family&&t.append(m({family:e.data.family,variants:r(e.data)}))}),$("head").prepend(t)}function r(e){var t={};return _.each(e.sources,function(e){var n=e.variant||"regular";t[n]||(t[n]=s(e)),t[n].sources[e.type]=_.clone(e),t[n].sources[e.type].source=t[n].sources[e.type].source.replace(/http[s]?:/,"")}),t}function s(e){var t={sources:{}};return e.variant&&(e.variant.indexOf("italic")>-1&&(t.style="italic"),t.weight=e.variant.indexOf("regular")>-1?400:e.variant.replace("italic","")),t}function l(e){return _.map(e,function(e){var t=_.uniq(_.map(e.data.sources,function(e){var t=e.variant?e.variant.replace("regular","400"):"400";return"italic"===t&&(t="400italic"),t})),n=e.data.is_system_font||e.data.family.match(/^page.+font.+$/);return{family:e.data.family,name:e.data.name,support:{b:_.contains(t,"700"),bi:_.contains(t,"700italic"),i:_.contains(t,"400italic"),variants:t},customId:e.id,isSystem:n}})}function c(e,t){var n={};t&&_.each(t,function(e){var t=e.data.family;n[t]=n[t]||0,n[t]++});var i=_.map(e,function(e,t){return{family:t,support:e}});return _.sortBy(i,function(e){return-(n[e.family]||0)})}var d=e("./library"),u=e("../facade/editor/editor"),p=e("../facade/restrictions/restrictions"),h=e("../app/decorate"),m=e("./library/font-template.hbs"),f=c(INKIVE.C.FONT_LIST);t.exports=h(e("./app/fonts"),{fontListLoaded:!1,initialize:function(){var e=$.Deferred(),t=d.get("texts"),n=d.get("fonts");return $.when(n,t).then(_.bind(this._onDataLoaded,this,e)),e},isLoadedFont:function(e){return _.any(f,function(t){return t.family==e})},refreshCustomFonts:function(){var e=$.Deferred();return d.cacheClear("fonts"),d.get("fonts").then(function(t){var n=_.filter(t,function(e){return!_.any(f,function(t){return t.family==e.data.family})});n.length&&(f=_.union(l(n),f),o(n)),e.resolve()}),e},_onDataLoaded:function(e,t,n){o(t),f=_.union(l(_.union(t,n)),c(INKIVE.C.FONT_LIST,n)),this.fontListLoaded=!0,u.trigger("fontlist.loaded",{}),e.resolve()},getUsableFonts:function(){var e=_.chain($("#svgcontent").find("[font-family]")).map(function(e){return $(e).attr("font-family").replace(/^'(.+)'$/,"$1")}).uniq().compact().value();return _.each(f,function(t){_.contains(e,t.family)&&(t.templateFonts=!0)}),p.isFunctionalityAllowed("function_use_desygner_font")?f:_.filter(f,function(e){return e.customId||e.templateFonts})},get:function(e,t){var n=_.clone(e?a(e):f);return"undefined"!=typeof t&&n&&n.customId&&(n.support=i(n,t)),n},getCustomFont:function(e){var t=$.Deferred();return _.findWhere(f,{customId:e})?t.reject():d.getResource("fonts",e).then(function(e){_.isArray(e)||(e=[e]),f=_.union(f,l(e)),o(e),t.resolve()}),t.promise()},getFontUrl:function(e,t,n){var i=/url\(.*?\)/g,a=[],o=n?"italic":"normal";return e.split(" ").length>1&&(e='"'+e+'"'),t=t||400,_.each(document.styleSheets,function(n){_.each(n.cssRules,function(n){if(n instanceof CSSFontFaceRule){var r=n.style,s=_.contains(r,"font-family")&&r.fontFamily===e;s=_.contains(r,"font-weight")?parseInt(r.fontWeight)===t&&s:s,s=_.contains(r,"font-style")?r.fontStyle===o&&s:s,s&&a.push(r.src.match(i))}})}),JSON.stringify(_.uniq(_.flatten(a)))}})},{"../app/decorate":8,"../facade/editor/editor":76,"../facade/restrictions/restrictions":94,"./app/fonts":97,"./library":103,"./library/font-template.hbs":107}],101:[function(e,t,n){function i(){this.resource="management/formatgroups",this.apiInit=_.memoize(r.prototype.init)}function a(){var e=$("#svgcontent > g.main").attr("class");return e?(e=_.find(e.split(" "),function(e){return e.match(/format-id-[\d+]/)}),e?e.split("-")[2]:null):null}function o(){var e,t={},n=$("#svgcontent")[0];return n&&_.each(n.classList,function(n){(e=n.match(/du-(\w+)/))?t.unit=e[1]:(e=n.match(/dw-([\d|\.]+)/))?t.width=parseFloat(e[1]):(e=n.match(/dh-([\d|\.]+)/))&&(t.height=parseFloat(e[1]))}),t}var r=e("./api"),s=e("./company").instance;i.prototype=new r,i.prototype.init=function(e){function t(){var e=_.map(n,function(e){var t=_.chain(i).filter(function(t){return t.campaign===e.id}).map(function(e){return _.extend({string_id:"f_"+e.id},e)}).value();return{key:"c_"+e.id,name:e.name,data:t}});this.initDeferred.resolve(e)}var n,i;return this.useWeBrandFormats=INKIVE.Helpers.isWeBrandProject(),this.useWeBrandFormats?(this.initDeferred||(this.initDeferred=$.Deferred(),t=_.bind(t,this),s.get("campaigns?consume").then(function(e){n=e,i&&t()}),s.get("formats?consume").then(function(e){i=e,n&&t()})),this.initDeferred.promise()):this.apiInit()},i.prototype.getGroup=function(e){var t=$.Deferred();return this.getGroups([e]).then(function(e){t.resolve(e[0])},function(e){t.reject(e+" | Formats GetGroup error")}),t.promise()},i.prototype.getGroups=function(e){var t=$.Deferred();return this.init().then(function(n){e?t.resolve(_.filter(n,function(t){return _.any(e,function(e){return e==t.key})})):t.resolve(n)},function(e){t.reject(e+" | Formats GetGroups error")}),t.promise()},i.prototype.getFormat=function(e){var t=$.Deferred();return this.getFormats([e]).then(function(e){t.resolve(e[0])},function(e){t.reject(e+" | Formats GetFormat error")}),t.promise()},i.prototype.getFormats=function(e){var t=$.Deferred();return this.init().then(function(n){INKIVE.C.IS_MOBILE_APP&&(n=n.groups);var i=_.flatten(_.map(n,function(e){return e.data}));e?t.resolve(_.filter(i,function(t){return _.any(e,function(e){return e==t.string_id||e==t.id})})):t.resolve(i)},function(e){t.reject(e+" | Formats GetFormats error")}),t.promise()},i.prototype.getFormatsBasedOnSize=function(e){var t=$.Deferred();return this.getFormats().then(_.bind(function(n){var i=_.bind(this.isSameSize,this,e);t.resolve(_.filter(n,i))},this),function(e){t.reject(e+" | Formats GetFormatsBasedOnSize error")}),t.promise()},i.prototype.getCurrentSize=function(){var e=INKIVE.Tool.getInstance(),t=e.editor.canvas,n={width:t.contentW,height:t.contentH},i=o(),a=["px","in","cm","mm"];return i.unit&&_.contains(a,i.unit)?i:n},i.prototype.isSameSize=function(e,t){var n=INKIVE.Helpers.convertUnitsToPixels;if(e.unit)return e.unit===t.unit&&e.width===t.width&&e.height===t.height;var i=n(t.width,t.unit),a=n(t.height,t.unit);return e.width===i&&e.height===a},i.prototype.getCurrentFormat=function(){var e=$.Deferred(),t=a()||INKIVE.Helpers.getFragmentParam("filter"),n=this.getCurrentSize();return t?$.when(this.getFormat(t),this.getFormatsBasedOnSize(n)).then(_.bind(function(t,i){t&&this.isSameSize(n,t)?e.resolve(t):e.resolve(i[0])},this)):INKIVE.C.BOOK.book_type==INKIVE.C.BOOK_TYPE.TEMPLATE?s.get("templates",INKIVE.C.BOOK.encodedId).then(function(t){s.get("formats",t.format).then(function(t){e.resolve(t)})}):INKIVE.C.BOOK.book_type==INKIVE.C.BOOK_TYPE.RESTRICTED_DESIGN||INKIVE.C.BOOK.book_type==INKIVE.C.BOOK_TYPE.DESYGNER_DESIGN?s.get("designs",INKIVE.C.BOOK.encodedId).then(function(t){e.resolve(t.format)}):this.getFormatsBasedOnSize(n).then(function(t){e.resolve(t[0])}),e.promise()},t.exports=new i},{"./api":96,"./company":98}],102:[function(e,t,n){function i(){this.imagesData={},this.inlinedImages={},this.base64Images={},this.mimeTypes={},this.imagesBlacklist=[]}var a=e("../utils/md5");i.prototype={convertFormats:["/thumb/","/mobile/","/tab/","/web/","/largeweb/","/original/"],defaultAmazonDataNames:{name:"name",thumb:"thumb",mobile:"mobile",tab:"tab",web:"web",largeweb:"largeweb",original:"original"},defaultAmazonVersionDataNames:{name:"name",thumb:"version.thumb",mobile:"version.mobile",tab:"version.tab",
web:"version.web",largeweb:"version.largeweb",original:"version.original"},defaultAPIDataNames:{name:"name",thumb:"src",mobile:"src_mobile",tab:"src_tab",web:"src_web",largeweb:"src_big",original:"src_big"},getFacebookPhotos:function(e,t){this.sendCommand("load/photos/facebook",e,_.bind(function(e){if(e=$.parseJSON(e),INKIVE.Helpers.isResponseExists(e)){var n=this.setFacebookImagesData(e);t(!0,n,e)}else t(!1)},this))},setFacebookImagesData:function(e){var t={};return _.each(e,function(e){_.extend(t,this.setImagesData(e.data,"fb"))},this),t},getDropboxPhotos:function(e,t){this.fetchGenericData("load/photos/dropbox",e,t,"db")},getGooglePhotos:function(e,t){this.fetchGenericData("load/photos/google",e,t,"go")},getFlickerPhotos:function(e,t){this.fetchGenericData("load/photos/flickr",e,t,"fl")},getInstagramPhotos:function(e,t){this.fetchGenericData("load/photos/instagram",e,t,"in")},fetchGenericData:function(e,t,n,i){this.sendCommand(e,t,_.bind(function(e){if(e=$.parseJSON(e),INKIVE.Helpers.isResponseExists(e)){var t=this.setImagesData(e,i);n(!0,t,e)}else n(!1)},this))},getOriginalUrl:function(e){function t(){return this.isAmazonImage(e)?(_.each(n,function(t){e=e.replace(t,"/original/")}),e):null}if(e=INKIVE.Helpers.getCORSSecureUrl(e)){if(this.imagesData[e])return e;var n=this.convertFormats,i=_.find(this.imagesData,function(t){return _.contains(t.version,e)});return i?i.version.original:t.call(this)}},isAmazonImage:function(e){return!!e&&(null!==e.match(/^((http|https):\/\/s3.amazonaws.com)/)||e.indexOf("static.inkive.me")>-1||e.indexOf("static.inkive.com")>-1||e.indexOf("static.webrand.com")>-1||e.indexOf("static.desygner.com")>-1||e.indexOf("static.makewebrand.xyz")>-1||e.indexOf("static.makedesygner.xyz")>-1||e.indexOf("static.buildwebrand.xyz")>-1||e.indexOf("static.builddesygner.xyz")>-1)},blacklistImage:function(e){this.imagesBlacklist.push(this.getImageHash(e))},isBlacklisted:function(e,t){var n=this.getImageHash(e,t);return _.any(this.imagesBlacklist,function(e){return e==n})},setImageUrl:function(e,t){var n=this.getImageHash(e);this.inlinedImages[n]=t,t?INKIVE.C.IS_MOBILE_APP||this.fetchMimeType(t):(t=e.getAttribute("xlink:href"),INKIVE.Helpers.isDataURL(t)?this.base64Images[n]=t:INKIVE.C.IS_MOBILE_APP||this.fetchMimeType(t))},getBase64:function(e){return this.base64Images[e]},getImageUrl:function(e,t){var n=this.getImageHash(e,t);if("undefined"!=typeof this.inlinedImages[n])return this.inlinedImages[n];var i=INKIVE.Helpers.isDataURL(t||e.getAttribute("xlink:href"));if(i){var o=a(this.getHashableSubstring(t||e.getAttribute("xlink:href"))),r=_.find(this.inlinedImages,function(e,t){var n=t.split("_");return n[n.length-1]===o});if("undefined"!=typeof r)return r}return $(e).data("url")},getImageHash:function(e,t){if(_.isString(e))return e+"_"+a(this.getHashableSubstring(t?t:null));var n=e.getAttribute("id"),i=e.getAttribute("xlink:href");return n+"_"+a(this.getHashableSubstring(i))},getHashableSubstring:function(e){if(!e)return e;var t=100;return e.length<t||"http"===e.substring(0,4)?e:(e.length+e).substr(0,t)},getAllImageVersions:function(e){var t={};return _.each(this.defaultAmazonDataNames,_.bind(function(n){"name"!==n&&(t[n]=this.getVersionUrl(e.replace("/original/","/"+n+"/")))},this)),t},getVersionUrl:function(e,t){if(e){var n=_.find(this.imagesData,function(t){return _.contains(t.version,e)});if(n)return n.version[t];if(this.isAmazonImage(e)){var i,a=null;_.each(this.convertFormats,function(t){var n=e.indexOf(t);n!==-1&&(!a||n<i)&&(a=t)}),e=e.replace(a,"/"+t+"/")}return INKIVE.Helpers.getCORSSecureUrl(e)}},getRightSizeUrl:function(t,n){function i(){function e(e){var t=this.getAttribute(a,o[e]+"_height"),n=this.getAttribute(a,o[e]+"_width");if(t&&n)return{name:e,width:parseInt(n),height:parseInt(t)}}var n=[{name:"thumb",width:168,height:168},{name:"mobile",width:499,height:499},{name:"tab",width:800,height:800},{name:"web",width:1200,height:1200},{name:"largeweb",width:2500,height:2500},{name:"original",width:1/0,height:1/0}],i=this.getOriginalUrl(t)||t,a=this.getImageOriginalData(i);if(a){var o=this.imagesData[i].attributesNames,r=_.compact(_.map(["thumb","mobile","tab","web","largeweb"],e,this));if(r.length)return r.push({name:"original",width:1/0,height:1/0}),r}return n}var a=e("../facade/editor/editor"),o=a.handle("zoom","get"),r=i.call(this),s=n.width*o,l=n.height*o,c=_.find(r,function(e){return s<e.width&&l<e.height});return c?this.getVersionUrl(t,c.name):INKIVE.Helpers.getCORSSecureUrl(t)},getImageDataFromData:function(e,t){var n=INKIVE.Helpers.getCORSSecureUrl(this.getAttribute(e,t.original)),i=this.imagesData[n]||{},a=this.CORSSecureClean({web:this.getAttribute(e,t.web),tab:this.getAttribute(e,t.tab),thumb:this.getAttribute(e,t.thumb),mobile:this.getAttribute(e,t.mobile),largeweb:this.getAttribute(e,t.largeweb),original:n});return{name:this.getAttribute(e,t.name),stored:i.stored||!1,originalData:e,attributesNames:t,version:a}},getAttribute:function(e,t){if(e&&t){for(var n=t.split("."),i=e;i&&n[0];)i=i[n.shift()];return i}},getImageOriginalData:function(e){var t=this.getOriginalUrl(e),n=this.imagesData[t];return n&&n.originalData},getImageOriginalSizeData:function(e,t){function n(){s||(clearInterval(d),s=!0,l.onload=l.onerror=$.noop,t({width:c?l.naturalWidth:l.width,height:c?l.naturalHeight:l.height}),l.src="")}function i(){var e=l.naturalWidth||l.width>50;e&&n()}var a=this.getOriginalUrl(e),o=this.imagesData[a];if(o){var r=o.originalData;if(r.original_width&&r.original_height)return void t({width:parseFloat(r.original_width),height:parseFloat(r.original_height)})}var s,l=new Image,c="naturalWidth"in l,d=setInterval(i,100);l.onload=n,l.src=INKIVE.Helpers.getCORSSecureUrl(a)},storeImageData:function(e){var t=this.getOriginalUrl(e),n=this.imagesData[t];if(n&&!n.stored&&n.loadType){var i={scrapbookId:INKIVE.C.BOOK.id,images:JSON.stringify(n.originalData),loadType:n.loadType};this.sendCommand("inkiveeditor/storeImageData",i,function(){n.stored=!0})}},setImagesData:function(e,t,n){var i={};return n=n?n:t?this.defaultAPIDataNames:this.defaultAmazonDataNames,_.each(e,function(e){var a=this.getImageDataFromData(e,n);t&&(a.loadType=t);var o=a.version.original;i[o]=this.imagesData[o]=a,this.CORSSecureClean(this.imagesData[o].versions),INKIVE.C.IS_MOBILE_APP||this.fetchMimeType(o)},this),i},addImageData:function(e,t){t=t||this.defaultAmazonVersionDataNames;var n=this.getImageDataFromData(e,t),i=n.version.original;this.imagesData[i]=n,this.CORSSecureClean(this.imagesData[i].versions),INKIVE.C.IS_MOBILE_APP||this.fetchMimeType(i)},CORSSecureClean:function(e){return e?(e.web=INKIVE.Helpers.getCORSSecureUrl(e.web),e.tab=INKIVE.Helpers.getCORSSecureUrl(e.tab),e.thumb=INKIVE.Helpers.getCORSSecureUrl(e.thumb),e.mobile=INKIVE.Helpers.getCORSSecureUrl(e.mobile),e.largeweb=INKIVE.Helpers.getCORSSecureUrl(e.largeweb),e.original=INKIVE.Helpers.getCORSSecureUrl(e.original),e):e},smartLoad:function(e,t,n){function i(){r++,r<=a?_.delay(_.bind(function(){s.src=INKIVE.Helpers.getCORSSecureUrl(r<a?l:this.getOriginalUrl(e))},this),o):n(INKIVE.C.Status.timeout,s)}var a=4,o=5e3,r=0,s=new Image,l=this.getRightSizeUrl(e,t);s.onerror=_.bind(i,this),s.onload=_.partial(n,INKIVE.C.Status.success,s),s.src=INKIVE.Helpers.getCORSSecureUrl(l)},sendCommand:function(e,t,n){console.warn("Images Factory: Called old sendCmd: "+e),$.ajax({url:INKIVE.C.BASE_URL+e,type:"POST",data:t,dataType:"json",complete:function(e){n(e.responseText)}})},getMimeType:function(e){return this.mimeTypes[this.getOriginalUrl(e)||e]},fetchMimeType:function(e){function t(e){switch(e.substr(0,8)){case"89504E47":return"image/png";case"47494638":return"image/gif";case"25504446":return"application/pdf";case"FFD8FFDB":case"FFD8FFE0":return"image/jpeg";case"504B0304":return"application/zip";default:return"Unknown filetype"}}e=this.getVersionUrl(e,"thumb")||e;var n=$.Deferred();return $.ajax({url:e,responseType:"arraybuffer",type:"GET",dataType:"binary",processData:!1,error:n.reject,success:_.bind(function(i){var a=new Uint8Array(i),o=_.map(a,function(e){return e.toString(16)}),r=t(o.join("").toUpperCase());this.mimeTypes[this.getOriginalUrl(e)||e]=r,n.resolve(r)},this)}),n.promise()},toggleReplaceImageOverlayButton:function(){var e=INKIVE.Tool.getInstance().editor.canvas.getSelectedElems();$(".overlay [data-type=replace-image]").toggleClass("hidden",!(1===e.length&&$(e[0]).is("image:not(#svg_background_image)")))}},t.exports=new i},{"../facade/editor/editor":76,"../utils/md5":485}],103:[function(e,t,n){function i(){_.bindAll(this,"get","post","cacheClear","initialize","getResource","_collectionFetch"),this.addedColors=[],this.collections={},this.cache={},this.modelCache={},this.currentFolderId=null,this.popupMenuColorPalette="0"}var a=e("./user-info"),o=e("./company").instance,r={palettes:e("./library/palette-model"),colors:e("./library/color-model"),texts:e("./library/text-model"),images:e("./library/image-model"),logos:e("./library/logo-model"),icons:e("./library/icon-model"),fonts:e("./library/font-model"),folders:e("./library/folder-model"),videos:e("./library/video-model")};i.prototype=_.extend({},Backbone.Events),i.prototype.initialize=_.memoize(function(){var e=$.Deferred();return $.when(a.get(),o.getCompany()).then(_.bind(function(t,n){this.companyData=n,this.credentials={username:t.user_token,password:t.user_hash},this.baseUrl=INKIVE.Helpers.projectIsLinkedToRestrictions()?INKIVE.C.WE_BRAND+"api/brand/companies/"+n.id+"/assets/":INKIVE.C.DESYGNER_PREMIUM+"api/library/",e.resolve()},this)),e.promise()}),i.prototype.get=function(e,t){var n=$.Deferred();return this.initialize().then(_.partial(this._collectionFetch,e)).then(_.bind(function(){var i=t?this.collections[e].filter(function(e){var n=e.get("data");return _.all(t,function(t,i){return n[i].toString()===t.toString()||e.get(i)===t})}):this.collections[e].toArray();n.resolve(_(i).map(function(e){return e.toJSON()}))},this)),n.promise()},i.prototype.post=function(e,t){var n=$.Deferred();return this._collectionFetch(e).then(_.bind(function(i){var a=i.create(t,{url:this.baseUrl+e,headers:Backbone.BasicAuth.getHeader(this.credentials)});a.on("change:id",n.resolve),a.on("error",function(){a.destroy(),n.reject()},"add-to-library-error")},this)),n.promise()},i.prototype.getResource=function(e,t){function n(e){e.resources=_.map(e.resources,function(e){var t=e.type.toLocaleLowerCase()+"s";return r[t]&&r[t].prototype.parse?r[t].prototype.parse(e):e})}if(this.modelCache[t])return this.modelCache[t];var i=new r[e];i.set("id",t),i.baseUrl=this.baseUrl;var a=$.Deferred();return this.modelCache[t]=a.promise(),i.fetch({headers:Backbone.BasicAuth.getHeader(this.credentials)}).then(function(e){"Folder"===e.type&&n(e.data),a.resolve(e)}),this.modelCache[t]},i.prototype.cacheClear=function(e){this.cache=_(this.cache).omit(e)},i.prototype._collectionFetch=function(e){if(this.cache[e])return this.cache[e];var t=$.Deferred();return this.collections[e]||this._initCollection(e),this.cache[e]=t.promise(),this.collections[e].fetch({success:t.resolve,error:t.resolve}),this.cache[e]},i.prototype._initCollection=function(e){var t=Backbone.Collection.extend({model:r[e],url:this.baseUrl+e});this.collections[e]=new t,this.collections[e].credentials=this.credentials},i.prototype.clearModelCache=function(){this.modelCache={}},t.exports=new i},{"./company":98,"./library/color-model":104,"./library/folder-model":105,"./library/font-model":106,"./library/icon-model":108,"./library/image-model":109,"./library/logo-model":111,"./library/palette-model":112,"./library/text-model":119,"./library/video-model":120,"./user-info":132}],104:[function(e,t,n){var i=e("../../../../bower_components/tinycolor/tinycolor");t.exports=Backbone.Model.extend({url:function(){return this.baseUrl+(this.id?"colors/"+this.id:"colors")},parse:function(e){var t=parseInt(e.data.color_code/65536),n=parseInt((e.data.color_code-65536*t)/256),a=parseInt(e.data.color_code-65536*t-256*n),o=i("rgb("+a+","+n+","+t+")");return e.data.color_code=o.toHexString(),e.data.is_dark=o.isDark(),this.attributes&&this.attributes.data&&(e.data.palette=this.attributes.data.palette),e},getServerModel:function(){var e=_(this.attributes).clone(),t=i(e.data.color_code).toRgb();return e.data=_(e.data).omit("is_dark"),e.data.color_code=65536*t.b+256*t.g+t.r,e},sync:function(){this.toJSON=this.getServerModel;var e=Backbone.sync.apply(this,arguments);return this.toJSON=Backbone.Model.prototype.toJSON,e}})},{"../../../../bower_components/tinycolor/tinycolor":3}],105:[function(e,t,n){var i=e("../images");t.exports=Backbone.Model.extend({url:function(){return this.baseUrl+(this.id?"folders/"+this.id:"folders")},parse:function(e){return this.id&&"resources"===this.id.split("/")[1]?void _.each(e,function(e){if(e.data.source){var t=e.data.source;e.data.tab=i.getVersionUrl(t,"tab"),e.data.web=i.getVersionUrl(t,"web"),e.data.thumb=i.getVersionUrl(t,"thumb"),e.data.mobile=i.getVersionUrl(t,"mobile"),e.data.largeweb=i.getVersionUrl(t,"largeweb"),e.data.original=t}}):e}})},{"../images":102}],106:[function(e,t,n){t.exports=Backbone.Model.extend({url:function(){return this.baseUrl+(this.id?"fonts/"+this.id:"fonts")}})},{}],107:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({1:function(e,t,n,i,a,o,r){var s,l,c,d=null!=t?t:e.nullContext||{},u=n.helperMissing,p="function",h=n.blockHelperMissing,m="@font-face {\n    font-family: '"+(null!=(s=(n.font_quote||t&&t.font_quote||u).call(d,null!=r[1]?r[1].family:r[1],{name:"font_quote",hash:{},data:a}))?s:"")+"';\n    src: local('☺')";return l=null!=(l=n.sources||(null!=t?t.sources:t))?l:u,c={name:"sources",hash:{},fn:e.program(2,a,0,o,r),inverse:e.noop,data:a},s=typeof l===p?l.call(d,c):l,n.sources||(s=h.call(t,s,c)),null!=s&&(m+=s),m+=";\n    ",l=null!=(l=n.weight||(null!=t?t.weight:t))?l:u,c={name:"weight",hash:{},fn:e.program(13,a,0,o,r),inverse:e.noop,data:a},s=typeof l===p?l.call(d,c):l,n.weight||(s=h.call(t,s,c)),null!=s&&(m+=s),m+="\n    ",l=null!=(l=n.style||(null!=t?t.style:t))?l:u,c={name:"style",hash:{},fn:e.program(15,a,0,o,r),inverse:e.noop,data:a},s=typeof l===p?l.call(d,c):l,n.style||(s=h.call(t,s,c)),null!=s&&(m+=s),m+"\n}\n"},2:function(e,t,n,i,a){var o,r,s,l=null!=t?t:e.nullContext||{},c=n.helperMissing,d="function",u=n.blockHelperMissing,p="\n        ";return r=null!=(r=n.woff2||(null!=t?t.woff2:t))?r:c,s={name:"woff2",hash:{},fn:e.program(3,a,0),inverse:e.noop,data:a},o=typeof r===d?r.call(l,s):r,n.woff2||(o=u.call(t,o,s)),null!=o&&(p+=o),p+="\n        ",r=null!=(r=n.woff||(null!=t?t.woff:t))?r:c,s={name:"woff",hash:{},fn:e.program(5,a,0),inverse:e.noop,data:a},o=typeof r===d?r.call(l,s):r,n.woff||(o=u.call(t,o,s)),null!=o&&(p+=o),p+="\n        ",r=null!=(r=n.svg||(null!=t?t.svg:t))?r:c,s={name:"svg",hash:{},fn:e.program(7,a,0),inverse:e.noop,data:a},o=typeof r===d?r.call(l,s):r,n.svg||(o=u.call(t,o,s)),null!=o&&(p+=o),p+="\n        ",r=null!=(r=n.otf||(null!=t?t.otf:t))?r:c,s={name:"otf",hash:{},fn:e.program(9,a,0),inverse:e.noop,data:a},o=typeof r===d?r.call(l,s):r,n.otf||(o=u.call(t,o,s)),null!=o&&(p+=o),p+="\n        ",r=null!=(r=n.ttf||(null!=t?t.ttf:t))?r:c,s={name:"ttf",hash:{},fn:e.program(11,a,0),inverse:e.noop,data:a},o=typeof r===d?r.call(l,s):r,n.ttf||(o=u.call(t,o,s)),null!=o&&(p+=o),p+"\n    "},3:function(e,t,n,i,a){var o;return",url('"+e.escapeExpression((o=null!=(o=n.source||(null!=t?t.source:t))?o:n.helperMissing,"function"==typeof o?o.call(null!=t?t:e.nullContext||{},{name:"source",hash:{},data:a}):o))+"') format('woff2')"},5:function(e,t,n,i,a){var o;return",url('"+e.escapeExpression((o=null!=(o=n.source||(null!=t?t.source:t))?o:n.helperMissing,"function"==typeof o?o.call(null!=t?t:e.nullContext||{},{name:"source",hash:{},data:a}):o))+"') format('woff')"},7:function(e,t,n,i,a){var o;return",url('"+e.escapeExpression((o=null!=(o=n.source||(null!=t?t.source:t))?o:n.helperMissing,"function"==typeof o?o.call(null!=t?t:e.nullContext||{},{name:"source",hash:{},data:a}):o))+"') format('svg')"},9:function(e,t,n,i,a){var o;return",url('"+e.escapeExpression((o=null!=(o=n.source||(null!=t?t.source:t))?o:n.helperMissing,"function"==typeof o?o.call(null!=t?t:e.nullContext||{},{name:"source",hash:{},data:a}):o))+"') format('opentype')"},11:function(e,t,n,i,a){var o;return",url('"+e.escapeExpression((o=null!=(o=n.source||(null!=t?t.source:t))?o:n.helperMissing,"function"==typeof o?o.call(null!=t?t:e.nullContext||{},{name:"source",hash:{},data:a}):o))+"') format('truetype')"},13:function(e,t,n,i,a){return"font-weight: "+e.escapeExpression(e.lambda(t,t))+";"},15:function(e,t,n,i,a){return"font-style: "+e.escapeExpression(e.lambda(t,t))+";"},compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a,o,r){var s;return null!=(s=n.each.call(null!=t?t:e.nullContext||{},null!=t?t.variants:t,{name:"each",hash:{},fn:e.program(1,a,0,o,r),inverse:e.noop,data:a}))?s:""},useData:!0,useDepths:!0})},{"hbsfy/runtime":535}],108:[function(e,t,n){var i=e("../images");t.exports=Backbone.Model.extend({url:function(){return this.baseUrl+(this.id?"logos/"+this.id:"logos")},parse:function(e){var t=e.data.source||"";return e.data.tab=i.getVersionUrl(t,"tab"),e.data.web=i.getVersionUrl(t,"web"),e.data.thumb=i.getVersionUrl(t,"thumb"),e.data.mobile=i.getVersionUrl(t,"mobile"),e.data.largeweb=i.getVersionUrl(t,"largeweb"),e.data.original=t,i.setImagesData({version:e.data},"library",i.defaultAmazonDataNames),e}})},{"../images":102}],109:[function(e,t,n){var i=e("../images");t.exports=Backbone.Model.extend({url:function(){return this.baseUrl+(this.id?"images/"+this.id:"images")},parse:function(e){var t=e.data.source;return e.data.tab=i.getVersionUrl(t,"tab"),e.data.web=i.getVersionUrl(t,"web"),e.data.thumb=i.getVersionUrl(t,"thumb"),e.data.mobile=i.getVersionUrl(t,"mobile"),e.data.largeweb=i.getVersionUrl(t,"largeweb"),e.data.original=t,i.setImagesData({version:e.data},"library",i.defaultAmazonDataNames),e}})},{"../images":102}],110:[function(e,t,n){function i(){this.canvas=null,this.fileContentUploader=null,this.type=null,this.handlers={text:e("./populator/text"),image:e("./populator/image"),logo:e("./populator/logo"),icon:e("./populator/icon"),color:e("./populator/color"),video:e("./populator/video")}}var a=e("../library"),o=e("../../facade/design/design"),r=e("../../utils/advice");i.prototype=_.extend({},Backbone.Events),i.prototype.initialize=function(e){this.canvas=e,_.bindAll(this,"onError","wrappResource","addElementToLibrary")},i.prototype.addElementToLibrary=function(e){function t(e,t){a.post(e,t).then(_.bind(n,this,e,t),this.onError)}function n(e,t){a.clearModelCache(),this.trigger("new."+e,t),INKIVE.Modal.togglePageLoader(!1),r.show("add-to-library-success")}INKIVE.Modal.togglePageLoader(!0),this.generateLibraryItem(e).then(_.bind(t,this),this.onError)},i.prototype.onError=function(e){INKIVE.Modal.togglePageLoader(!1),r.show(_.isString(e)?e:"add-to-library-error")},i.prototype.generateLibraryItem=function(e){var t=$.Deferred(),n=o.get($(e).is(".background")?"background":e.getAttribute("id")),i="sticker"===n.type?"icon":n.type,a=this.handlers[i];return a?a.getNewItem(n,e).then(_.bind(this.ensureUniquenes,this,i),t.reject).then(this.wrappResource,_.partial(t.reject,"add-to-library-duplicity")).then(_.partial(t.resolve,i+"s")):t.reject(),t.promise()},i.prototype.ensureUniquenes=function(e,t){var n=_.partial(this.handlers[e].isSameModel,t),i=$.Deferred();return a.get(e+"s").then(function(a){_.any(_.pluck(a,"data"),n)?i.reject():i.resolve(e,t)}),i.promise()},i.prototype.wrappResource=function(e,t){return{order:0,type:e.charAt(0).toUpperCase()+e.slice(1),data:t}},t.exports=new i},{"../../facade/design/design":34,"../../utils/advice":477,"../library":103,"./populator/color":113,"./populator/icon":114,"./populator/image":115,"./populator/logo":116,"./populator/text":117,"./populator/video":118}],111:[function(e,t,n){arguments[4][108][0].apply(n,arguments)},{"../images":102,dup:108}],112:[function(e,t,n){var i=e("./color-model");t.exports=Backbone.Model.extend({url:function(){return this.baseUrl+(this.id?"palettes/"+this.id:"palettes")},parse:function(e){return _.each(e.data.colors,i.prototype.parse),e}})},{"./color-model":104}],113:[function(e,t,n){t.exports={getNewItem:function(e){var t=$.Deferred();return t.resolve({color_code:e.color_code}),t.promise()},isSameModel:function(e,t){return e.palette===t.palette&&e.color_code.toLowerCase()===t.color_code.toLowerCase()}}},{}],114:[function(e,t,n){var i=e("../../../ui/tool-menu/components/mixins/file-content-uploader"),a=e("../../../ui/tool-menu/components/thumbnail/upload"),o=e("../../library");t.exports=_.extend({getNewItem:function(e,t){var n=$.Deferred(),i="logo"===e.type||"icon"===e.type;return i?n.resolve({type:e.is_vector?2:1,source:e.thumb_src}):this.procesSVGResource(n,t),n.promise()},procesSVGResource:function(e,t){var n=this.generateSVGFile(t);this.initUpload(),this.uploadFileContent(n),$(document).one("file-content-upload:error",e.reject),$(document).one("file-content-upload:complete",function(t,n){e.resolve({type:2,source:n})})},generateSVGFile:function(e){var t=svgedit.utilities.getBBox(e),n='<svg xmlns="http://www.w3.org/2000/svg" xlinkns="http://www.w3.org/1999/xlink" charset="utf-8"';return n+=' height="'+Math.floor4(t.height)+'"',n+=' width="'+Math.floor4(t.width)+'"',n+=' x="0" y="0"',n+=' viewBox="'+Math.floor4(t.x)+" "+Math.floor4(t.y)+" "+Math.floor4(t.width)+" "+Math.floor4(t.height)+'">',n+=(new XMLSerializer).serializeToString(e)+"</svg>"},isSameModel:function(e,t){return e.type===t.type&&e.source===t.source},initUpload:function(){function e(e,t){t=t||2;var n="0000000000000000"+e;return n.substr(n.length-t)}this.uploadPath=INKIVE.C.BOOK.book_type===INKIVE.C.BOOK_TYPE.TEMPLATE?"/company/assets/"+e(o.companyData.id,10)+"/"+this.getType():"/library/"+INKIVE.C.USER.id+"/"+this.getType(),_.bindAll(this,"complete","errorEvent","getUploadKey","completeEvent","uploadFileContent"),this._addUploadThumbnail(),this.initializeUpload()},getType:function(){return"icon"},_addUploadThumbnail:function(){this.$el=$(".modalWrapper .modal.alert"),this.$el.find(".content").after($('<ul class="uploader-wrapper hidden"></ul>'));var e=this.$el.find(".uploader-wrapper");this.$uploaderThumbnail=$("<div></div>").addClass("thumbnail uploader"),e.append(this.$uploaderThumbnail),this.views={},this.views.uploadThumbnail=new a({el:this.$uploaderThumbnail})}},i)},{"../../../ui/tool-menu/components/mixins/file-content-uploader":268,"../../../ui/tool-menu/components/thumbnail/upload":326,"../../library":103}],115:[function(e,t,n){var i=e("../../../facade/design/setters/image"),a=e("../../../facade/design/design"),o=e("../../images");t.exports={maxAttempts:10,attemptDelayInMs:500,getNewItem:function(e){var t=$.Deferred();return this.resolveAttempt(e,t),t.promise()},isSameModel:function(e,t){var n=o.getOriginalUrl(e.source),i=o.getOriginalUrl(t.source);return n=INKIVE.Helpers.getCORSSecureUrl(n),i=INKIVE.Helpers.getCORSSecureUrl(i),n===i},resolveAttempt:function(e,t,n){function o(){this.waitForExternalImage(n).then(_.bind(function(){this.resolveAttempt(a.get(e.id),t,n+1)},this))}n=n||1,i.prototype.isExternal(e)?(1===n&&this.addExternalImageLoadingHint(),n<this.maxAttempts?o.call(this):t.reject()):t.resolve({type:1,source:e.source.url})},addExternalImageLoadingHint:function(){$(".modalWrapper .modal.alert").find("p").append('<br/><b style="font-weight: 400">'+INKIVE.TranslateHelper.translate("advice.content.uploading_images_save")+"</b>")},waitForExternalImage:function(e){var t=$.Deferred();return _.defer(t.resolve,e*this.attemptDelayInMs),t.promise()}}},{"../../../facade/design/design":34,"../../../facade/design/setters/image":59,"../../images":102}],116:[function(e,t,n){t.exports=e("./icon")},{"./icon":114}],117:[function(e,t,n){var i=e("../../../../../bower_components/tinycolor/tinycolor");t.exports={getNewItem:function(e){var t=$.Deferred(),n={default_content:e.content,family:e.font.family,weight:"bold"===e.font.weight?800:400,size:e.font.size,italic:"italic"===e.font.style,underline:"underline"===e.decoration,letter_spacing:e.spacing.letter,word_spacing:e.spacing.word,line_spacing:e.spacing.line,color_code:e.color};return e.stroke.width&&(n.stroke_width=e.stroke.width,n.stroke_color=e.stroke.none,n.stroke_dasharray=e.stroke.dasharray),t.resolve(n),t.promise()},isSameModel:function(e,t){var n=(i(e.color_code).toHexString(),e.content||e.name||""),a=t.content||t.name||"";return n.trim()===a.trim()&&e.size===t.size&&e.family===t.family&&e.color_code.toLowerCase()===t.color_code.toLowerCase()&&e.italic===t.italic&&e.underline===t.underline}}},{"../../../../../bower_components/tinycolor/tinycolor":3}],118:[function(e,t,n){t.exports={getNewItem:function(e){var t=$.Deferred();return t.resolve({source:e.source}),t.promise()},isSameModel:function(e,t){return e.source===t.source}}},{}],119:[function(e,t,n){var i=e("./color-model"),a=e("../../../../bower_components/tinycolor/tinycolor");t.exports=Backbone.Model.extend({url:function(){return this.baseUrl+(this.id?"texts/"+this.id:"texts")},getServerModel:function(){var e=_(this.attributes).clone(),t=a(e.data.color_code).toRgb();return e.data.color_code=65536*t.b+256*t.g+t.r,e.data.stroke_color&&(t=a(e.data.stroke_color).toRgb(),e.data.stroke_color=65536*t.b+256*t.g+t.r),e},parse:function(e){var t=parseInt(e.data.stroke_color/65536),n=parseInt((e.data.stroke_color-65536*t)/256),i=parseInt(e.data.stroke_color-65536*t-256*n),o=a("rgb("+i+","+n+","+t+")");e.data.stroke_color=o.toHexString();var t=parseInt(e.data.color_code/65536),n=parseInt((e.data.color_code-65536*t)/256),i=parseInt(e.data.color_code-65536*t-256*n),o=a("rgb("+i+","+n+","+t+")");return e.data.color_code=o.toHexString(),e},toJSON:function(){var e=Backbone.Model.prototype.toJSON.call(this);return e.data.name=e.data.name||e.data.family,e.data.default_content=e.data.default_content||e.data.name||e.data.family,e},sync:i.prototype.sync})},{"../../../../bower_components/tinycolor/tinycolor":3,"./color-model":104}],120:[function(e,t,n){var i=e("../images");t.exports=Backbone.Model.extend({url:function(){return this.baseUrl+(this.id?"videos/"+this.id:"videos")},parse:function(e){var t=e.data.selected_thumbnail||"";return e.data.tab=i.getVersionUrl(t,"tab"),e.data.web=i.getVersionUrl(t,"web"),e.data.thumb=i.getVersionUrl(t,"thumb"),e.data.mobile=i.getVersionUrl(t,"mobile"),e.data.largeweb=i.getVersionUrl(t,"largeweb"),e.data.original=t,i.setImagesData({version:e.data},"library",i.defaultAmazonDataNames),e}})},{"../images":102}],121:[function(e,t,n){function i(){this.data={},this.versions=[],this.defaultSize=344,_.bindAll(this,"get","addThumbnailVersion","renderCurrentPage"),this.initPreviewListener()}function a(e){var t=c.get("master_bucket"),n=c.get("design",{design_id:e});if(t&&n)if(!n.design_id&&n.based_on){var i=c.get("design",{design_id:n.based_on});if(i&&i.design_id)return a(i.design_id)}else if(n.design_id){var s=r(n.design_id||n.based_on),l=t+"/"+this.defaultSize+"/"+INKIVE.C.BOOK.id+"/"+s+".jpg?"+n.last_mod;return INKIVE.Helpers.projectIsLinkedToRestrictions()?l:INKIVE.Helpers.getCORSSecureUrl(l)}return o(n)}function o(e){var t=new Date;return INKIVE.C.BASE_URL+"design/displaythumbnail/"+INKIVE.C.BOOK.id+"/"+e.page_number+"/110?"+t.getTime()}var r=e("../utils/md5"),s=e("../facade/editor/editor"),l=e("../facade/design/design"),c=e("../facade/project/project");i.prototype=_.extend({},Backbone.Events),i.prototype.initialize=function(){return this.initializeDeferred||(this.initializeDeferred=$.Deferred(),c.loadPageInfo().then(this.initializeDeferred.resolve),s.on("page.saving",_.bind(function(){this.storeNewSavedVersion=!0,this.renderCurrentPage()},this)),c.on("design.added",_.bind(function(e){this.data[e.design_id]="https://static.webrand.com/blank.jpg"},this)),c.on("design.copied",_.bind(function(e){this.data[e.design_id]=this.data[e.based_on]},this))),this.initializeDeferred.promise()},i.prototype.get=function(e){return e=e||INKIVE.Tool._current_design_id,this.data[e]=this.data[e]||a.call(this,e),this.data[e]},i.prototype.notify=function(e){var t=c.get("design",{design_id:e});this.trigger("update",t),this.trigger("update.page."+t.page_number,t),this.trigger("update.design."+t.design_id,t)},i.prototype.renderCurrentPage=function(){INKIVE.C.IS_MOBILE_APP||l.handle("preview",null,{maxwidth:this.defaultSize,background:"#FFF"})},i.prototype.initPreviewListener=function(){var e=_.debounce(this.renderCurrentPage,1e3);INKIVE.History.on("change",e),INKIVE.History.on("undo",e),INKIVE.History.on("redo",e),l.on("preview.full",_.bind(function(e){this.data[INKIVE.Tool._current_design_id]=e,this.storeNewSavedVersion&&this.addThumbnailVersion(e),_.defer(_.bind(this.notify,this,INKIVE.Tool._current_design_id))},this))},i.prototype.addThumbnailVersion=function(e){var t={timeStamp:Date.now(),base64:e,designId:INKIVE.Tool._current_design_id};this.storeNewSavedVersion=!1,_.any(this.versions,function(t){return t.base64===e})||this.versions.push(t)},t.exports=new i},{"../facade/design/design":34,"../facade/editor/editor":76,"../facade/project/project":89,"../utils/md5":485}],122:[function(e,t,n){function i(){_.bindAll(this,"initialize","initListeners","getElementPermissions","getTemplatePermissions"),this.unsavedElementChanges=[],this.unsavedTemplateChanges=[],this.elementOriginalContent={},this.listeners={logo:e("./restrictions/listeners/logo"),image:e("./restrictions/listeners/image"),video:e("./restrictions/listeners/video"),background:e("./restrictions/listeners/background")}}var a,o=e("./company").instance,r=e("./user-info"),s=e("../facade/design/design"),l=e("./restrictions/defaults.json"),c=e("../facade/project/project"),d=e("../facade/restrictions/restrictions"),u=e("../facade/design/setters/restrictions/text"),p=e("./restrictions/default-values/text");i.prototype=_.extend({},Backbone.Events),i.prototype.initialize=_.memoize(function(){function e(e){e.design_number||e.page_number;this.getElementPermissionsCollection().each(function(t){t.get("page_number")>=e.design_number&&(t.set("page_number",t.get("page_number")+1),this.unsavedElementChanges.push(t))},this)}function t(e){this.getElementPermissionsCollection().each(function(t){t.get("page_number")==e&&(this.unsavedElementChanges=_.without(this.unsavedElementChanges,t),_.defer(function(){t.destroy()}))},this)}function n(){var e=$.Deferred();return r.get().then(function(t){$.ajaxSetup({headers:{Authorization:"Basic "+btoa(t.user_token+":"+t.user_hash)}}),e.resolve()}),e.promise()}function i(){return INKIVE.C.BOOK.book_type==INKIVE.C.BOOK_TYPE.TEMPLATE?o.get("templates",INKIVE.C.BOOK.encodedId):o.get("designs",INKIVE.C.BOOK.encodedId).then(function(e){return o.get("templates",e.template)})}function l(e){return a=e,$.when(o.get("templates",a.id,"templatepermissions"),o.get("templates",a.id,"elementpermissions"))}var d=$.Deferred();return c.on("design.added",_.bind(e,this)),c.on("design.copied",_.bind(e,this)),c.on("design.removed",_.bind(function(e){t.call(this,e.page_number),this.getElementPermissionsCollection().each(function(t){t.get("page_number")>e.page_number&&(t.set("page_number",t.get("page_number")-1),this.unsavedElementChanges.push(t))},this)},this)),s.on("template.update",_.bind(function(){t.call(this,INKIVE.Tool._current_page_number)},this)),n().then(i).then(l).then(this.initListeners).then(d.resolve),d.promise()}),i.prototype.initListeners=function(){function e(){this.getElementPermissionsCollection().chain().filter(t).each(this.refreshListener,this)}function t(e){return e.get("page_number")==INKIVE.Tool._current_page_number}var n=$.Deferred();return _.each(this.listeners,function(e){e.initialize(this)},this),e.call(this),n.resolve(),n.promise()},i.prototype.refreshListener=function(e){var t=e.get("element_id"),n="background"===t?"background":d.getElementType($("#"+t)[0]);this.listeners[n]&&this.listeners[n].refresh(e)},i.prototype.getTemplatePermissionsCollection=function(){return o.getContainer("templates",a.id,"templatepermissions")},i.prototype.getElementPermissionsCollection=function(){
return o.getContainer("templates",a.id,"elementpermissions")},i.prototype.getTemplatePermissions=function(){return this.initialize().then(function(){return o.get("templates",a.id,"templatepermissions")})},i.prototype.getElementPermissions=function(){return this.initialize().then(function(){return o.get("templates",a.id,"elementpermissions")})},i.prototype.createGlobalTemplateRestriction=function(e){var t=this.getDefaultsByType(e),n=$.Deferred(),i=this.getTemplatePermissionsCollection().find(function(e){return!e.get("group")});i&&i.destroy();var o=[this.getTemplatePermissionsCollection().create(_.extend(_.omit(t,"background"),{template:a.id})),this.getElementPermissionsCollection().create({page_number:INKIVE.Tool._current_page_number,element_id:"background",template:a.id,restrictions:JSON.stringify(t.background)})],r=_.bind(n.resolve,this,o[0]);return r=_.after(o.length,r),_.each(o,function(e){e.on("change:id",r)}),n.promise()},i.prototype.setGlobalTemplateRestriction=function(e,t){function n(){var e=this.getTemplatePermissionsCollection().find(function(e){return!e.get("group")});if(e){var t=$.Deferred();return t.resolve(e),t.promise()}return this.createGlobalTemplateRestriction()}var i=$.Deferred();return n.call(this).then(_.bind(function(n){n.set(e,t),this.storeTemplateChange(n),i.resolve()},this)),i.promise()},i.prototype.getGlobalRestrictionElementPermissions=function(e,t){function n(n){var i=this.getElementPermissionsCollection().create({page_number:INKIVE.Tool._current_page_number,element_id:e,template:a.id,restrictions:t});i.on("change:id",_.bind(n.resolve,this,i))}var i=$.Deferred(),o=this.getElementPermissionsCollection().find(function(t){return!t.get("group")&&t.get("page_number")==INKIVE.Tool._current_page_number&&t.get("element_id")==e});return o?i.resolve(o):t?n.call(this,i):i.resolve(null),i.promise()},i.prototype.setGlobalRestrictionName=function(e,t){var n=$.Deferred();return this.getGlobalRestrictionElementPermissions(e).then(_.bind(function(e){e&&(e.set("name",t),this.storeElementChange(e)),n.resolve()},this)),n.promise()},i.prototype.setGlobalElementRestriction=function(e,t){var n=$.Deferred();return this.getGlobalRestrictionElementPermissions(e,t).then(_.bind(function(i){i&&(i.set("restrictions",t),this.storeElementChange(i),this.setElementContent(e,t)),n.resolve()},this)),n.promise()},i.prototype.setElementContent=function(e,t){var n=s.get(e);if(t&&"text"===n.type){var i=n.content,a=JSON.parse(t);if(u.contentCompliesWithRestrictions(i,a))return;this.elementOriginalContent[e]||(this.elementOriginalContent[e]=i);var o=p.getDefaultRestrictionValue(a);o||(o=this.elementOriginalContent[e],delete this.elementOriginalContent[e]),o&&o!=i&&INKIVE.DesignFacade.set(e,{content:o.toString()})}},i.prototype.storeElementChange=function(e){function t(){this.getElementPermissionsCollection().each(function(t){var a=t!=e&&t.get("page_number")==INKIVE.Tool._current_page_number&&t.get("element_id")==i&&t.get("group")==n;a&&(this.unsavedElementChanges=_.without(this.unsavedElementChanges,t),_.defer(_.bind(function(){t.set("restrictions",null),this.refreshListener(t),t.destroy()},this)))},this)}var n=e.get("group"),i=e.get("element_id"),a=e.get("restrictions")&&_.size(JSON.parse(e.get("restrictions")));t.call(this),this.unsavedElementChanges=_.without(this.unsavedElementChanges,e),this.refreshListener(e),a&&this.unsavedElementChanges.push(e),a||e.destroy()},i.prototype.storeTemplateChange=function(e){function t(){this.getTemplatePermissionsCollection().each(function(t){var i=t.get("group")==n&&t!=e;i&&(this.unsavedTemplateChanges=_.without(this.unsavedTemplateChanges,t),_.defer(function(){t.destroy()}))})}var n=e.get("group");t.call(this),this.unsavedTemplateChanges=_.without(this.unsavedTemplateChanges,e),this.unsavedTemplateChanges.push(e)},i.prototype.isAllSaved=function(e){return!this.unsavedElementChanges.length&&!this.unsavedTemplateChanges.length},i.prototype.save=function(e){var t=this.unsavedElementChanges.length||this.unsavedTemplateChanges.length;if(!t){var n=$.Deferred();return n.resolve(),n.promise()}for(var i=[];this.unsavedElementChanges.length;)i.push(this.unsavedElementChanges.pop().save());for(;this.unsavedTemplateChanges.length;)i.push(this.unsavedTemplateChanges.pop().save());return $.when.apply($,i)},i.prototype.getDefaultsByType=function(e){switch(e){case"tight":return l.tight;case"moderate":return l.moderate;case"loose":default:return l.loose}},i.prototype.removeAll=function(){function e(e){_.defer(function(){e.destroy()})}this.getTemplatePermissionsCollection().each(e),this.getElementPermissionsCollection().each(e),this.unsavedElementChanges=[]},i.prototype.copyRestrictions=function(e){function t(i){if(_.size(i)){var a=i.pop();return a.page_number==e?n(a.element_id,a.restrictions).then(_.partial(t,i)):t(i)}var o=$.Deferred();return o.resolve(),o.promise()}var n=_.bind(this.setGlobalElementRestriction,this);return this.getElementPermissions().then(t)},t.exports=new i},{"../facade/design/design":34,"../facade/design/setters/restrictions/text":61,"../facade/project/project":89,"../facade/restrictions/restrictions":94,"./company":98,"./restrictions/default-values/text":123,"./restrictions/defaults.json":124,"./restrictions/listeners/background":125,"./restrictions/listeners/image":126,"./restrictions/listeners/logo":127,"./restrictions/listeners/video":128,"./user-info":132}],123:[function(e,t,n){t.exports={DEFAULT_NUMBER:123456,DEFAULT_CURRENCY:99.9,DEFAULT_EMAIL:"email@domain.com",getDefaultRestrictionValue:function(e,t){var n;if(e.numeric)n=e.numeric.min?e.numeric.min:this.DEFAULT_NUMBER;else if(e.dictionary){var i=$(".restrictions").find('[data-name="dictionary"]').find(".bootstrap-tagsinput>input");i.val(_.contains(e.dictionary.list,t)?"":t)}else e.date?(n=e.date.daterange?e.date.daterange.start:moment(new Date).format("MM/DD/YY"),e.date.dateformat&&(n=moment(n,"MM/DD/YY").format(e.date.dateformat))):e.currencies?(n=e.currencies.min?e.currencies.min:e.currencies.max?e.currencies.max:this.DEFAULT_CURRENCY,e.currencies.currency&&(n=e.currencies.currency+n)):e.email&&(n=this.DEFAULT_EMAIL);return n}}},{}],124:[function(e,t,n){t.exports={tight:{background:{opacity:!1,basic:{image:!1,color:!1}},function_add_page:!1,function_change_page_order:!1,function_artwork_resizing:!1,function_download_file:!0,function_draw:!1,function_print_file:!0,function_share_file:!0,function_use_asset_background:!0,function_use_asset_images:!0,function_use_asset_logo:!0,function_use_asset_vector:!0,function_use_asset_colors:!0,function_use_desygner_font:!0,function_use_desygner_background:!1,function_use_desygner_images:!1,function_use_desygner_logo:!1,function_use_desygner_vector:!1,function_use_own_background:!1,function_use_own_colors:!1,function_use_own_images:!1,function_use_own_logo:!1,function_use_web_background:!1,function_use_web_images:!1,function_use_web_logo:!1,function_use_web_vector:!1,image_add:!1,image_content:!1,image_crop:!1,image_deletion:!1,image_duplication:!1,image_filter:!1,image_opacity:!1,image_position:!1,image_replace:!1,image_rotation:!1,image_size:!1,image_z_index:!1,text_add:!1,text_alignment:!1,text_change_content:!1,text_colour:!1,text_decoration:!1,text_deletion:!1,text_duplication:!1,text_font_family:!1,text_font_size:!1,text_opacity:!1,text_position:!1,text_rotation:!1,text_size:!1,text_spacing:!1,text_z_index:!1,vector_add:!1,vector_colour:!1,vector_deletion:!1,vector_duplication:!1,vector_opacity:!1,vector_position:!1,vector_rotation:!1,vector_size:!1,vector_stroke:!1,vector_z_index:!1,logo_size:!1,logo_opacity:!1,logo_colour:!1,logo_deletion:!1,logo_duplication:!1,logo_rotation:!1,logo_position:!1,logo_z_index:!1,logo_stroke:!1,logo_add:!1,logo_replace:!1,icon_size:!1,icon_opacity:!1,icon_colour:!1,icon_deletion:!1,icon_duplication:!1,icon_rotation:!1,icon_position:!1,icon_z_index:!1,icon_stroke:!1,icon_add:!1,icon_replace:!1,video_add:!1,video_deletion:!1,video_duplication:!1,video_flags:!1,video_position:!1,video_replace:!1,video_size:!1},moderate:{background:{opacity:!1,basic:{image:!0,color:!0}},function_add_page:!1,function_change_page_order:!1,function_artwork_resizing:!1,function_download_file:!0,function_draw:!0,function_print_file:!0,function_share_file:!0,function_use_asset_background:!0,function_use_asset_images:!0,function_use_asset_logo:!0,function_use_asset_vector:!0,function_use_asset_colors:!0,function_use_desygner_font:!0,function_use_desygner_background:!0,function_use_desygner_images:!0,function_use_desygner_logo:!0,function_use_desygner_vector:!0,function_use_own_background:!0,function_use_own_colors:!0,function_use_own_images:!0,function_use_own_logo:!0,function_use_web_background:!0,function_use_web_images:!0,function_use_web_logo:!0,function_use_web_vector:!1,image_add:!0,image_content:!0,image_crop:!0,image_deletion:!1,image_duplication:!1,image_filter:!1,image_opacity:!1,image_position:!1,image_replace:!0,image_rotation:!1,image_size:!1,image_z_index:!1,text_add:!0,text_alignment:!1,text_change_content:!0,text_colour:!1,text_decoration:!1,text_deletion:!1,text_duplication:!1,text_font_family:!1,text_font_size:!1,text_opacity:!1,text_position:!1,text_rotation:!1,text_size:!0,text_spacing:!1,text_z_index:!1,vector_add:!0,vector_colour:!1,vector_deletion:!1,vector_duplication:!1,vector_opacity:!1,vector_position:!1,vector_rotation:!1,vector_size:!1,vector_stroke:!1,vector_z_index:!1,logo_size:!1,logo_opacity:!1,logo_colour:!1,logo_deletion:!0,logo_duplication:!1,logo_rotation:!1,logo_position:!1,logo_z_index:!1,logo_stroke:!1,logo_add:!0,logo_replace:!1,icon_size:!1,icon_opacity:!1,icon_colour:!1,icon_deletion:!0,icon_duplication:!1,icon_rotation:!1,icon_position:!1,icon_z_index:!1,icon_stroke:!1,icon_add:!0,icon_replace:!1,video_add:!0,video_deletion:!0,video_duplication:!1,video_flags:!1,video_position:!0,video_replace:!1,video_size:!0},loose:{background:{opacity:!0,basic:{image:!0,color:!0}},function_add_page:!0,function_change_page_order:!0,function_artwork_resizing:!1,function_download_file:!0,function_draw:!0,function_print_file:!0,function_share_file:!0,function_use_asset_background:!0,function_use_asset_images:!0,function_use_asset_logo:!0,function_use_asset_vector:!0,function_use_asset_colors:!0,function_use_desygner_font:!0,function_use_desygner_background:!0,function_use_desygner_images:!0,function_use_desygner_logo:!0,function_use_desygner_vector:!0,function_use_own_background:!0,function_use_own_colors:!0,function_use_own_images:!0,function_use_own_logo:!0,function_use_web_background:!0,function_use_web_images:!0,function_use_web_logo:!0,function_use_web_vector:!0,image_add:!0,image_content:!0,image_crop:!0,image_deletion:!0,image_duplication:!0,image_filter:!0,image_opacity:!0,image_position:!0,image_replace:!0,image_rotation:!0,image_size:!0,image_z_index:!0,text_add:!0,text_alignment:!0,text_change_content:!0,text_colour:!0,text_decoration:!0,text_deletion:!0,text_duplication:!0,text_font_family:!0,text_font_size:!0,text_opacity:!0,text_position:!0,text_rotation:!0,text_size:!0,text_spacing:!0,text_z_index:!0,vector_add:!0,vector_colour:!0,vector_deletion:!0,vector_duplication:!0,vector_opacity:!0,vector_position:!0,vector_rotation:!0,vector_size:!0,vector_stroke:!0,vector_z_index:!0,logo_size:!0,logo_opacity:!0,logo_colour:!0,logo_deletion:!0,logo_duplication:!0,logo_rotation:!0,logo_position:!0,logo_z_index:!0,logo_stroke:!0,logo_add:!0,logo_replace:!0,icon_size:!0,icon_opacity:!0,icon_colour:!0,icon_deletion:!0,icon_duplication:!0,icon_rotation:!0,icon_position:!0,icon_z_index:!0,icon_stroke:!0,icon_add:!0,icon_replace:!0,video_add:!0,video_deletion:!0,video_duplication:!0,video_flags:!0,video_position:!0,video_replace:!0,video_size:!0}}},{}],125:[function(e,t,n){var i=e("../../../facade/design/design");t.exports={sourceListener:null,colorListener:null,initialize:function(e){_.bindAll(this,"onNewColor","onNewSource"),this.restrictionsFactory=e,this.canvas=INKIVE.Tool.getInstance().editor.canvas},refresh:function(e){var t=JSON.parse(e.get("restrictions")||"{}");t.images&&t.images.list?this.sourceListener||this.addSourceListener(e):this.sourceListener&&this.removeSourceListener(),t.colors&&t.colors.list?this.colorListener||this.addColorListener(e):this.colorListener&&this.removeColorListener()},removeSourceListener:function(){this.sourceListener=null,i.off("background.update.source.loaded",this.onNewSource)},addSourceListener:function(e){this.sourceListener=e,i.on("background.update.source.loaded",this.onNewSource)},removeColorListener:function(){this.colorListener=null,i.off("background.update.color",this.onNewColor)},addColorListener:function(e){this.colorListener=e,i.on("background.update.color",this.onNewColor)},onNewColor:function(e){var t=e.color,n=JSON.parse(this.colorListener.get("restrictions")||"{}");n.colors&&n.colors.list?_(n.colors.list).contains(t)||(this.canvas.call("advice.show","color-restriction-applied"),n.colors.list.push(t),this.restrictionsFactory.setGlobalElementRestriction("background",JSON.stringify(n))):this.colorListener&&this.removeSourceListener(elementId)},onNewSource:function(e){var t=e.source,n=JSON.parse(this.sourceListener.get("restrictions")||"{}");n.images&&n.images.list?_(n.images.list).contains(t)||(this.canvas.call("advice.show","source-restriction-applied"),n.images.list.push(t),this.restrictionsFactory.setGlobalElementRestriction("background",JSON.stringify(n))):this.sourceListener&&this.removeSourceListener(elementId)}}},{"../../../facade/design/design":34}],126:[function(e,t,n){var i=e("../../../facade/design/design");t.exports={listeners:{},initialize:function(e){_.bindAll(this,"onNewSource"),this.restrictionsFactory=e,this.canvas=INKIVE.Tool.getInstance().editor.canvas},refresh:function(e){var t=JSON.parse(e.get("restrictions")||"{}"),n=e.get("element_id");t.source&&t.source.list?this.listeners[n]||this.addListener(n,e):this.listeners[n]&&this.removeListener(n)},removeListener:function(e){this.listeners=_.omit(this.listeners,e),i.off(e+".source.url",this.onNewSource)},addListener:function(e,t){this.listeners[e]=t,i.on(e+".source.url",this.onNewSource)},onNewSource:function(e){var t=e.source.url,n=JSON.parse(this.listeners[e.id].get("restrictions")||"{}");n.source&&n.source.list?_(n.source.list).contains(t)||(this.canvas.call("advice.show","source-restriction-applied"),n.source.list.push(t),this.restrictionsFactory.setGlobalElementRestriction(e.id,JSON.stringify(n))):this.listeners[elementId]&&this.removeListener(elementId)}}},{"../../../facade/design/design":34}],127:[function(e,t,n){var i=e("../../../facade/design/design");t.exports={listeners:{},initialize:function(e){_.bindAll(this,"onNewSource"),this.restrictionsFactory=e,this.canvas=INKIVE.Tool.getInstance().editor.canvas},refresh:function(e){var t=JSON.parse(e.get("restrictions")||"{}"),n=e.get("element_id");t.source&&t.source.list?this.listeners[n]||this.addListener(n,e):this.listeners[n]&&this.removeListener(n)},removeListener:function(e){this.listeners=_.omit(this.listeners,e),i.off(e+".thumb_src",this.onNewSource)},addListener:function(e,t){this.listeners[e]=t,i.on(e+".thumb_src",this.onNewSource)},onNewSource:function(e){var t=JSON.parse(this.listeners[e.id].get("restrictions")||"{}");if(t.source&&t.source.list){var n=_(t.source.list).find(function(t){return t.thumb_src==e.thumb_src});n||(this.canvas.call("advice.show","source-restriction-applied"),t.source.list.push({thumb_src:e.thumb_src,is_vector:e.is_vector}),this.restrictionsFactory.setGlobalElementRestriction(e.id,JSON.stringify(t)))}else this.listeners[elementId]&&this.removeListener(elementId)}}},{"../../../facade/design/design":34}],128:[function(e,t,n){var i=e("../../../facade/design/design");t.exports={listeners:{},initialize:function(e){_.bindAll(this,"onNewSource"),this.restrictionsFactory=e,this.canvas=INKIVE.Tool.getInstance().editor.canvas},refresh:function(e){var t=JSON.parse(e.get("restrictions")||"{}"),n=e.get("element_id");t.source&&t.source.list?this.listeners[n]||this.addListener(n,e):this.listeners[n]&&this.removeListener(n)},removeListener:function(e){this.listeners=_.omit(this.listeners,e),i.off(e+".resolution_optimized",this.onNewSource)},addListener:function(e,t){this.listeners[e]=t,i.on(e+".resolution_optimized",this.onNewSource)},onNewSource:function(e){var t=JSON.parse(this.listeners[e.id].get("restrictions")||"{}");if(t.source&&t.source.list){var n=_(t.source.list).find(function(t){return t.source==e.source});n||(this.canvas.call("advice.show","source-restriction-applied"),t.source.list.push({thumb_src:e.thumb_src,source:e.source}),this.restrictionsFactory.setGlobalElementRestriction(e.id,JSON.stringify(t)),this.canvas.selectOnly([$("#"+e.id)[0]]))}else this.listeners[elementId]&&this.removeListener(elementId)}}},{"../../../facade/design/design":34}],129:[function(e,t,n){function i(){this.resource="inkiveeditor/updateSettings",this.baseUrl=INKIVE.C.BASE_URL}var a=e("./api");i.prototype=new a,i.prototype.set=function(e){var t=$.Deferred();return e=_.extend({name:Base64.decode(INKIVE.C.BOOK.name),description:Base64.decode(INKIVE.C.BOOK.description),category:INKIVE.C.BOOK.category,security:INKIVE.C.BOOK.security},e),this.data?t.resolve(this.data):this.api(this.resource,{idInkive:INKIVE.C.BOOK.id,data:_.map(e,function(e,t){return{name:t,value:e}})}).then(_.bind(function(){var n=["name","description"];_.each(e,function(e,t){INKIVE.C.BOOK[t]=_.contains(n,t)?Base64.encode(e):e}),this.trigger("update"),t.resolve()},this),function(e){t.reject(e+" | API Init error")}),t.promise()},t.exports=new i},{"./api":96}],130:[function(e,t,n){function i(){_.bindAll(this,"initialize","getCategories","get"),this.categories=[{key:"basic",icon:"fa fa-square-o"},{key:"animal",icon:"fa fa-bug"},{key:"arrow",icon:"fa fa-arrows"},{key:"dialog_balloon",icon:"fa fa-comments-o"},{key:"electronics",icon:"fa fa-microphone"},{key:"flowchart",icon:"fa fa-sitemap"},{key:"game",icon:"fa fa-gamepad"},{key:"math",icon:"fa fa-superscript"},{key:"misc",icon:"fa fa-fire-extinguisher"},{key:"music",icon:"fa fa-music"},{key:"object",icon:"fa fa-lightbulb-o"},{key:"symbol",icon:"fa fa-plus-square-o"},{key:"web",icon:"fa fa-rss"}]}var a=e("../modules/shapelib/basic.json");i.prototype=_.extend({},Backbone.Events),i.prototype.initialize=_.memoize(function(){var e=$.Deferred(),t=INKIVE.TranslateHelper.translate;return INKIVE.TranslateHelper.load().then(_.bind(function(){this.data={basic:this.mapResult("basic",a)},_.each(this.categories,function(e){e.name=t("shapes.category."+e.key)}),e.resolve()},this)),e.promise()}),i.prototype.getCategories=function(){var e=$.Deferred();return this.initialize().then(_.bind(function(){e.resolve(this.categories)},this)),e.promise()},i.prototype.get=function(e,t){var n=$.Deferred();return e="undefined"==typeof e?0:e,this.getCategories().then(_.bind(function(i){var a=i[e]||_.find(i,{key:e});this._getCategory(a).then(function(e){var i="undefined"==typeof t;if(i&&n.resolve(e),!i){var a=e[t]||_.find(e,{key:t});n.resolve(a)}})},this)),n.promise()},i.prototype._getCategory=function(e){var t=$.Deferred(),n=INKIVE.C.BASE_URL+"assets/js/editor/modules/shapelib/"+e.key+".json";return this.data[e.key]&&t.resolve(this.data[e.key]),this.data[e.key]||$.getJSON(n,_.bind(function(n){this.data[e.key]=this.mapResult(e.key,n),t.resolve(this.data[e.key])},this)),t.promise()},i.prototype.mapResult=function(e,t){var n=INKIVE.TranslateHelper.translate;return _.map(t.data,function(i){return _.extend({fill:t.fill||!1,size:t.size||300,name:n("shapes.names."+e+"."+i.key)},i)})},t.exports=new i},{"../modules/shapelib/basic.json":142}],131:[function(e,t,n){function i(e){var t;return _.any(u,function(n,i){return!!_(n).contains(e)&&(t=i)}),t}function a(e){return l.indexOf(o(e))>-1}function o(e){var t={custom:{4:"a","@":"a",3:"e","|":"i","!":"i","¡":"i",0:"o","ø":"o","+":"t",7:"t",2:"s",5:"2",$:"s","ß":"b","©":"c","¢":"c","®":"r"}};return s&&(t.lang=s),getSlug(e,t)}function r(e){return $.get(d+e+".json?"+INKIVE.C.VERSION)}var s,l,c={},d=INKIVE.C.IS_DEV?INKIVE.C.BASE_URL+"assets/build/swearing/swearing.":"https://static.inkive.com/assets/build/"+INKIVE.C.VERSION+"/swearing/swearing.",u={ar:[],az:[],cs:[],de:["de"],dv:[],en:["en"],es:["es"],fa:[],fr:["fr"],gr:[],hu:[],it:["it"],lt:[],lv:[],my:[],mk:[],nl:["nl"],pl:[],pt:["pt"],ro:[],ru:["ru"],sk:[],sr:[],tr:[],uk:[],vn:[]};t.exports={matchSwearing:function(e,t){return e=_.isArray(e)?e:[e],_.any(e,function(e){return s=i(e),l=o(t),_.any(c[e],a)})},preloadSweringLists:function(e){e=_.isArray(e)?e:[e];var t=$.Deferred(),n=_(e).filter(function(e){return!c[e]});return n.length?$.when.apply($,_(n).map(r)).then(function(){var e=_.toArray(arguments);_.each(n,function(t,i){c[t]=1===n.length?e[0].badwords:e[i][0].badwords}),t.resolve()}):t.resolve(),t.promise()}}},{}],132:[function(e,t,n){function i(){var e=$.Deferred();return $.getJSON(INKIVE.C.BASE_URL+"api/user/current",function(t){e.resolve(t)}),e.promise()}function a(){var t=e("./company").instance;return t.get("memberships","me")}function o(e){function t(){var a=new XMLHttpRequest;a.open("HEAD",s),a.onreadystatechange=function(){this.readyState==this.DONE&&(403===this.status?(l&&(r(i,e),l=!1),setTimeout(t,2e3)):n.resolve())},a.send()}var n=$.Deferred(),i=INKIVE.Tool._current_design_id,a=u(i),o="1754",s=INKIVE.Helpers.getImageUrl(a,o),l=!0;return t(),n.promise()}function r(e,t){var n=new XMLHttpRequest,i="Basic "+btoa(t.user_token+":"+t.user_hash),a=INKIVE.C.VIEWER+"untidy-api/generate-jpeg",o="design_id="+e;n.open("POST",a),n.setRequestHeader("Authorization",i),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.send(o)}var s,l,c,d,u=e("../utils/md5");t.exports=s={canConsume:function(e){var t=$.Deferred();return INKIVE.Helpers.isDesygnerProject()?(t.resolve(),t.promise()):($.when(s.get(),s.getMembership()).then(function(n,i){s.checkRenderedImage(!1,n).then(function(){function a(){t.reject()}function o(){t.resolve()}function r(){var i=new XMLHttpRequest,a="Basic "+btoa(n.user_token+":"+n.user_hash),o=INKIVE.C.WE_BRAND+"untidy-api/consume/"+INKIVE.C.BOOK.id+"/"+e+"?intent";i.open("GET",o),i.setRequestHeader("Authorization",a),i.onload=function(){i.status>=400?t.reject():t.resolve()},i.send()}i?i.is_consumer?r():o():a()})}),t.promise())},get:function(e){return l&&!e?l:l=i()},getMembership:function(e){return c&&!e?c:c=a()},checkRenderedImage:function(e,t){return d&&!e?d:d=o(t)}}},{"../utils/md5":485,"./company":98}],133:[function(e,t,n){function i(){window.INKIVE.EXTENSION.Logo=e("./extensions/ext-logo"),window.INKIVE.EXTENSION.Icon=e("./extensions/ext-icon")}function a(){function t(e,t){var n=INKIVE.Tool.getInstance();INKIVE.History.onChange(e,t,n.editor.getSvgString())}function n(){var e=INKIVE.Tool.getInstance();INKIVE.History.reload(e.editor.getSvgString())}var i=e("./facade/design/design"),a=e("./facade/editor/editor");INKIVE.History=e("./core/history/history");var o=["background.update.source.loaded","background.update.color","group.update","image.update","shape.update","sticker.update","logo.create","logo.update","icon.create","icon.update","text.update","group.create","image.create","shape.create","sticker.create","text.create","send_forward","send_backward","send_top","send_bottom","shape.flip_vertical","shape.flip_horizontal","sticker.flip_vertical","sticker.flip_horizontal","image.flip_vertical","image.flip_horizontal","background.flip_vertical","background.flip_horizontal","group.ungroup","delete","duplicate"];_.each(o,function(e){i.on(e,_.partial(t,"design."+e))}),i.on("template.update.grid",n),i.on("template.update.designed",n),o=["image.crop.end","convert_to_image_box","align"],_.each(o,function(e){a.on(e,_.partial(t,"editor."+e))}),a.on("page.move_to",function(){var e=INKIVE.Tool.getInstance();INKIVE.History.reload(e.editor.getSvgString())})}function o(){e("./ui/tool-menu/element-options");var t=e("./ui/tool-menu/images/view"),n=e("./ui/tool-menu/text/view"),i=e("./ui/tool-menu/icons/view"),a=e("./ui/tool-menu/logos/view"),o=e("./ui/tool-menu/videos/view"),r=e("./ui/tool-menu/templates/view"),s=e("./ui/tool-menu/settings/view"),l=e("./ui/tool-menu/admin/view"),c=e("./ui/tool-menu/search/view");if(window.INKIVE.Tabs.images=new t({el:"#tabImages"}),window.INKIVE.Tabs.text=new n({el:"#tabText"}),window.INKIVE.Tabs.icons=new i({el:"#tabIcons"}),window.INKIVE.Tabs.logos=new a({el:"#tabLogos"}),window.INKIVE.Tabs.video=new o({el:"#tabVideo"}),window.INKIVE.Tabs.settings=new s({el:"#tabSettings"}),window.INKIVE.Tabs.admin=new l({el:"#tabAdmin"}),window.INKIVE.Tabs.layouts=new r({el:"#tabLayouts"}),window.INKIVE.Tabs.search=new c({el:"#tabSearch"}),$("#tabRestrictions").length){var d=e("./ui/tool-menu/placeholders/view");window.INKIVE.Tabs.placeholders=new d({el:"#tabPlaceholders"})}if($("#tabRestrictions").length){var u=e("./ui/tool-menu/restrictions/view");window.INKIVE.RestrictionsFactory=e("./factory/restrictions"),window.INKIVE.Tabs.restrictions=new u({el:"#tabRestrictions"})}if($("#tabRestricted").length){var u=e("./ui/tool-menu/restricted/view");window.INKIVE.Tabs.restricted=new u({el:"#tabRestricted"})}}function r(){window.INKIVE.Tool=window.INKIVE.Tool||{},window.INKIVE.Helpers=window.INKIVE.Helpers||{},window.INKIVE.Helpers.cookieStorage=e("./utils/cookie-storage"),window.INKIVE.Helpers.imagesSanitize=e("./utils/images-sanitize"),window.INKIVE.Helpers.DownloadProcedure=e("./ui/top-submenu/contents/download/download-procedure"),window.INKIVE.Helpers.DownloadProcedure.initialize(),window.INKIVE.SVGElementLoading=e("./SVGElementLoading"),INKIVE.C.IS_MOBILE_APP&&(window.AppBridge=e("./app/bridge")),e("./utils/ellipsis")(),e("./utils/backbone-mixin");var t=INKIVE.Tool.getInstance();t.editor.on("initialize",function(){var n=e("./utils/advice");n.initialize(t.editor.canvas)})}function s(){var t=e("../../translations/translate-helper");return window.INKIVE.TranslateHelper=new t("editor",INKIVE.C.BASE_URL,"translations/client/",!INKIVE.C.IS_DEV&&INKIVE.C.VERSION),_.bindAll(window.INKIVE.TranslateHelper,"translate"),INKIVE.TranslateHelper.load()}function l(){window.INKIVE.ModalHelp=e("./modal/help"),window.INKIVE.ModalAddPage=e("./modal/add-page"),window.INKIVE.ModalShareEmail=e("./modal/share-email"),window.INKIVE.ModalShareEmbed=e("./modal/share-embed"),window.INKIVE.ModalFriends=e("./modal/friends"),window.INKIVE.ModalDownload=e("./modal/download"),window.INKIVE.ModalLogin=e("./modal/login")}function c(){window.INKIVE.SVGPlaceholderImage=e("./thumb/placeholder")}function d(){e("./ui/filterpicker");var t=INKIVE.C.MODE.IS_DESYGNER&&!INKIVE.C.IS_MOBILE,n=e("./ui/stage-dnd");t&&n.init()}function u(){var t=e("hbsfy/runtime");window.INKIVE.TemplatesHelper=e("./ui/templates/templates-helper"),t.registerHelper("Desygner",function(e){return INKIVE.C.MODE.IS_DESYGNER?e.fn(this):e.inverse(this)}),t.registerHelper("Photobooky",function(e){return INKIVE.C.MODE.IS_DESYGNER?e.inverse(this):e.fn(this)}),t.registerHelper("Mobile",function(e){return INKIVE.C.IS_MOBILE?e.fn(this):e.inverse(this)}),t.registerHelper("Desktop",function(e){return INKIVE.C.IS_MOBILE?e.inverse(this):e.fn(this)}),t.registerHelper("low",function(e){return e.toLowerCase()}),t.registerHelper("upp",function(e){return e.toUpperCase()}),t.registerHelper("route",function(e){return INKIVE.C.BASE_URL+e}),t.registerHelper("eq",function(e,t,n){return e==t?n.fn(this):n.inverse(this)}),t.registerHelper("neq",function(e,t,n){return e==t?n.inverse(this):n.fn(this)}),t.registerHelper("ln2br",function(e){return e.replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1<br>$2")}),t.registerHelper("math",function(e,t,n,i){return e=parseFloat(e),n=parseFloat(n),{"+":e+n,"-":e-n,"*":e*n,"/":e/n,"%":e%n}[t]}),t.registerHelper("font_quote",function(e){return e.replace(/\'/g,"\\'")})}function p(){var t=e("./themes/theme-factory");INKIVE.C.ThemeFactory=new t,INKIVE.C.ThemeFactory&&INKIVE.C.ThemeFactory.applyTheme()}function h(){window.INKIVE.ContextMenu=e("./ui/context-menu")}$(function(){INKIVE.disableWindowExitConfirm=INKIVE.C.IS_MOBILE_APP,INKIVE.C.DEBUG=!1,$(window).bind("beforeunload",function(e){if(!INKIVE.disableWindowExitConfirm&&INKIVE.hasEditorUnsavedChanges){var t=INKIVE.TranslateHelper.translate("modal.sure_to_leave");return e=e||window.event,e&&(e.returnValue=t),t}}),$(window).bind("dragover drop",function(e){e=e||event,$(e.target).is("input[type=file]")||e.preventDefault()});var t=s();u(),l(),d(),c(),r(),a(),p(),i(),h(),window.INKIVE.Tabs={},INKIVE.C.IS_MOBILE_APP||o(),e("./analytics/error-track"),window.INKIVE.Menus={},t.done(function(){e("./utils/translate-constants")(window.INKIVE.TranslateHelper.translate);var t=e("./ui/page-order/view"),n=e("./ui/top-submenu/view"),i=e("./ui/bottom-submenu/view");INKIVE.C.IS_MOBILE_APP||(new n({el:"body > header"}),new t({el:"#pages-panel"})),INKIVE.C.BOOK.book_type===INKIVE.C.BOOK_TYPE.RESTRICTED_DESIGN?document.title=INKIVE.TranslateHelper.translate("common.webrand_design_title"):INKIVE.C.BOOK.book_type===INKIVE.C.BOOK_TYPE.TEMPLATE&&(document.title=INKIVE.TranslateHelper.translate("common.webrand_template_title")),window.INKIVE.Menus.bottomSubmenu=new i({el:"#bottom-submenu"})}),window.INKIVE.DesignFacade=e("./facade/design/design"),window.INKIVE.EditorFacade=e("./facade/editor/editor"),window.INKIVE.ProjectFacade=e("./facade/project/project"),window.INKIVE.RestrictionsFacade=e("./facade/restrictions/restrictions"),window.INKIVE.EditorModeManager=e("./ui/editor-mode-manager"),window.INKIVE.SettingsFactory=e("./factory/settings"),window.INKIVE.ImagesFactory=e("./factory/images"),window.INKIVE.LibraryFactory=e("./factory/library"),window.INKIVE.UserInfoFactory=e("./factory/user-info"),window.INKIVE.FontsFactory=e("./factory/fonts"),window.INKIVE.FormatFactory=e("./factory/formats");var n=e("./ui/element-popupmenu/view");window.INKIVE.Menus.elementPopupMenu=new n({el:"#element-popupmenu"}),INKIVE.C.IS_MOBILE_APP||(INKIVE.DesignFacade.on("background.update",function(){$(".popupmenu").remove()}),INKIVE.DesignFacade.on("background.update.color",function(){var e=INKIVE.Tool.getInstance();e.editor.canvas.runExtensions("showBackgroundPopupMenu",{})}))})},{"../../translations/translate-helper":490,"./SVGElementLoading":4,"./analytics/error-track":6,"./app/bridge":7,"./core/history/history":13,"./extensions/ext-icon":20,"./extensions/ext-logo":21,"./facade/design/design":34,"./facade/editor/editor":76,"./facade/project/project":89,"./facade/restrictions/restrictions":94,"./factory/fonts":100,"./factory/formats":101,"./factory/images":102,"./factory/library":103,"./factory/restrictions":122,"./factory/settings":129,"./factory/user-info":132,"./modal/add-page":134,"./modal/download":135,"./modal/friends":136,"./modal/help":137,"./modal/login":138,"./modal/share-email":140,"./modal/share-embed":141,"./themes/theme-factory":143,"./thumb/placeholder":144,"./ui/bottom-submenu/view":158,"./ui/context-menu":161,"./ui/editor-mode-manager":162,"./ui/element-popupmenu/view":187,"./ui/filterpicker":188,"./ui/page-order/view":192,"./ui/stage-dnd":193,"./ui/templates/templates-helper":230,"./ui/tool-menu/admin/view":247,"./ui/tool-menu/element-options":336,"./ui/tool-menu/icons/view":364,"./ui/tool-menu/images/view":379,"./ui/tool-menu/logos/view":393,"./ui/tool-menu/placeholders/view":396,"./ui/tool-menu/restricted/view":398,"./ui/tool-menu/restrictions/view":429,"./ui/tool-menu/search/view":433,"./ui/tool-menu/settings/view":435,"./ui/tool-menu/templates/view":448,"./ui/tool-menu/text/view":452,"./ui/tool-menu/videos/view":455,"./ui/top-submenu/contents/download/download-procedure":459,"./ui/top-submenu/view":476,"./utils/advice":477,"./utils/backbone-mixin":479,"./utils/cookie-storage":480,"./utils/ellipsis":481,"./utils/images-sanitize":483,"./utils/translate-constants":487,"hbsfy/runtime":535}],134:[function(e,t,n){var i=e("../ui/templates/modal/add-page.hbs");t.exports=ModalAddPage=function(e){this.opts=$.extend({baseUrl:INKIVE.C.BASE_URL,staticUrl:INKIVE.C.STATIC_URL},e),this.$wrapper=$(this.opts.wrapper?this.opts.wrapper:'<div style="padding-top: 10px;"></div>'),
this.$wrapper.append(i())},ModalAddPage.prototype={constructor:INKIVE.ModalAddPage,getFormHtml:function(){return this.$wrapper},saveForm:function(e){e&&e(!0)}}},{"../ui/templates/modal/add-page.hbs":205}],135:[function(e,t,n){var i=(e("../app/version"),e("../ui/templates/modal/download.hbs"));t.exports=ModalDownload=function(e){function t(){function e(){n.$wrapper.find("#quality-section").addClass("disabled")}function t(){n.$wrapper.find("[type=checkbox]").iCheck({checkboxClass:"icheckbox_square-yellow"}),n.$wrapper.find("[type=radio]").iCheck({radioClass:"iradio_square-yellow"}),n.$wrapper.find(".ui-dropdown .input-icon").on("click",function(e){$(e.target).parents(".ui-dropdown").find("ul").toggle()}),n.$wrapper.find("a.quality").on("click",function(){n.$wrapper.find("a.quality").removeClass("active"),$(this).addClass("active")})}function i(e,t){var i="."+e+"Dimensions",a=t&&c>t?t:c,o=t&&c>t?parseInt(t/u):d;n.$wrapper.find(i+'[data-type="width"]').val(a),n.$wrapper.find(i+'[data-type="height"]').val(o)}function a(e){var t="is"+s(e),i="."+e+"Dimensions";n.$wrapper.find('[type=checkbox][name="'+t+'"]').on("ifToggled",function(e){n.$wrapper.find(i).toggleClass("disabled")})}function o(e){e+="Dimensions",n.$wrapper.find("."+e).change(function(t){r($(this),e)})}function r(e,t){var i=parseInt(e.val()),a=e.attr("data-type");i<16&&(i=16),i>3e3&&(i=3e3);var o="width"==a?i:parseInt(i/u),r="width"!=a?i:parseInt(i/u);n.$wrapper.find("."+t+'[data-type="width"]').val(o),n.$wrapper.find("."+t+'[data-type="height"]').val(r)}function s(e){return e.charAt(0).toUpperCase()+e.slice(1)}var l=["thumb","web","mobile"],c=n.opts.contentW,d=n.opts.contentH;737==c&&521==d&&(c=842,d=595);var u=c/d;"png"==n.opts.format&&e(),t(),i("rangeCurrent"),i("thumb",110),i("mobile",600),i("web",800),_.each(l,a),_.each(_.union(["rangeCurrent"],l),o)}var n=this;this.opts=$.extend({format:null,contentW:null,contentH:null,baseUrl:INKIVE.C.BASE_URL,staticUrl:INKIVE.C.STATIC_URL},e),this.$wrapper=$(this.opts.wrapper?$(this.opts.wrapper):$('<div class="tool-content"></div>')),this.$wrapper.append(i({display_zip_option:INKIVE.C.IS_MOBILE_APP&&!window.Android,display_extended_options:"pdf"!=n.opts.format})),t()},ModalDownload.prototype={constructor:ModalDownload,getFormHtml:function(){return this.$wrapper},download:function(e){INKIVE.Helpers.DownloadProcedure.execute(this.$wrapper,this.opts,e)}}},{"../app/version":11,"../ui/templates/modal/download.hbs":217}],136:[function(e,t,n){var i=e("../../user-search/index"),a={container:e("../ui/templates/modal/friends.hbs"),item:e("../ui/templates/modal/friends/item.hbs"),loading:e("../ui/templates/modal/friends/loading.hbs"),noResults:e("../ui/templates/modal/friends/no-results.hbs")};t.exports=ModalFriends=function(e){function t(){r.$wrapper.append(a.container()),r.$wrapper.find("#search").focus()}function n(){function e(){p.find("li:visible .btn-add-request").first().click()}function t(e,t){e.length>0?(p.find('.media-heading:not(:contains("'+e+'"))').closest("li").hide(),p.find('.media-heading:contains("'+e+'")').closest("li").show()):p.find("li").show();var n=t&&e.length>2;o(n)}function n(e){p.append(a.item(e))}function o(e){var t=r.$wrapper.find(".antiscroll-wrap"),n=p.find("li").first().height(),i=p.find("li:visible").length;t.height(i>5?5*n:n*(i||1)),e&&l(),e||r.$wrapper.find(".info-message").remove(),e||i||s(),t.antiscroll({autoHide:!1,width:t.width(),height:t.height()}),r.$wrapper.trigger("contentChanged")}function s(){var e=r.$wrapper.find(".info-message");e.length||p.before(a.noResults())}function l(){r.$wrapper.find(".info-message").remove();var e=r.$wrapper.find(".antiscroll-wrap");e.after(a.loading())}function c(){r.$wrapper.on("itemAdded itemRemoved","#search",function(e){var t=e.item;if(t){var n=p.find('li[data-id="'+t.id+'"]'),i=n.find(".btn-add-request");n.hasClass("grayscale")?(n.removeClass("grayscale"),i.html("Drop user")):(n.addClass("grayscale"),i.html("Add user"))}u.tagsinput("input").val(""),p.find("li").show(),o()}),r.$wrapper.on("click"," ul.friends li .btn-add-request",function(e){var t=$(this).parent("li").data(),n=$(this).parent("li").find(".media-body").text(),i=n.replace("Facebook","");i=i.replace("Inkive","");var a=$(this).parent("li"),o=a.hasClass("grayscale"),r={id:a.attr("data-id"),name:i,network:t.network};o&&u.tagsinput("add",r),o||u.tagsinput("remove",r)})}var d=INKIVE.Tool.getInstance(),u=r.$wrapper.find("#search"),p=r.$wrapper.find("ul.friends"),h={scrapbook:r.opts.bookId,ink_type:r.opts.type};l(),c(),i({$searchInput:u,api:INKIVE.Helpers.api,baseUrl:r.opts.baseUrl,friendsListParameters:h,facebookToken:d.facebookToken||FB.getAccessToken(),noProfilePicture:r.opts.staticUrl+"img/profile/anonimo.jpg",enter:e,filter:t,appendUser:n,updateFriendScroll:o})}function o(){var e=r.$wrapper.find("#email4inviting"),t=r.$wrapper.find("#inviteFriendComments").parent();e.keyup(function(e){var n=$(this).val().trim(),i=n.length>0&&n.indexOf("@")>0?"slideDown":"slideUp";t[i]("fast",function(){r.$wrapper.trigger("contentChanged")})})}var r=this;this.opts=$.extend({type:null,bookId:INKIVE.C.BOOK.id,bookName:Base64.decode(INKIVE.C.BOOK.name),baseUrl:INKIVE.C.BASE_URL,staticUrl:INKIVE.C.STATIC_URL},e),this.$wrapper=$(this.opts.wrapper?$(this.opts.wrapper):$('<div class="tool-content"></div>')),t(),n(),o()},ModalFriends.prototype={constructor:ModalFriends,getFormHtml:function(){return this.$wrapper},saveForm:function(e){e=e||$.noop;var t=this,n=t.$wrapper.find("#email4inviting").val();if(n){var i={email:n,message:t.$wrapper.find("#inviteFriendComments").val(),scrapbook_id:t.opts.bookId,scrapbook_name:t.opts.bookName,invite_type:"admins"==t.opts.type?2:"inked"==t.opts.type?1:"tagged"==t.opts.type?3:null};$.post(t.opts.baseUrl+"inkive/inkviaemail",i,function(e){t.$wrapper.find("#email4inviting").val(""),console.log("invitation(s) has been sent")}).error(function(e){t.$wrapper.find("#email4inviting").val("")})}for(var a=t.$wrapper.find("#search").tagsinput("items"),o=[],r=0;r<a.length;r++)"facebook"==a[r].network.toLowerCase()&&(o[r]="'"+a[r].id+"'");var s="";o.length>0&&(s="["+o.join(",")+"]"),a.length>0?ModalFriends.addInvolvedUser(t.opts.type,t.opts.bookId,a,function(n){e(n,t.opts.type,a)}):e(!0,t.opts.type,a)}},ModalFriends.addInvolvedUser=function(e,t,n,i,a){a=a||INKIVE.C.BASE_URL,t=t||INKIVE.C.BOOK.id,i=i||$.noop,jQuery.post(a+"inkive/setInked/"+e,{scrapbook:t,users:n},function(e){i(e.success)},"json")},ModalFriends.deleteInvolvedUser=function(e,t,n,i){i=i||INKIVE.C.BASE_URL,t=t||INKIVE.C.BOOK.id,n=n||$.noop;var a={id:e.parents(".userHolder").data("id"),inkive_id:t};$.post(i+"friends/unsetinked",a,function(i){var a=e.parents(".listContainer");e.parents(".userHolder").remove(),a.find(".userHolder").length||(a.parent().addClass("empty"),a.find(".emptyText").show()),n(t)})},ModalFriends.initInvolvedList=function(e,t,n,i,a){a=a||INKIVE.C.BASE_URL,i=i||INKIVE.C.BOOK.id,n=n||$.noop;var o=e.attr("class"),r={type:t,scrapbook:i,currentPage:"mykive"},s=e.find("li:last"),l=e.parent().parent();$.getJSON(a+"inkive/getInked",r).done(function(t){if(e.find("li>:not(a)").parent().remove(),l.find(".spinnerWrapper").hide(),t.success){var a=t.data;if(a.trim().length&&(e.find("li>:not(a)").parent().remove(),e.prepend(t.data),$('li[data-toggle="tooltip"]').tooltip({placement:"top"}),l.removeClass("empty"),l.find(".emptyText").hide()),null!=$(s).attr("data-position")){var r=40*$(s).attr("data-position");"co-creators-list"!=o&&(r+=40),$(e).css("width",r)}$(e).trigger("listupdate",i)}e.find(".thumb-img").unbind("mouseenter"),e.on("mouseenter",".thumb-img",function(e){var t=$(this).parent().find(".thumb-delete");t.length>0&&($(this).fadeOut(),t.fadeIn())}),e.find(".thumb-delete").unbind("mouseleave click"),e.on("mouseleave",".thumb-delete",function(e){$(this).fadeOut(),$(this).parent().find(".thumb-img").fadeIn()}),e.on("click",".thumb-delete",function(e){n($(this))})})}},{"../../user-search/index":488,"../ui/templates/modal/friends.hbs":218,"../ui/templates/modal/friends/item.hbs":219,"../ui/templates/modal/friends/loading.hbs":220,"../ui/templates/modal/friends/no-results.hbs":221}],137:[function(e,t,n){var i=e("../ui/templates/modal/help.hbs");t.exports=ModalHelp=function(e){this.opts=$.extend({userId:INKIVE.C.USER.id,userName:Base64.decode(INKIVE.C.USER.nickname),userEmail:Base64.decode(INKIVE.C.USER.email),baseUrl:INKIVE.C.BASE_URL,staticUrl:INKIVE.C.STATIC_URL},e),this.$wrapper=$(this.opts.wrapper?$.parseHTML(this.opts.wrapper):$.parseHTML('<div class="tool-content"></div>')),this.$wrapper.append(i({user_name:this.opts.userName,user_email:this.opts.userEmail}))},ModalHelp.prototype={constructor:ModalHelp,getFormHtml:function(){return this.$wrapper},saveForm:function(e){var t=(INKIVE.Tool.getInstance(),{email:this.$wrapper.find('[name="email"]').val(),name:this.$wrapper.find('[name="name"]').val(),help:this.$wrapper.find('[name="help"]').val(),scrapbook_id:INKIVE.C.BOOK.id}),n=$("#svgcontent g.main")[0].classList,i=_.find(n,function(e){return 0===e.indexOf("layout-id")});i&&(t.template_id=i.split("-")[2]),INKIVE.Helpers.api("inkive/feedback","POST",t,function(t){e&&e(t.status)})}}},{"../ui/templates/modal/help.hbs":222}],138:[function(e,t,n){t.exports=ModalLogin=function(e){this.opts=$.extend({userEmail:Base64.decode(INKIVE.C.USER.email)},e)},ModalLogin.prototype={constructor:ModalLogin,getFormHtml:function(){var e=$("<div>");return e.height(370),e.css("display","flex"),e.css("align-items","center"),e.append('<div class="loading-label" style="text-align:center">'+INKIVE.TranslateHelper.translate("general.save_logged_out")+INKIVE.TemplatesHelper("modal_loader")+"</div>"),e.append('<iframe width="100%" height="370px" style="display:none" name="loginPopup" id="loginPopup" src="'+INKIVE.C.BASE_URL+"login?popup=true&email="+this.opts.userEmail+'"/>'),e}}},{}],139:[function(e,t,n){var i=e("../ui/templates/modal/prompt.hbs");t.exports=PromptModal=function(e){this.$wrapper=$(e.wrapper?$.parseHTML(e.wrapper):$.parseHTML('<div class="tool-content"></div>')),this.$wrapper.append(i({title:e.title,label:e.label,default_value:e.defaultValue}))},PromptModal.prototype={constructor:PromptModal,getFormHtml:function(){return this.$wrapper},getValue:function(e){return this.$wrapper.find("input").val()}}},{"../ui/templates/modal/prompt.hbs":223}],140:[function(e,t,n){var i=e("../ui/templates/modal/share-email.hbs");t.exports=ModalShareEmail=function(e){var t=this;this.opts=$.extend({userId:INKIVE.C.USER.id,userName:Base64.decode(INKIVE.C.USER.nickname),baseUrl:INKIVE.C.BASE_URL,staticUrl:INKIVE.C.STATIC_URL},e),this.$wrapper=$(this.opts.wrapper?$(this.opts.wrapper):$('<div class="tool-content"></div>')),t.$wrapper.append(i({thumb:INKIVE.C.BOOK.thumb,book_name:Base64.decode(INKIVE.C.BOOK.name),book_description:Base64.decode(INKIVE.C.BOOK.description).trimToLength(100),user_name:t.opts.userName}))},ModalShareEmail.prototype={constructor:ModalShareEmail,getFormHtml:function(){return this.$wrapper},saveForm:function(e){e=e||$.noop;var t=INKIVE.C.BASE_URL+"share/sendemail/"+INKIVE.C.BOOK.id,n=this.$wrapper.parents("form").serialize();$.post(t,n,function(t){t.success&&e(!0)},"json").fail(function(){e(!1)}),e(!1)}}},{"../ui/templates/modal/share-email.hbs":224}],141:[function(e,t,n){var i=e("../ui/templates/modal/share-embed.hbs");t.exports=ModalShareEmbed=function(e){function t(){o.$wrapper.append(i({width:INKIVE.C.EMBED.DefaultWidth,height:INKIVE.C.EMBED.DefaultHeight})),o.$wrapper.find("[type=checkbox]").iCheck({checkboxClass:"icheckbox_square-yellow"}),o.$wrapper.find("[name=bookName]").iCheck("check"),o.$wrapper.find("[name=bookViews]").iCheck("check")}function n(){o.$wrapper.find("a.type").on("click",function(){o.$wrapper.find("a.type").removeClass("active"),$(this).addClass("active"),"scroll"==$(this).attr("data-id")?(o.$wrapper.find("#share-embed-checkboxes").slideUp(function(){o.$wrapper.trigger("contentChanged")}),o.$wrapper.find("#share-embed-size-text").html(o.opts.text_size+" (1.5 "+(INKIVE.C.MODE.IS_DESYGNER?"designs":"pages")+" at a time)"),o.$wrapper.find("#share-embed-size a.size:not([data-id=custom])").each(function(e,t){var n=parseInt($(t).attr("data-id")),i=Math.round(n*INKIVE.C.EMBED.W2H*1.5+40);$(t).attr("tag",n+" x "+i)})):(o.$wrapper.find("#share-embed-checkboxes").slideDown(function(){o.$wrapper.trigger("contentChanged")}),o.$wrapper.find("#share-embed-size-text").html(o.opts.text_size),o.$wrapper.find("#share-embed-size a.size:not([data-id=custom])").each(function(e,t){var n=parseInt($(t).attr("data-id")),i=Math.round(n*INKIVE.C.EMBED.W2H);$(t).attr("tag",n+" x "+i)})),a()}),o.$wrapper.find("a.size").on("click",function(){o.$wrapper.find("a.size").removeClass("active"),$(this).addClass("active"),"custom"==$(this).attr("data-id")?($(this).hide(),o.$wrapper.find("#share-embed-custom-sizes").fadeIn()):(o.$wrapper.find("#share-embed-custom-sizes").hide(),o.$wrapper.find("a.size").show()),a()}),o.$wrapper.find("input[name=width]").keyup(function(e){var t=o.$wrapper.find("a.type.active").attr("data-id"),n=parseInt($(this).val())||0;parseInt(o.$wrapper.find("input[name=height]").val());n>INKIVE.C.EMBED.MaxWidth&&($(this).val(INKIVE.C.EMBED.MaxWidth),n=$(this).val()),"scroll"==t?n>Math.round((INKIVE.C.EMBED.DefaultHeight-40)/INKIVE.C.EMBED.W2H*1.5)&&o.$wrapper.find("input[name=height]").val(Math.round(n*INKIVE.C.EMBED.W2H*1.5+40)):o.$wrapper.find("input[name=height]").val(Math.round(n*INKIVE.C.EMBED.W2H)),a()}),o.$wrapper.find("input[name=height]").keyup(function(e){var t=o.$wrapper.find("a.type.active").attr("data-id"),n=parseInt($(this).val())||0;if("scroll"!=t){var i=n/INKIVE.C.EMBED.W2H;i>INKIVE.C.EMBED.MaxWidth&&(i=INKIVE.C.EMBED.MaxWidth,$(this).val(Math.round(i*INKIVE.C.EMBED.W2H))),o.$wrapper.find("input[name=width]").val(Math.round(i))}a()}),o.$wrapper.find("textarea").on("click",function(e){this.select()}),o.$wrapper.find("[type=checkbox]").on("ifToggled",function(){a()}),a()}function a(){var e=o.$wrapper.find("a.type.active").attr("data-id"),t=INKIVE.C.EMBED.DefaultWidth,n=INKIVE.C.EMBED.DefaultHeight,i=o.$wrapper.find("[name=bookName]").is(":checked")?1:0,a=o.$wrapper.find("[name=bookViews]").is(":checked")?1:0,r=o.$wrapper.find("a.size.active");"custom"==r.attr("data-id")?(t=o.$wrapper.find("input[name=width]").val()||t,n=o.$wrapper.find("input[name=height]").val()||n):(t=parseInt(r.attr("data-id")),n="scroll"==e?Math.round(t*INKIVE.C.EMBED.W2H*1.5+40):Math.round(t*INKIVE.C.EMBED.W2H));var s='<iframe src="'+INKIVE.C.BASE_URL.replace("http:","")+"design/embedded/"+INKIVE.C.BOOK.id+"/"+t+"/"+n+"/"+e+"/"+i+"/"+a+'/" width="'+t+'" height="'+n+'" frameborder="0"></iframe>';o.$wrapper.find("textarea[name=code]").val(s)}var o=this;this.opts=e||{},this.$wrapper=$(this.opts.wrapper?$(this.opts.wrapper):$('<div class="tool-content"></div>')),t(),n()},ModalShareEmbed.prototype={constructor:ModalShareEmbed,getFormHtml:function(){return this.$wrapper},saveForm:function(e){e&&e(!0)}}},{"../ui/templates/modal/share-embed.hbs":225}],142:[function(e,t,n){t.exports={data:[{key:"line",path:"M 0 125 L 0 175 L 300 175 L 300 125 L 0 125"},{key:"round_square",path:"M 30.1,0 H 270.9 C 287.5754,0 301,13.4246 301,30.1 v 240.8 c 0,16.6754 -13.4246,30.1 -30.1,30.1 H 30.1 C 13.4246,301 0,287.5754 0,270.9 V 30.1 C 0,13.4246 13.4246,0 30.1,0 Z"},{key:"square",path:"M 0 0 L 0 300 L 300 300 L 300 0 L 0 0"},{key:"rectangle",path:"M 0 50 L 0 250 L 300 250 L 300 50 L 0 50"},{key:"circle",path:"M 150 150 m -150, 0 a 150,150 0 1,0 300,0 a 150,150 0 1,0 -300,0"},{key:"ellipse",path:"M0,150a150,100 0 1,0 300,0a150,100 0 1,0 -300,0"},{key:"pentagon",path:"m1.00035,116.97758l148.99963,-108.4053l148.99998,108.4053l-56.91267,175.4042l-184.1741,0l-56.91284,-175.4042z"},{key:"triangle",path:"m1,280.375l149,-260.75l149,260.75z"},{key:"diamond",path:"m1,150l149,-149l149,149l-149,149l-149,-149z"},{key:"right_triangle",path:"m1,299l0,-298l298,298z"},{key:"donut",path:"m1,150l0,0c0,-82.29042 66.70958,-149 149,-149l0,0c39.51724,0 77.41599,15.69816 105.35889,43.64108c27.94293,27.94293 43.64111,65.84165 43.64111,105.35892l0,0c0,82.29041 -66.70958,149 -149,149l0,0c-82.29041,0 -149,-66.70959 -149,-149zm74.5,0l0,0c0,41.1452 33.35481,74.5 74.5,74.5c41.14522,0 74.5,-33.3548 74.5,-74.5c0,-41.1452 -33.3548,-74.5 -74.5,-74.5l0,0c-41.14519,0 -74.5,33.35481 -74.5,74.5z"},{key:"hexagon",path:"m1,149.99944l63.85715,-127.71428l170.28572,0l63.85713,127.71428l-63.85713,127.71428l-170.28572,0l-63.85715,-127.71428z"},{key:"heart",path:"m150,73c61,-175 300,0 0,225c-300,-225 -61,-400 0,-225z"},{key:"frame",path:"m70,140l160,0l0,160l-160,0zm20,-140l0,120l120,0l0,-120z"},{key:"septagon1",path:"m0.99917,191.06511l29.51249,-127.7108l119.48833,-56.83673l119.48836,56.83673l29.51303,127.7108l-82.69087,102.41679l-132.62103,0l-82.69031,-102.41679z"},{key:"heptagon",path:"m1,88.28171l87.28172,-87.28171l123.43653,0l87.28172,87.28171l0,123.43654l-87.28172,87.28172l-123.43653,0l-87.28172,-87.28172l0,-123.43654z"},{key:"decagon",path:"m1,150.00093l28.45646,-88.40318l74.49956,-54.63682l92.08794,0l74.50002,54.63682l28.45599,88.40318l-28.45599,88.40318l-74.50002,54.63681l-92.08794,0l-74.49956,-54.63681l-28.45646,-88.40318z"},{key:"dodecagon",path:"m1,110.07421l39.92579,-69.14842l69.14842,-39.92579l79.85159,0l69.14842,39.92579l39.92578,69.14842l0,79.85159l-39.92578,69.14842l-69.14842,39.92578l-79.85159,0l-69.14842,-39.92578l-39.92579,-69.14842l0,-79.85159z"},{key:"star_points_5",path:"m1,116.58409l113.82668,0l35.17332,-108.13487l35.17334,108.13487l113.82666,0l-92.08755,66.83026l35.17514,108.13487l-92.08759,-66.83208l-92.08757,66.83208l35.17515,-108.13487l-92.08758,-66.83026z"},{key:"trapezoid",path:"m1,299l55.875,-298l186.25001,0l55.87498,298z"},{key:"arrow_up",path:"m1.49805,149.64304l148.50121,-148.00241l148.50121,148.00241l-74.25061,0l0,148.71457l-148.5012,0l0,-148.71457z"},{key:"dialog_balloon_1",path:"m0.99786,35.96579l0,0c0,-19.31077 15.28761,-34.96524 34.14583,-34.96524l15.52084,0l0,0l74.50001,0l139.68748,0c9.05606,0 17.74118,3.68382 24.14478,10.24108c6.40356,6.55726 10.00107,15.45081 10.00107,24.72416l0,87.41311l0,0l0,52.44785l0,0c0,19.31078 -15.2876,34.96524 -34.14584,34.96524l-139.68748,0l-97.32507,88.90848l22.82506,-88.90848l-15.52084,0c-18.85822,0 -34.14583,-15.65446 -34.14583,-34.96524l0,0l0,-52.44785l0,0z"},{key:"arrow_u_turn",path:"m1.00059,299.00055l0,-167.62497l0,0c0,-72.00411 58.37087,-130.37499 130.375,-130.37499l0,0l0,0c34.57759,0 67.73898,13.7359 92.18906,38.18595c24.45006,24.45005 38.18593,57.61144 38.18593,92.18904l0,18.625l37.24997,0l-74.49995,74.50002l-74.50002,-74.50002l37.25,0l0,-18.625c0,-30.8589 -25.0161,-55.87498 -55.87498,-55.87498l0,0l0,0c-30.85892,0 -55.875,25.01608 -55.875,55.87498l0,167.62497z"},{key:"arrow_left_up",path:"m0.99865,224.5l74.50004,-74.5l0,37.25l111.74991,0l0,-111.75l-37.25,0l74.5,-74.5l74.5,74.5l-37.25,0l0,186.25l-186.24989,0l0,37.25l-74.50005,-74.5z"},{key:"cross",path:"m0.99844,99.71339l98.71494,0l0,-98.71495l101.26279,0l0,98.71495l98.71495,0l0,101.2628l-98.71495,0l0,98.71494l-101.26279,0l0,-98.71494l-98.71494,0z"},{key:"plaque",path:"m-0.00197,49.94376l0,0c27.5829,0 49.94327,-22.36036 49.94327,-49.94327l199.76709,0l0,0c0,27.5829 22.36037,49.94327 49.94325,49.94327l0,199.7671l0,0c-27.58289,0 -49.94325,22.36034 -49.94325,49.94325l-199.76709,0c0,-27.58292 -22.36037,-49.94325 -49.94327,-49.94325z"},{key:"page",path:"m249.3298,298.99744l9.9335,-39.73413l39.73413,-9.93355l-49.66763,49.66768l-248.33237,0l0,-298.00001l298.00001,0l0,248.33234"}]}},{}],143:[function(e,t,n){var i=e("../../../bower_components/tinycolor/tinycolor");e("../../../bower_components/jquery-injectCSS/jquery.injectCSS");var a=function(){};a.prototype.applyTheme=function(){INKIVE.C.THEME&&_.each(this.getCssCollection(),$.injectCSS)},a.prototype.getCssCollection=function(){var e=INKIVE.C.THEME.logoImgSmall?INKIVE.C.THEME.logoImgSmall:INKIVE.C.THEME.logoImg,t=INKIVE.C.THEME.userInterfaceColor,n=INKIVE.C.THEME.brandColor,a=INKIVE.C.THEME.remarkedColor,o=(i(t).lighten(60).toString(),i(t).lighten().toString(),i(t).darken().toString(),{background:n});return INKIVE.C.THEME.gradientBackround&&(o={background:"-moz-radial-gradient(center, ellipse cover, "+i(n).lighten(30).toString()+" 0%, "+n+" 30%, "+i(n).darken(30).toString()+" 100%);",background:"-webkit-radial-gradient(center, ellipse cover, "+i(n).lighten(30).toString()+" 0%,"+n+" 30%,"+i(n).darken(30).toString()+" 100%);",background:"radial-gradient(ellipse at center, "+i(n).lighten(30).toString()+" 0%,"+n+" 30%,"+i(n).darken(30).toString()+" 100%);"}),[{"body > header .menus > .logo-icon > div":{background:'url("'+e+'")no-repeat center center',"background-size":"contain;"}},{"#tool-panel #tabTutorial h1":{color:a}},{"#tool-panel #tabTutorial ul li a":{color:a}},{".btn-primary, .btn-primary:focus":{background:a}},{"#pages-panel .submenu a:hover":{color:a}},{"#tool-panel .tool-content .tab-content.inner-tabs .header-links > div.active":{"border-bottom":"4px solid "+a}},{"#tool-panel .tool-content #tabSearch .tool-static-block ul li.ui-tabs-active a":{color:a}},{"#tool-panel .tool-content #tabSettings .tab-content a.btn-squire.active i":{color:a}},{"#tool-panel .tool-content #tabSettings .tab-content a.btn-squire.active:after":{color:a}},{"#tool-panel .tool-content .tab-content.text > .add .thumbnail a:hover":{color:a}},{"#tool-panel .tool-content .tab-content.text > .add .thumbnail a.applied":{color:a}},{"#tool-panel .tool-content .tab-content.inner-tabs .categories-container .category-list .category-element:hover":{color:a}},{"#tool-panel .tool-content .tab-content.inner-tabs .categories-container .category-list .category-element:selected":{color:a}},{"#tool-panel .tool-content .tab-content.text > .add .thumbnail .line-container > a.item.active":{color:a}},{"#tool-panel .tool-content .tab-content.text > .add .thumbnail .line-container > a a.item:hover":{color:a}},{"#tool-panel .tool-content .tab-content.text > .add .thumbnail .line-container a.toggle-options.active":{color:a}},{"#tool-panel .tool-content .tab-content.text > .add .thumbnail .options ul li .btn:hover":{color:a}}]},t.exports=a},{"../../../bower_components/jquery-injectCSS/jquery.injectCSS":1,"../../../bower_components/tinycolor/tinycolor":3}],144:[function(e,t,n){var i=e("../ui/templates/thumb/placeholder.hbs"),a=function(){function e(e,n){var a=t(n);if(a){var o=a.width>a.height?a.width:a.height,r={x:a.x+(a.width-o)/2,y:a.y+(a.height-o)/2,id:e,size:o,clipId:n,is_vertical:a.width<a.height};return{renderData:r,svgString:i(r)}}}function t(e){var t=n.find("#"+e.trim()+" rect");return 0===t.length?null:{x:parseFloat(t.attr("x")),y:parseFloat(t.attr("y")),width:parseFloat(t.attr("width")),height:parseFloat(t.attr("height"))}}var n;return{render:e,setClipsData:function(e){n=$("<div>").html(e)}}}();t.exports=a},{"../ui/templates/thumb/placeholder.hbs":231}],145:[function(e,t,n){t.exports={eventCategory:"Editor UI | Bottom Menu",eventAction:"page",previousEvent:{eventLabel:"previous"},nextEvent:function(e){var t=$(e.currentTarget).find("i.add").is(":visible");this.trackEvent({eventLabel:t?"add":"next"})}}},{}],146:[function(e,t,n){var i=e("../../../factory/formats");t.exports={eventCategory:"Editor UI | Bottom Menu",eventAction:"size",showResizeEvent:{eventLabel:"display_resize_options"},showResizeMenu:{eventLabel:"display_multi_resize_menu"},doResizeEvent:function(e){var t,n,a,o="",r=this.$el.find("input.custom").is(":checked");r?(t=parseFloat(this.$el.find("input.size.page-width").val()),n=parseFloat(this.$el.find("input.size.page-height").val()),a=this.$el.find("select.unit").val(),o=t+"x"+n+a):this.$el.find("[type=checkbox]:checked").each(function(e,t){i.getFormat($(t).val()).then(_.bind(function(e){o+=e.width+"x"+e.height+e.unit+" "},this))}),this.trackEvent({eventAction:r?"resize_custom":"resize_standar",eventLabel:"from "+this.$el.find(".page-size").text().trim()+" to "+o})}}},{"../../../factory/formats":101}],147:[function(e,t,n){t.exports={eventCategory:"Editor UI | Bottom Menu",eventAction:"zoom",setHundredPercentEvent:{eventLabel:"set_hundred_percent"},setOriginalEvent:{eventLabel:"set_original"},zoomInEvent:{eventLabel:"zoom_in"},zoomOutEvent:{eventLabel:"zoom_out"}}},{}],148:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){var o=null!=t?t:e.nullContext||{},r=n.helperMissing,s=e.escapeExpression;return'<li>\n  <a class="btn btn-gray prev" data-popover="tooltip" data-placement="top" data-original-title="'+s((n.t||t&&t.t||r).call(o,"bottom_submenu.page.prev",{name:"t",hash:{},data:a}))+'"><i class="icon-chevron-left arrow"></i></a>\n</li><li class="page-count">\n\t<div class="page-count-text">\n\t\t<span data-popover="tooltip" data-placement="top" data-original-title="'+s((n.t||t&&t.t||r).call(o,"editor.current_design",{name:"t",hash:{},data:a}))+'">0</span>/<span data-popover="tooltip" data-placement="top" data-original-title="'+s((n.t||t&&t.t||r).call(o,"bottom_submenu.page.total",{name:"t",hash:{},data:a}))+'">0</span>\n\t</div>\n\t<input type="text" class="page-number"/>\n</li><li>\n\t<a class="btn btn-gray next"><i class="icon-chevron-right arrow hidden" data-popover="tooltip" data-placement="top" data-original-title="'+s((n.t||t&&t.t||r).call(o,"bottom_submenu.page.next",{name:"t",hash:{},data:a}))+'"></i><i class="add icon-plus" data-popover="tooltip" data-placement="top" data-original-title="'+s((n.t||t&&t.t||r).call(o,"editor.add_design",{name:"t",hash:{},data:a}))+'"></i></a>\n</li>\n'},useData:!0})},{"hbsfy/runtime":535}],149:[function(e,t,n){var i=e("./page.hbs"),a=e("../../../facade/editor/editor"),o=e("../../../facade/project/project"),r=e("../../../analytics/decorate"),s=e("../../../facade/restrictions/decorate");t.exports=s(e("../restrict/page"),r(e("../analytics/page"),Backbone.View.extend({events:{"click a.btn.prev":"previousEvent","click a.btn.next":"nextEvent","click li.page-count":"pageNumberEvent"},previousEvent:function(e){var t=parseInt(INKIVE.Tool._current_page_number);a.handle("page","move_to",{page_number:t-1})},nextEvent:function(e){var t=parseInt(INKIVE.Tool._current_page_number),n=$(e.currentTarget).find("i.add").is(":visible");n&&this.addPage(),n||a.handle("page","move_to",{page_number:t+1})},pageNumberEvent:function(e){function t(){o.addClass("hidden"),i.removeClass("hidden")}var n=parseInt(INKIVE.Tool._current_page_number),i=(INKIVE.C.BOOK.num_pages,this.$el.find(".page-count-text")),o=i.next();i.addClass("hidden"),o.removeClass("hidden"),o.val(n),o.select(),o.focusout(t),o.keypress(function(e){if(13==e.which){var n=this.value;this.value="",n&&n>0&&n<=INKIVE.C.BOOK.num_pages&&a.handle("page","move_to",{page_number:n}),t()}})},addPage:function(){o.handle("design","add"),INKIVE.ProjectFacade.once("design.added",function(){var e=$('.ui-dropdown-content[data-id="download"]');e.find('[type=radio][name="isRange"][id="isRangeCurrent"]').parents("div.checkbox").show(),e.find('[type=radio][name="isRange"][id="isRangeSelected"]').parents("div.checkbox").show(),e.find('[type=radio][name="isRange"][id="isRangeAll"]').trigger("ifToggled")})},initialize:function(){this.tool=INKIVE.Tool.getInstance(),this.editor=this.tool.editor,_.bindAll(this,"updateCurrentPageInfo"),this.render()},render:function(){this.$el.html(i()),INKIVE.Helpers.projectIsLinkedToRestrictions()&&(this.$el.find("a.btn.next").find("i.add").addClass("hidden"),this.$el.find("a.btn.next").find("i.arrow").removeClass("hidden")),this.$el.find(".page-number").addClass("hidden")},updateCurrentPageInfo:function(){var e=INKIVE.Tool._current_page_number,t=INKIVE.C.BOOK.num_pages,n=this.$el.find(".page-count span"),i=this.$el.find("a.btn.prev"),a=this.$el.find("a.btn.next");n.eq(0).text(e),n.eq(1).text(t),i.toggleClass("disabled",1==e),INKIVE.Helpers.projectIsLinkedToRestrictions()?a.toggleClass("disabled",e==t):(a.find("i.add").toggleClass("hidden",e!=t),a.find("i.arrow").toggleClass("hidden",e==t))}})))},{"../../../analytics/decorate":5,"../../../facade/editor/editor":76,"../../../facade/project/project":89,"../../../facade/restrictions/decorate":90,"../analytics/page":145,"../restrict/page":155,"./page.hbs":148}],150:[function(e,t,n){var i=e("../../../facade/design/design"),a=e("../../../facade/editor/editor"),o=e("../../../facade/project/project"),r=e("../../../factory/formats");t.exports=function(){function e(){return this.$el.find("input.custom").is(":checked")?t.call(this):n.call(this)}function t(){var e=$.Deferred(),t=this.$el.find("select.unit").val(),n=parseFloat(this.$el.find("input.size.page-width").val()),i=parseFloat(this.$el.find("input.size.page-height").val());return e.resolve([{width:n,height:i,unit:t}]),e.promise()}function n(){var e=$.Deferred(),t=_.map(this.$el.find("[type=checkbox]:checked"),function(e){return r.getFormat($(e).val())});return $.when.apply($,t).then(function(){e.resolve(_.toArray(arguments))}),e.promise()}function s(e){function t(){var a=0===e.length;a&&i.resolve(n),a||o.handle("design","copy",{design_id:INKIVE.Tool._current_design_id,append:!0,stay:!0,save:!1,silent:!0}).then(function(i){n[i.page_number]=e.pop(),t()})}var n={},i=$.Deferred();return c(0,e.length),a.handle("page","save").then(t),i.promise()}function l(e){function t(){var e=0===r.length;e&&o.resolve(),e||r.shift()().then(t)}function n(t,n){var o=$.Deferred();return c(_.size(e)-r.length-1,_.size(e)),a.handle("page","move_to",{page_number:n}).then(function(){i.once("template.update",o.resolve),i.set("template",{size:t})}),o.promise()}var o=$.Deferred(),r=_.map(e,function(e,t){return _.partial(n,e,t)});return t(),o.promise()}function c(e,t){function n(){INKIVE.Modal.toggleLock(!1);var n=['<b style="font-weight: 400">',INKIVE.TranslateHelper.translate("modal.alert.resize_page",{page:e+1,from:t,percent:parseInt(100*e/t)}),"</b>"];d=INKIVE.Modal.alertMessage(n.join(""),{skip:!1,loader:!0}),INKIVE.Modal.toggleLock(!0)}d&&d.close(n),d||n()}var d;parseInt(this.editor.canvas.contentW),parseInt(this.editor.canvas.contentH);e.call(this).then(s).then(l).then(_.partial(a.handle,"page","save")).then(function(){d&&d.close(),INKIVE.Modal.toggleLock(!1)})}},{"../../../facade/design/design":34,"../../../facade/editor/editor":76,"../../../facade/project/project":89,"../../../factory/formats":101}],151:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({1:function(e,t,n,i,a,o,r){var s,l,c,d="        ";return l=null!=(l=n.data||(null!=t?t.data:t))?l:n.helperMissing,c={name:"data",hash:{},fn:e.program(2,a,0,o,r),inverse:e.noop,data:a},s="function"==typeof l?l.call(null!=t?t:e.nullContext||{},c):l,n.data||(s=n.blockHelperMissing.call(t,s,c)),null!=s&&(d+=s),d+"\n"},2:function(e,t,n,i,a,o,r){var s;return null!=(s=(n.eq||t&&t.eq||n.helperMissing).call(null!=t?t:e.nullContext||{},null!=t?t.id:t,null!=(s=null!=r[2]?r[2].format:r[2])?s.id:s,{name:"eq",hash:{},fn:e.program(3,a,0,o,r),inverse:e.noop,data:a}))?s:""},3:function(e,t,n,i,a,o,r){var s,l=e.escapeExpression,c=null!=t?t:e.nullContext||{},d=n.helperMissing,u="function";return'\n        <div class="page-size-group">\n            <div>'+l(e.lambda(null!=r[1]?r[1].name:r[1],t))+": "+l((s=null!=(s=n.name||(null!=t?t.name:t))?s:d,typeof s===u?s.call(c,{name:"name",hash:{},data:a}):s))+"</div>\n            <div><small>"+l((s=null!=(s=n.width||(null!=t?t.width:t))?s:d,typeof s===u?s.call(c,{name:"width",hash:{},data:a}):s))+"x"+l((s=null!=(s=n.height||(null!=t?t.height:t))?s:d,typeof s===u?s.call(c,{name:"height",hash:{},data:a}):s))+l((s=null!=(s=n.unit||(null!=t?t.unit:t))?s:d,typeof s===u?s.call(c,{name:"unit",hash:{},data:a}):s))+"</small></div>\n        </div>\n        "},5:function(e,t,n,i,a){return" checked"},7:function(e,t,n,i,a){return" active"},9:function(e,t,n,i,a){return" disabled"},11:function(e,t,n,i,a,o,r){var s,l,c,d="          ";return l=null!=(l=n.data||(null!=t?t.data:t))?l:n.helperMissing,c={name:"data",hash:{},fn:e.program(12,a,0,o,r),inverse:e.noop,data:a},s="function"==typeof l?l.call(null!=t?t:e.nullContext||{},c):l,n.data||(s=n.blockHelperMissing.call(t,s,c)),
null!=s&&(d+=s),d+"\n"},12:function(e,t,n,i,a,o,r){var s;return null!=(s=(n.eq||t&&t.eq||n.helperMissing).call(null!=t?t:e.nullContext||{},null!=t?t.id:t,null!=(s=null!=r[2]?r[2].format:r[2])?s.id:s,{name:"eq",hash:{},fn:e.noop,inverse:e.program(13,a,0,o,r),data:a}))?s:""},13:function(e,t,n,i,a,o,r){var s,l=null!=t?t:e.nullContext||{},c=n.helperMissing,d="function",u=e.escapeExpression;return'<div class="checkbox"><input type="checkbox" id="resize_page_id_opt_'+u((s=null!=(s=n.id||(null!=t?t.id:t))?s:c,typeof s===d?s.call(l,{name:"id",hash:{},data:a}):s))+'" value="'+u((s=null!=(s=n.id||(null!=t?t.id:t))?s:c,typeof s===d?s.call(l,{name:"id",hash:{},data:a}):s))+'"><label for="resize_page_id_opt_'+u((s=null!=(s=n.id||(null!=t?t.id:t))?s:c,typeof s===d?s.call(l,{name:"id",hash:{},data:a}):s))+'">'+u(e.lambda(null!=r[1]?r[1].name:r[1],t))+": "+u((s=null!=(s=n.name||(null!=t?t.name:t))?s:c,typeof s===d?s.call(l,{name:"name",hash:{},data:a}):s))+"</label></div>"},15:function(e,t,n,i,a){return"  disabled"},17:function(e,t,n,i,a,o,r){var s;return"<option"+(null!=(s=(n.eq||t&&t.eq||n.helperMissing).call(null!=t?t:e.nullContext||{},t,null!=(s=null!=r[1]?r[1].format:r[1])?s.unit:s,{name:"eq",hash:{},fn:e.program(18,a,0,o,r),inverse:e.noop,data:a}))?s:"")+">"+e.escapeExpression(e.lambda(t,t))+"</option>"},18:function(e,t,n,i,a){return" selected"},compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a,o,r){var s,l,c,d=null!=t?t:e.nullContext||{},u=n.helperMissing,p=e.escapeExpression,h=e.lambda,m="function",f=n.blockHelperMissing,g='<li class="page-size" data-popover="tooltip" data-placement="top" data-original-title="'+p((n.t||t&&t.t||u).call(d,"bottom_submenu.size.format",{name:"t",hash:{},data:a}))+'">\n  <span>'+p(h(null!=(s=null!=t?t.format:t)?s.width:s,t))+"x"+p(h(null!=(s=null!=t?t.format:t)?s.height:s,t))+p(h(null!=(s=null!=t?t.format:t)?s.unit:s,t))+" - "+p(h(null!=(s=null!=t?t.format:t)?s.name:s,t))+'</span>\n</li>\n\n<li data-popover="tooltip" data-placement="top" data-original-title="'+p((n.t||t&&t.t||u).call(d,"editor.resize",{name:"t",hash:{},data:a}))+'">\n  <a class="resize btn btn-gray">\n    <i class="icon-photo_size_select_large"></i>\n  </a>\n</li>\n\n<div class="ui-dropdown-content">\n';return l=null!=(l=n.groups||(null!=t?t.groups:t))?l:u,c={name:"groups",hash:{},fn:e.program(1,a,0,o,r),inverse:e.noop,data:a},s=typeof l===m?l.call(d,c):l,n.groups||(s=f.call(t,s,c)),null!=s&&(g+=s),g+='\n  <div class="page-size-group">\n    <input type="radio" name="page-size" class="format"'+(null!=(s=n["if"].call(d,null!=(s=null!=t?t.format:t)?s.id:s,{name:"if",hash:{},fn:e.program(5,a,0,o,r),inverse:e.noop,data:a}))?s:"")+'/>\n\n    <section class="format'+(null!=(s=n["if"].call(d,null!=(s=null!=t?t.format:t)?s.id:s,{name:"if",hash:{},fn:e.program(7,a,0,o,r),inverse:e.program(9,a,0,o,r),data:a}))?s:"")+'">\n        <div class="header">'+p((n.t||t&&t.t||u).call(d,"bottom_submenu.size.resize_to",{name:"t",hash:{},data:a}))+'</div>\n        <div class="body">\n',l=null!=(l=n.groups||(null!=t?t.groups:t))?l:u,c={name:"groups",hash:{},fn:e.program(11,a,0,o,r),inverse:e.noop,data:a},s=typeof l===m?l.call(d,c):l,n.groups||(s=f.call(t,s,c)),null!=s&&(g+=s),g+='        </div>\n    </section>\n  </div>\n\n  <div class="page-size-group">\n    <input type="radio" name="page-size" class="custom"'+(null!=(s=n["if"].call(d,null!=(s=null!=t?t.format:t)?s.id:s,{name:"if",hash:{},fn:e.noop,inverse:e.program(5,a,0,o,r),data:a}))?s:"")+"/>\n    <label>"+p((n.t||t&&t.t||u).call(d,"bottom_submenu.size.custom",{name:"t",hash:{},data:a}))+'</label>\n\n    <section>\n      <input type="text" class="size page-width small'+(null!=(s=n["if"].call(d,null!=(s=null!=t?t.format:t)?s.id:s,{name:"if",hash:{},fn:e.program(15,a,0,o,r),inverse:e.noop,data:a}))?s:"")+'" placeholder="'+p((n.t||t&&t.t||u).call(d,"editor.width",{name:"t",hash:{},data:a}))+'" value="'+p(h(null!=(s=null!=t?t.format:t)?s.width:s,t))+'"/>\n      <span>x</span>\n      <input type="text" class="size page-height small'+(null!=(s=n["if"].call(d,null!=(s=null!=t?t.format:t)?s.id:s,{name:"if",hash:{},fn:e.program(15,a,0,o,r),inverse:e.noop,data:a}))?s:"")+'" placeholder="'+p((n.t||t&&t.t||u).call(d,"editor.height",{name:"t",hash:{},data:a}))+'" value="'+p(h(null!=(s=null!=t?t.format:t)?s.height:s,t))+'"/>\n      <select class="unit'+(null!=(s=n["if"].call(d,null!=(s=null!=t?t.format:t)?s.id:s,{name:"if",hash:{},fn:e.program(15,a,0,o,r),inverse:e.noop,data:a}))?s:"")+'">\n        ',l=null!=(l=n.units||(null!=t?t.units:t))?l:u,c={name:"units",hash:{},fn:e.program(17,a,0,o,r),inverse:e.noop,data:a},s=typeof l===m?l.call(d,c):l,n.units||(s=f.call(t,s,c)),null!=s&&(g+=s),g+'\n      </select>\n    </section>\n  </div>\n\n  <div>\n    <a class="btn btn-yellow do-resize">\n      '+p((n.t||t&&t.t||u).call(d,"bottom_submenu.size.apply",{name:"t",hash:{},data:a}))+"\n    </a>\n  </div>\n</div>\n"},useData:!0,useDepths:!0})},{"hbsfy/runtime":535}],152:[function(e,t,n){var i=e("../../../facade/design/design"),a=e("../../../factory/formats"),o=e("../../../analytics/decorate"),r=e("../../../facade/restrictions/decorate");t.exports=r(e("../restrict/size"),o(e("../analytics/size"),Backbone.mixin(Backbone.View.extend({template:e("./size.hbs"),events:{"click section.format":"showResizeMenu","click a.btn.resize":"showResizeEvent","ifToggled [type=radio]":"togglePageSizeEvent","change .size":"sizeChangeEvent","change select.unit":"sizeChangeEvent","click .do-resize":"doResizeEvent"},showResizeMenu:function(e){var t=this.$el.find("section.format");t.toggleClass("active")},showResizeEvent:function(e){var t=this.$el.find("li.page-size");this.$el.find("[type=checkbox]").iCheck("uncheck");var n=this.$el.find(".ui-dropdown-content"),i=$(window).width()-(t.offset().left+t.outerWidth());n.show().css("right",i)},togglePageSizeEvent:function(e){var t=this.$el.find("input.format"),n=this.$el.find("input.custom"),i=t.is(":checked");this.$el.find("section.format").toggleClass("disabled",!i),this.$el.find("section.format").toggleClass("active",i);var a=n.is(":checked");this.$el.find("input.size").toggleClass("disabled",!a),this.$el.find("select.unit").toggleClass("disabled",!a)},sizeChangeEvent:function(){var e=40,t=5e3,n=INKIVE.Helpers.convertPixelsToUnits,i=INKIVE.Helpers.convertUnitsToPixels,a=this.$el.find("select.unit").val(),o="px"==a;this.$el.find("input.size").each(function(){var r=$(this).val();r=(o?parseInt(r):parseFloat(r))||0;var s=i(r,a);s>t?r=n(t,a):s<e&&(r=n(e,a)),$(this).val(Math.round(100*r)/100)})},doResizeEvent:function(){var t=e("./resize");t.call(this)},initialize:function(){_.bindAll(this,"render","updateCurrentPageInfo"),this.tool=INKIVE.Tool.getInstance(),this.editor=this.tool.editor,i.on("template.update.size",this.updateCurrentPageInfo),i.on("template.update.designed",this.updateCurrentPageInfo)},render:function(e,t){var n=_.uniq(_.pluck(_.flatten(_.pluck(t,"data")),"unit"));e=e||a.getCurrentSize(),e.unit=e.unit||"px",e.name=e.name||INKIVE.TranslateHelper.translate("bottom_submenu.size.custom"),this.$el.html(this.template({format:e,groups:t,units:n})),this.$el.find("[type=checkbox]").iCheck({checkboxClass:"icheckbox_square-yellow"}),this.initDropdown(),INKIVE.Helpers.initTooltips(this.$el),this.trigger("render")},initDropdown:function(){this.$el.find("[type=radio]").iCheck({radioClass:"iradio_square-yellow"})},updateCurrentPageInfo:function(){var e=a.getCurrentFormat(),t=a.getGroups();$.when(e,t).then(this.render)}}),Backbone.Events)))},{"../../../analytics/decorate":5,"../../../facade/design/design":34,"../../../facade/restrictions/decorate":90,"../../../factory/formats":101,"../analytics/size":146,"../restrict/size":156,"./resize":150,"./size.hbs":151}],153:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){var o=null!=t?t:e.nullContext||{},r=n.helperMissing,s=e.escapeExpression;return'<li>\n    <a class="btn btn-gray out" data-popover="tooltip" data-placement="top" data-original-title="'+s((n.t||t&&t.t||r).call(o,"editor.zoom_out",{name:"t",hash:{},data:a}))+'"><i class="desygner-icon-zoom-out"></i></a>\n</li><li class="border-left">\n    <a class="btn btn-gray custom" style="padding-left: 10px;width: 70px;" data-popover="tooltip" data-placement="top" data-original-title="'+s((n.t||t&&t.t||r).call(o,"bottom_submenu.zoom.custom",{name:"t",hash:{},data:a}))+'">\n        <span class="percent">100</span>%<i class="icon-chevron-up"></i>\n    </a>\n</li><li class="border-left">\n    <a class="btn btn-gray in" data-popover="tooltip" data-placement="top" data-original-title="'+s((n.t||t&&t.t||r).call(o,"editor.zoom_in",{name:"t",hash:{},data:a}))+'"><i class="desygner-icon-zoom-in"></i></a>\n</li>\n\n<div class="ui-dropdown-content custom-zoom"><ul>\n    <li><a data-value="10">10%</a></li>\n    <li><a data-value="25">25%</a></li>\n    <li><a data-value="50">50%</a></li>\n    <li><a data-value="75">75%</a></li>\n    <li><a data-value="100">100%</a></li>\n    <li><a data-value="125">125%</a></li>\n    <li><a data-value="150">150%</a></li>\n    <li><a data-value="175">175%</a></li>\n    <li><a data-value="200">200%</a></li>\n    <li><a data-value="500">500%</a></li>\n    <li><a data-value="fit">'+s((n.t||t&&t.t||r).call(o,"bottom_submenu.zoom.fit",{name:"t",hash:{},data:a}))+'</a></li>\n    <li><a data-value="original">'+s((n.t||t&&t.t||r).call(o,"bottom_submenu.zoom.original",{name:"t",hash:{},data:a}))+"</a></li>\n</ul></div>\n"},useData:!0})},{"hbsfy/runtime":535}],154:[function(e,t,n){var i=e("./zoom.hbs"),a=e("../../../analytics/decorate"),o=e("../../../facade/editor/editor");t.exports=a(e("../analytics/zoom"),Backbone.View.extend({events:{"click div.custom-zoom li a":"customZoomEvent","click a.btn.custom":"showCustomEvent","click a.btn.in":"zoomInEvent","click a.btn.out":"zoomOutEvent"},showCustomEvent:function(e){var t=this.$el.find("a.btn.custom"),n=this.$el.find(".ui-dropdown-content"),i=$(window).width()-(t.offset().left+t.outerWidth());n.show().css("right",i)},customZoomEvent:function(e){var t=$(e.target),n=this.$el.find(".ui-dropdown-content"),i=t.attr("data-value");"fit"==i?o.handle("zoom","fit"):"original"==i?o.handle("zoom","original"):o.handle("zoom","set",{zoom:parseInt(i)/100}),n.hide()},zoomInEvent:function(e){o.handle("zoom","in")},zoomOutEvent:function(e){o.handle("zoom","out")},initialize:function(){this.render()},render:function(){this.$el.html(i())}}))},{"../../../analytics/decorate":5,"../../../facade/editor/editor":76,"../analytics/zoom":147,"./zoom.hbs":153}],155:[function(e,t,n){var i=e("../../../factory/company").instance,a=e("../../../facade/editor/editor"),o=e("../../../facade/restrictions/restrictions");t.exports={initialize:function(){this.tool=INKIVE.Tool.getInstance(),this.editor=this.tool.editor,_.bindAll(this,"updateCurrentPageInfo","initDeleteOption","toggleDeleteOption"),this.render(),this.$el.find(".btn.delete").parent().addClass("disabled"),a.once("page.move_to",this.initDeleteOption)},initDeleteOption:function(){i.get("designs",INKIVE.C.BOOK.encodedId).then(function(e){return i.get("templates",e.template)}).then(_.bind(function(e){this.templateInfo=e,this.canChangePageOrder=o.isFunctionalityAllowed("function_change_page_order"),this.toggleDeleteOption(),a.on("page.move_to",this.toggleDeleteOption)},this))},toggleDeleteOption:function(){if(this.templateInfo){var e=this.canChangePageOrder||this.templateInfo.pages.length<INKIVE.Tool._current_page_number;this.$el.find(".btn.delete").parent().toggleClass("disabled",!e)}}}},{"../../../facade/editor/editor":76,"../../../facade/restrictions/restrictions":94,"../../../factory/company":98}],156:[function(e,t,n){var i=e("../../../factory/formats");t.exports={showResizeMenu:$.noop,doResizeEvent:$.noop,showResizeEvent:$.noop,render:function(e,t){var n=_.uniq(_.pluck(_.flatten(_.pluck(t,"data")),"unit"));e=e||i.getCurrentSize(),e.unit=e.unit||"px",this.$el.html(this.template({format:e,groups:t,units:n})),this.$el.find(".btn.resize").parent().hide(),this.$el.find(".page-size").css("border-right","none"),INKIVE.Helpers.initTooltips(this.$el),this.trigger("render")}}},{"../../../factory/formats":101}],157:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){return'<div class="margin"></div><!--\n--><ul class="tool-page"></ul><!--\n--><ul class="tool-size"></ul><!--\n--><ul class="tool-zoom"></ul>\n'},useData:!0})},{"hbsfy/runtime":535}],158:[function(e,t,n){var i=e("./template.hbs"),a=e("./contents/page"),o=e("./contents/zoom"),r=e("./contents/size"),s=e("../../facade/editor/editor"),l=e("../../facade/design/design"),c=e("../../facade/project/project");t.exports=Backbone.View.extend({initialize:function(){_.bindAll(this,"setMenuSize","updateCurrentPageInfo"),c.on("design.removed",this.updateCurrentPageInfo),c.on("design.copied",this.updateCurrentPageInfo),c.on("design.added",this.updateCurrentPageInfo),s.on("page.move_to",this.updateCurrentPageInfo),l.on("template.update.designed",this.updateCurrentPageInfo),this.render()},render:function(){this.$el.html(i()),this.pageView=new a({el:this.$el.find(".tool-page")}),this.zoomView=new o({el:this.$el.find(".tool-zoom")}),this.sizeView=new r({el:this.$el.find(".tool-size")}),$(window).resize(_.bind(function(){this.setMenuSize(),_.debounce(this.setMenuSize,1e3)},this)),this.sizeView.on("render",_.bind(function(){this.setMenuSize(),INKIVE.EditorFacade.handle("zoom","fit")},this)),this.setMenuSize()},setMenuSize:function(){var e=this.$el.children(".tool-size"),t=e.is(":visible"),n=t?e:this.$el.children(".margin"),i=$("#canvas-panel").width(),a=$(".pages-button-container").outerWidth(),o=this.$el.outerWidth()-n.width();n.width(i-a-o)},updateCurrentPageInfo:function(){this.sizeView.updateCurrentPageInfo(),this.pageView.updateCurrentPageInfo()}})},{"../../facade/design/design":34,"../../facade/editor/editor":76,"../../facade/project/project":89,"./contents/page":149,"./contents/size":152,"./contents/zoom":154,"./template.hbs":157}],159:[function(e,t,n){var i=e("../../../../bower_components/tinycolor/tinycolor"),a=e("../../factory/library"),o=e("../../factory/library/library-populator"),r=e("./palette-selector.hbs"),s=e("../../utils/advice"),l=function(){this.$addColorButton=null,this.selectedColor=null,this.$wrapper=null,this.callback=null,this.libraryColors=null,this.libraryPalettes=[],this.$elem=null};l.prototype.isLibraryShown=!1,l.prototype=new l,l.prototype.constructor=l,l.prototype.initialize=function(e,t){var n=$.Deferred();return this.hasLibrary=e,this.editor=INKIVE.Tool.getInstance().editor,this.$elem=t,this.hasLibrary||n.resolve(),this.hasLibrary&&INKIVE.LibraryFactory.get("palettes").then(_.bind(function(e){this.libraryPalettes=e,INKIVE.LibraryFactory.get("colors").then(_.bind(function(e){this.libraryPalettes.unshift({id:0,data:{colors:_.reject(e,function(e){return e.data.palette}),name:INKIVE.TranslateHelper.translate("tool.library.default_palette")}}),n.resolve()},this))},this),n.resolve),_.bindAll(this,"favColors","renderColors","setColor","addColor","getColorHtml","addColorPicker","addColorToList","addColorToLibrary","selectPaletteEvent"),n.promise()},l.prototype.favColors=function(e,t){this.callback=t,e.css({"overflow-y":"initial","overflow-x":"initial"}),this.$wrapper=e.find(".colorLineWrapper"),this.renderColors(),this.addColorPicker(),$("#jpickerWrapper"+this.$wrapper.parents("a").attr("type")).on("color-picker-loaded",_.bind(function(e){this.selectedColor=this.$wrapper.parents("a").find("[name=hex]").val()},this)),this.toggleLibraryColors(!0)},l.prototype.renderColors=function(){if(this.$wrapper.empty(),this.hasLibrary){this.$wrapper.append('<div class="ui-dropdown-content-title color-title library-title">'+INKIVE.TranslateHelper.translate("popupmenu.dropdown_title.library_colors")+'<i class="title-arrow desygner-icon-arrow-down"></i></div>');var e=$('<div class="library-colors-container"></div>');this.$wrapper.append(e),e.append(r(_.map(this.libraryPalettes,function(e){return{key:e.id,tag:e.data.name}})));var t=e.find(".palette-container>select");t.val(INKIVE.LibraryFactory.popupMenuColorPalette),t.on("change",this.selectPaletteEvent),this.selectPaletteEvent(),e.before('<div class="library-loader"/>'),this.$wrapper.append('<div class="horizontal-separator"></div>')}var n=_.difference(this.editor.getEditorUsedColors(),this.libraryColors);this.$wrapper.append('<div class="ui-dropdown-content-title color-title template-title">'+INKIVE.TranslateHelper.translate("popupmenu.dropdown_title.template_colors")+(this.hasLibrary?'<i class="title-arrow desygner-icon-arrow-up"></i>':"")+"</div>");var i=$('<div class="template-colors-container"></div>');this.$wrapper.append(i),n=_.last(n,5),_.each(n,_.bind(function(e){this.addColor(e,"editor",i)},this)),this.recentColors=_.difference(this.editor.getFavColors(),n),this.recentColors=_.last(this.recentColors,4),_.each(this.recentColors,_.bind(function(e){this.addColor(e,"recent",i)},this));var a=$('<div class="palette-item addmore-recent-color addmore" data-attr="fill fill-opacity" data-title="'+INKIVE.TranslateHelper.translate("popupmenu.color_picker.add_more_recent")+'"><i class="icon-plus"></i></div>');i.append(a),a.off("click").on("click",this.addColorToList),this.hasLibrary&&this.$wrapper.find(".color-title").off("click").on("click",_.bind(function(){return this.toggleLibraryColors(),!1},this)),INKIVE.Helpers.initTooltips(this.$wrapper,{placement:"bottom"})},l.prototype.addColorToList=function(e,t){if(!this.selectedColor)return!1;t||this.editor.setFavColor(this.selectedColor);var n=this.$wrapper.parents("a").attr("type");INKIVE.EditorFacade.editor.clearSelection(),INKIVE.EditorFacade.select(this.$elem.attr("id")),this.$elem.is(".subelement")&&INKIVE.Menus.elementPopupMenu.render(this.$elem);var i=$('[data-action="colormap-circle"][type='+n+"]");return i.find("input[type=hidden]").val(this.selectedColor),i.trigger("click",{keepHidden:e}),e===!0&&void i.find(".palette-item[data-color="+this.selectedColor+"]").trigger("click",{keepHidden:e})},l.prototype.addColorToLibrary=function(){function e(e){e&&l.data.colors.push(e.attributes),this.addColorToList(!0,!0),s.show("add-to-library-success")}function t(e){INKIVE.Modal.loaderClose(this.$wrapper.find(".library-loader")),n.css("opacity",1),o.onError(e)}if(!this.selectedColor)return!1;var n=this.$wrapper.find(".library-colors-container");n.is(":visible")?(n.css("opacity",0),INKIVE.Modal.loader(this.$wrapper.find(".library-loader"))):INKIVE.Modal.togglePageLoader(!0);var r={color_code:this.selectedColor,is_dark:i(this.selectedColor).isDark()},l=_.findWhere(this.libraryPalettes,{id:parseInt(INKIVE.LibraryFactory.popupMenuColorPalette)});return l.id&&(r.palette=l.data.id),o.ensureUniquenes("color",r).then(o.wrappResource,_.bind(t,this,"add-to-library-duplicity")).then(_.bind(function(n){return a.post("colors",n).then(_.bind(e,this),_.bind(t,this))},this)).always(_.partial(INKIVE.Modal.togglePageLoader,!1)),!1},l.prototype.setColor=function(e){return this.selectedColor=_.isString(e)?e.toUpperCase():null,e},l.prototype.addColor=function(e,t,n){var i=this.getColorHtml(e,t);n.append(i),$(i).off("click").on("click",_.partial(this.callback||$.noop,i))},l.prototype.getColorHtml=function(e,t){var n=INKIVE.TranslateHelper.translate("popupmenu.color_picker.thumb."+t,{color:e}),i="NONE"===e?"":'style="background: '+e+';"';return $('<div class="palette-item" data-attr="fill fill-opacity" data-color-type="'+t+'" data-color="'+e+'"><span '+i+' data-popover="tooltip" title="'+n+'" data-original-title="'+n+'" data-title="'+n+'"></span></div>')},l.prototype.addColorPicker=function(){var e=this.$wrapper.parent();e.append('<div class="horizontal-separator"></div>'),e.append('<div class="ui-dropdown-content-title color-title">'+INKIVE.TranslateHelper.translate("popupmenu.dropdown_title.choose_color")+"</div>"),e.append('<div class="colorpicker-container"/>'),e.find(".colorpicker-container").colorpicker({isInline:!0,selectedElement:this.$elem,defaultColor:e.parents("a").find("[name=hex]").val(),onSubmit:_.bind(function(e,t,n){var i=this.$wrapper.siblings(".colorpicker-container").find(".color-selector-input").val()?e:"";if(i&&"none"!==e||(i=e),this.setColor(i),n&&this.addColorToLibrary(),n||this.addColorToList(!0),!i)return!1},this),onChange:this.setColor,onCancel:_.bind(function(){this.$addColorButton.remove()},this)}),e.append('<div class="horizontal-separator color-separator"/>')},l.prototype.toggleLibraryColors=function(e){e||(l.prototype.isLibraryShown=this.isLibraryShown=!this.isLibraryShown);var t=this.isLibraryShown?"library":"template",n=this.isLibraryShown?"template":"library";this.$wrapper.find(".title-arrow").removeClass("desygner-icon-arrow-down desygner-icon-arrow-up"),this.$wrapper.find("."+n+"-colors-container").slideUp(),this.$wrapper.find("."+t+"-colors-container").slideDown(),this.$wrapper.find("."+t+"-title .title-arrow").addClass("desygner-icon-arrow-up"),this.$wrapper.find("."+n+"-title .title-arrow").addClass("desygner-icon-arrow-down"),this.$wrapper.find(".palettes").val(INKIVE.LibraryFactory.popupMenuColorPalette).trigger("change")},l.prototype.selectPaletteEvent=function(e){e&&(INKIVE.LibraryFactory.popupMenuColorPalette=$(e.target).val());var t=this.$wrapper.find(".library-colors-container"),n=_.findWhere(this.libraryPalettes,{id:parseInt(INKIVE.LibraryFactory.popupMenuColorPalette)}).data.colors;t.find(".palette-item").remove(),this.libraryColors=_(n).chain().pluck("data").pluck("color_code").value(),this.libraryColors=_.last(this.libraryColors.map(function(e){return e.toUpperCase()}),9),_.each(this.libraryColors,_.bind(function(e){this.addColor(e,"library",t)},this));var i=$('<div class="palette-item addmore addmore-library-color" data-attr="fill fill-opacity" data-popover="tooltip" data-title="'+INKIVE.TranslateHelper.translate("popupmenu.color_picker.add_more_library")+'"><i class="icon-plus"></i></div>');t.append(i),i.off("click").on("click",this.addColorToLibrary)},t.exports=l},{"../../../../bower_components/tinycolor/tinycolor":3,"../../factory/library":103,"../../factory/library/library-populator":110,"../../utils/advice":477,"./palette-selector.hbs":160}],160:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({1:function(e,t,n,i,a){var o,r=null!=t?t:e.nullContext||{},s=n.helperMissing,l="function",c=e.escapeExpression;return'      <option value="'+c((o=null!=(o=n.key||(null!=t?t.key:t))?o:s,typeof o===l?o.call(r,{name:"key",hash:{},data:a}):o))+'">\n        '+c((o=null!=(o=n.tag||(null!=t?t.tag:t))?o:s,typeof o===l?o.call(r,{name:"tag",hash:{},data:a}):o))+"\n      </option>\n"},compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){var o;return'<div class="palette-container">\n  <select class="palettes">\n'+(null!=(o=n.each.call(null!=t?t:e.nullContext||{},t,{name:"each",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a}))?o:"")+"  </select>\n</div>"},useData:!0})},{"hbsfy/runtime":535}],161:[function(e,t,n){var i=e("../factory/library/library-populator");t.exports={items:{},handledElement:null,canvas:null,isUserPremium:!1,lastAction:null,textArea:null,copiedText:null,handleContextMenu:function(e){if(!this.canvas){var t=INKIVE.Tool.getInstance().editor;this.canvas=t.canvas,this.textArea=$(t.curConfig.initText.input).get(0)}this.getHandledElement(e),(2===e.button||0===e.button&&e.ctrlKey)&&(this.handledElement?("svgroot"===this.handledElement.id||this.canvas.selectorManager.requestSelector(this.handledElement).showGrips(!1),INKIVE.UserInfoFactory.get().then(_.bind(function(e){this.isUserPremium=_(e.roles).contains("ROLE_PREMIUM"),this.populateMenuItems(),this.applyRestrictions(),$(".menu.popupmenu").hide(),$.contextMenu({selector:"#"+this.handledElement.id,build:_.bind(function(e,t){return{callback:_.bind(function(e,n){this.handleCallback(e,n,t)},this),items:this.items}},this)}),$(this.handledElement).contextMenu(!0)},this))):($.contextMenu("destroy"),$(".context-menu-active").removeClass("icon-context-menu-active"),this.canvas.clearSelection()))},populateMenuItems:function(){function e(e){return function(t,n,i,a){n.html('<i class="'+e+'"></i><span>'+a.name+"</span>")}}var t=this.canvas.getSelectedElems(),n=$(this.handledElement);if(this.items={},"textedit"!==this.canvas.getMode()&&(this.copiedText=null),this.items.copy={name:INKIVE.TranslateHelper.translate("editor.contextmenu.copy"),icon:e("icon-context-copy"),disabled:"svgroot"===this.handledElement.id||"textedit"===this.canvas.getMode()&&!this.getCopiedText()},this.items.cut={name:INKIVE.TranslateHelper.translate("editor.contextmenu.cut"),icon:e("icon-context-cut"),disabled:"svgroot"===this.handledElement.id||"textedit"===this.canvas.getMode()&&!this.getCopiedText()},this.items.paste={name:INKIVE.TranslateHelper.translate("editor.contextmenu.paste"),icon:e("icon-context-paste"),disabled:!(this.canvas.clipBoard.length&&$(this.handledElement).is("#svgroot")||this.copiedText)},!n.is("#svgroot")&&"textedit"!==this.canvas.getMode())switch(this.items.sep1="---------",this.items.fold_z_index={name:INKIVE.TranslateHelper.translate("popupmenu.tooltip.order")},this.items.fold_z_index.items={bring_to_front:{name:INKIVE.TranslateHelper.translate("popupmenu.tooltip.send_top"),icon:e("icon-context-send-to-front")},send_to_back:{name:INKIVE.TranslateHelper.translate("popupmenu.tooltip.send_bottom"),icon:e("icon-context-send-to-back")},bring_item_forward:{name:INKIVE.TranslateHelper.translate("popupmenu.tooltip.send_forward"),icon:e("icon-context-send-forward")},send_item_backwards:{name:INKIVE.TranslateHelper.translate("popupmenu.tooltip.send_backward"),icon:e("icon-context-send-backward")}},_.contains([INKIVE.C.BOOK_TYPE.TEMPLATE,INKIVE.C.BOOK_TYPE.RESTRICTED_DESIGN],INKIVE.C.BOOK.book_type)||(this.items.sep2="---------",this.items.group={name:INKIVE.TranslateHelper.translate("popupmenu.dropdown_title.group_group"),icon:e("icon-context-group"),disabled:1===t.length},this.items.ungroup={name:INKIVE.TranslateHelper.translate("popupmenu.dropdown_title.group_ungroup"),icon:e("icon-context-ungroup"),disabled:1!==t.length||!n.is(".group")}),this.items.sep3="---------",this.items.lock_movement={name:INKIVE.TranslateHelper.translate("editor.contextmenu.lock_movement"),icon:e("icon-context-lock"),disabled:n.is(".locked")},this.items.unlock_movement={name:INKIVE.TranslateHelper.translate("editor.contextmenu.unlock_movement"),icon:e("icon-context-unlock"),disabled:!n.is(".locked")},this.getAddToLibraryProperties(t[0]),INKIVE.C.BOOK.book_type){case INKIVE.C.BOOK_TYPE.TEMPLATE:this.items.sep4="---------",this.items.add_to_brand_assets={name:INKIVE.TranslateHelper.translate("editor.contextmenu.add_to_brand_assets"),icon:e("icon-context-brandasset"),disabled:!this.isAddToLibraryAllowed},this.items.sep5="---------",this.items.restrict={name:INKIVE.TranslateHelper.translate("editor.contextmenu.restrict"),icon:e("icon-context-restrict")};break;case INKIVE.C.BOOK_TYPE.DESIGN:case INKIVE.C.BOOK_TYPE.DESYGNER_DESIGN:this.items.sep4="---------",this.items.add_to_personal_library={name:INKIVE.TranslateHelper.translate("editor.contextmenu.add_to_personal_library"),icon:e("icon-context-personal-folder"),disabled:!this.isUserPremium||!this.isAddToLibraryAllowed}}},getAddToLibraryProperties:function(e){var t=["sticker","text","image","logo","icon","video"],n=INKIVE.DesignFacade.get($(e).is(".background")?"background":e.getAttribute("id"));this.isAddToLibraryAllowed=t.indexOf(n.type)>-1},handleCallback:function(e,t,n){switch(e){case"lock_movement":INKIVE.DesignFacade.set({locked:!0});break;case"unlock_movement":INKIVE.DesignFacade.set({locked:!1});break;case"copy":"textedit"===this.canvas.getMode()?this.copiedText=this.getCopiedText():this.canvas.copySelectedElements();break;case"cut":"textedit"===this.canvas.getMode()?(this.copiedText=this.getCopiedText(),this.redrawText(!1)):this.canvas.cutSelectedElements();break;case"paste":"textedit"===this.canvas.getMode()?this.redrawText(!0):this.canvas.pasteElements("icon-context-menu",this.canvas.lastClickPoint.x,this.canvas.lastClickPoint.y);break;case"group":INKIVE.DesignFacade.create("group");break;case"ungroup":INKIVE.DesignFacade.handle("ungroup"),this.canvas.clearSelection();break;case"bring_to_front":INKIVE.DesignFacade.handle(this.handledElement.id,"send_top");break;case"send_to_back":INKIVE.DesignFacade.handle(this.handledElement.id,"send_bottom");break;case"bring_item_forward":INKIVE.DesignFacade.handle(this.handledElement.id,"send_forward");break;case"send_item_backwards":INKIVE.DesignFacade.handle(this.handledElement.id,"send_backward");break;case"restrict":$('.tool-menu li > a[href="#tabRestrictions"]').trigger("click");break;case"add_to_personal_library":case"add_to_brand_assets":i.addElementToLibrary(this.handledElement)}this.lastAction=e},getCopiedText:function(){return this.textArea.value.substring(this.textArea.selectionStart,this.textArea.selectionEnd)},redrawText:function(e){var t,n;t=this.textArea.value.substring(0,this.textArea.selectionStart),e&&(t+=this.copiedText),n=t.length,t+=this.textArea.value.substring(this.textArea.selectionEnd),this.textArea.value=t,this.textArea.selectionStart=this.textArea.selectionEnd=n,$(this.textArea).trigger("keyup",{forceRedraw:!0})},applyRestrictions:function(){var e=INKIVE.RestrictionsFacade;e.canChange(this.handledElement,"z_index")||this.items.fold_z_index&&(this.items.fold_z_index.disabled=!0),e.canChange(this.handledElement,"position")||(this.items.lock_movement&&(this.items.lock_movement.disabled=!0),this.items.unlock_movement&&(this.items.unlock_movement.disabled=!0),this.items.cut&&(this.items.cut.disabled=!0)),e.canChange(this.handledElement,"duplication")||(this.items.copy&&(this.items.copy.disabled=!0),this.items.cut&&(this.items.cut.disabled=!0)),e.canChange(this.handledElement,"deletion")||this.items.cut&&(this.items.cut.disabled=!0)},getHandledElement:function(e){var t=INKIVE.Tool.getInstance().editor,n=t.isClickInsideEditor(e.clientX,e.clientY),i=$(e.target).is("#context-menu-layer"),a=null;if($(".element").each(function(n,i){t.isElementClicked(i,e)&&(a=i)}),n)if(a){this.handledElement=a;var o=_.contains(this.canvas.getSelectedElems(),a);o||this.canvas.selectOnly([a],!1),i&&($(".menu.popupmenu").show(),this.canvas.selectorManager.requestSelector(this.handledElement).showGrips(!0))}else this.canvas.clearSelection(),this.handledElement=$("#svgroot")[0];else this.handledElement=null}}},{"../factory/library/library-populator":110}],162:[function(e,t,n){var i="default",a=null,o={"default":e("./editor-modes/default"),template:e("./editor-modes/template"),sticker:e("./editor-modes/sticker"),banner:e("./editor-modes/banner"),placeholder:e("./editor-modes/placeholder"),logo:e("./editor-modes/logo"),restrict:e("./editor-modes/restrict"),brand_template:e("./editor-modes/brand-template")},r={};_.each(o,function(e,t){r[t]=new e}),t.exports={setMode:function(e,t){r[e]&&(r[i].disable(),i=e,a=t,r[e].enable(t))},getMode:function(){return i},getData:function(){return a},isMode:function(e){return i===e}}},{"./editor-modes/banner":163,"./editor-modes/brand-template":164,"./editor-modes/default":165,"./editor-modes/logo":166,"./editor-modes/placeholder":167,"./editor-modes/restrict":168,"./editor-modes/sticker":169,"./editor-modes/template":170}],163:[function(e,t,n){function i(){this.type="banner"}var a=e("./sticker");i.prototype=new a,t.exports=i},{"./sticker":169}],164:[function(e,t,n){function i(){this.type="brand_template",this.hideList=["#pages-panel","#bottom-submenu > .tool-page","#bottom-submenu > .tool-size"]}var a=e("./default"),o=e("../../factory/company").instance;i.prototype=new a,i.prototype.enableUI=function(){a.prototype.enableUI.call(this),$('.tool-menu a[role="tab"][href="#tabAdmin"]').parent().hide(),$('.tool-menu a[role="tab"][href="#tabSettings"]').parent().hide(),$("#bottom-submenu .duplicate").parent().hide(),$("#bottom-submenu .delete").parent().hide(),$('.tool-menu a[role="tab"][href="#tabLayouts"]').parent().hide();
},i.prototype.disableUI=function(){a.prototype.disableUI.call(this),$('.tool-menu a[role="tab"][href="#tabAdmin"]').parent().show(),$('.tool-menu a[role="tab"][href="#tabSettings"]').parent().show(),$("#bottom-submenu .duplicate").parent().show(),$("#bottom-submenu .delete").parent().show(),$('.tool-menu a[role="tab"][href="#tabLayouts"]').parent().show()},i.prototype.afterUIEnable=function(e){o.get("templates",INKIVE.C.BOOK.encodedId).then(function(e){if(e.is_multipage){$('.tool-menu a[role="tab"][href="#tabLayouts"]').parent().show(),$("#bottom-submenu .duplicate").parent().show(),$("#bottom-submenu .delete").parent().show(),$("#pages-panel").show(),$("#bottom-submenu > .tool-page").show(),$("#pages-panel .page-order-show").trigger("click"),$(window).trigger("resize");var t=0===$("#svgroot .main").find(":not(title)").length;t&&$('.tool-menu a[role="tab"][href="#tabLayouts"]').trigger("click")}})},t.exports=i},{"../../factory/company":98,"./default":165}],165:[function(e,t,n){function i(){this.type="default",this.hideList=[],this.showList=[],this.enableList=[],this.disableList=[]}i.prototype.initialize=function(){this.initialized=!0,this.tool=INKIVE.Tool.getInstance(),this.editor=this.tool.editor,this.canvas=this.editor.canvas,_.bindAll(this,"enable","disable")},i.prototype.enable=function(e){this.initialized||this.initialize(),this.beforeUIEnable(),this.enableUI(),this.afterUIEnable(e)},i.prototype.disable=function(){this.initialized||this.initialize(),this.disableUI()},i.prototype.beforeUIEnable=function(){clearTimeout(INKIVE.Tool._autoSaveTimeout),INKIVE.Tool._autoSaveTimeout=null},i.prototype.afterUIEnable=function(e){this.canvas.runExtensions("disableRuler",{}),this.tool.load(INKIVE.Tool._current_page_number)},i.prototype.enableUI=function(){$(this.hideList.join(",")).hide(),$(this.showList.join(",")).show(),$(this.enableList.join(",")).removeClass("disabled"),$(this.disableList.join(",")).addClass("disabled")},i.prototype.disableUI=function(){$(this.hideList.join(",")).show(),$(this.showList.join(",")).hide(),$(this.enableList.join(",")).addClass("disabled"),$(this.disableList.join(",")).removeClass("disabled")},t.exports=i},{}],166:[function(e,t,n){function i(){this.type="logo",this.hideList=["#pages-panel","#tool-panel .help-menu",".name.editor-header-title","#bottom-submenu > .margin","#bottom-submenu > .tool-page","#bottom-submenu > .tool-size","#bottom-submenu > .tool-zoom li:nth-child(2)","#ruler-horizontal","#ruler-vertical","#ik-grid-snap"]}var a=e("./default");i.prototype=new a,i.prototype.enableUI=function(){a.prototype.enableUI.call(this),$('.tool-menu a[role="tab"][href="#tabAdmin"]').parent().hide(),$('.tool-menu a[role="tab"][href="#tabLayouts"]').parent().hide(),$('.tool-menu a[role="tab"][href="#tabSettings"]').parent().hide()},i.prototype.disableUI=function(){a.prototype.disableUI.call(this),$('.tool-menu a[role="tab"][href="#tabAdmin"]').parent().show(),$('.tool-menu a[role="tab"][href="#tabLayouts"]').parent().show(),$('.tool-menu a[role="tab"][href="#tabSettings"]').parent().show()},i.prototype.afterUIEnable=function(e){$('.tool-menu a[role="tab"][href="#tabExtra"]').trigger("click"),this.editor.canvas.runExtensions("enableRuler",{})},t.exports=i},{"./default":165}],167:[function(e,t,n){function i(){this.type="placeholder"}var a=e("./sticker");i.prototype=new a,t.exports=i},{"./sticker":169}],168:[function(e,t,n){function i(){this.type="restrict",this.hideList=["#pages-panel","#bottom-submenu > .tool-page"]}var a=e("./default"),o=e("../../factory/company").instance,r=e("../../facade/restrictions/restrictions");i.prototype=new a,i.prototype.enableUI=function(){var e=r.isFunctionalityAllowed;a.prototype.enableUI.call(this),$("#bottom-submenu .duplicate").parent().hide(),$("#bottom-submenu .delete").parent().hide(),$('.tool-menu a[role="tab"][href="#tabImport"]').parent().hide(),$('.tool-menu a[role="tab"][href="#tabAdmin"]').parent().hide(),$('.tool-menu a[role="tab"][href="#tabLayouts"]').parent().hide(),$('.tool-menu a[role="tab"][href="#tabSettings"]').parent().hide(),e("text_add")||$('.tool-menu a[role="tab"][href="#tabText"]').parent().hide(),e("function_download_file")||$('#shr-buttons > [data-id="download"]').hide(),e("function_print_file")||$("#shr-buttons > .print").hide(),e("function_share_file")||$('#shr-buttons > [data-id="share"]').hide(),!e("function_draw")&&!e("function_use_desygner_background")&&(!e("function_use_desygner_images")||!e("image_add"))&&(!e("function_use_desygner_vector")||!e("vector_add"))&&$('.tool-menu a[role="tab"][href="#tabExtra"]').parent().hide(),!e("text_add")&&!(e("image_add")&&e("function_use_asset_images"))&&!(e("image_add")&&e("function_use_asset_logo"))&&!e("function_use_asset_colors")&&$('.tool-menu a[role="tab"][href="#tabLibrary"]').parent().hide(),!e("function_use_own_images")&&!e("function_use_web_images")&&!e("function_use_desygner_background")&&!e("function_use_asset_images")||!e("image_add")&&$('.tool-menu a[role="tab"][href="#tabImages"]').parent().hide(),!e("video_add")&&$('.tool-menu a[role="tab"][href="#tabVideo"]').parent().hide(),!(e("logo_add")&&e("function_use_asset_logo"))&&$('.tool-menu a[role="tab"][href="#tabLogos"]').parent().hide(),!e("icon_add")&&!e("vector_add")&&$('.tool-menu a[role="tab"][href="#tabIcons"]').parent().hide(),$('#tabSearch a[data-id="layout"]').parent().addClass("hidden"),(!e("function_use_web_vector")||!e("function_use_desygner_vector"))&&$('#tabSearch a[data-id="sticker"]').parent().addClass("hidden"),(!e("function_use_web_background")||!e("function_use_desygner_background"))&&$('#tabSearch a[data-id="background"]').parent().addClass("hidden"),e("function_use_web_images")&&e("image_add")||$('#tabSearch a[data-id="image"]').parent().addClass("hidden").siblings("li:not(.hidden)").first().find("a").trigger("click"),(!e("function_use_web_images")||!$("#tabSearch li:not(.hidden)").length)&&$('.tool-menu a[role="tab"][href="#tabSearch"]').parent().hide()},i.prototype.disableUI=function(){a.prototype.disableUI.call(this),$('.tool-menu a[role="tab"][href="#tabAdmin"]').parent().show(),$('.tool-menu a[role="tab"][href="#tabLayouts"]').parent().show(),$('.tool-menu a[role="tab"][href="#tabSettings"]').parent().show(),$("#bottom-submenu .duplicate").parent().show(),$("#bottom-submenu .delete").parent().show()},i.prototype.afterUIEnable=function(e){var t=r.isFunctionalityAllowed;o.get("designs",INKIVE.C.BOOK.encodedId).then(function(e){if(e.is_multipage&&($("#pages-panel").show(),$("#bottom-submenu > .tool-page").show(),$(window).trigger("resize"),INKIVE.C.BOOK.num_pages>1&&$("#pages-panel .page-order-show").trigger("click"),t("function_change_page_order")&&$("#bottom-submenu .duplicate").parent().show(),t("function_add_page")||t("function_change_page_order"))){$("#bottom-submenu .delete").parent().show(),$('.tool-menu a[role="tab"][href="#tabLayouts"]').parent().show();var n=0===$("#svgroot .main").find(":not(title)").length;n&&$('.tool-menu a[role="tab"][href="#tabLayouts"]').trigger("click")}})},t.exports=i},{"../../facade/restrictions/restrictions":94,"../../factory/company":98,"./default":165}],169:[function(e,t,n){function i(){this.type="sticker",this.disableList=["#header #shr-buttons > a:not(.save)",'.tool-menu a[role="tab"][href="#tabSettings"]','.tool-menu a[role="tab"][href="#tabLayouts"]','.tool-menu a[role="tab"][href="#tabFavourites"]','.tool-menu a[role="tab"][href="#tabImages"]','.tool-menu a[role="tab"][href="#tabSearch"]','.tool-content #tabAdmin input[name="search"]','.tool-content a[data-toggle="accordion"][href="#accordionBackgrounds"]','.tool-content #tabAdmin a[data-toggle="accordion"][href="#accordionAdminLayouts"]',".tool-content #tabAdmin .btn-new-item",'.tool-content #tabAdmin a[data-toggle="accordion"][href="#accordionAdminBackgrounds"]']}var a=e("./template");i.prototype=new a,i.prototype.afterUIEnable=function(e){this.editor.canvas.runExtensions("enableRuler",{}),this.editor.loadSvgString(Base64.decode(INKIVE.C.BLANK_SVG),_.bind(this.onBlankSVG,this,e),1e3,1e3)},i.prototype.onBlankSVG=function(e){if(e.content){var t=INKIVE.Helpers.getStickerFromString(Base64.decode(e.content));if(!t)return;var n=this.canvas.getCurrentDrawing().getCurrentLayer();n.appendChild(t);var i=this.editor.getOffset();INKIVE.Helpers.resize(t,i.width,i.height,50,50)}},t.exports=i},{"./template":170}],170:[function(e,t,n){function i(){this.type="template",this.showList=["#mode-panel"],this.hideList=["#pages-panel","#bottom-submenu > .margin","#bottom-submenu > .tool-page","#bottom-submenu > .tool-size"],this.disableList=["#header #shr-buttons > a:not(.save)",'.tool-menu a[role="tab"][href="#tabSettings"]','.tool-menu a[role="tab"][href="#tabLayouts"]','.tool-content #tabAdmin input[name="search"]',".tool-content #tabAdmin .btn-new-item",'.tool-content #tabAdmin a[data-toggle="accordion"][href="#accordionAdminBackgrounds"]','.tool-content #tabAdmin a[data-toggle="accordion"][href="#accordionAdminStickers"]']}var a=e("./default");i.prototype=new a,i.prototype.enableUI=function(){a.prototype.enableUI.call(this);var t=e("../editor-mode-manager"),n=this.tool,i=$("#mode-panel");$("#canvas-panel").addClass("mode"),i.find("span").html("close_mode."+this.type),i.find("a").on("click",function(){INKIVE.Modal.togglePageLoader(!0),n.save(null,function(){t.setMode("default"),INKIVE.Modal.togglePageLoader(!1)})})},i.prototype.disableUI=function(){a.prototype.disableUI.call(this),$("#canvas-panel").removeClass("mode"),$("#mode-panel").find("a").off("click")},i.prototype.afterUIEnable=function(e){this.editor.canvas.runExtensions("enableRuler",{}),this.editor.loadSvgString(Base64.decode(INKIVE.C.BLANK_SVG),_.bind(this.onBlankSVG,this,e),e.format_width,e.format_height)},i.prototype.onBlankSVG=function(e){if(e.content){var t={background:Base64.decode(e.background),defs:Base64.decode(e.defs),content:Base64.decode(e.content)};this.editor.addElement("layout",t),e.old_format_width&&e.old_format_height&&INKIVE.Helpers.converterLayoutSizeChange(e.format_width,e.format_height,e.old_format_width,e.old_format_height)}},t.exports=i},{"../editor-mode-manager":162,"./default":165}],171:[function(e,t,n){t.exports={VIDEO:["INCREASE","DECREASE","DUPLICATE","REMOVE","ALIGNMENT","VIDEO_SOURCE","VIDEO_AUTOPLAY","VIDEO_MUTE","VIDEO_MOVE_TO_NEXT","VIDEO_CONTROLS","VIDEO_FULLSCREEN","VIDEO_LOOP","LIBRARY_ADD","DESELECT"],TEXT_EDIT:["TEXT_FINISH_EDITING","TEXT_FONTFAMILY","TEXT_FONTSIZE","TEXT_TYPING","TEXT_BOLD","TEXT_ITALIC","TEXT_UNDERLINE","TEXT_CASE","FILL_COLOR","REMOVE_STYLE","DESELECT"],TEXT:["LINK","UNLINK","INCREASE","DECREASE","DUPLICATE","REMOVE","TEXT_FONTFAMILY","TEXT_FONTSIZE","TEXT_TYPING","OPACITY","FILL_COLOR","STROKE_COLOR","STROKE","TEXT_BOLD","TEXT_ITALIC","TEXT_UNDERLINE","TEXT_CASE","TEXT_BULLETS","TEXT_ALIGN","TEXT_SPACING","LOCK","UNLOCK","TEXT_AUTO_ADJUSTABLE","TRANSFORM","ARRANGE","ROTATE","ORDER","ALIGNMENT","LIBRARY_ADD","DESELECT"],LAYOUT:["INCREASE","DECREASE","LAYOUT_CONFIRM","LAYOUT_CLOSE","DESELECT"],IMAGE:["LINK","UNLINK","INCREASE","DECREASE","DUPLICATE","REMOVE","IMAGE_TAB","IMAGE_REPOSITION","IMAGE_CROP","IMAGE_FILTER","OPACITY","LOCK","UNLOCK","SET_BACKGROUND","TRANSFORM","ARRANGE","ROTATE","FLIP_IMAGE","ORDER","ALIGNMENT","LIBRARY_ADD","DESELECT"],STICKER:["LINK","UNLINK","IMAGE_REPOSITION","INCREASE","DECREASE","DUPLICATE","REMOVE","OPACITY","FILL_COLOR","STROKE_COLOR","STROKE","LOCK","UNLOCK","TRANSFORM","ARRANGE","ROTATE","FLIP","ORDER","ALIGNMENT","LIBRARY_ADD","DESELECT"],LOGO:["LINK","UNLINK","INCREASE","DECREASE","DUPLICATE","REMOVE","OPACITY","FILL_COLOR","STROKE_COLOR","LOCK","UNLOCK","TRANSFORM","ARRANGE","ROTATE","ORDER","ALIGNMENT","LIBRARY_ADD","DESELECT"],ICON:["LINK","UNLINK","INCREASE","DECREASE","DUPLICATE","REMOVE","OPACITY","FILL_COLOR","STROKE_COLOR","LOCK","UNLOCK","TRANSFORM","ARRANGE","ROTATE","ORDER","ALIGNMENT","LIBRARY_ADD","DESELECT"],GROUP:["LINK","UNLINK","INCREASE","DECREASE","DUPLICATE","REMOVE","GROUP_UNGROUP","OPACITY","LOCK","UNLOCK","TRANSFORM","ROTATE","LIBRARY_ADD","DESELECT"],MULTISELECT:["DUPLICATE","REMOVE","GROUP_GROUP","ARRANGE","ALIGNMENT","DESELECT"],DEFAULT:["LINK","UNLINK","INCREASE","DECREASE","DUPLICATE","REMOVE","IMAGE_BOX","OPACITY","FILL_COLOR","STROKE_COLOR","STROKE","LOCK","UNLOCK","TRANSFORM","ARRANGE","ROTATE","FLIP","ORDER","ALIGNMENT","DESELECT"],BACKGROUND:["BACKGROUND_REMOVE","BACKGROUND_COLOR_IMAGE","BACKGROUND_COLOR","BACKGROUND_OPACITY","BACKGROUND_REPOSITION","TRANSFORM","BACKGROUND_FLIP","DESELECT"],COMMON:["LINK","UNLINK","DUPLICATE","REMOVE","BACKGROUND_REMOVE","LOCK","UNLOCK","TRANSFORM","ARRANGE"],SPECIAL:["PERMISSIONS","LIBRARY_ADD","DESELECT"],ROOT:["ROOT_DRAWING","ROOT_SHAPES","ROOT_FRAMES","ROOT_TEXT"]}},{}],172:[function(e,t,n){var i=e("./templates/drawing.hbs");t.exports=Backbone.View.extend({buttons:[{tag:"editor.square",mode:"square",icon:"desygner-icon-square"},{tag:"editor.line",mode:"line",icon:"desygner-icon-line"},{tag:"editor.circle",mode:"circle",icon:"desygner-icon-circle"},{tag:"editor.pen",mode:"fhpath",icon:"desygner-icon-drawing"},{tag:"editor.rectangle",mode:"rect",icon:"desygner-icon-rectangle"},{tag:"editor.ellipse",mode:"ellipse",icon:"desygner-icon-elipse"}],initialize:function(e){_.bindAll(this,"changeModeEvent"),this.editor=INKIVE.Tool.getInstance().editor,this.$el=e,this.render()},changeModeEvent:function(e){var t=$(e.currentTarget).data("mode");$("#workarea").css("cursor","crosshair"),this.editor.clearSelection(),this.editor.setMode(t)},render:function(){this.$el.html(i(this.buttons)),this.$el.find(".drawing-tool").on("click",this.changeModeEvent)}})},{"./templates/drawing.hbs":176}],173:[function(e,t,n){var i=e("../../../tool-menu/components/accordion-list/content"),a=e("../../../../analytics/decorate");t.exports=a(e("../../../tool-menu/customize/analytics/placeholders"),i.extend({apiCall:"search/stickers",callbackName:"callbackStickers",initialize:function(){this.debouncedMasonryReload=_.debounce(_.bind(this.masonryReload,this),500),i.prototype.initialize.call(this),this.$el.parent().one("mouseup",_.bind(function(){"hidden"===this.$el.css("visibility")&&this.debouncedMasonryReload()},this))},getParams:function(){var e={from:this.from,limit:this.limit,where:{isPlaceholder:!0,active:INKIVE.C.USER.IS_SUPER?0:1}};return this.from+=this.limit,e},extractData:function(e){return _.map(e,function(e){var t=this.idPrefix?this.idPrefix+"-":"";return t+="sticker-"+e.id,{id:t,src:e.url,width:122.5,height:122.5,cls:parseInt(e.active)?"":" grayscale",data:{count:e.count,changeable:e.changeable}}},this)},getScrollHeight:function(e){return e.height()},getScrollWidth:function(e){return e.width()}}))},{"../../../../analytics/decorate":5,"../../../tool-menu/components/accordion-list/content":252,"../../../tool-menu/customize/analytics/placeholders":329}],174:[function(e,t,n){var i=e("../../../tool-menu/components/accordion-list/content"),a=e("../../../tool-menu/components/thumbnail/shape"),o=e("../../../../analytics/decorate"),r=e("../../../../factory/shapes"),s=e("./templates/shapes.hbs");t.exports=o(e("../../../tool-menu/customize/analytics/shapes"),i.extend({apiCall:"search/shapes",dataName:"shapesCategories",$categorySelect:null,initialize:function(e){_.bindAll(this,"loadCategoryContent"),this.debouncedMasonryReload=_.debounce(_.bind(this.masonryReload,this),500),this.loadCategories().then(_.bind(function(t){e.html(s(t)),this.$el=e.find(".shapes-content"),this.$categorySelect=e.find("select.categories"),this.$categorySelect.on("change",this.loadCategoryContent),this.$categorySelect.trigger("change"),e.parent().one("mouseup",this.debouncedMasonryReload)},this))},initScroll:function(){this.$el&&i.prototype.initScroll.call(this)},loadCategoryContent:function(){this.categoryKey=this.$categorySelect.val(),i.prototype.initialize.call(this)},loadData:function(e,t){this.end=t,INKIVE.Modal.loader(this.$el.find(".antiscroll-inner")),r.get(this.categoryKey).then(this.onMoreData)},onMoreData:function(e){e.length&&this.appendThumbnails(e),INKIVE.Modal.loaderClose(this.$el.find(".antiscroll-inner")),this.end(),this.scrollRefresh()},appendThumbnails:function(e){var t=this.$el.find(".thumbnail-wrapper");_.each(e,function(e){var n=$("<div>").addClass("thumbnail");new a({el:n,item:e});n.appendTo(t)})},loadCategories:function(){var e=$.Deferred();return r.getCategories().then(function(t){e.resolve(_.map(t,function(e){return{key:e.key,tag:e.name,icon:"fa fa-ellipsis-v"}}))}),e.promise()},getScrollHeight:function(e){return e.parents(".ui-dropdown-items").height()-40},getScrollWidth:function(e){return e.parents(".ui-dropdown-items").width()}}))},{"../../../../analytics/decorate":5,"../../../../factory/shapes":130,"../../../tool-menu/components/accordion-list/content":252,"../../../tool-menu/components/thumbnail/shape":304,"../../../tool-menu/customize/analytics/shapes":330,"./templates/shapes.hbs":177}],175:[function(e,t,n){var i=e("./templates/text.hbs"),a=e("../../../../facade/design/design");t.exports=Backbone.View.extend({addTextEvent:function(e){var t=$(e.currentTarget);a.create("text",this.getClickElementData(t))},initialize:function(){this.editor=INKIVE.Tool.getInstance().editor,this.render()},render:function(){var e=[50,35,20];this.$el.html(i(_.map(INKIVE.C.TextDefault,function(t,n){return _.extend({fsize:e[n]},t)}))),this.$el.find(".text-tool").on("click",_.bind(this.addTextEvent,this))},getClickElementData:function(e){var t=this.editor.getOffset(),n=this.getBaseElementData(e),i=(t.width-n.size.width)/2;return _.extend(n,{position:{x:Math.floor4(i),y:Math.floor4((t.height-n.font.size)/2)}})},getBaseElementData:function(e){var t=this.editor.canvas,n=_.min([t.contentW,t.contentH]),i=e[0].getBoundingClientRect().width,a=Math.round(n*e.data("size")),o=i*(a/25);return{selected:!1,content:e.text().trim(),font:{size:a},size:{width:Math.floor4(o)}}}})},{"../../../../facade/design/design":34,"./templates/text.hbs":178}],176:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({1:function(e,t,n,i,a){var o,r=null!=t?t:e.nullContext||{},s=n.helperMissing,l=e.escapeExpression,c="function";return'  <li>\n    <a class="btn btn-tag drawing-tool item" tag="'+l((n.t||t&&t.t||s).call(r,null!=t?t.tag:t,{name:"t",hash:{},data:a}))+'" data-mode="'+l((o=null!=(o=n.mode||(null!=t?t.mode:t))?o:s,typeof o===c?o.call(r,{name:"mode",hash:{},data:a}):o))+'">\n      <div class="icon-wrapper"><i class="'+l((o=null!=(o=n.icon||(null!=t?t.icon:t))?o:s,typeof o===c?o.call(r,{name:"icon",hash:{},data:a}):o))+'"></i></div>\n    </a>\n  </li>\n'},compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){var o;return"<ul>\n"+(null!=(o=n.each.call(null!=t?t:e.nullContext||{},t,{name:"each",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a}))?o:"")+"</ul>\n"},useData:!0})},{"hbsfy/runtime":535}],177:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({1:function(e,t,n,i,a){var o,r=null!=t?t:e.nullContext||{},s=n.helperMissing,l="function",c=e.escapeExpression;return'      <option value="'+c((o=null!=(o=n.key||(null!=t?t.key:t))?o:s,typeof o===l?o.call(r,{name:"key",hash:{},data:a}):o))+'">\n        '+c((o=null!=(o=n.tag||(null!=t?t.tag:t))?o:s,typeof o===l?o.call(r,{name:"tag",hash:{},data:a}):o))+"\n      </option>\n"},compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){var o;return'<div>\n  <div class="categories-container">\n    <select class="categories">\n'+(null!=(o=n.each.call(null!=t?t:e.nullContext||{},t,{name:"each",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a}))?o:"")+'    </select>\n  </div>\n  <div class="shapes-content"></div>\n</div>'},useData:!0})},{"hbsfy/runtime":535}],178:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({1:function(e,t,n,i,a){var o,r=null!=t?t:e.nullContext||{},s=n.helperMissing,l="function",c=e.escapeExpression;return'  <li>\n    <a class="btn text-tool item" data-size="'+c((o=null!=(o=n.size||(null!=t?t.size:t))?o:s,typeof o===l?o.call(r,{name:"size",hash:{},data:a}):o))+'" style="font-size: '+c((o=null!=(o=n.fsize||(null!=t?t.fsize:t))?o:s,typeof o===l?o.call(r,{name:"fsize",hash:{},data:a}):o))+'px;">\n      '+c((o=null!=(o=n.text||(null!=t?t.text:t))?o:s,typeof o===l?o.call(r,{name:"text",hash:{},data:a}):o))+"\n    </a>\n  </li>\n"},compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){var o;return"<ul>\n"+(null!=(o=n.each.call(null!=t?t:e.nullContext||{},t,{name:"each",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a}))?o:"")+"</ul>\n"},useData:!0})},{"hbsfy/runtime":535}],179:[function(e,t,n){t.exports=Backbone.View.extend({initialize:function(e,t,n,i,a){this.$elem=e,this.popupMenuCommonFunctions=n,this.buttonSelect=t,this.defaultMenus=i,this.canvas=INKIVE.Tool.getInstance().editor.canvas,this.fontMenu=a,this.hasLibrary=n.hasLibrary,_.bindAll(this,"drawTextMenuItems","addAppliedClass","drawTextBlockActions","updateFontStyle","updateTextAnchor","initSliders","drawFontSizes","isContainsSubset","getFontSubsetByLocale","sortByLocale","drawFontNames","drawFontGroup","drawAFont","drawFontLocaleSelector","isLocaleSubsetSelected","drawLibraryFonts","toggleFontLibraryMenu","addLibraryItems","onFavFontsPreload","prependFav","buildFontMenu")},drawTextMenuItems:function(){var e="textedit"===this.canvas.getMode();this.$elem.find(">g.textGroup, >text").length&&(new INKIVE.Text.Textarea).setDOM(this.$elem[0]).render(this.canvas),this.$elem.popupmenu({buttons:this.defaultMenus[e?"TEXT_EDIT":"TEXT"]}),this.drawTextBlockActions()},drawTextBlockActions:function(){var e=(new INKIVE.Text.Textarea).setDOM(this.$elem[0]),t=this.canvas.runExtensions("selectionRange",{});this.styles=e.text.getStyles4Range(t.start,t.end),this.drawFontSizes(),this.drawFontNames(),e.text.bullets&&this.addAppliedClass("on_set-bullets"),e.text.auto_adjustable&&this.addAppliedClass("on_set-auto-adjustable"),this.updateFontStyle(),this.updateTextAnchor(e),this.initSliders(e)},updateFontStyle:function(){("bold"===this.styles.font_weight||parseInt(this.styles.font_weight)>=700)&&this.addAppliedClass("on_set-bold"),"italic"===this.styles.font_style&&this.addAppliedClass("on_set-italic"),"underline"===this.styles.text_decoration&&this.addAppliedClass("on_set-underline")},updateTextAnchor:function(e){if(this.buttonSelect("on_text-align").length)switch(e.text.text_anchor){case"end":this.addAppliedClass("on_set-align-right"),this.buttonSelect("on_text-align").find("i").get(0).className="desygner-icon-text-align-right";break;case"middle":this.addAppliedClass("on_set-align-center"),this.buttonSelect("on_text-align").find("i").get(0).className="desygner-icon-text-align-center";break;case"justify":this.addAppliedClass("on_set-align-justify"),this.buttonSelect("on_text-align").find("i").get(0).className="desygner-icon-text-align-justify";break;default:this.addAppliedClass("on_set-align-left"),this.buttonSelect("on_text-align").find("i").get(0).className="desygner-icon-text-align-left"}},initSliders:function(e){this.popupMenuCommonFunctions.initSliderElement(this.buttonSelect("on_set-line-spacing"),"lineSpacing",e.text.line_spacing,-10,100),this.popupMenuCommonFunctions.initSliderElement(this.buttonSelect("on_set-word-spacing"),"wordSpacing",e.text.word_spacing,0,100),this.popupMenuCommonFunctions.initSliderElement(this.buttonSelect("on_set-char-spacing"),"charSpacing",e.text.letter_spacing,-5,100)},drawFontSizes:function(){function e(){for(var e=[],t=8;t<=56;t+=2)e.push(t);return e.push(62,74,86,98,110,122,134,146,158),e}function t(){function e(){var e=i.parents(".ui-dropdown"),t=parseFloat(i.val());_.isNumber(t)&&(i.val(t||""),t&&e.trigger("change",[t]))}var t=n.find(".ui-dropdown-title").hide(),i=$("<input>");i.val(this.toFixed(this.styles.font_size)).insertBefore(t),i.on("keyup",_.debounce(e,500)),i.on("keydown",function(t){13===t.which&&(t.preventDefault(),e())})}var n=this.buttonSelect("on_fontsize"),i=INKIVE.TemplatesHelper("popupmenu_font_size_list",e());n.find(".ui-dropdown-items").empty().append(i),_.bind(t,this)()},isContainsSubset:function(e){return $.inArray(this.getFontSubsetByLocale(),e.support.subsets)>-1},getFontSubsetByLocale:function(){var e=INKIVE.Helpers.cookieStorage.get("locale");if(this.$elem.data("font-locale-subset"))t=this.$elem.data("font-locale-subset");else{var t=null;_.each(INKIVE.C.LOCALE_SUBSETS,function(n){$.inArray(e,n.locales)>-1&&(t=n.name)})}return t||"default"},sortByLocale:function(e,t){return(this.isContainsSubset(e)===this.isContainsSubset(t)?0:this.isContainsSubset(e)?-1:1)||e.family.toLowerCase().localeCompare(t.family.toLowerCase())},drawFontNames:function(){var e=this.buttonSelect("on_fontfamily");this.fontMenu||this.buildFontMenu(),this.fontMenu.appendTo(e.find(" > .ui-dropdown-items")),this.addFontMenuEvents(e);var t=INKIVE.FontsFactory.get(this.styles.font_family),n=t&&t.isSystem?"PDF font":this.styles.font_family.replace(/^'(.*)'$/,"$1").replace(/\\'/g,"'");t&&t.isSystem&&this.canvas.call("advice.show","pdf-text"),e.find(".ui-dropdown-title").html(n),INKIVE.Helpers.initTooltips(e)},buildFontMenu:function(){var e=INKIVE.FontsFactory.getUsableFonts(),t=function(e){return!e.isSystem&&e.templateFonts},n=function(e){return!e.isSystem&&e.customId},i=function(e){return!e.isSystem&&!(e.customId||e.templateFonts)},a=_.filter(e,t),o=_.filter(e,i);this.libraryFonts=_.sortBy(_.uniq(_.filter(e,n),function(e){return e.family}),"family"),o=_.filter(o,this.isLocaleSubsetSelected),this.fontNamesHeader=$('<div class="ui-dropdown-font-names-header">'),this.fontNames=$("<ul>");var r=[];_.each(a,_.bind(function(e){_.where(this.libraryFonts,{family:e.family}).length||_.isEmpty(_.where(r,{family:e.family}))&&r.push(e)},this)),a=r,a.sort(this.sortByLocale),o.sort(this.sortByLocale),INKIVE.RestrictionsFacade.isFunctionalityAllowed("_use_desygner_font")&&this.drawFontLocaleSelector(),this.hasLibrary&&this.addLibraryItems(),this.addFontSearch(),this.fontNamesHeader.find(".ui-font-selection").length||(this.fontNamesHeader.find(".ui-dropdown-font-library-icon").css("margin-top",20),this.fontNamesHeader.find(".ui-dropdown-font-search").css("margin-top",60)),this.drawFontGroup(this.libraryFonts,"popupmenu.font_title.library"),this.drawFontGroup(a,"popupmenu.font_title.recent"),this.drawFontGroup(o,"popupmenu.font_title.all");var s=this.$libraryFontsContainer?this.$libraryFontsContainer[0].outerHTML:"",l='<div class="up"><i class="icon-chevron-up"></i></div><div class="down"><i class="icon-chevron-down"></i></div>';this.fontMenu=this.fontNamesHeader[0].outerHTML+this.fontNames[0].outerHTML+l+s,$(document).trigger("font-menu-created",this.fontMenu),this.fontMenu=$(this.fontMenu)},drawFontGroup:function(e,t){var n=t.replace("popupmenu.font_title.",""),i=$('<div class="ui-dropdown-font-group-title" data-type="'+n+'"><span>'+INKIVE.TranslateHelper.translate(t)+"</span></div>").css("display","none");this.fontNames.append(i),_.each(e,_.bind(function(e){this.drawAFont(e,null,n)},this))},addLibraryItems:function(){var e=_.isEmpty(this.libraryFonts),t=INKIVE.TranslateHelper.translate("popupmenu.font_title."+(e?"empty_library":"library")),n=$('<div class="ui-dropdown-font-library-icon" data-popover="tooltip" data-placement="bottom"/>');n.append($('<i class="desygner-icon-folder"></i>')),n.attr("data-original-title",t),n.toggleClass("disabled-icon",e),this.fontNamesHeader.append(n),this.drawLibraryFonts()},addFontSearch:function(){var e=$('<div class="ui-dropdown-font-search"/>'),t=$('<input type="text" placeholder="'+INKIVE.TranslateHelper.translate("popupmenu.font_title.search_font")+'"/>');e.append(t),e.append($('<i class="desygner-icon-search"/>')),this.fontNamesHeader.append(e)},filterFont:function(e){var t=$(".fullscreen>ul>li"),n=t.parent();t.find(">a").each(function(){var t=$(this);t.parent().toggle(t.html().toLowerCase().indexOf($(e.target).val().toLowerCase())>-1)}),n.find("div[data-type]").hide(),t.each(function(){var e=$(this);e.is(":visible")&&n.find("div[data-type="+e.find("a").data("type")+"]").show()}),n.css("top",100),n.siblings(".up").hide();var i=0;t.find(">:visible").each(function(){i+=$(this).height()})},drawAFont:function(e,t,n){var i=t?t:this.fontNames,a="",o="",r=[];i.find("div[data-type="+n+"]").css("display","inline-block"),e.support.variants&&e.support.variants.length>1&&$.each(e.support.variants,function(t,n){if(!n.match(/italic/)){r.push(n);var i=INKIVE.TranslateHelper.translate("font_variant."+n);o+='<li data-popover="tooltip" data-original-title="'+i+'" data-title="'+i+'" ><a role="menuitem"  data-font-family="'+e.family+'" data-font-weight="'+n+'" style="font-family: \''+e.family.replace(/'/g,"\\'")+"'; font-weight: "+n+';" >'+e.family+"</a></li>"}});var s="",l="",c="";jQuery.grep(r,function(e){return 700!==e}).length>0&&(s='<div class="ui-dropdown-items sub"><ul>'+o+"</ul></div>",l=' class="dropdown-hover"',c='<i class="arrow icon-chevron-right"></i>'),i.append($("<li   >"+a+'<a data-type="'+n+'" role="menuitem" '+l+" style=\"font-family: '"+e.family.replace(/'/g,"\\'")+'\';" data-font-family="'+e.family+'">'+e.family+"</a>"+c+s+"</li>"))},drawFontLocaleSelector:function(){var e=[],t=this.getFontSubsetByLocale(),n=t||"default",i={"default":INKIVE.TranslateHelper.translate("popupmenu.font_locale.languages.title.default"),arabic:"Arabic",bengali:"Bengali",chinese:"中国",cyrillic:"кириллица",devanagari:"Devanagari",greek:"ελληνικά",gujarati:"Gujarati",gurmukhi:"Gurmukhi",hebrew:"עברי",kannada:"Kannada",khmer:"Khmer",korean:"한국의",japanese:"日本の","latin-ext":"Latin Ext",malayalam:"Malayalam",myanmar:"Myanmar",oriya:"Oriya",sinhala:"Sinhala",tamil:"Tamil",telugu:"Telugu",thai:"Thai",vietnamese:"Vietnamese"},a=$('<div class="ui-font-selection"/>'),o=$('<div class="ui-dropdown-items antiscroll-wrap"/>'),r=$('<div class="antiscroll-inner"/>'),s=$("<ul/>"),l=$('<a role="menuitem"  class="dropdown-hover">'+i[n]+"</a>");$.each(INKIVE.C.LOCALE_SUBSETS,function(t,a){function o(e){return _.contains(e.support.subsets,a.name)}if("default"===a.name||_.filter(INKIVE.FontsFactory.get(),o,"latin").length){e.push(a.name);var r=INKIVE.TranslateHelper.translate("popupmenu.font_locale.languages.tooltip."+a.name);s.append($('<li class="font-locale'+(n===a.name?" selected":"")+'"><a data-font-locale-subset="'+a.name+'" role="menuitem" data-popover="tooltip" data-original-title="'+r+'" data-title="'+r+'" data-placement="right">'+i[a.name]+"</a></li>"))}}),o.append(r),r.append(s),this.fontNamesHeader.append($('<div class="ui-dropdown-all-languages-title">'+INKIVE.TranslateHelper.translate("popupmenu.font_locale.title")+"</div>")),a.append(l),a.append($('<i class="desygner-icon-arrow-down"></i>')),a.append(o),this.fontNamesHeader.append(a)},drawLibraryFonts:function(){this.$libraryFontsContainer=$('<div class="ui-font-library-container"/>');var e=$('<div class="ui-dropdown-font-library-icons"/>');e.append('<div class="ui-dropdown-font-library-icon"><i class="desygner-icon-folder"></i></div>');var t=$('<div class="ui-dropdown-font-library-back-icon"><i class="desygner-icon-back"></i></div>');e.append(t),this.$libraryFontsContainer.append(e);var n=$("<ul/>"),i=$('<div class="ui-dropdown-font-group-title" data-type="library-fonts" ><span>'+INKIVE.TranslateHelper.translate("popupmenu.font_title.library")+"</span></div>");_.each(this.libraryFonts,_.bind(function(e){this.drawAFont(e,n,i.data("type"))},this)),this.$libraryFontsContainer.append(i),this.$libraryFontsContainer.append(n),n.after('<div class="down"><i class="icon-chevron-down"></i><div>').after('<div class="up"><i class="icon-chevron-up"></i><div>')},addAntiScroll:function(e){e.antiscroll({autoHide:!1,width:e.width(),height:e.height()})},addFontMenuEvents:function(e){this.toggleFontLibraryMenu(!1),e.find(".ui-font-selection").off("click").on("click",_.bind(function(t){var n=$(t.target);if(n.parents().andSelf().is(".ui-dropdown-items.antiscroll-wrap")){var i=n.data("font-locale-subset")||n.find(">[data-font-locale-subset]").data("font-locale-subset");i&&($(document).trigger("font-menu-reset"),INKIVE.EditorFacade.canvas.runExtensions("reloadFontLocaleSubset",i))}else e.find(".ui-font-selection .antiscroll-wrap").toggle();
this.addAntiScroll($(".ui-font-selection .antiscroll-wrap")),t.stopPropagation()},this));var t=e.find(".ui-dropdown-items.sub").parent();t.off("mouseenter").on("mouseenter",this.toggleSubContainer),t.off("mouseleave").on("mouseleave",this.toggleSubContainer),e.find(".ui-dropdown-items.fullscreen>ul, .ui-font-library-container>ul").each(_.bind(function(e,t){var n=$(t),i="DOMMouseScroll mousewheel scroll";n.off(i).on(i,_.bind(function(e){var t=e.originalEvent;$(e.target).parents(".ui-font-selection").length||($(".ui-font-selection").find(".ui-dropdown-items").hide(),this.scroll(n,t.deltaY||t.wheelDelta))},this)),n.siblings(".up").off("click").on("click",_.bind(function(){this.scroll(n,-500)},this)),n.siblings(".down").off("click").on("click",_.bind(function(){this.scroll(n,500)},this))},this));var n=e.find(".ui-dropdown-font-names-header .ui-dropdown-font-library-icon");n.off("click").on("click",_.bind(function(e){n.is(".disabled-icon")||(this.toggleFontLibraryMenu(!0),e.stopPropagation())},this));var i=e.find(".ui-dropdown-font-library-back-icon");i.off("click").on("click",_.partial(this.toggleFontLibraryMenu,!1)),e.find(".ui-dropdown-font-search input[type=text]").off("keyup").on("keyup",this.filterFont)},toggleSubContainer:function(e){var t=$(e.target).closest("li"),n="mouseenter"===e.type,i=t.find(".ui-dropdown-items.sub"),a=t.parents(".fullscreen");a.data("original-width")||a.data("original-width",a.width());var o=a.data("original-width");n&&(o+=i.width()),a.width(o),a.find(".sub").hide(),n&&i.show()},scroll:function(e,t){var n=e.offset().top,i=e.find(">li:visible:last").offset().top,a=$(".ui-dropdown-items.fullscreen"),o=n-t-50,r=a.height();o>100?o=100:i-t<r&&(o=n-(i-r)-100),o<=100&&(e.css({top:o}),a.find(".up").toggle(100!==o))},toggleFontLibraryMenu:function(e){var t=this.fontMenu.parent().find(".ui-font-library-container");this.fontMenu.toggle(!e),this.fontMenu.parent().find(">.down").toggle(!e);var n=this.fontMenu.parent().find(">.up");n.hide(),!e&&parseInt(this.fontMenu.parent().find(">ul").css("top"))<100&&n.show(),t.toggle(e)},isLocaleSubsetSelected:function(e){return"default"===this.getFontSubsetByLocale()&&e.support.isDefault?e:this.isContainsSubset(e)?e:void 0},onFavFontsPreload:function(){var e=this.buttonSelect("on_fontfamily")&&this.buttonSelect("on_fontfamily").find(".ui-dropdown-items ul li hr").length;INKIVE.Tool._cache.favFonts.length&&!e&&(this.prependFav("on_fontsize","fontSize",function(e){return'<li><a role="menuitem">'+this.toFixed(e)+" pt</a></li>"}),this.prependFav("on_fontfamily","fontFamily",function(e){return'<li><a role="menuitem" style="font-family: '+e+';" font-family="'+e+'">'+e+"</a></li>"}))},addAppliedClass:function(e){this.buttonSelect(e).addClass("applied")},prependFav:function(e,t,n){var i=this.buttonSelect(e);if(i){var a=i.find(" > .ui-dropdown-items > ul"),o=_.map(this.getProcessedValues(t),n).join("");a.prepend(o)}},getProcessedValues:function(e){return _(INKIVE.Tool._cache.favFonts).chain().flatten().pluck(e).unique().value().reverse()},toFixed:function(e){return e=Number(e),e===Math.round(e)?Math.round(e):e.toFixed(1)}})},{}],180:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({1:function(e,t,n,i,a){return" disabled"},3:function(e,t,n,i,a){return" checked"},5:function(e,t,n,i,a){return' value="'+e.escapeExpression(e.lambda(t,t))+'"'},7:function(e,t,n,i,a){return'<a class="remove btn">'+e.escapeExpression((n.t||t&&t.t||n.helperMissing).call(null!=t?t:e.nullContext||{},"popupmenu.tooltip.remove",{name:"t",hash:{},data:a}))+"</a>"},9:function(e,t,n,i,a){return'<a class="apply btn">'+e.escapeExpression((n.t||t&&t.t||n.helperMissing).call(null!=t?t:e.nullContext||{},"editor.apply",{name:"t",hash:{},data:a}))+"</a>"},compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){var o,r,s,l=null!=t?t:e.nullContext||{},c=n.helperMissing,d="function",u=n.blockHelperMissing,p='<div class="option';return r=null!=(r=n.is_set||(null!=t?t.is_set:t))?r:c,s={name:"is_set",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a},o=typeof r===d?r.call(l,s):r,n.is_set||(o=u.call(t,o,s)),null!=o&&(p+=o),p+='">\n  <input type="radio" name="link-type" value="url"',r=null!=(r=n.is_set||(null!=t?t.is_set:t))?r:c,s={name:"is_set",hash:{},fn:e.noop,inverse:e.program(3,a,0),data:a},o=typeof r===d?r.call(l,s):r,n.is_set||(o=u.call(t,o,s)),null!=o&&(p+=o),r=null!=(r=n.url||(null!=t?t.url:t))?r:c,s={name:"url",hash:{},fn:e.program(3,a,0),inverse:e.noop,data:a},o=typeof r===d?r.call(l,s):r,n.url||(o=u.call(t,o,s)),null!=o&&(p+=o),p+='/>\n  <input type="text" name="url" placeholder="https://desygner.com" ',r=null!=(r=n.url||(null!=t?t.url:t))?r:c,s={name:"url",hash:{},fn:e.program(5,a,0),inverse:e.noop,data:a},o=typeof r===d?r.call(l,s):r,n.url||(o=u.call(t,o,s)),null!=o&&(p+=o),p+='/>\n</div>\n\n<div class="option',r=null!=(r=n.is_set||(null!=t?t.is_set:t))?r:c,s={name:"is_set",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a},o=typeof r===d?r.call(l,s):r,n.is_set||(o=u.call(t,o,s)),null!=o&&(p+=o),p+='">\n  <input type="radio" name="link-type" value="anchor" id="anchor-link-type"',r=null!=(r=n.anchor||(null!=t?t.anchor:t))?r:c,s={name:"anchor",hash:{},fn:e.program(3,a,0),inverse:e.noop,data:a},o=typeof r===d?r.call(l,s):r,n.anchor||(o=u.call(t,o,s)),null!=o&&(p+=o),p+='/>\n  <label for="anchor-link-type">'+e.escapeExpression((n.t||t&&t.t||c).call(l,"shapes.names.basic.page",{name:"t",hash:{},data:a}))+'</label>\n  <input type="text" name="anchor" class="disabled"',r=null!=(r=n.anchor||(null!=t?t.anchor:t))?r:c,s={name:"anchor",hash:{},fn:e.program(5,a,0),inverse:e.noop,data:a},o=typeof r===d?r.call(l,s):r,n.anchor||(o=u.call(t,o,s)),null!=o&&(p+=o),p+="/>\n</div>\n\n",r=null!=(r=n.is_set||(null!=t?t.is_set:t))?r:c,s={name:"is_set",hash:{},fn:e.program(7,a,0),inverse:e.noop,data:a},o=typeof r===d?r.call(l,s):r,n.is_set||(o=u.call(t,o,s)),null!=o&&(p+=o),p+="\n",r=null!=(r=n.is_set||(null!=t?t.is_set:t))?r:c,s={name:"is_set",hash:{},fn:e.noop,inverse:e.program(9,a,0),data:a},o=typeof r===d?r.call(l,s):r,n.is_set||(o=u.call(t,o,s)),null!=o&&(p+=o),p+'\n\n<!--\n<input type="text" value="\' + val + \'" readonly="readonly" /><a class="btn"><i class="icon-remove"></i></a>\n-->\n'},useData:!0})},{"hbsfy/runtime":535}],181:[function(e,t,n){var i=e("./link.hbs");t.exports=Backbone.View.extend({mode:"url",events:{'keydown input[name="anchor"]':"anchorCheckEvent","click .apply.btn":"applyEvent","click .remove.btn":"removeEvent"},removeEvent:function(){this.canvas.removeHyperlink()},applyEvent:function(){var e=this.$el.find('input[name="'+this.mode+'"]').val();e&&(e="url"===this.mode?INKIVE.Helpers.isUrlValid(e)?e:"http://"+e:"#"+e,this.canvas.makeHyperlink(e))},anchorCheckEvent:function(e){var t=48<=e.which&&e.which<=57,n=8===e.which||46===e.which;return t||n},toggleEvent:function(e){var t=$(e.currentTarget).attr("value"),n=$(e.currentTarget).is(":checked");n&&(this.mode=t),this.$el.find('input[type="text"]').val(""),this.$el.find('input[name="'+t+'"]').toggleClass("disabled",!n)},initialize:function(e){this.href=e.href,this.canvas=e.canvas,this.render()},render:function(){var e=this.href&&0===this.href.indexOf("#")&&this.href.replace("#",""),t=!e&&this.href,n=i({anchor:e,url:t,is_set:e||t});this.$el.html(n).find("[type=radio]").iCheck({radioClass:"iradio_square-yellow"}).on("ifChanged",_.bind(this.toggleEvent,this))}})},{"./link.hbs":180}],182:[function(e,t,n){var i=e("../../../utils/humps"),a=e("./default-menus.json"),o=e("./popupmenu-events"),r=e("./popupmenu-common-functions"),s=e("./popupmenu-element-items-drawer"),l=e("./dropdown/link");t.exports=Backbone.View.extend({defaultMenus:a,initialize:function(){_.bindAll(this,"buildPopupMenu"),this.popupMenuEvents=new o,this.popupMenuCommonFunctions=new r,this.editor=INKIVE.Tool.getInstance().editor,INKIVE.C.BOOK.book_type===INKIVE.C.BOOK_TYPE.TEMPLATE&&(this.defaultMenus.TEXT=_.without(this.defaultMenus.TEXT,"LOCK"),this.defaultMenus.LOGO=_.without(this.defaultMenus.LOGO,"LOCK"),this.defaultMenus.ICON=_.without(this.defaultMenus.ICON,"LOCK"),this.defaultMenus.IMAGE=_.without(this.defaultMenus.IMAGE,"LOCK"),this.defaultMenus.STICKER=_.without(this.defaultMenus.STICKER,"LOCK"),this.defaultMenus.GROUP=_.without(this.defaultMenus.GROUP,"LOCK"),this.defaultMenus.DEFAULT=_.without(this.defaultMenus.DEFAULT,"LOCK"),this.defaultMenus.TEXT.unshift("PERMISSIONS"),this.defaultMenus.LOGO.unshift("PERMISSIONS"),this.defaultMenus.ICON.unshift("PERMISSIONS"),this.defaultMenus.VIDEO.unshift("PERMISSIONS"),this.defaultMenus.IMAGE.unshift("PERMISSIONS"),this.defaultMenus.STICKER.unshift("PERMISSIONS"),this.defaultMenus.DEFAULT.unshift("PERMISSIONS"),this.defaultMenus.BACKGROUND.unshift("PERMISSIONS")),$(document).on("font-menu-created",_.bind(function(e,t){this.fontMenu=$(t)},this)),$(document).on("font-menu-reset",_.bind(function(){this.fontMenu=null},this))},buildPopupMenu:function(e,t,n){if(this.$elem=$(e),!INKIVE.C.IS_MOBILE_APP){if(this.buttonSelect=_.bind(this.$elem.popupmenu,this.$elem,"button"),this.popupMenuElementItemsDrawer=new s(this.$elem,this.buttonSelect,this.popupMenuCommonFunctions,this.defaultMenus,this.fontMenu),_.contains(["text","video","logo","icon","layout","image","sticker","group","multiselect","background","root"],t)?this.popupMenuElementItemsDrawer["draw"+i.pascalize(t)+"MenuItems"]():this.popupMenuElementItemsDrawer.drawDefaultMenuItems(t),!this.$elem.popupmenu("menu"))return!1;this.$elem.popupmenu("menu").find(".ui-dropdown").popupmenudropdown(),this.$elem.is("#svgroot")||(this.popupMenuCommonFunctions.initSliderElement(this.$elem.popupmenu("button","on_opacity"),"opacity",parseInt(100*this.editor.getOpacity()),0,100),this.popupMenuCommonFunctions.drawStrokeDropdownItems(this.$elem),this.initColors(e),this.initLinks(e)),this.popupMenuEvents.loadEvents(e),this.popupMenuCommonFunctions.highlightAppliedOptions(this.buttonSelect,this.$elem),n.find(".element-popupmenu").css("display",this.$elem.is("#svgroot")?"none":"flex"),n.find(".root-popupmenu").css("display",this.$elem.is("#svgroot")?"flex":"none"),this.editor.canvas.runExtensions("browserResize",{}),n.find(".scroll-handler i").on("click",this.popupMenuCommonFunctions.scrollHandler)}},initColors:function(e){this.$elem.popupmenu("button","colormap-circle").find(".ui-dropdown-items").each(_.partial(this.popupMenuCommonFunctions.drawColor,e))},initLinks:function(e){var t=this.$elem.popupmenu("button","on_linkElement").find(".ui-dropdown-items"),n=this.$elem.popupmenu("button","on_unlinkElement").find(".ui-dropdown-items");(t.length||n.length)&&new l({el:t.length?t:n,href:svgedit.utilities.getHref(e),canvas:this.editor.canvas})}})},{"../../../utils/humps":482,"./default-menus.json":171,"./dropdown/link":181,"./popupmenu-common-functions":183,"./popupmenu-element-items-drawer":184,"./popupmenu-events":185}],183:[function(e,t,n){var i=e("../../colors/color-selector"),a=e("../../../../../bower_components/tinycolor/tinycolor"),o=e("./drawer/drawing-menu-items"),r=e("./drawer/frame-menu-items"),s=e("./drawer/shape-menu-items"),l=e("./drawer/simpletext-menu-items");t.exports=Backbone.View.extend({hasLibrary:null,initialize:function(){this.editor=INKIVE.Tool.getInstance().editor,INKIVE.UserInfoFactory.get().then(_.bind(function(e){this.hasLibrary=_(e.roles).contains("ROLE_LIBRARY")},this)),_.bindAll(this,"initSliderElement","getElemsForStrokeChange","updateFontRelatedMenu","highlightAppliedOptions","drawStrokeDropdownItems","drawColors","drawColor","scrollHandler")},initSliderElement:function(e,t,n,i,a){var o=e.find(".ui-dropdown-items");n=this.getAvgDx(n),o.length||(o=e,o.append('<small style="line-height: 10px; display: flex;">'+o.attr("data-title")+"</small>"),o.tooltip("disable"),o.addClass("nohover")),o.append('<span id="sliderWrapper"><div class="slider"></div></span><input type="text" id="'+t+'" value="'+n+'"/>'),o.find("#"+t).on("click",function(){$(this).select()});var r;o.find("#"+t).keydown(function(t){if(r=$(this).val(),/[0-9]/.test(t.key)){var n=parseInt($(this).val())||0;e.trigger("start",[n])}}),o.find("#"+t).keyup(function(t,n){if(/[0-9]/.test(t.key)||n){var o=n?0:parseInt($(this).val())||0;o>a?$(this).val(a):o<i?$(this).val(i):$(this).val(o),s.slider("option","value",o),e.trigger("change",[o]),e.trigger("stop",[o])}else $(this).val(r)});var s=o.find(".slider").slider({max:a,min:i,value:n,slide:function(e,n){o.find("#"+t).val(n.value),o.find("#"+t).trigger("change",[n.value])},start:function(e,n){o.find("#"+t).trigger("start",[n.value])},stop:function(e,n){o.find("#"+t).trigger("stop",[n.value])}});s.slider("float")},getElemsForStrokeChange:function(e){function t(e){"g"!==e.nodeName&&n.push(e)}var n=[];return e&&($(e).hasClass("layoutBox")||($(e).hasClass("textarea")?n.push(e):"g"===e.tagName?svgedit.utilities.walkTree(e,t):n.push(e))),n},updateFontRelatedMenu:function(e){if(e.button("on_fontfamily").length||e.button("on_finishTextEditing").length){var t=(new INKIVE.Text.Textarea).setDOM(e.element()),n=t.text.font_family,i=INKIVE.FontsFactory.get(n,t.text.font_weight);i||(n="Lato",t.text.font_family=n,t.render(this.editor.canvas),i=INKIVE.FontsFactory.get(n,t.text.font_weight));var a=i.support,o=e.button("on_set-bold"),r=e.li("on_set-bold").addClass("semidisabled"),s=e.button("on_set-italic"),l=e.li("on_set-italic").addClass("semidisabled"),c=e.button("on_set-underline"),d=e.li("on_set-underline").addClass("semidisabled"),u=e.$element.find(".text").attr("font-weight"),p=a.b||a.bi||!!u,h=a.i||a.bi;_.isNumber(u)&&u>400&&o.addClass("applied"),(p||o.hasClass("applied"))&&o.click(),(h||s.hasClass("applied"))&&s.click(),t.text.letter_spacing&&c.hasClass("applied")&&c.click(),p&&r.removeClass("semidisabled"),h&&l.removeClass("semidisabled"),a.b?o.attr("data-original-title",o.attr("data-title")):o.attr("data-original-title",INKIVE.TranslateHelper.translate("modal.alert.font_no_bold")),a.i?s.attr("data-original-title",s.attr("data-title")):s.attr("data-original-title",INKIVE.TranslateHelper.translate("modal.alert.font_no_italic")),o.hasClass("applied")&&!a.bi?(l.addClass("semidisabled"),s.hasClass("applied")&&s.click(),s.attr("data-original-title",INKIVE.TranslateHelper.translate("modal.alert.font_no_bolditalic"))):o.hasClass("applied")&&a.bi&&s.attr("data-original-title",s.attr("data-title")),s.hasClass("applied")&&!a.bi?(r.addClass("semidisabled"),o.hasClass("applied")&&o.click(),o.attr("data-original-title",INKIVE.TranslateHelper.translate("modal.alert.font_no_bolditalic"))):s.hasClass("applied")&&a.bi&&o.attr("data-original-title",o.attr("data-title")),t.text.letter_spacing?c.attr("data-original-title",INKIVE.TranslateHelper.translate("modal.alert.font_no_underline")):(d.removeClass("semidisabled"),c.attr("data-original-title",c.attr("data-title"))),this.toggleTextSpacingForJustification(e,"justify"!==t.text.text_anchor)}},toggleTextSpacingForJustification:function(e,t){e.button("on_set-char-spacing").parent().toggle(t),e.button("on_set-word-spacing").parent().toggle(t)},highlightAppliedOptions:function(e,t){function n(){return null!==t.attr("filter")}function i(){return null!==t.attr("opacity")&&t.attr("opacity")<1}function a(e){var n=INKIVE.DesignFacade.get(t.attr("id"));return!(!n||!n.flipped)&&n.flipped[e]}function o(e){var n=INKIVE.DesignFacade.get(t.attr("id"));return!(!n||!n.flipped)&&n.flipped[e]}function r(){return t.is("a")||t.parent().is("a")}function s(){return t.attr("stroke-width")>0}function l(t,n){e(t).toggleClass("applied",n)}l("on_unlinkElement",r()),l("on_unlockImage",!0),l("on_flipImageH",a("horizontal")),l("on_flipImageV",a("vertical")),l("on_flipBackgroundH",o("horizontal")),l("on_flipBackgroundV",o("vertical")),l("on_imageFilter",n()),l("on_unlockElement",!0),l("on_opacity",i()),l("on_stroke",s());var c=t.popupmenu()[0],d=c.button("on_set-align-justify").is(":not(.applied)");this.toggleTextSpacingForJustification(c,d)},drawStrokeDropdownItems:function(e){function t(e,t){var n=["5, 5","5, 10","10, 5","5, 1","1, 5","0.9","15, 10, 5, 10","5, 5, 1, 5"],a=INKIVE.TemplatesHelper("popupmenu_stroke_dasharray",{dashArrays:n,width:e.getStrokeWidth()});i.append(a).find("ul.stroke-dasharray li").on("click",function(){var e=$(this),n=e.find("svg line").attr("stroke-dasharray"),i=INKIVE.DesignFacade.get(t.getAttribute("id")),a={stroke:{dasharray:n}};if("shape"===i.type)INKIVE.DesignFacade.set(a);else{var o=[];_.each(i.shapes,function(e,t){o[t]=a}),INKIVE.DesignFacade.set({shapes:o})}e.addClass("applied").siblings(".applied").removeClass("applied")}),i.find(".stroke-dasharray").toggle(e.getStrokeWidth()>0)}function n(e){function t(){i.find("ul.stroke-dasharray li").first().addClass("applied")}function n(e){var t=e.getAttribute("stroke-dasharray");return _.map(t?t.split(","):[],function(e){return e.trim()})}function a(e){return!e&&!o||!(!e||!o)&&(e.length===o.length&&_.all(e,function(e,t){return e===o[t]}))}var o=n(e),r=i.find("li svg line");_.any(r,function(e){var t=n(e);if(a(t))return $(e).closest("li").addClass("applied"),!0})||t()}var i=e.popupmenu("button","on_stroke").find(".ui-dropdown-items");this.initSliderElement(e.popupmenu("button","on_stroke"),"strokeWidth",this.editor.getStrokeWidth(),0,20),t(this.editor,e[0]),n(e[0])},drawColor:function(e,t,n){function o(e){e=_.isString(e)?e.toUpperCase():null;var t="popupmenu.tooltip."+(c?"stroke_color":"fill_color"),n=INKIVE.TranslateHelper.translate(t,{color:e});s.find("i").css("color",e),"background"===l&&"none"===e&&s.find("i").attr("class","icon-stroke_colour").css("color","#fff"),"background"===l||s.attr("data-original-title",n)}var r=INKIVE.Tool.getInstance().editor.canvas;$(n).append('<div class="colorLineWrapper"></div>');var s=$(n).parents(".btn-onmenu"),l=s.attr("type"),c="stroke"===l,d=INKIVE.Helpers.getColor(e,l);o(d),s.append('<input type="hidden" name="hex" value="'+a(d).toHexString()+'"/>');var u=new i;u.initialize(this.hasLibrary,$(e)).then(function(){u.favColors($(n),function(t){var n=$(t).data("color");if(o(n),"textedit"===r.getMode()){var i=(new INKIVE.Text.Textarea).setDOM(e),a=r.runExtensions("selectionRange",{});i.text.setPartialStyling(a.start,a.end,"fill",n),i.render(r)}else{var s=INKIVE.DesignFacade.get(e.getAttribute("id")),l=c?{stroke:{color:n}}:{fill:{color:n}};switch(s.type){case"text":s.id===r.getSelectedElems()[0].id?INKIVE.DesignFacade.set(c?l:{color:n}):INKIVE.DesignFacade.set(s.id,c?l:{color:n});break;case"shape":INKIVE.DesignFacade.set(l);break;case"logo":case"icon":case"sticker":var d={};if(c)_.each(s.shapes,function(e,t){(e.fill&&e.fill.color||c)&&(d[t]=l)});else{var u=$(t).closest(".btn-onmenu").attr("type").split("_")[1],p=s.shapes[u];(p.fill&&p.fill.color||c)&&(d[u]=l)}INKIVE.DesignFacade.set({shapes:d});break;case"background":INKIVE.DesignFacade.set("background",{color:n}),r.runExtensions("showBackgroundPopupMenu",{})}c&&$(e).popupmenu("li","on_stroke").toggle(n&&"none"!==n)}})}),d||c&&$(e).popupmenu("li","on_stroke").hide()},drawColors:function(e,t){var n=0,i={};_.each(INKIVE.DesignFacade.get(e.attr("id"),"shapes"),function(e,t){e.fill&&e.fill.color&&(i[t]=e.fill.color)}),_.size(i)||1!==e.find("path").length||(i[2]="black"),_.any(i,_.bind(function(t,i){return n++>6||void e.popupmenu("appendBeforeSelector",'[data-action="colormap-circle"][type="fill"]',"FILL_COLOR",{type:"set_"+i})},this)),$(t("colormap-circle")).filter('[type="fill"]').last().parent().remove()},scrollHandler:function(e){var t=$(".element-popupmenu.menu"),n=$(e.target).parents().andSelf().is(".scroll-handler-left"),i=t.siblings(".scroll-handler-left").hide(),a=t.siblings(".scroll-handler-right").hide(),o=0;t.children().each(function(){o+=$(this).outerWidth()}),t.animate({left:n?0:t.width()-o},500,_.bind(function(){this.editor.canvas.runExtensions("browserResize",{skipScroll:!0,$handler:n?a:i})},this))},getAvgDx:function(e){return _.isArray(e)?Math.precision(_.reduce(e,function(e,t){return e+parseFloat(t)},0)/(e.length-1),4):e},calculateDx:function(e,t){if(!_.isArray(t))return parseInt(e);var n=e/this.getAvgDx(t)||1,i=[];return _.each(t,function(e){i.push(Math.precision(e*n,4))}),i},getDrawingButtons:function(e){this.drawing=new o(e)},getFrameButtons:function(e){this.frames=new r({el:e})},getTextButtons:function(e){this.texts=new l({el:e})},getShapeButtons:function(e){this.shapes=new s(e)}})},{"../../../../../bower_components/tinycolor/tinycolor":3,"../../colors/color-selector":159,"./drawer/drawing-menu-items":172,"./drawer/frame-menu-items":173,"./drawer/shape-menu-items":174,"./drawer/simpletext-menu-items":175}],184:[function(e,t,n){var i=e("./drawer/text-menu-items");t.exports=Backbone.View.extend({initialize:function(e,t,n,i,a){this.$elem=e,this.popupMenuCommonFunctions=n,this.buttonSelect=t,this.defaultMenus=i,this.fontMenu=a},drawDefaultMenuItems:function(e){this.$elem.popupmenu({buttons:this.defaultMenus.DEFAULT,disableBuild:!0}),$.inArray(e,["ellipse","rect","polygon","path","square","circle"])===-1&&this.$elem.popupmenu("li","on_imageBox").hide(),this.$elem.popupmenu("build")},drawMultiselectMenuItems:function(){this.$elem.popupmenu({buttons:this.defaultMenus.MULTISELECT})},drawGroupMenuItems:function(){this.$elem.popupmenu({buttons:this.defaultMenus.GROUP})},drawLayoutMenuItems:function(){this.$elem.data("popupmenu")&&this.$elem.removeData("popupmenu"),this.$elem.popupmenu({buttons:this.defaultMenus.LAYOUT}),this.$elem.popupmenu("menu").parent().find(".back-menu").hide()},drawBackgroundMenuItems:function(){this.$elem.popupmenu({buttons:this.defaultMenus.BACKGROUND}),INKIVE.DesignFacade.get("background").source||this.$elem.popupmenu("li","on_transform").hide()},drawImageMenuItems:function(){this.$elem.popupmenu({buttons:this.defaultMenus.IMAGE})},drawLogoMenuItems:function(){this.$elem.popupmenu({buttons:this.defaultMenus.LOGO,disableBuild:!0}),this.popupMenuCommonFunctions.drawColors(this.$elem,this.buttonSelect),this.$elem.popupmenu("build")},drawIconMenuItems:function(){this.drawLogoMenuItems()},drawVideoMenuItems:function(){INKIVE.DesignFacade.get(this.$elem.attr("id"));this.$elem.popupmenu({buttons:this.defaultMenus.VIDEO})},drawStickerMenuItems:function(){this.$elem.popupmenu({buttons:this.defaultMenus.STICKER,disableBuild:!0}),this.popupMenuCommonFunctions.drawColors(this.$elem,this.buttonSelect);var e=_.contains(["sticker","banner","placeholder"],INKIVE.EditorModeManager.getMode()),t=this.$elem.find(".textarea.subelement, .layoutBox.subelement").length>0;(e||t)&&($("[data-action=on_transform]").find(".ui-dropdown-content-title.on_flip").hide(),this.$elem.popupmenu("li","on_flipH").hide(),this.$elem.popupmenu("li","on_flipV").hide(),this.$elem.popupmenu("append","EXPLODE_STICKER")),this.$elem.popupmenu("build")},drawTextMenuItems:function(){var e=new i(this.$elem,this.buttonSelect,this.popupMenuCommonFunctions,this.defaultMenus,this.fontMenu);e.drawTextMenuItems(),this.popupMenuCommonFunctions.updateFontRelatedMenu(this.$elem.data("popupmenu"))},drawRootMenuItems:function(e){this.$elem.popupmenu({buttons:this.defaultMenus.ROOT}),this.$elem.popupmenu("build")}})},{"./drawer/text-menu-items":179}],185:[function(e,t,n){var i=e("./popupmenu-common-functions"),a=e("../../../factory/library/library-populator");t.exports=Backbone.View.extend({initialize:function(){this.popupMenuCommonFunctions=new i},loadEvents:function(t){function n(e,t){var n=INKIVE.TranslateHelper.translate($(e).find(".textarea.subelement")?"modal.alert.explode_banner":"modal.alert.explode_placeholder");INKIVE.Modal.alertMessage(n,{width:450,callback:[t,$.noop]})}function i(e){var t=1*m.getRotationAngle(f.element())+e;INKIVE.DesignFacade.set({rotation:t})}function o(e){_.each(["right","justify","center","left"],function(t){f.button("on_set-align-"+t).toggleClass("applied",t===e)})}function r(e){f.button("on_set-bullets").toggleClass("applied",e===!0)}function s(e){f.button("on_set-auto-adjustable").toggleClass("applied",e===!0)}function l(e){f.button("on_set-align-left").toggleClass("applied","start"===e),f.button("on_set-align-right").toggleClass("applied","end"===e),f.button("on_set-align-center").toggleClass("applied","middle"===e),f.button("on_set-align-justify").toggleClass("applied","justify"===e),h.toggleTextSpacingForJustification(f,"justify"!==e)}function c(e,t){var n="on_removePartialStyle"===$(this).attr("data-action");if(!$(this).parents("li.semidisabled").length){t.preventDefault();var i=(new INKIVE.Text.Textarea).setDOM(f.element()),a=m.runExtensions("selectionRange",{});e.call(this,i,a,!$(this).is(".applied")),m.runExtensions("renderTextArea",{textArea:i}),n?$(this).closest("ul").children().each(function(e,t){$(t).children().removeClass("applied")}):$(this).toggleClass("applied"),h.updateFontRelatedMenu(f),u("text_style")}}function d(e,t){t.preventDefault();var n=(new INKIVE.Text.Textarea).setDOM(f.element()),i=m.runExtensions("selectionRange",{});n.text.setTextCase(i.start,i.end,e),m.runExtensions("renderTextArea",{textArea:n}),u("text_case")}function u(e){var t=INKIVE.Tool.getInstance();INKIVE.History.onChange(e,null,t.editor.getSvgString())}function p(e,t){if(t!==!0&&t!==!1){var n=f.element().getAttribute("id");t=!INKIVE.DesignFacade.get(n)[e]}var i={};i[e]=t,INKIVE.DesignFacade.set(i),INKIVE.Menus.elementPopupMenu.refresh()}var h=this.popupMenuCommonFunctions,m=INKIVE.Tool.getInstance().editor.canvas,f=$(t).popupmenu()[0],g=null;f.button("on_imageFilter").on("click",function(){$(this).filterpicker({$svgImageElement:$(t)})}),f.button("on_align-vertical-middle").on("click",function(){INKIVE.EditorFacade.handle("align","vertical_middle")}),f.button("on_align-horizontal-middle").on("click",function(){INKIVE.EditorFacade.handle("align","horizontal_middle")}),f.button("on_align-left").on("click",function(){INKIVE.EditorFacade.handle("align","left")}),f.button("on_align-right").on("click",function(){INKIVE.EditorFacade.handle("align","right")}),f.button("on_align-top").on("click",function(){INKIVE.EditorFacade.handle("align","top")}),f.button("on_align-bottom").on("click",function(){INKIVE.EditorFacade.handle("align","bottom")}),f.button("on_explode_sticker").on("click",function(){var e=f.element(),t=$(e).find(".textarea.subelement, .layoutBox.subelement").length>0,i=_.partial(INKIVE.DesignFacade.handle,e.getAttribute("id"),"explode");t&&n(e,i),t||i()}),f.button("on_opacity").on("start",$.noop).on("change",function(e,t){m.changeSelectedAttributeNoUndo("opacity",parseInt(t)/100,[f.element()])}).on("stop",function(e,t){INKIVE.DesignFacade.set({opacity:parseInt(t)/100}),$(f.element()[0]).is("image")&&m.runExtensions("showBackgroundPopupMenu")}),f.button("on_stroke").on("start",$.noop).on("change",function(e,t){if($(this).find("svg line").attr("stroke-width",t),$(this).find(".stroke-dasharray").toggle(t>0),$(f.element()).hasClass("textarea")){var n=(new INKIVE.Text.Textarea).setDOM(f.element());n.text.stroke_width=parseInt(t),m.runExtensions("renderTextArea",{textArea:n})}else m.setStrokeWidth(parseInt(t),h.getElemsForStrokeChange(f.element()))}).on("stop",function(e,t){var n=INKIVE.DesignFacade.get(f.element().getAttribute("id"));switch(n.type){case"text":INKIVE.DesignFacade.set({stroke:{width:t}});break;case"shape":INKIVE.DesignFacade.set({stroke:{width:t}});break;case"sticker":var i={};_.each(n.shapes,function(e,n){i[n]={stroke:{width:t}}}),INKIVE.DesignFacade.set({shapes:i})}}),f.button("on_sendForward").on("click",function(){INKIVE.DesignFacade.handle(f.element().getAttribute("id"),"send_forward")}),f.button("on_sendBackward").on("click",function(){INKIVE.DesignFacade.handle(f.element().getAttribute("id"),"send_backward")}),f.button("on_sendTop").on("click",function(){INKIVE.DesignFacade.handle(f.element().getAttribute("id"),"send_top")}),f.button("on_sendBottom").on("click",function(){INKIVE.DesignFacade.handle(f.element().getAttribute("id"),"send_bottom")}),f.button("on_rotateLeft").on("click",_.partial(i,-10)),f.button("on_rotateRight").on("click",_.partial(i,10)),f.button("on_setBackground").on("click",function(){INKIVE.EditorFacade.handle(f.element().getAttribute("id"),"set_as_background"),f.destroy()}),f.button("on_backgroundReposition").on("click",function(){INKIVE.EditorFacade.handle("background","crop")}),f.button("on_removeElement").on("click",function(){var e=_.map(INKIVE.Tool.getInstance().editor.canvas.getSelectedElems(),function(e){return e.getAttribute("id")});_.each(e,function(e){INKIVE.DesignFacade.handle(e,"delete")}),f.destroy()}),f.button("on_copyElement").on("click",function(){INKIVE.DesignFacade.handle(f.element().getAttribute("id"),"duplicate"),INKIVE.Tool.blinkScreen(f.element())}),f.button("on_reposition").on("click",function(){var e=$(f.element()).is(".sticker")?$(f.element()).find("image"):$(f.element());INKIVE.EditorFacade.handle(e.attr("id"),"crop")}),f.button("on_crop").on("click",function(){var e=f.element().getAttribute("id");INKIVE.EditorFacade.handle(e,"crop")}),f.button("on_lockImage").on("click",function(){INKIVE.DesignFacade.set({locked_image:!0})}),f.button("on_unlockImage").on("click",function(){INKIVE.DesignFacade.set({locked_image:!1})}),f.button("on_flipImageH").on("click",function(){return $("#"+m.getSelectedElems()[0].id+"-loader").length?void m.call("advice.show","image-flip-disabled"):void INKIVE.DesignFacade.set({flipped:{horizontal:!0}})}),f.button("on_flipImageV").on("click",function(){return $("#"+m.getSelectedElems()[0].id+"-loader").length?void m.call("advice.show","image-flip-disabled"):void INKIVE.DesignFacade.set({flipped:{vertical:!0}})}),f.button("on_flipBackgroundH").on("click",function(){return $("#"+m.getSelectedElems()[0].id+"-loader").length?void m.call("advice.show","image-flip-disabled"):void INKIVE.DesignFacade.set({flipped:{horizontal:!0}})}),f.button("on_flipBackgroundV").on("click",function(){return $("#"+m.getSelectedElems()[0].id+"-loader").length?void m.call("advice.show","image-flip-disabled"):void INKIVE.DesignFacade.set({flipped:{vertical:!0}})}),f.button("on_imageBox").on("click",function(){INKIVE.EditorFacade.handle("convert_to_image_box")}),f.button("on_set_permissions").on("click",function(){$('.tool-menu li > a[href="#tabRestrictions"]').trigger("click"),$(".simplified-restrictions").is(".hidden")||m.call("advice.show","choose-restriction-option")}),f.button("on_layoutConfirm").on("click",function(){$(f.element()).trigger("dblclick")}),f.button("on_layoutClose").on("click",function(){var e=$(".clipperImage .layoutClipperImage")[0];m.runExtensions("cropLayoutContent",{layout:e,elem:e,hasChanges:!1})});var v=INKIVE.C.IS_MOBILE_APP&&(!window.Android&&INKIVE.Helpers.mobileVersion.isGreaterThan("1.1.1")||window.Android&&!INKIVE.Helpers.mobileVersion.isLowerThan("1.1.3"));v&&f.button("on_fontfamily").on("click",function(){var e=$(f.button("on_fontfamily")),t=$(f.element()).is("text")?f.element():$(f.element()).find("text")[0],n={font_family:t.getAttribute("font-family")};"bold"===t.getAttribute("font-weight")&&(n.font_weight=t.getAttribute("font-weight")),"italic"===t.getAttribute("font-style")&&(n.font_style=t.getAttribute("font-style")),t.getAttribute("text-decoration")&&(n.text_decoration=t.getAttribute("text-decoration"));var i="";$(t).children().each(function(){i+=$(this).text(),i+=$(this).hasClass("eol")?"\n":" "}),AppBridge.callBoth("pick_font",_.extend(n,{text:i,font_size:parseFloat($(f.button("on_fontsize")).find("input").val()),position:_.extend(e.offset(),{height:e.height(),width:e.width()})})),AppBridge.off("ik.editor.text_update"),AppBridge.on("ik.editor.text_update",function(e,t){t={font:{family:t.font_family,size:t.font_size}},AppBridge.design.set(t),INKIVE.Tool._cache.favFonts=null,h.updateFontRelatedMenu(f),t.font.size&&f.button("on_fontsize").find("input").val(parseInt(t.font.size))}),e.removeClass("active").find(".ui-dropdown-items").removeAttr("style")}),f.button("on_fontfamily").on("change",function(e,t,n,i){function a(){i||isNaN(o.text.font_weight)||(i="normal"),o.text.setPartialStyling(r.start,r.end,"font-weight",i),m.runExtensions("renderTextArea",{textArea:o}),u("font_family"),h.updateFontRelatedMenu(f)}if(!$(e.target).is("input")){
INKIVE.Tool._cache.favFonts=null;var o=(new INKIVE.Text.Textarea).setDOM(f.element()),r=m.runExtensions("selectionRange",{});n=n?n.replace(/'/g,"\\'"):t.replace(/'/g,"\\'");var s=/\b[0-9]+\b/g;s.test(n)&&(n="'"+n+"'"),o.text.setPartialStyling(r.start,r.end,"font-family",n);var l=function(){var e=!1;return $(o.dom).find("tspan").each(function(){$(this).attr("font-family")&&(e=!0)}),e};l()&&r.start===r.end&&0===r.start?INKIVE.Modal.alertMessage(INKIVE.TemplatesHelper("alert_span",{text:INKIVE.TranslateHelper.translate("modal.alert.apply_to_whole_test")}),{callback:[function(){var e=[];_.each(o.text.styles,function(t){"font-family"!==t.attribute&&e.push(t)}),o.text.styles=e,a()},a]}):a()}}),f.button("on_fontsize").on("change",function(e,t){function i(){t=parseInt(t);var e=(new INKIVE.Text.Textarea).setDOM(o),n=m.runExtensions("selectionRange",{});e.text.setPartialStyling(n.start,n.end,"font-size",t),m.runExtensions("renderTextArea",{textArea:e}),u("text_size")}function a(){INKIVE.DesignFacade.handle(r.getAttribute("id"),"explode")}if(t){var o=f.element(),r=$(o).closest("g.element.sticker")[0];r||i(),r&&n(r,function(){a(),i()}),$(this).find("input").val(t)}}),f.button("on_finishTextEditing").on("click",function(){m.runExtensions("endEditing",{})}),f.button("on_textEditing").on("click",function(){m.runExtensions("beginTextEditing",{elem:f.element()}),!INKIVE.C.IS_DEV&&!INKIVE.C.IS_MOBILE&&ga("send",{hitType:"event",eventCategory:"Editor UI | Popupmenu | text",eventAction:"editing"})}),f.button("on_textTyping").on("click",function(){m.runExtensions("beginTextTyping",{elem:f.element()}),!INKIVE.C.IS_DEV&&!INKIVE.C.IS_MOBILE&&ga("send",{hitType:"event",eventCategory:"Editor UI | Popupmenu | text",eventAction:"typing"})}),f.button("on_set-align-justify").on("click",function(){f.button("on_text-align").find(">i").hasClass("desygner-icon-text-align-justify")||(f.button("on_set-word-spacing").find("input").trigger("keyup",!0),f.button("on_set-char-spacing").find("input").trigger("keyup",!0),INKIVE.DesignFacade.set({anchor:"justify"}),o("justify"),f.button("on_text-align").find("i").get(0).className="desygner-icon-text-align-justify")}),f.button("on_set-align-left").on("click",function(){INKIVE.DesignFacade.set({anchor:"start"}),o("left"),f.button("on_text-align").find("i").get(0).className="desygner-icon-text-align-left"}),f.button("on_set-align-center").on("click",function(){INKIVE.DesignFacade.set({anchor:"middle"}),o("center"),f.button("on_set-bullets").removeClass("applied"),f.button("on_text-align").find("i").get(0).className="desygner-icon-text-align-center"}),f.button("on_set-align-right").on("click",function(){INKIVE.DesignFacade.set({anchor:"end"}),o("right"),f.button("on_set-bullets").removeClass("applied"),f.button("on_text-align").find("i").get(0).className="desygner-icon-text-align-right"}),f.button("on_set-line-spacing").on("start",$.noop).on("change",function(e,t){var n=(new INKIVE.Text.Textarea).setDOM(f.element());n.text.setValues({line_spacing:parseInt(t)}),m.runExtensions("renderTextArea",{textArea:n})}).on("stop",function(e,t){INKIVE.DesignFacade.set({spacing:{line:parseInt(t)}})}),f.button("on_set-word-spacing").on("start",function(){f.button("on_set-underline").is(".applied")&&INKIVE.DesignFacade.set({text_decoration:"none"})}).on("change",function(e,t){var n=(new INKIVE.Text.Textarea).setDOM(f.element());n.text.setValues({word_spacing:parseInt(t)}),m.runExtensions("renderTextArea",{textArea:n})}).on("stop",function(e,t){INKIVE.DesignFacade.set({spacing:{word:parseInt(t)}}),h.updateFontRelatedMenu(f)}),f.button("on_set-char-spacing").on("start",function(){f.button("on_set-underline").is(".applied")&&INKIVE.DesignFacade.set({text_decoration:"none"})}).on("change",_.throttle(function(e,t){var n=(new INKIVE.Text.Textarea).setDOM(f.element()),i=n.text.letter_spacing;_.isArray(i)&&!g&&(g=i),i=g||i,n.text.setValues({letter_spacing:h.calculateDx(t,i)}),m.runExtensions("renderTextArea",{textArea:n})},300)).on("stop",function(e,t){INKIVE.DesignFacade.set({spacing:{letter:parseInt(t)}}),h.updateFontRelatedMenu(f)}),f.button("on_set-bullets").on("click",function(e){e.preventDefault(),INKIVE.DesignFacade.set({bullet_points:!$(this).hasClass("applied")})}),f.button("on_set-auto-adjustable").on("click",function(e){e.preventDefault(),INKIVE.DesignFacade.set({auto_adjustable:!$(this).hasClass("applied")})}),INKIVE.DesignFacade.off("text.update.bullet_points",r).on("text.update.bullet_points",r).off("text.update.auto_adjustable",s).on("text.update.auto_adjustable",s).off("text.update.anchor",l).on("text.update.anchor",l),f.button("on_set-bold").on("click",_.partial(c,function(e,t,n){e.text.setPartialStyling(t.start,t.end,"font-weight",n?"bold":"normal")})),f.button("on_set-italic").on("click",_.partial(c,function(e,t,n){e.text.setPartialStyling(t.start,t.end,"font-style",n?"italic":"normal")})),f.button("on_set-underline").on("click",_.partial(c,function(e,t,n){e.text.setPartialStyling(t.start,t.end,"text-decoration",n?"underline":"normal")})),f.button("on_removePartialStyle").on("click",_.partial(c,function(e,t){e.text.removePartialStyling(t.start,t.end)})),f.button("on_set-ucase").on("click",_.partial(d,!0)),f.button("on_set-lcase").on("click",_.partial(d,!1)),f.button("on_set-left").on("click",function(){m.moveSelectedElements(-10,0)}),f.button("on_set-right").on("click",function(){m.moveSelectedElements(10,0)}),f.button("on_set-up").on("click",function(){m.moveSelectedElements(0,-10)}),f.button("on_set-down").on("click",function(){m.moveSelectedElements(0,10)}),f.button("on_flipH").on("click",function(){INKIVE.DesignFacade.handle("flip_horizontal")}),f.button("on_flipV").on("click",function(){INKIVE.DesignFacade.handle("flip_vertical")}),f.button("on_groupGroup").on("click",function(){INKIVE.DesignFacade.create("group")}),f.button("on_groupUngroup").on("click",function(){INKIVE.DesignFacade.handle("ungroup"),m.clearSelection()}),f.button("on_lockElement").on("click",_.partial(p,"locked",!0)),f.button("on_unlockElement").on("click",_.partial(p,"locked",!1)),f.button("on_increaseElement").on("click",function(){new INKIVE.Gesture(m).testResize(f.element())}),f.button("on_decreaseElement").on("click",function(){new INKIVE.Gesture(m).testResize(f.element(),!0)}),f.button("on_imageTab").on("click",function(){m.clearSelection(),$('[data-toggle="tab"][href="#tabImages"]').tab("show")}),f.button("on_set-source").on("click",function(){var t=e("../../../modal/prompt"),n=new t({label:INKIVE.TranslateHelper.translate("modal.prompt.add_video")}),i=INKIVE.Modal.modalWindow(n.getFormHtml(),{width:400,headerIcon:"fa fa-film",headerTitle:"tool.customize.add_video",buttons:[{title:INKIVE.TranslateHelper.translate("modal.buttons.add_video"),onClick:function(){i.close();var e=n.getValue();e&&INKIVE.DesignFacade.set({source:e})}}]})}),f.button("on_toggle-autoplay").on("click",_.partial(p,"autoplay")),f.button("on_toggle-move-to-next").on("click",_.partial(p,"movetonext")),f.button("on_toggle-controls").on("click",_.partial(p,"controls")),f.button("on_toggle-fullscreen").on("click",_.partial(p,"fullscreen")),f.button("on_toggle-loop").on("click",_.partial(p,"loop")),f.button("on_toggle-mute").on("click",_.partial(p,"mute")),f.button("on_restrictionInfo").on("click",function(){var e=m.getSelectedElems()[0].id,t=INKIVE.RestrictionsFacade.shownRestrictionMessages[e];t&&toastr.info(t)}),f.button("on_library_add").on("click",function(){a.addElementToLibrary(f.element())}),f.button("on_deselect").on("click",function(){m.clearSelection(),m.runExtensions("selectedChanged")})}})},{"../../../factory/library/library-populator":110,"../../../modal/prompt":139,"./popupmenu-common-functions":183}],186:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){return'<div class="scroll-handler scroll-handler-left">\n  <i class="fa fa-angle-left">\n  </i>\n</div>\n<div class="element-popupmenu menu">\n  <div class="special-buttons">\n    <ul>\n    </ul>\n  </div>\n  <div class="specific-buttons">\n    <ul>\n    </ul>\n  </div>\n  <div class="common-buttons">\n    <ul>\n    </ul>\n  </div>\n</div>\n<div class="root-popupmenu menu">\n  <div class="special-buttons">\n  </div>\n  <div class="root-buttons">\n    <ul>\n    </ul>\n  </div>\n  <div class="common-buttons">\n  </div>\n</div>\n<div class="scroll-handler scroll-handler-right fa angle-double-right">\n  <i class="fa fa-angle-right">\n  </i>\n</div>'},useData:!0})},{"hbsfy/runtime":535}],187:[function(e,t,n){var i=e("./template.hbs"),a=(e("../../facade/editor/editor"),e("../../facade/design/design"),e("../../facade/project/project"),e("./content/popupmenu-buttons"));t.exports=Backbone.View.extend({popupMenuButtons:null,initialize:function(){_.bindAll(this,"hide","removeElementEvent"),this.popupMenuButtons=new a,INKIVE.DesignFacade.on("delete",this.removeElementEvent)},render:function(e,t){if(e&&e.length){if(this.$el.html()||this.$el.html(i()),this.hide(),1!==e.length||!t)if(1===e.length){var n=e[0];if(!n)return;$(n).hasClass("element")||$(n).addClass("element"),t="g"===n.tagName||$(n).closest("g").is(".background")||$(n).is(".logo")?INKIVE.DesignFacade.getType(n):$(n).hasClass("layoutClipperImage")?"layout":"a"===n.tagName?$(n).hasClass("video")?"video":"link":n.tagName}else t="multiselect";this.show(e[0],t)}},show:function(e,t){$("#workarea").css("cursor",""),this.popupMenuButtons.buildPopupMenu(e,t,this.$el)},hide:function(){this.canvas=this.canvas||INKIVE.Tool.getInstance().editor.canvas,_.each($(".element-popupmenu"),_.bind(function(e){var t=$(e).attr("data-element-id"),n=$("#svgcontent").find("#"+t);this.popupMenuButtons.fontMenu&&this.popupMenuButtons.fontMenu.detach(),n.length&&n.data("popupmenu")&&n.popupmenu("destroy")},this)),$(".element, .subelement, .background rect, .background image, .main>rect, .main>path").each(function(){var e=$(this);e.data("popupmenu")&&e.popupmenu("destroy")}),this.$el.find(".element-popupmenu>div>ul").empty(),this.$el.find(".scroll-handler i").off("click"),this.$el.find(".scroll-handler").hide(),this.$el.find(".element-popupmenu").css("display","none"),this.$el.find(".element-popupmenu").css("left",0),this.$el.find(".root-popupmenu").css("display","flex")},refresh:function(){this.hide(),this.render(this.canvas.getSelectedElems())},removeElementEvent:function(){this.hide(),this.canvas.runExtensions("clear",{})}})},{"../../facade/design/design":34,"../../facade/editor/editor":76,"../../facade/project/project":89,"./content/popupmenu-buttons":182,"./template.hbs":186}],188:[function(e,t,n){var i=e("../factory/images"),a={container:e("./templates/filterpicker/container.hbs"),SVGImageFiltred:e("./templates/filterpicker/svg-image-filtred.hbs")};!function(t){INKIVE.C.IS_MOBILE_APP||t.fn.extend({filterpicker:function(n){function o(e,t,n){return r(e,-100,100,t,n)}function r(e,t,n,i,a){e=parseFloat(e),i="undefined"==typeof i?-100:i,a="undefined"==typeof a?100:a;var o=a-i,r=(e-i)/o,s=n-t;return t+s*r}function s(){var e=x.find(".slider-wrapper.saturation-slider-wrapper input").val();if(0!=e){var t=document.createElementNS(C,"feColorMatrix");if(e<0)t.setAttribute("type","saturate"),t.setAttribute("values",T.to.saturation(e));else{var n=T.to.matrixSaturation(e),i=-.3*n,a=1+.7*n;t.setAttribute("type","matrix"),t.setAttribute("values",a+" "+i+" "+i+" 0 0 "+i+" "+a+" "+i+" 0 0 "+i+" "+i+" "+a+" 0 0 0 0 0 1 0")}return t}}function l(){var e=x.find(".slider-wrapper.blur-slider-wrapper input").val();if(0!=e){if(e>0){var t=document.createElementNS(C,"feGaussianBlur");return t.setAttribute("stdDeviation",T.to.blur(e)),t}var n=T.to.sharpen(e),i=-1*n,a=1+4*n,o=document.createElementNS(C,"feConvolveMatrix");return o.setAttribute("order","3 3"),o.setAttribute("preserveAlpha","true"),o.setAttribute("kernelMatrix","0 "+i+" 0 "+i+" "+a+" "+i+" 0 "+i+" 0"),o}}function c(){var e=x.find(".slider-wrapper.brightness-slider-wrapper input").val();if(0!=e){var t=T.to.brightness(e),n=document.createElementNS(C,"feComponentTransfer");return _.each(["R","G","B"],function(e){var i=document.createElementNS(C,"feFunc"+e);i.setAttribute("type","linear"),i.setAttribute("slope",t),n.appendChild(i)}),n}}function d(){var e=x.find(".slider-wrapper.contrast-slider-wrapper input").val();if(0!=e){var t=T.to.contrast(e),n=.5-.5*t,i=document.createElementNS(C,"feComponentTransfer");return _.each(["R","G","B"],function(e){var a=document.createElementNS(C,"feFunc"+e);a.setAttribute("type","linear"),a.setAttribute("slope",t),a.setAttribute("intercept",n),i.appendChild(a)}),i}}function u(){var e=x.find(".slider-wrapper.x-process-slider-wrapper input").val();if(0!=e){var t=document.createElementNS(C,"feColorMatrix");return t.setAttribute("type","hueRotate"),t.setAttribute("values",T.to.hue(e)),t}}function p(e,t){function i(){if(t=t||n.$svgImageElement,t.hasClass("layoutBox")){var e=t.get(0).textContent.replace(/[^\d.-\s]/g,"").split(" ");return{leftOffset:parseFloat(e[0]),topOffset:parseFloat(e[1]),width:parseFloat(e[2]),height:parseFloat(e[3])}}return{leftOffset:parseFloat(t.attr("x")),topOffset:parseFloat(t.attr("y")),width:parseFloat(t.attr("width")),height:parseFloat(t.attr("height"))}}var a=x.find(".slider-wrapper.vignette-slider-wrapper input").val();if(0!=a){var o=(T.to.vignetteOpacity(a),T.to.vignetteSpecular(a)),r=i(),s=document.createElementNS(C,"feFlood"),l=document.createElementNS(C,"fePointLight"),c=document.createElementNS(C,"feSpecularLighting"),d=document.createElementNS(C,"feBlend"),u=document.createElementNS(C,"feBlend");return s.setAttribute("result","blackfield-"+e),s.setAttribute("x",r.leftOffset+"px"),s.setAttribute("y",r.topOffset+"px"),s.setAttribute("width",r.width+"px"),s.setAttribute("height",r.height+"px"),l.setAttribute("x",r.leftOffset+r.width/2),l.setAttribute("y",r.topOffset+r.height/2),l.setAttribute("z",_.min([r.width,r.height])),c.setAttribute("result","spotlight-"+e),c.setAttribute("lighting-color","#FFFFFF"),c.setAttribute("surfaceScale","1"),c.setAttribute("specularConstant","1"),c.setAttribute("specularExponent",o),c.setAttribute("x",r.leftOffset+"px"),c.setAttribute("y",r.topOffset+"px"),c.setAttribute("width",r.width+"px"),c.setAttribute("height",r.height+"px"),c.appendChild(l),d.setAttribute("result","A-"+e),d.setAttribute("in","blackfield-"+e),d.setAttribute("in2","spotlight-"+e),d.setAttribute("mode","lighten"),u.setAttribute("result","B-"+e),u.setAttribute("in","A-"+e),u.setAttribute("in2","SourceGraphic"),u.setAttribute("mode","multiply"),[s,c,d,u]}}function h(){var e=document.createElementNS(C,"defs"),t=n.$svgImageElement.closest("svg");return t.children("defs").length||t.prepend(e),t.children("defs").get(0)}function m(){function e(e){var n=x.find(".presets-container");_.each(S,function(i){var o="filter-thumb-"+i.className,r=i.template({filter_id:o}),s=t("<li>",{"class":"thumb "+i.className,html:a.SVGImageFiltred({width:110,height:110,image:e,filter_id:o,filter:r})});s.append('<span class="filter-name">'+i.name+"</span>"),n.append(s)})}function n(e){var n=x.find(".svg-container");t(a.SVGImageFiltred({width:400,height:400,image:e,filter_id:"filtered-image-preview",filter:_.findWhere(S,{name:"Normal"}).template()})).appendTo(n)}var i=t.Deferred();return x=t(a.container()),E().then(function(t){x.on("change",I),x.tabs(),e(t),n(t),i.resolve()}),i.promise()}function f(e,t){t=t||0;var i=(e.width()||400)+t,a=(e.height()||400)+t,o=i/a,r=parseInt(n.$svgImageElement.attr("width")),s=parseInt(n.$svgImageElement.attr("height")),l=r/s;return{width:l>o?a*l:i,height:l>o?a:i/l}}function g(){E().then(function(e){var t=x.find(".svg-container"),n=t.find("image"),i=f(t,4);n.attr("xlink:href",e),n.attr("width",i.width),n.attr("height",i.height),t.find("svg").attr("width",i.width),t.find("svg").attr("height",i.height)})}function v(){var e=x.find(".presets-container");e.hasClass("slick-slider")&&e.slick("unslick"),e.slick({prevArrow:'<span class="prev btn btn-green"><i class="icon-chevron-left"></i></span>',nextArrow:'<span class="next btn btn-green"><i class="icon-chevron-right"></i></span>',infinite:!0,slidesToShow:4,slidesToScroll:2})}function b(){E().then(function(e){var t=x.find(".presets-container"),n=t.find("li"),i=n.find("image");i.attr("xlink:href",e),t.hide(),INKIVE.Modal.loader(t.parent()),t.hasClass("slick-slider")&&t.slick("slickGoTo",0),_.delay(function(){n.width(n.width()||n.height()),INKIVE.Modal.loaderClose(t.parent()),t.show(),v();var e=f(n,2);i.attr("width",e.width),i.attr("height",e.height),n.find("svg").attr("width",e.width),n.find("svg").attr("height",e.height),w&&w.refresh()},2e3)})}function y(e){function n(){function e(e,i,a,o){o=isNaN(o)?0:Math.round(o);var r=t('<div class="slider-wrapper"><div class="slider"></div></div>'),s=t('<input type="text" />').val(o);r.append(s),r.addClass(e+"-slider-wrapper"),d.append(r),s.on("click",function(e){e.stopPropagation()}),s.keyup(function(e){var n=parseInt(t(this).val())||0;n>a?n=a:n<i&&(n=i),t(this).val(n),l.slider("option","value",n),x.trigger("change")});var l=r.children(".slider").slider({max:a,min:i,value:o,slide:function(e,t){s.val(t.value),x.trigger("change")}});l.slider("float"),r.prepend(t("<label>",{text:n("filterpicker.sliders."+e)}))}var n=INKIVE.TranslateHelper.translate;d.empty(),e("brightness",-100,100),e("contrast",-100,100),e("saturation",-100,100),e("blur",-100,100),e("x-process",-100,100),e("vignette",0,100)}function i(){var t=e.find("feComponentTransfer feFuncR:not([intercept])");return t.length?c.brightness(t.attr("slope")):0}function a(){var t=e.find("feComponentTransfer feFuncR[intercept]");return t.length?c.contrast(t.attr("slope")):0}function o(){var t=e.find('feColorMatrix[type="saturate"]'),n=e.find('feColorMatrix[type="matrix"]');if(t.length)return c.saturation(t.attr("values"));if(n.length){var i=n.attr("values");return c.matrixSaturation((i.split(" ")[0]-1)/.7)}return 0}function r(){var t=e.find('feColorMatrix[type="hueRotate"]');return t.length?c.hue(t.attr("values")):0}function s(){var t=e.find("feSpecularLighting");return t.length?c.vignetteSpecular(t.attr("specularExponent")):0}function l(){var t=e.find("feGaussianBlur"),n=e.find("feConvolveMatrix");if(t.length)return c.blur(t.attr("stdDeviation"));if(n.length){var i=n.attr("kernelMatrix");return c.sharpen(parseFloat(i.split(" ")[1])*-1)}return 0}var c=T.from,d=x.find(".sliders-container");n(),d.find(".blur-slider-wrapper input").val(l()),d.find(".x-process-slider-wrapper input").val(r()),d.find(".vignette-slider-wrapper input").val(s()),d.find(".contrast-slider-wrapper input").val(a()),d.find(".brightness-slider-wrapper input").val(i()),d.find(".saturation-slider-wrapper input").val(o()),d.find("input").trigger("keyup")}function I(){function e(){n.innerHTML="";var e=_.compact(_.flatten(_.map([p,s,c,d,l,u],function(e){return e("filtered-image-preview",i)})));return _.each(e,function(e){n.appendChild(e)}),e.length>0}var t=x.find("#filtered-image-preview"),n=t.get(0),i=t.closest("svg").find("image"),a=e();a&&i.attr("filter","url(#filtered-image-preview)"),a||i.removeAttr("filter")}function E(){function e(e,t){function n(){i.src=e.shift()}var i=new Image;n(),i.onload=function(){t(i.src)},i.onerror=function(){e.length&&n()}}var a=t.Deferred(),o=n.$svgImageElement[0].getAttribute("xlink:href");if(INKIVE.Helpers.isDataURL(o)){var o=i.getImageUrl(n.$svgImageElement[0]);if(k[o])return k[o].promise();k[o]=a,e([i.getVersionUrl(o,"tab"),o],a.resolve)}else a.resolve(o);return a.promise()}var w,x,k={},C="http://www.w3.org/2000/svg";n=t.extend({defaultFilter:null,$svgImageElement:null},n);var S=[{name:"Normal",className:"thumb-normal",template:_.template('<feColorMatrix type="saturate" values="1"></feColorMatrix>')},{name:"Cali",className:"thumb-cali",template:e("./templates/filterpicker/filter-cali.hbs")},{name:"Drama",className:"thumb-drama",template:e("./templates/filterpicker/filter-drama.hbs")},{name:"Edge",className:"thumb-edge",template:e("./templates/filterpicker/filter-edge.hbs")},{name:"Epic",className:"thumb-epic",template:e("./templates/filterpicker/filter-epic.hbs")},{name:"Festive",className:"thumb-festive",template:e("./templates/filterpicker/filter-festive.hbs")},{name:"Grayscale",className:"thumb-grayscale",template:e("./templates/filterpicker/filter-grayscale.hbs")},{name:"Nordic",className:"thumb-nordic",template:e("./templates/filterpicker/filter-nordic.hbs")},{name:"Street",className:"thumb-street",template:e("./templates/filterpicker/filter-street.hbs")},{name:"The blues",className:"thumb-the-blues",template:e("./templates/filterpicker/filter-the-blues.hbs")}],T={to:{hue:function(e){return r(e,-180,180)},blur:function(e){return r(e,-10,10)},sharpen:function(e){return r(e,-1,1)*-1},contrast:function(e){return r(e,0,2)},brightness:function(e){return r(e,0,2)},saturation:function(e){return r(e,0,2)},matrixSaturation:function(e){return r(e,-1,1)},vignetteOpacity:function(e){return.7+r(e,0,.3,0,100)},vignetteSpecular:function(e){return r(e,0,30,0,100)}},from:{hue:function(e){return o(e,-180,180)},blur:function(e){return o(e,-10,10)},sharpen:function(e){return o(e,-1,1)*-1},contrast:function(e){return o(e,0,2)},brightness:function(e){return o(e,0,2)},saturation:function(e){return o(e,0,2)},matrixSaturation:function(e){return o(e,-1,1)},vignetteSpecular:function(e){return r(e,0,100,0,30)}}};return this.each(function(e){function i(){t("#filter-picker").remove(),m().then(function(){o(),a(),_.defer(r)})}function a(){x.find(".presets-container li").off("click").on("click",function(e){e.stopPropagation();var n=t("#filtered-image-preview"),i=n.closest("svg").find("image"),a=t(this).attr("class").split(/\s+/),o=_.find(S,function(e){return _.contains(a,e.className)});o&&(n.html(o.template({filter_id:"filtered-image-preview"})),i.attr("filter","url(#filtered-image-preview)"),y(n),x.trigger("change"))}),x.off("change").on("change",I)}function o(){var e=_.debounce(function(){x.trigger("change"),f()},400);n.$svgImageElement.on("change",function(){t("#"+v).length&&(r(),e())})}function r(){g(),b(),y(t("#"+v))}function f(){function e(){var e=document.createElementNS(C,"filter");e.setAttribute("id",i);var t=_.compact(_.flatten(_.map([p,s,c,d,l,u],function(e){return e(i)})));return _.each(t,function(t){e.appendChild(t)}),a&&t.length&&a.appendChild(e),t.length>0}var i="filter_"+n.$svgImageElement.attr("id"),a=h(),o=INKIVE.Tool.getInstance().editor;for(o.canvas;t("#"+i).length;)t("#"+i).remove();var r=e();r&&n.$svgImageElement.attr("filter","url(#"+i+")"),r||n.$svgImageElement.removeAttr("filter"),t("[data-action=on_imageFilter]").toggleClass("applied",r),w&&w.close()}var v=(t(this),"filter_"+n.$svgImageElement.attr("id"));w&&w.close(),i();var E=.8*t(window).width();E>800&&(E=800);var k=INKIVE.TranslateHelper.translate;w=INKIVE.Modal.modalWindow(x,{width:E,headerIcon:"icon-filters",headerTitle:"Filters",buttons:[{title:k("editor.apply"),onClick:f}]})})}})}(jQuery)},{"../factory/images":102,"./templates/filterpicker/container.hbs":194,"./templates/filterpicker/filter-cali.hbs":195,"./templates/filterpicker/filter-drama.hbs":196,"./templates/filterpicker/filter-edge.hbs":197,"./templates/filterpicker/filter-epic.hbs":198,"./templates/filterpicker/filter-festive.hbs":199,"./templates/filterpicker/filter-grayscale.hbs":200,"./templates/filterpicker/filter-nordic.hbs":201,"./templates/filterpicker/filter-street.hbs":202,"./templates/filterpicker/filter-the-blues.hbs":203,"./templates/filterpicker/svg-image-filtred.hbs":204}],189:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({1:function(e,t,n,i,a){return' style="height: 0; padding-bottom: '+e.escapeExpression(e.lambda(t,t))+'%;"'},compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){var o,r,s,l='<div class="thumbnail add">\n  <a href="#"';return r=null!=(r=n.padding||(null!=t?t.padding:t))?r:n.helperMissing,s={name:"padding",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a},o="function"==typeof r?r.call(null!=t?t:e.nullContext||{},s):r,n.padding||(o=n.blockHelperMissing.call(t,o,s)),null!=o&&(l+=o),l+'><i class="icon-plus"></i></a>\n</div>\n'},useData:!0})},{"hbsfy/runtime":535}],190:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({1:function(e,t,n,i,a){var o=null!=t?t:e.nullContext||{},r=n.helperMissing,s=e.escapeExpression;return'      <a class="tool-icon add-page" tag="'+s((n.t||t&&t.t||r).call(o,"page_order.new",{name:"t",hash:{},data:a}))+'"><i class="icon-plus"></i></a>\n      <a class="tool-icon copy-page" tag="'+s((n.t||t&&t.t||r).call(o,"editor.duplicate",{name:"t",hash:{},data:a}))+'"><i class="icon-copy"></i></a>\n'},3:function(e,t,n,i,a){return'  <div class="page-submenu">\n    <a class="tool-icon top show-pagemenu" data-popover="tooltip" data-original-title="'+e.escapeExpression((n.t||t&&t.t||n.helperMissing).call(null!=t?t:e.nullContext||{},"page_order.show_menu",{name:"t",hash:{},data:a}))+'">\n      <i class="icon-chevron-down"></i>\n    </a>\n  </div>\n'},compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){var o,r,s,l=null!=t?t:e.nullContext||{},c=n.helperMissing,d="function",u=e.escapeExpression,p=n.blockHelperMissing,h='<div class="page-order-wrapper"><!--\n--><a class="block">\n  <div class="loader-wrapper dark">\n    <div class="int-loader">\n    </div>\n  </div>\n  <img data-src="'+u((r=null!=(r=n.thumb||(null!=t?t.thumb:t))?r:c,typeof r===d?r.call(l,{name:"thumb",hash:{},data:a}):r))+'"/></a>\n  <a class="hide-pagemenu">\n    <span>'+u((n.t||t&&t.t||c).call(l,"general.cancel",{name:"t",hash:{},data:a}))+'</span><span class="icon-remove"></span>\n  </a>\n\n  <div class="page-menu">\n    <div class="info help">'+u((n.t||t&&t.t||c).call(l,"page_order.select",{name:"t",hash:{},data:a}))+"</div>\n";return r=null!=(r=n.can_add_page||(null!=t?t.can_add_page:t))?r:c,s={name:"can_add_page",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a},o=typeof r===d?r.call(l,s):r,n.can_add_page||(o=p.call(t,o,s)),null!=o&&(h+=o),h+='    <a class="tool-icon delete-page" tag="'+u((n.t||t&&t.t||c).call(l,"editor.delete",{name:"t",hash:{},data:a}))+'"><i class="icon-bin"></i></a>\n  </div>\n\n',r=null!=(r=n.show_page_menu||(null!=t?t.show_page_menu:t))?r:c,s={name:"show_page_menu",hash:{},fn:e.program(3,a,0),inverse:e.noop,data:a},o=typeof r===d?r.call(l,s):r,n.show_page_menu||(o=p.call(t,o,s)),null!=o&&(h+=o),h+"</div>\n\n<p><label>"+u((r=null!=(r=n.page_id||(null!=t?t.page_id:t))?r:c,typeof r===d?r.call(l,{name:"page_id",hash:{},data:a}):r))+"</label></p>\n"},useData:!0})},{"hbsfy/runtime":535}],191:[function(e,t,n){var i=e("./thumb.hbs"),a=e("../../facade/project/project"),o=e("../../factory/page-thumbnail"),r=e("../../facade/restrictions/restrictions"),s=10,l=500;t.exports=Backbone.mixin(Backbone.View.extend({events:{"click .block":"moveToPageEvent",mouseleave:"hidePageSubmenuEvent",mouseenter:"showPageSubmenuEvent","click .add-page":"addPageEvent","click .copy-page":"copyPageEvent","click .delete-page":"deletePageEvent","click .show-pagemenu":"showPageMenuEvent","click .hide-pagemenu":"hidePageMenuEvent"},moveToPageEvent:function(){INKIVE.EditorFacade.handle("page","move_to",{page_number:this.pageNumber})},hidePageSubmenuEvent:function(e){$(e.currentTarget).find(".page-submenu").removeClass("show")},showPageSubmenuEvent:function(e){this.$el.find(".page-menu").is(":visible")||$(e.currentTarget).find(".page-submenu").addClass("show")},addPageEvent:function(){function e(e,n){INKIVE.Modal.togglePageLoader(!1),n&&e&&"false"!=e.success&&a.handle("design","add",{page_number:this.pageNumber+1,size:t(e.pageContent)}).then(_.bind(function(){this.trigger("design_added",this.pageNumber)},this))}function t(e){var t=e.match(/<svg[^>]*>/)[0],n=t.match(/.*width="([^"]*)".*height="([^"]*)"/);return n?{width:n[1],height:n[2]}:(n=t.match(/.*height="([^"]*)".*width="([^"]*)"/),{height:n[1],width:n[2]})}this.trigger("working"),this.hidePageMenuEvent(),INKIVE.Modal.togglePageLoader(!0),INKIVE.Helpers.api("page/by_pagenumber","GET",{page:this.pageNumber,scrapbook_id:INKIVE.C.BOOK.id},_.bind(e,this))},copyPageEvent:function(){this.trigger("working"),this.hidePageMenuEvent(),a.handle("design","copy",{page_number:this.pageNumber}).then(_.bind(this.trigger,this,"design_copied",this.pageNumber))},deletePageEvent:function(){this.trigger("working"),this.hidePageMenuEvent(),a.handle("design","remove",{design_id:this.design.design_id}).then(_.bind(this.trigger,this,"design_deleted",this.pageNumber),_.bind(this.trigger,this,"work_cancelled"))},showPageMenuEvent:function(){this.$el.find(".page-menu").slideDown(),this.$el.find(".hide-pagemenu").fadeIn("fast"),this.$el.find(".page-submenu").removeClass("show")},hidePageMenuEvent:function(){this.$el.find(".page-menu").fadeOut("fast"),this.$el.find(".hide-pagemenu").fadeOut("fast")},initialize:function(e){this.$el.data("page",e.pageNumber),this.pageNumber=e.pageNumber,this.design=a.get("design",{page_number:e.pageNumber}),_.bindAll(this,"loadImage","setPageNumber","onImageLoaded","renderThumbnail","onThumbnailUpdate","render"),this.design&&(INKIVE.C.BOOK.book_type===INKIVE.C.BOOK_TYPE.RESTRICTED_DESIGN?r.initialize().then(this.render):this.render())},setPageNumber:function(e){function t(){var t=a.get("design",{page_number:e});if(this.design.design_id&&t.design_id!=this.design.design_id)throw{userMessage:"An error occur during page order: id does not match"};this.design=t}this.pageNumber=e,this.$el.data("page",e),this.$el.find("label").text(e),t.call(this)},render:function(){var e=!0,t=!0;INKIVE.C.BOOK.book_type===INKIVE.C.BOOK_TYPE.RESTRICTED_DESIGN&&(e=r.isFunctionalityAllowed("function_add_page"),t=e||r.isFunctionalityAllowed("function_change_page_order")),this.$el.append(i({thumb:o.get(this.design.design_id),page_id:this.pageNumber,show_page_menu:t,can_add_page:e})),e||this.$el.find(".delete-page").addClass("align-right");var n="update.design."+this.design.design_id;o.on(n,this.onThumbnailUpdate)},onThumbnailUpdate:function(){this.$el.find("img").data("src",o.get(this.design.design_id)),this.$el.closest("#pages-panel").data("type")&&this.renderThumbnail()},renderThumbnail:function(){var e=this.$el.find("img"),t=e.data("src");INKIVE.Helpers.isDataURL(t)?(e.attr("src",t),this.onImageLoaded(e,e[0])):t!==e.attr("src")&&(e.removeAttr("src"),this.loadImage(e,t))},loadImage:function(e,t,n){if(this.$el.find("img").addClass("hidden"),this.$el.find(".loader-wrapper").removeClass("hidden"),n=n||0,!(n>s||t!==e.data("src")))return!this.$el.find("img").attr("src")&&INKIVE.C.BOOK.book_type===INKIVE.C.BOOK_TYPE.TEMPLATE&&n>2?void this.onEmptyImage():void setTimeout(_.bind(function(){var t=new Image;t.src=e.data("src"),t.onload=_.partial(this.onImageLoaded,e,t),t.onerror=_.partial(this.loadImage,e,t.src,n+1)},this),n*l)},onEmptyImage:function(){this.$el.find(".loader-wrapper").addClass("hidden"),this.$el.find("img").removeClass("hidden");var e=INKIVE.Tool.getInstance(),t=e.editor.canvas,n=t.contentW/t.contentH,i=this.$el.find(".block").width(),a=Math.round(i/n);this.$el.find("img").attr("src","https://static.webrand.com/blank.jpg").fadeIn("slow").parent().height(a),this.trigger("resize",a)},onImageLoaded:function(e,t,n){if(this.$el.find(".loader-wrapper").addClass("hidden"),this.$el.find("img").removeClass("hidden"),t.src===e.data("src")){var i=this.$el.find(".block").width(),a=t.width/t.height,o=Math.round(i/a);e.attr("src",t.src).fadeIn("slow").parent().height(o),o||n?this.trigger("resize",o):_.delay(_.bind(this.onImageLoaded,this,e,t,!0),500)}}}),Backbone.Events)},{"../../facade/project/project":89,"../../facade/restrictions/restrictions":94,"../../factory/page-thumbnail":121,"./thumb.hbs":190}],192:[function(e,t,n){var i=e("./plus.hbs"),a=e("./thumb.js"),o=236,r=e("../../facade/project/project"),s=e("../../factory/page-thumbnail");t.exports=Backbone.View.extend({type:null,thumbnailViews:[],events:{"click .thumbnail.add":"addDesignEvent","click .page-order-show":"toggleOpenEvent","click .page-order-expand":"toggleFullEvent"},addDesignEvent:function(){this.toggleWorking(!0),INKIVE.ProjectFacade.handle("design","add",{
page_number:INKIVE.C.BOOK.num_pages+1}).then(_.bind(function(){this.toggleWorking(!1),this.toggleCollapsedPageOrder()},this))},toggleOpenEvent:function(){this.type?this.toggleCollapsedPageOrder():this.toggleRowPageOrder()},toggleFullEvent:function(){"row"===this.type?this.toggleFullPageOrder():this.toggleRowPageOrder()},initialize:function(){this.$wrapper=this.$el.find(".thumbnail-wrapper"),_.bindAll(this,"render","appendPageThumbnail"),s.initialize().then(_.bind(function(){this.render(),INKIVE.ProjectFacade.on("design.added",this.render),INKIVE.ProjectFacade.on("design.copied",this.render),INKIVE.ProjectFacade.on("design.removed",this.render),INKIVE.EditorFacade.bind("page.move_to",_.bind(function(){"full"===this.type&&this.toggleCollapsedPageOrder()},this))},this))},render:function(){function t(){_.each(this.thumbnailViews,function(e){e.remove()})}function n(){this.thumbnailViews=_.map(_.range(1,INKIVE.C.BOOK.num_pages+1),_.partial(this.appendPageThumbnail,a))}function i(){var t=INKIVE.Helpers.projectIsLinkedToRestrictions();if(INKIVE.C.BOOK.book_type==INKIVE.C.BOOK_TYPE.RESTRICTED_DESIGN){var n=e("../../facade/restrictions/restrictions");n.initialize().then(_.bind(function(){!n.isFunctionalityAllowed("function_add_page")||a.length||this.appendPlusThumbnail(!0),n.isFunctionalityAllowed("function_change_page_order")&&this.initSortable()},this))}else a.length||this.appendPlusThumbnail(t),t||this.initSortable();this.$el.find(".thumbmenu").disableSelection()}var a=this.$el.find(".thumbnail.add");t.call(this),n.call(this),i.call(this),this.toggleWorking(!1)},updateScroll:function(){var e="full"===this.type;this.$wrapper.css(e?{width:"100%","white-space":"normal"}:{width:"auto","white-space":"nowrap"}),this.$el.find(".page-order").antiscroll({autoHide:!1}),this.$el.find(".antiscroll-inner").css("height","100%"),this.$el.toggleClass("thumbnails-shown",_.isString(this.type))},appendPageThumbnail:function(e,t){var n=$("<div>").addClass("thumbnail"),i=new a({el:n,pageNumber:t});return e.length&&n.insertBefore(e),e.length||this.$wrapper.append(n),this.type&&i.renderThumbnail(),i.on("working",_.bind(this.toggleWorking,this,!0)),i.on("work_cancelled",_.bind(this.toggleWorking,this,!1)),i.on("resize",_.bind(this.onThumbnailResize,this)),i.on("design_deleted",_.bind(this.toggleWorking,this,!1)),i.on("design_copied",_.bind(this.toggleWorking,this,!1)),i.on("design_added",_.bind(this.toggleWorking,this,!1)),i},onThumbnailResize:function(e){if("row"===this.type){var t=147,n=$(window).height()-o,i=$(window).height()-(t+e),a=n<i;if(!a){var r=60;o=t+e,this.$el.css("top",i+"px"),this.$el.find(".antiscroll-inner").css("height",r+e+"px")}}},toggleWorking:function(e){this.$el.find(".page-order").toggleClass("disabled",e)},appendPlusThumbnail:function(e){var t;if(e){var n=INKIVE.Tool.getInstance().editor.canvas;if(!n)return void INKIVE.EditorFacade.once("page.move_to",_.bind(this.appendPlusThumbnail,this,e));t=n.contentH/n.contentW*100}this.$wrapper.append(i({padding:t}))},initSortable:function(){function e(e,t){$(t.item).find("img").css("cursor","move")}function t(e,t){this.toggleWorking(!0);var i=r.get("designs"),a=_.map(this.$el.find(".thumbnail:not(.add)"),function(e){return i[$(e).data("page")-1].design_id});$.get(INKIVE.C.BASE_URL+"api/project/order",{scrapbook_id:INKIVE.C.BOOK.id,order:a.join(",")},_.bind(n,this))}function n(e){"success"==e.status?r.refreshPageInfo().then(_.bind(function(){_.each(this.thumbnailViews,function(e){e.setPageNumber(e.$el.index()+1)});var e=r.get("design",{design_id:INKIVE.Tool._current_design_id});INKIVE.Tool._current_page_number=e.page_number,INKIVE.Menus.bottomSubmenu.updateCurrentPageInfo(),this.toggleWorking(!1)},this)):this.toggleWorking(!1)}this.$el.find(".page-order .thumbnail-wrapper").sortable({items:".thumbnail:not(.add)",start:e,update:_.bind(t,this)})},toggleFullPageOrder:function(){this.type="full",this._togglePageOrder("20%")},toggleRowPageOrder:function(){this.type="row",this._togglePageOrder($(window).height()-o)},toggleCollapsedPageOrder:function(){this.type=null,this._togglePageOrder("100%")},_togglePageOrder:function(e){function t(){i.call(this),this.type&&n.call(this),this.$el.data("type",this.type).transition({top:e},_.bind(a,this))}function n(){var e=this.$el.find(".page-order-expand"),t="full"===this.type?"icon-chevron-down":"icon-chevron-up",n="page_order."+("full"===this.type?"showing_all":"show_all");e.find("span").html(INKIVE.TranslateHelper.translate(n)),e.find("i").attr("class",t)}function i(){this.$el.find(".modal-header.page-order-show .action").toggleClass("icon-chevron-down",null!==this.type).toggleClass("icon-chevron-up",null===this.type)}function a(){this.updateScroll(),this.$wrapper.transition({opacity:100}),this.type&&_.each(this.thumbnailViews,function(e){e.renderThumbnail()})}this.$wrapper.transition({opacity:0},400,"ease",_.bind(t,this))}})},{"../../facade/project/project":89,"../../facade/restrictions/restrictions":94,"../../factory/page-thumbnail":121,"./plus.hbs":189,"./thumb.js":191}],193:[function(e,t,n){function i(){s=INKIVE.Tool.getInstance(),a()}function a(){function e(e){return e.type.match(/image.*/)}var t=$("#svgcanvas");t.on("dragover",function(e){function t(){var t=$("#svgcontent").offset();l={x:e.clientX-t.left,y:e.clientY-t.top}}e.stopPropagation(),e.preventDefault(),e=e.originalEvent,e.dataTransfer.dropEffect="copy",t()}),t.on("drop",function(t){t.stopPropagation(),t.preventDefault();var n=t.originalEvent.dataTransfer.files,i=_.filter(n,e);c=i.length,d=0,_.each(i,o)})}function o(e){r(e)}function r(e){var t=$.Deferred();return $('.btn-tag[href="#tabImages"]').trigger("click"),$("#tabImages").find(".header-links").find("[data-key=add]").trigger("click"),_.defer(function(){var n=INKIVE.Tabs.images.$el.find(".import-button.uploader.progress-button"),i=INKIVE.Tabs.images.$el.find('.btn-accordion[data-key="project"]');i.trigger("click"),n.fineUploaderS3("addFiles",e),t.resolve(_.last(n.fineUploaderS3("getUploads")).id)}),t.promise()}e("../facade/editor/editor"),e("../factory/images");t.exports={init:i};var s,l,c,d},{"../facade/editor/editor":76,"../factory/images":102}],194:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){var o=null!=t?t:e.nullContext||{},r=n.helperMissing,s=e.escapeExpression;return'<div id="filter-picker">\n    <ul style="justify-content: flex-start;">\n        <li><a href="#filter-tab-1">'+s((n.t||t&&t.t||r).call(o,"filterpicker.container.presets_label",{name:"t",hash:{},data:a}))+'</a></li>\n        <li><a href="#filter-tab-2">'+s((n.t||t&&t.t||r).call(o,"filterpicker.container.advanced_label",{name:"t",hash:{},data:a}))+'</a></li>\n    </ul>\n\n    <div id="filter-tab-1"><ul class="presets-container"></ul></div>\n    <div id="filter-tab-2" class="sliders-container"></div>\n\n    <div class="svg-container"></div>\n</div>\n'},useData:!0})},{"hbsfy/runtime":535}],195:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){return'<feColorMatrix type="matrix" values="1.238 -0.1 -0.1 0 0 -0.1 1.238 -0.1 0 0 -0.1 -0.1 1.238 0 0 0 0 0 1 0"></feColorMatrix>\n\n<feComponentTransfer>\n    <feFuncR type="linear" slope="1.22"></feFuncR>\n    <feFuncG type="linear" slope="1.22"></feFuncG>\n    <feFuncB type="linear" slope="1.22"></feFuncB>\n</feComponentTransfer>\n\n<feComponentTransfer>\n    <feFuncR type="linear" slope="0.95" intercept="0.025000000000000022"></feFuncR>\n    <feFuncG type="linear" slope="0.95" intercept="0.025000000000000022"></feFuncG>\n    <feFuncB type="linear" slope="0.95" intercept="0.025000000000000022"></feFuncB>\n</feComponentTransfer>\n\n<feColorMatrix type="hueRotate" values="7.200000000000017"></feColorMatrix>\n'},useData:!0})},{"hbsfy/runtime":535}],196:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){return'<feColorMatrix type="saturate" values="0.93"></feColorMatrix>\n\n<feComponentTransfer>\n    <feFuncR type="linear" slope="0.91"></feFuncR>\n    <feFuncG type="linear" slope="0.91"></feFuncG>\n    <feFuncB type="linear" slope="0.91"></feFuncB>\n</feComponentTransfer>\n\n<feComponentTransfer>\n    <feFuncR type="linear" slope="1.2" intercept="-0.09999999999999998"></feFuncR>\n    <feFuncG type="linear" slope="1.2" intercept="-0.09999999999999998"></feFuncG>\n    <feFuncB type="linear" slope="1.2" intercept="-0.09999999999999998"></feFuncB>\n</feComponentTransfer>\n\n<feConvolveMatrix order="3 3" preserveAlpha="true" kernelMatrix="0 -0.12 0 -0.12 1.48 -0.12 0 -0.12 0"></feConvolveMatrix>\n<feColorMatrix type="hueRotate" values="23.399999999999977"></feColorMatrix>\n'},useData:!0})},{"hbsfy/runtime":535}],197:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){return'<feColorMatrix type="matrix" values="1.119 -0.05 -0.05 0 0 -0.05 1.119 -0.05 0 0 -0.05 -0.05 1.119 0 0 0 0 0 1 0"></feColorMatrix>\n\n<feComponentTransfer>\n    <feFuncR type="linear" slope="1.09"></feFuncR>\n    <feFuncG type="linear" slope="1.09"></feFuncG>\n    <feFuncB type="linear" slope="1.09"></feFuncB>\n</feComponentTransfer>\n\n<feComponentTransfer>\n    <feFuncR type="linear" slope="0.91" intercept="0.044999999999999984"></feFuncR>\n    <feFuncG type="linear" slope="0.91" intercept="0.044999999999999984"></feFuncG>\n    <feFuncB type="linear" slope="0.91" intercept="0.044999999999999984"></feFuncB>\n</feComponentTransfer>\n\n<feConvolveMatrix order="3 3" preserveAlpha="true" kernelMatrix="0 -0.44999999999999996 0 -0.44999999999999996 2.8 -0.44999999999999996 0 -0.44999999999999996 0"></feConvolveMatrix>\n\n<feColorMatrix type="hueRotate" values="36"></feColorMatrix>\n'},useData:!0})},{"hbsfy/runtime":535}],198:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){var o,r=null!=t?t:e.nullContext||{},s=n.helperMissing,l="function",c=e.escapeExpression;return'<feFlood result="blackfield-'+c((o=null!=(o=n.filter_id||(null!=t?t.filter_id:t))?o:s,typeof o===l?o.call(r,{name:"filter_id",hash:{},data:a}):o))+'" flood-color="#000000" flood-opacity="0.868"></feFlood>\n\n<feSpecularLighting result="spotlight-'+c((o=null!=(o=n.filter_id||(null!=t?t.filter_id:t))?o:s,typeof o===l?o.call(r,{name:"filter_id",hash:{},data:a}):o))+'" lighting-color="#FFFFFF" surfaceScale="1" specularConstant="1" specularExponent="28.000000000000004">\n    <fePointLight z="500"></fePointLight>\n</feSpecularLighting>\n\n<feBlend result="A-'+c((o=null!=(o=n.filter_id||(null!=t?t.filter_id:t))?o:s,typeof o===l?o.call(r,{name:"filter_id",hash:{},data:a}):o))+'" in="blackfield-'+c((o=null!=(o=n.filter_id||(null!=t?t.filter_id:t))?o:s,typeof o===l?o.call(r,{name:"filter_id",hash:{},data:a}):o))+'" in2="spotlight-'+c((o=null!=(o=n.filter_id||(null!=t?t.filter_id:t))?o:s,typeof o===l?o.call(r,{name:"filter_id",hash:{},data:a}):o))+'" mode="lighten"></feBlend>\n<feBlend result="B-'+c((o=null!=(o=n.filter_id||(null!=t?t.filter_id:t))?o:s,typeof o===l?o.call(r,{name:"filter_id",hash:{},data:a}):o))+'" in="A-'+c((o=null!=(o=n.filter_id||(null!=t?t.filter_id:t))?o:s,typeof o===l?o.call(r,{name:"filter_id",hash:{},data:a}):o))+'" in2="SourceGraphic" mode="multiply"></feBlend>\n\n<feColorMatrix type="saturate" values="0.93"></feColorMatrix>\n\n<feComponentTransfer>\n    <feFuncR type="linear" slope="1.05"></feFuncR>\n    <feFuncG type="linear" slope="1.05"></feFuncG>\n    <feFuncB type="linear" slope="1.05"></feFuncB>\n</feComponentTransfer>\n\n<feComponentTransfer>\n    <feFuncR type="linear" slope="1.12" intercept="-0.06000000000000005"></feFuncR>\n    <feFuncG type="linear" slope="1.12" intercept="-0.06000000000000005"></feFuncG>\n    <feFuncB type="linear" slope="1.12" intercept="-0.06000000000000005"></feFuncB>\n</feComponentTransfer>\n\n<feGaussianBlur stdDeviation="0.09999999999999964"></feGaussianBlur>\n<feColorMatrix type="hueRotate" values="39.599999999999994"></feColorMatrix>\n'},useData:!0})},{"hbsfy/runtime":535}],199:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){return'<feColorMatrix type="matrix" values="1.154 -0.066 -0.066 0 0 -0.066 1.154 -0.066 0 0 -0.066 -0.066 1.154 0 0 0 0 0 1 0"></feColorMatrix>\n\n<feComponentTransfer>\n    <feFuncR type="linear" slope="1.07"></feFuncR>\n    <feFuncG type="linear" slope="1.07"></feFuncG>\n    <feFuncB type="linear" slope="1.07"></feFuncB>\n</feComponentTransfer>\n\n<feComponentTransfer>\n    <feFuncR type="linear" slope="1.15" intercept="-0.07499999999999996"></feFuncR>\n    <feFuncG type="linear" slope="1.15" intercept="-0.07499999999999996"></feFuncG>\n    <feFuncB type="linear" slope="1.15" intercept="-0.07499999999999996"></feFuncB>\n</feComponentTransfer>\n\n<feConvolveMatrix order="3 3" preserveAlpha="true" kernelMatrix="0 -0.06000000000000005 0 -0.06000000000000005 1.2400000000000002 -0.06000000000000005 0 -0.06000000000000005 0"></feConvolveMatrix>\n\n<feColorMatrix type="hueRotate" values="7.200000000000017"></feColorMatrix>\n'},useData:!0})},{"hbsfy/runtime":535}],200:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){return'<feColorMatrix type="saturate" values="0"></feColorMatrix>\n\n<feComponentTransfer>\n    <feFuncR type="linear" slope="1.1"></feFuncR>\n    <feFuncG type="linear" slope="1.1"></feFuncG>\n    <feFuncB type="linear" slope="1.1"></feFuncB>\n</feComponentTransfer>\n\n<feComponentTransfer>\n    <feFuncR type="linear" slope="0.95" intercept="0.025000000000000022"></feFuncR>\n    <feFuncG type="linear" slope="0.95" intercept="0.025000000000000022"></feFuncG>\n    <feFuncB type="linear" slope="0.95" intercept="0.025000000000000022"></feFuncB>\n</feComponentTransfer>\n'},useData:!0})},{"hbsfy/runtime":535}],201:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){return'<feColorMatrix type="saturate" values="0.52"></feColorMatrix>\n\n<feComponentTransfer>\n    <feFuncR type="linear" slope="1.1">\n    </feFuncR><feFuncG type="linear" slope="1.1"></feFuncG>\n    <feFuncB type="linear" slope="1.1"></feFuncB>\n</feComponentTransfer>\n\n<feComponentTransfer>\n    <feFuncR type="linear" slope="0.97" intercept="0.015000000000000013"></feFuncR>\n    <feFuncG type="linear" slope="0.97" intercept="0.015000000000000013"></feFuncG>\n    <feFuncB type="linear" slope="0.97" intercept="0.015000000000000013"></feFuncB>\n</feComponentTransfer>\n'},useData:!0})},{"hbsfy/runtime":535}],202:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){var o,r=null!=t?t:e.nullContext||{},s=n.helperMissing,l="function",c=e.escapeExpression;return'<feFlood result="blackfield-'+c((o=null!=(o=n.filter_id||(null!=t?t.filter_id:t))?o:s,typeof o===l?o.call(r,{name:"filter_id",hash:{},data:a}):o))+'" flood-color="#000000" flood-opacity="0.7839999999999999"></feFlood>\n\n<feSpecularLighting result="spotlight-'+c((o=null!=(o=n.filter_id||(null!=t?t.filter_id:t))?o:s,typeof o===l?o.call(r,{name:"filter_id",hash:{},data:a}):o))+'" lighting-color="#FFFFFF" surfaceScale="1" specularConstant="1" specularExponent="14.000000000000002">\n    <fePointLight z="500"></fePointLight>\n</feSpecularLighting>\n\n<feBlend result="A-'+c((o=null!=(o=n.filter_id||(null!=t?t.filter_id:t))?o:s,typeof o===l?o.call(r,{name:"filter_id",hash:{},data:a}):o))+'" in="blackfield-'+c((o=null!=(o=n.filter_id||(null!=t?t.filter_id:t))?o:s,typeof o===l?o.call(r,{name:"filter_id",hash:{},data:a}):o))+'" in2="spotlight-'+c((o=null!=(o=n.filter_id||(null!=t?t.filter_id:t))?o:s,typeof o===l?o.call(r,{name:"filter_id",hash:{},data:a}):o))+'" mode="lighten"></feBlend>\n<feBlend result="B-'+c((o=null!=(o=n.filter_id||(null!=t?t.filter_id:t))?o:s,typeof o===l?o.call(r,{name:"filter_id",hash:{},data:a}):o))+'" in="A-'+c((o=null!=(o=n.filter_id||(null!=t?t.filter_id:t))?o:s,typeof o===l?o.call(r,{name:"filter_id",hash:{},data:a}):o))+'" in2="SourceGraphic" mode="multiply"></feBlend>\n\n<feColorMatrix type="saturate" values="0.05"></feColorMatrix>\n\n<feComponentTransfer>\n    <feFuncR type="linear" slope="0.94"></feFuncR>\n    <feFuncG type="linear" slope="0.94"></feFuncG>\n    <feFuncB type="linear" slope="0.94"></feFuncB>\n</feComponentTransfer>\n\n<feComponentTransfer>\n    <feFuncR type="linear" slope="1.12" intercept="-0.06000000000000005"></feFuncR>\n    <feFuncG type="linear" slope="1.12" intercept="-0.06000000000000005"></feFuncG>\n    <feFuncB type="linear" slope="1.12" intercept="-0.06000000000000005"></feFuncB>\n</feComponentTransfer>\n\n<feConvolveMatrix order="3 3" preserveAlpha="true" kernelMatrix="0 -0.07999999999999996 0 -0.07999999999999996 1.3199999999999998 -0.07999999999999996 0 -0.07999999999999996 0"></feConvolveMatrix>\n'},useData:!0})},{"hbsfy/runtime":535}],203:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){return'<feColorMatrix type="saturate" values="0.76"></feColorMatrix>\n\n<feComponentTransfer>\n    <feFuncR type="linear" slope="1.61"></feFuncR>\n    <feFuncG type="linear" slope="1.61"></feFuncG>\n    <feFuncB type="linear" slope="1.61"></feFuncB>\n</feComponentTransfer>\n\n<feComponentTransfer>\n    <feFuncR type="linear" slope="0.73" intercept="0.135"></feFuncR>\n    <feFuncG type="linear" slope="0.73" intercept="0.135"></feFuncG>\n    <feFuncB type="linear" slope="0.73" intercept="0.135"></feFuncB>\n</feComponentTransfer>\n\n<feConvolveMatrix order="3 3" preserveAlpha="true" kernelMatrix="0 -0.13 0 -0.13 1.52 -0.13 0 -0.13 0"></feConvolveMatrix>\n<feColorMatrix type="hueRotate" values="55.80000000000001"></feColorMatrix>\n'},useData:!0})},{"hbsfy/runtime":535}],204:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){var o,r,s=null!=t?t:e.nullContext||{},l=n.helperMissing,c="function",d=e.escapeExpression;return'<svg class="filter-thumb" xmlns="http://www.w3.org/2000/svg" width="'+d((r=null!=(r=n.width||(null!=t?t.width:t))?r:l,typeof r===c?r.call(s,{name:"width",hash:{},data:a}):r))+'" height="'+d((r=null!=(r=n.height||(null!=t?t.height:t))?r:l,typeof r===c?r.call(s,{name:"height",hash:{},data:a}):r))+'">\n    <defs><filter id="'+d((r=null!=(r=n.filter_id||(null!=t?t.filter_id:t))?r:l,typeof r===c?r.call(s,{name:"filter_id",hash:{},data:a}):r))+'">'+(null!=(r=null!=(r=n.filter||(null!=t?t.filter:t))?r:l,o=typeof r===c?r.call(s,{name:"filter",hash:{},data:a}):r)?o:"")+'</filter></defs>\n    <g stroke="null">\n        <image filter="url(#'+d((r=null!=(r=n.filter_id||(null!=t?t.filter_id:t))?r:l,typeof r===c?r.call(s,{name:"filter_id",hash:{},data:a}):r))+')" xlink:href="'+d((r=null!=(r=n.image||(null!=t?t.image:t))?r:l,typeof r===c?r.call(s,{name:"image",hash:{},data:a}):r))+'" x="0" y="0" width="'+d((r=null!=(r=n.width||(null!=t?t.width:t))?r:l,typeof r===c?r.call(s,{name:"width",hash:{},data:a}):r))+'" height="'+d((r=null!=(r=n.height||(null!=t?t.height:t))?r:l,typeof r===c?r.call(s,{name:"height",hash:{},data:a}):r))+'" style="pointer-events:inherit"/>\n    </g>\n</svg>\n'},useData:!0})},{"hbsfy/runtime":535}],205:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({1:function(e,t,n,i,a){return'    <div class="filterWrapper" style="position: relative;">\n        <input type="text" name="filter" placeholder="'+e.escapeExpression((n.t||t&&t.t||n.helperMissing).call(null!=t?t:e.nullContext||{},"common.search_sizes",{name:"t",hash:{},data:a}))+'"/>\n    </div>\n\n    <div class="tool-content">\n        <div style="height: 200px;" role="tabpanel">\n            <div class="antiscroll-wrap">\n                <div class="antiscroll-inner">\n                    <div class="tab-content"></div>\n                </div>\n            </div>\n        </div>\n    </div>\n'},3:function(e,t,n,i,a){var o=null!=t?t:e.nullContext||{},r=n.helperMissing,s=e.escapeExpression;return'    <div style="display: table-cell; width:260px; padding-right: 5px; vertical-align: top; font-size: 13px;">\n        <div class="filterWrapper">\n            <ul class="filter">\n                <li class="active" data-type="all">'+s((n.t||t&&t.t||r).call(o,"modal.add_page.show_all",{name:"t",hash:{},data:a}))+'</li>\n                <li data-type="category">'+s((n.t||t&&t.t||r).call(o,"modal.add_page.filter_by",{name:"t",hash:{},data:a}))+'</li>\n            </ul>\n        </div>\n        <div class="filterWrapper subfilter" style="display: none;"></div>\n    </div>\n\n    <div class="tool-content" style="display: table-cell;">\n        <div style="height: 200px;" role="tabpanel">\n            <div class="antiscroll-wrap">\n                <div class="antiscroll-inner">\n                    <div class="tab-content"></div>\n                </div>\n            </div>\n        </div>\n    </div>\n'},compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){var o,r,s,l=null!=t?t:e.nullContext||{},c=n.helperMissing,d="function",u=n.blockHelperMissing,p='<input type="hidden" id="layout-id" />\n<div style="display: table; width:100%">\n';return r=null!=(r=n.Desygner||(null!=t?t.Desygner:t))?r:c,s={name:"Desygner",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a},o=typeof r===d?r.call(l,s):r,n.Desygner||(o=u.call(t,o,s)),null!=o&&(p+=o),p+="\n",r=null!=(r=n.Photobooky||(null!=t?t.Photobooky:t))?r:c,s={name:"Photobooky",hash:{},fn:e.program(3,a,0),inverse:e.noop,data:a},o=typeof r===d?r.call(l,s):r,n.Photobooky||(o=u.call(t,o,s)),null!=o&&(p+=o),p+"</div>\n"},useData:!0})},{"hbsfy/runtime":535}],206:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){return'<b style="font-weight: 400">'+e.escapeExpression((n.t||t&&t.t||n.helperMissing).call(null!=t?t:e.nullContext||{},null!=t?t.message:t,{name:"t",hash:{},data:a}))+"</b>\n"},useData:!0})},{"hbsfy/runtime":535}],207:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({1:function(e,t,n,i,a){return"<br><b>"+e.escapeExpression((n.t||t&&t.t||n.helperMissing).call(null!=t?t:e.nullContext||{},"common.try_again",{name:"t",hash:{},data:a}))+"</b>"},3:function(e,t,n,i,a){return"<br><b>"+e.escapeExpression((n.t||t&&t.t||n.helperMissing).call(null!=t?t:e.nullContext||{},"common.check_network",{name:"t",hash:{},data:a}))+"</b>"},5:function(e,t,n,i,a){var o;return"<br><b>"+(null!=(o=e.lambda(t,t))?o:"")+"</b>"},compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){var o,r,s,l=null!=t?t:e.nullContext||{},c=n.helperMissing,d="function",u=n.blockHelperMissing,p="<b>"+e.escapeExpression((n.t||t&&t.t||c).call(l,"common.error",{name:"t",hash:{},data:a}))+" - </b>\n<i>"+(null!=(o=(n.t||t&&t.t||c).call(l,null!=t?t.message:t,{name:"t",hash:{},data:a}))?o:"")+"</i>\n";return r=null!=(r=n.try_again||(null!=t?t.try_again:t))?r:c,s={name:"try_again",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a},o=typeof r===d?r.call(l,s):r,n.try_again||(o=u.call(t,o,s)),null!=o&&(p+=o),p+="\n",r=null!=(r=n.check_network||(null!=t?t.check_network:t))?r:c,s={name:"check_network",hash:{},fn:e.program(3,a,0),inverse:e.noop,data:a},o=typeof r===d?r.call(l,s):r,n.check_network||(o=u.call(t,o,s)),null!=o&&(p+=o),p+="\n",r=null!=(r=n.more_info||(null!=t?t.more_info:t))?r:c,s={name:"more_info",hash:{},fn:e.program(5,a,0),inverse:e.noop,data:a},o=typeof r===d?r.call(l,s):r,n.more_info||(o=u.call(t,o,s)),null!=o&&(p+=o),p+"\n"},useData:!0})},{"hbsfy/runtime":535}],208:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({1:function(e,t,n,i,a){var o,r,s=null!=t?t:e.nullContext||{},l=n.helperMissing;return"    "+(null!=(o=(n.t||t&&t.t||l).call(s,"modal.alert.delete_confirm_0",{name:"t",hash:{},data:a}))?o:"")+" <i>"+e.escapeExpression((r=null!=(r=n.title||(null!=t?t.title:t))?r:l,"function"==typeof r?r.call(s,{name:"title",hash:{},data:a}):r))+"</i>?<br>\n    "+(null!=(o=(n.t||t&&t.t||l).call(s,"modal.alert.delete_confirm_1",{name:"t",hash:{},data:a}))?o:"")+"\n"},3:function(e,t,n,i,a){var o,r,s=null!=t?t:e.nullContext||{},l=n.helperMissing;return"    "+(null!=(o=(n.t||t&&t.t||l).call(s,"modal.alert.delete_confirm_0",{name:"t",hash:{},data:a}))?o:"")+" "+e.escapeExpression((r=null!=(r=n.title||(null!=t?t.title:t))?r:l,"function"==typeof r?r.call(s,{name:"title",hash:{},data:a}):r))+"?\n"},compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){var o,r,s,l=null!=t?t:e.nullContext||{},c=n.helperMissing,d="function",u=n.blockHelperMissing,p="";return r=null!=(r=n.admin||(null!=t?t.admin:t))?r:c,s={name:"admin",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a},o=typeof r===d?r.call(l,s):r,n.admin||(o=u.call(t,o,s)),null!=o&&(p+=o),r=null!=(r=n.admin||(null!=t?t.admin:t))?r:c,s={name:"admin",hash:{},fn:e.noop,inverse:e.program(3,a,0),data:a},o=typeof r===d?r.call(l,s):r,n.admin||(o=u.call(t,o,s)),null!=o&&(p+=o),p},useData:!0})},{"hbsfy/runtime":535}],209:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){var o;return"<span>"+e.escapeExpression((o=null!=(o=n.text||(null!=t?t.text:t))?o:n.helperMissing,"function"==typeof o?o.call(null!=t?t:e.nullContext||{},{name:"text",hash:{},data:a}):o))+"</span>\n"},useData:!0})},{"hbsfy/runtime":535}],210:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){var o,r,s=null!=t?t:e.nullContext||{},l=n.helperMissing,c="function";return'<div class="modal alert" style="'+e.escapeExpression((r=null!=(r=n.width||(null!=t?t.width:t))?r:l,typeof r===c?r.call(s,{name:"width",hash:{},data:a}):r))+'">\n    <p class="content">'+(null!=(r=null!=(r=n.message||(null!=t?t.message:t))?r:l,o=typeof r===c?r.call(s,{name:"message",hash:{},data:a}):r)?o:"")+"</p>\n</div>\n"},useData:!0})},{"hbsfy/runtime":535}],211:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({1:function(e,t,n,i,a){var o,r=null!=t?t:e.nullContext||{},s=n.helperMissing,l="function",c=e.escapeExpression;return'<li style="'+c((o=null!=(o=n.width||(null!=t?t.width:t))?o:s,typeof o===l?o.call(r,{name:"width",hash:{},data:a}):o))+'"><a id="btn-'+c((o=null!=(o=n.key||a&&a.key)?o:s,typeof o===l?o.call(r,{name:"key",hash:{},data:a}):o))+'" class="btn '+c((o=null!=(o=n["class"]||(null!=t?t["class"]:t))?o:s,typeof o===l?o.call(r,{name:"class",hash:{},data:a}):o))+'">'+c((n.t||t&&t.t||s).call(r,null!=t?t.title:t,{name:"t",hash:{},data:a}))+"</a></li>"},compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){var o;return'<ul class="btnWrapper bottom">\n'+(null!=(o=n.each.call(null!=t?t:e.nullContext||{},t,{name:"each",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a}))?o:"")+"\n</ul>\n"},useData:!0})},{"hbsfy/runtime":535}],212:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({1:function(e,t,n,i,a){var o,r,s,l=null!=t?t:e.nullContext||{},c=n.helperMissing,d=e.escapeExpression,u='    <p style="margin-top: 10px;">'+d((n.t||t&&t.t||c).call(l,"modal.layout_load.different_size",null!=t?t.new_size:t,{name:"t",hash:{},data:a}))+'</p>\n    <div class="checkbox">\n        <input type="checkbox" name="keep-size-input"';return r=null!=(r=n.keep_size||(null!=t?t.keep_size:t))?r:c,s={name:"keep_size",hash:{},fn:e.program(2,a,0),inverse:e.noop,data:a},o="function"==typeof r?r.call(l,s):r,n.keep_size||(o=n.blockHelperMissing.call(t,o,s)),null!=o&&(u+=o),u+'/>\n        <label for="keep-size-input">'+d((n.t||t&&t.t||c).call(l,"modal.layout_load.keep_current_size",null!=t?t.current_size:t,{name:"t",hash:{},data:a}))+"</label>\n    </div>\n"},2:function(e,t,n,i,a){return" checked"},4:function(e,t,n,i,a){var o,r,s,l=null!=t?t:e.nullContext||{},c=n.helperMissing,d='    <div class="checkbox">\n        <input type="checkbox" name="keep-images-input"';return r=null!=(r=n.keep_images||(null!=t?t.keep_images:t))?r:c,s={name:"keep_images",hash:{},fn:e.program(2,a,0),inverse:e.noop,data:a},o="function"==typeof r?r.call(l,s):r,n.keep_images||(o=n.blockHelperMissing.call(t,o,s)),null!=o&&(d+=o),d+'/>\n        <label for="keep-images-input">'+e.escapeExpression((n.t||t&&t.t||c).call(l,"modal.layout_load.keep_images",{name:"t",hash:{},data:a}))+"</label>\n    </div>\n"},compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){var o,r,s,l=null!=t?t:e.nullContext||{},c=n.helperMissing,d="function",u=n.blockHelperMissing,p="<p>"+e.escapeExpression((n.t||t&&t.t||c).call(l,"modal.restricted_template_load.about",{name:"t",hash:{},data:a}))+"</p>\n";return r=null!=(r=n.is_same_size||(null!=t?t.is_same_size:t))?r:c,s={name:"is_same_size",hash:{},fn:e.noop,inverse:e.program(1,a,0),data:a},o=typeof r===d?r.call(l,s):r,n.is_same_size||(o=u.call(t,o,s)),null!=o&&(p+=o),r=null!=(r=n.has_images||(null!=t?t.has_images:t))?r:c,s={name:"has_images",hash:{},fn:e.program(4,a,0),inverse:e.noop,data:a},o=typeof r===d?r.call(l,s):r,n.has_images||(o=u.call(t,o,s)),null!=o&&(p+=o),p},useData:!0})},{"hbsfy/runtime":535}],213:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){return'<div class="loader-wrapper">\n  <div class="int-loader"></div>\n</div>\n'},useData:!0})},{"hbsfy/runtime":535}],214:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){var o,r=null!=t?t:e.nullContext||{},s=n.helperMissing,l="function",c=e.escapeExpression;return'<div class="modal" style="'+c((o=null!=(o=n.width||(null!=t?t.width:t))?o:s,typeof o===l?o.call(r,{name:"width",hash:{},data:a}):o))+'">\n    <a class="btn btn-green modal-header" id="page-order-show">\n        <i class="'+c((o=null!=(o=n.icon||(null!=t?t.icon:t))?o:s,typeof o===l?o.call(r,{name:"icon",hash:{},data:a}):o))+'"></i>\n        '+c((n.t||t&&t.t||s).call(r,null!=t?t.title:t,{name:"t",hash:{},data:a}))+'\n        <i class="icon-remove action"></i>\n    </a>\n    <section class="content">\n        <form action="#" autocomplete="on" id="form_'+c((o=null!=(o=n.id||(null!=t?t.id:t))?o:s,typeof o===l?o.call(r,{name:"id",hash:{},data:a}):o))+'" onsubmit="return false;">\n            <button type="submit" name="testname" value="test" style="display: none;"/>\n        </form>\n    </section>\n</div>\n'},useData:!0})},{"hbsfy/runtime":535}],215:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({1:function(e,t,n,i,a){return'    <div class="checkbox">\n        <input type="checkbox" name="copy-restrictions" checked/>\n        <label for="copy-restrictions">'+e.escapeExpression((n.t||t&&t.t||n.helperMissing).call(null!=t?t:e.nullContext||{},"modal.restricted_template_load.keep_restrictions",{name:"t",hash:{},data:a}))+"</label>\n    </div>\n"},compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){var o,r,s,l=null!=t?t:e.nullContext||{},c=n.helperMissing,d="<p>"+e.escapeExpression((n.t||t&&t.t||c).call(l,"modal.restricted_template_load.about",{name:"t",hash:{},data:a}))+"</p>\n";return r=null!=(r=n.has_restrictions||(null!=t?t.has_restrictions:t))?r:c,s={name:"has_restrictions",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a},o="function"==typeof r?r.call(l,s):r,n.has_restrictions||(o=n.blockHelperMissing.call(t,o,s)),null!=o&&(d+=o),d},useData:!0})},{"hbsfy/runtime":535}],216:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({1:function(e,t,n,i,a){return"mobile"},3:function(e,t,n,i,a){return"web"},compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){var o,r,s,l=null!=t?t:e.nullContext||{},c=n.helperMissing,d="function",u=n.blockHelperMissing,p='<div class="modalWrapper overlay nodrag ';return r=null!=(r=n.Mobile||(null!=t?t.Mobile:t))?r:c,s={name:"Mobile",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a},o=typeof r===d?r.call(l,s):r,n.Mobile||(o=u.call(t,o,s)),null!=o&&(p+=o),r=null!=(r=n.Desktop||(null!=t?t.Desktop:t))?r:c,s={name:"Desktop",hash:{},fn:e.program(3,a,0),inverse:e.noop,data:a},o=typeof r===d?r.call(l,s):r,n.Desktop||(o=u.call(t,o,s)),null!=o&&(p+=o),p+'" data-id="'+e.escapeExpression((r=null!=(r=n.id||(null!=t?t.id:t))?r:c,
typeof r===d?r.call(l,{name:"id",hash:{},data:a}):r))+'"></div>\n'},useData:!0})},{"hbsfy/runtime":535}],217:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({1:function(e,t,n,i,a){return'            <div class="checkbox">\n                <input type="checkbox" name="isZip" value="1"/>\n                <label for="isZip">'+e.escapeExpression((n.t||t&&t.t||n.helperMissing).call(null!=t?t:e.nullContext||{},"modal.download.zip_label",{name:"t",hash:{},data:a}))+"</label>\n            </div>\n"},3:function(e,t,n,i,a){var o=null!=t?t:e.nullContext||{},r=n.helperMissing,s=e.escapeExpression;return"    <section>\n        <span>"+s((n.t||t&&t.t||r).call(o,"modal.download.include_label",{name:"t",hash:{},data:a}))+'</span>\n        <div class="checkbox"><input type="checkbox" name="isThumb" value="1"/>\n            <label for="isThumb" style="width: 90px;">'+s((n.t||t&&t.t||r).call(o,"modal.download.thumb_label",{name:"t",hash:{},data:a}))+'</label>\n            <input type="number" style="margin: 0 5px; position:relative;" class="form-control small disabled thumbDimensions" data-type="width" placeholder="'+s((n.t||t&&t.t||r).call(o,"modal.download.width_label",{name:"t",hash:{},data:a}))+'"/><span>X</span>\n            <input type="number" style="margin: 0 5px; position:relative;" class="form-control small disabled thumbDimensions" data-type="height" placeholder="'+s((n.t||t&&t.t||r).call(o,"modal.download.height_label",{name:"t",hash:{},data:a}))+'"/><span>px</span>\n        </div>\n\n        <div class="checkbox"><input type="checkbox" name="isWeb" value="1"/>\n            <label for="isWeb" style="width: 90px;">'+s((n.t||t&&t.t||r).call(o,"modal.download.web_label",{name:"t",hash:{},data:a}))+'</label>\n            <input type="number" style="margin: 0 5px; position:relative;" class="form-control small disabled webDimensions" data-type="width" placeholder="'+s((n.t||t&&t.t||r).call(o,"modal.download.width_label",{name:"t",hash:{},data:a}))+'"/><span>X</span>\n            <input type="number" style="margin: 0 5px; position:relative;" class="form-control small disabled webDimensions" data-type="height" placeholder="'+s((n.t||t&&t.t||r).call(o,"modal.download.height_label",{name:"t",hash:{},data:a}))+'"/><span>px</span>\n        </div>\n\n        <div class="checkbox"><input type="checkbox" name="isMobile" value="1"/>\n            <label for="isMobile" style="width: 90px;">'+s((n.t||t&&t.t||r).call(o,"modal.download.mobile_label",{name:"t",hash:{},data:a}))+'</label>\n            <input type="number" style="margin: 0 5px; position:relative;" class="form-control small disabled mobileDimensions" data-type="width" placeholder="'+s((n.t||t&&t.t||r).call(o,"modal.download.width_label",{name:"t",hash:{},data:a}))+'"/><span>X</span>\n            <input type="number" style="margin: 0 5px; position:relative;" class="form-control small disabled mobileDimensions" data-type="height" placeholder="'+s((n.t||t&&t.t||r).call(o,"modal.download.height_label",{name:"t",hash:{},data:a}))+'"/><span>px</span>\n        </div>\n    </section>\n'},compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){var o,r,s,l=null!=t?t:e.nullContext||{},c=n.helperMissing,d=e.escapeExpression,u="function",p=n.blockHelperMissing,h='<section style="display: block; float: left; margin-right: 10px;">\n    <section id="quality-section">\n        <span>'+d((n.t||t&&t.t||c).call(l,"modal.download.quality_label",{name:"t",hash:{},data:a}))+'</span>\n\n        <ul class="btnWrapper">\n            <li>\n                <a class="btn btn-squire btn-tag quality active" tag="'+d((n.t||t&&t.t||c).call(l,"modal.download.high_label",{name:"t",hash:{},data:a}))+'" data-value="92">\n                    <div class="icon-wrapper"><i class="icon-brightness_1"></i></div>\n                </a>\n            </li>\n            <li>\n                <a class="btn btn-squire btn-tag quality" tag="'+d((n.t||t&&t.t||c).call(l,"modal.download.medium_label",{name:"t",hash:{},data:a}))+'" data-value="75">\n                    <div class="icon-wrapper"><i class="icon-brightness_2"></i></div>\n                </a>\n            </li>\n            <li>\n                <a class="btn btn-squire btn-tag quality" tag="'+d((n.t||t&&t.t||c).call(l,"modal.download.low_label",{name:"t",hash:{},data:a}))+'" data-value="60">\n                    <div class="icon-wrapper"><i class="icon-brightness_3"></i></div>\n                </a>\n            </li>\n        </ul>\n    </section>\n\n    <span>'+d((n.t||t&&t.t||c).call(l,"modal.download.resize_label",{name:"t",hash:{},data:a}))+'</span>\n    <section>\n        <input type="number" style="margin: 0 5px; position:relative;" class="form-control small rangeCurrentDimensions" data-type="width" placeholder="'+d((n.t||t&&t.t||c).call(l,"modal.download.width_label",{name:"t",hash:{},data:a}))+'"/><span>X</span>\n        <input type="number" style="margin: 0 5px; position:relative;" class="form-control small rangeCurrentDimensions" data-type="height" placeholder="'+d((n.t||t&&t.t||c).call(l,"modal.download.height_label",{name:"t",hash:{},data:a}))+'"/><span>px</span>\n    </section>\n</section>\n\n<section style="display: block; float: right;">\n    <section>\n        <span>'+d((n.t||t&&t.t||c).call(l,"modal.download.settings_label",{name:"t",hash:{},data:a}))+'</span>\n        <div class="checkbox"><input type="checkbox" name="isBleed" value="1"/>\n            <label for="isBleed">'+d((n.t||t&&t.t||c).call(l,"modal.download.bleed_label",{name:"t",hash:{},data:a}))+"</label></div>\n\n";return r=null!=(r=n.displayZipOption||(null!=t?t.displayZipOption:t))?r:c,s={name:"displayZipOption",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a},o=typeof r===u?r.call(l,s):r,n.displayZipOption||(o=p.call(t,o,s)),null!=o&&(h+=o),h+="    </section>\n\n",r=null!=(r=n.display_extended_options||(null!=t?t.display_extended_options:t))?r:c,s={name:"display_extended_options",hash:{},fn:e.program(3,a,0),inverse:e.noop,data:a},o=typeof r===u?r.call(l,s):r,n.display_extended_options||(o=p.call(t,o,s)),null!=o&&(h+=o),h+"</section>\n"},useData:!0})},{"hbsfy/runtime":535}],218:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){var o=null!=t?t:e.nullContext||{},r=n.helperMissing,s=e.escapeExpression;return'<section>\n    <input type="text" class="findFriendsSearch" id="search" name="search" placeholder="'+s((n.t||t&&t.t||r).call(o,"general.search",{name:"t",hash:{},data:a}))+'" data-role="tagsinput"/>\n    <div class="antiscroll-wrap">\n        <div class="antiscroll-inner">\n            <ul class="friends" style="padding-right: 15px; list-style: none;"></ul>\n        </div>\n    </div>\n</section>\n<hr/>\n\n<section data-description="'+s((n.t||t&&t.t||r).call(o,"modal.friends.invite_description",{name:"t",hash:{},data:a}))+'">\n    <input type="text" id="email4inviting" name="emails" placeholder="'+s((n.t||t&&t.t||r).call(o,"general.invite_by_email",{name:"t",hash:{},data:a}))+'"/>\n</section>\n\n<section style="display: none;">\n    <textarea id="inviteFriendComments" placeholder="'+s((n.t||t&&t.t||r).call(o,"general.personal_message",{name:"t",hash:{},data:a}))+'"></textarea>\n</section>\n'},useData:!0})},{"hbsfy/runtime":535}],219:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({1:function(e,t,n,i,a){return e.escapeExpression(e.lambda(t,t))},3:function(e,t,n,i,a){var o,r,s,l=null!=t?t:e.nullContext||{},c=n.helperMissing,d="function",u=n.blockHelperMissing,p="            ";return r=null!=(r=n.Desygner||(null!=t?t.Desygner:t))?r:c,s={name:"Desygner",hash:{},fn:e.program(4,a,0),inverse:e.noop,data:a},o=typeof r===d?r.call(l,s):r,n.Desygner||(o=u.call(t,o,s)),null!=o&&(p+=o),p+="\n            ",r=null!=(r=n.Photobooky||(null!=t?t.Photobooky:t))?r:c,s={name:"Photobooky",hash:{},fn:e.program(6,a,0),inverse:e.noop,data:a},o=typeof r===d?r.call(l,s):r,n.Photobooky||(o=u.call(t,o,s)),null!=o&&(p+=o),p+"\n"},4:function(e,t,n,i,a){return"Desygner"},6:function(e,t,n,i,a){return"Photobooky"},compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){var o,r,s,l=null!=t?t:e.nullContext||{},c=n.helperMissing,d="function",u=e.escapeExpression,p=n.blockHelperMissing,h='<li class="media grayscale" data-id="'+u((r=null!=(r=n.user_id||(null!=t?t.user_id:t))?r:c,typeof r===d?r.call(l,{name:"user_id",hash:{},data:a}):r))+'" data-network="Inkive">\n    <img class="media-object pull-left" alt="'+u((r=null!=(r=n.user_name||(null!=t?t.user_name:t))?r:c,typeof r===d?r.call(l,{name:"user_name",hash:{},data:a}):r))+'" src="'+u((r=null!=(r=n.profile_pic||(null!=t?t.profile_pic:t))?r:c,typeof r===d?r.call(l,{name:"profile_pic",hash:{},data:a}):r))+'" style="width: 42px; height: 42px">\n    <a style="width:20%" class="pull-right btn btn-inkive btn-black btn-xs btn-add-request">'+u((n.t||t&&t.t||c).call(l,"general.add_user",{name:"t",hash:{},data:a}))+'</a>\n\n    <div class="media-body">\n        <span class="media-heading">\n            <strong>'+u((r=null!=(r=n.user_name||(null!=t?t.user_name:t))?r:c,typeof r===d?r.call(l,{name:"user_name",hash:{},data:a}):r))+"</strong><br />\n            ";return r=null!=(r=n.source||(null!=t?t.source:t))?r:c,s={name:"source",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a},o=typeof r===d?r.call(l,s):r,n.source||(o=p.call(t,o,s)),null!=o&&(h+=o),h+="\n",r=null!=(r=n.source||(null!=t?t.source:t))?r:c,s={name:"source",hash:{},fn:e.noop,inverse:e.program(3,a,0),data:a},o=typeof r===d?r.call(l,s):r,n.source||(o=p.call(t,o,s)),null!=o&&(h+=o),h+"        </span>\n    </div>\n</li>\n"},useData:!0})},{"hbsfy/runtime":535}],220:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){return'<div class="info-message text-center">\n    <div class="spinner-wrapper">\n        <div class="spinner small">\n            <circle class="path"></circle>\n        </div>\n    </div>\n    <div class="empty-text">'+e.escapeExpression((n.t||t&&t.t||n.helperMissing).call(null!=t?t:e.nullContext||{},"general.loading",{name:"t",hash:{},data:a}))+"</div>\n</div>\n"},useData:!0})},{"hbsfy/runtime":535}],221:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){return'<div class="info-message text-center">\n    <div class="empty-text">'+e.escapeExpression((n.t||t&&t.t||n.helperMissing).call(null!=t?t:e.nullContext||{},"general.no_results",{name:"t",hash:{},data:a}))+"</div>\n</div>\n"},useData:!0})},{"hbsfy/runtime":535}],222:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){var o,r=null!=t?t:e.nullContext||{},s=n.helperMissing,l=e.escapeExpression,c="function";return"<p>\n    "+l((n.t||t&&t.t||s).call(r,"modal.help.hello",{name:"t",hash:{},data:a}))+" "+l((o=null!=(o=n.user_name||(null!=t?t.user_name:t))?o:s,typeof o===c?o.call(r,{name:"user_name",hash:{},data:a}):o))+",<br />\n    <small>"+l((n.t||t&&t.t||s).call(r,"modal.help.message",{name:"t",hash:{},data:a}))+'</small>\n</p>\n<section>\n    <label for="name">'+l((n.t||t&&t.t||s).call(r,"general.your_name",{name:"t",hash:{},data:a}))+'</label>\n    <input type="text" name="name" class="form-control" id="name" value="'+l((o=null!=(o=n.user_name||(null!=t?t.user_name:t))?o:s,typeof o===c?o.call(r,{name:"user_name",hash:{},data:a}):o))+'"/>\n</section>\n<section>\n    <label for="email">'+l((n.t||t&&t.t||s).call(r,"general.email_address",{name:"t",hash:{},data:a}))+'</label>\n    <input type="text" name="email" class="form-control" id="email" value="'+l((o=null!=(o=n.user_email||(null!=t?t.user_email:t))?o:s,typeof o===c?o.call(r,{name:"user_email",hash:{},data:a}):o))+'"/>\n</section>\n<section>\n    <label for="help">'+l((n.t||t&&t.t||s).call(r,"general.how_help",{name:"t",hash:{},data:a}))+'</label>\n    <textarea name="help" rows="3" class="form-control"></textarea>\n</section>\n'},useData:!0})},{"hbsfy/runtime":535}],223:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({1:function(e,t,n,i,a){return"<p><small>"+e.escapeExpression(e.lambda(t,t))+"</small></p>"},3:function(e,t,n,i,a){return'<label for="name">'+e.escapeExpression(e.lambda(t,t))+"</label>"},5:function(e,t,n,i,a){return' value="'+e.escapeExpression(e.lambda(t,t))},compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){var o,r,s,l=null!=t?t:e.nullContext||{},c=n.helperMissing,d="function",u=n.blockHelperMissing,p="";return r=null!=(r=n.title||(null!=t?t.title:t))?r:c,s={name:"title",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a},o=typeof r===d?r.call(l,s):r,n.title||(o=u.call(t,o,s)),null!=o&&(p+=o),p+="\n<section>\n  ",r=null!=(r=n.label||(null!=t?t.label:t))?r:c,s={name:"label",hash:{},fn:e.program(3,a,0),inverse:e.noop,data:a},o=typeof r===d?r.call(l,s):r,n.label||(o=u.call(t,o,s)),null!=o&&(p+=o),p+='\n  <input type="text" class="form-control"',r=null!=(r=n.default_value||(null!=t?t.default_value:t))?r:c,s={name:"default_value",hash:{},fn:e.program(5,a,0),inverse:e.noop,data:a},o=typeof r===d?r.call(l,s):r,n.default_value||(o=u.call(t,o,s)),null!=o&&(p+=o),p+'"/>\n</section>\n'},useData:!0})},{"hbsfy/runtime":535}],224:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({1:function(e,t,n,i,a){var o,r=null!=t?t:e.nullContext||{},s=n.helperMissing,l="function",c=e.escapeExpression;return'<section>\n    <img src="'+c((o=null!=(o=n.thumb||(null!=t?t.thumb:t))?o:s,typeof o===l?o.call(r,{name:"thumb",hash:{},data:a}):o))+'" width="124"/>\n    <div style="display: inline-block; vertical-align: top; padding-left: 10px; width: 340px;">\n        <strong>'+c((o=null!=(o=n.book_name||(null!=t?t.book_name:t))?o:s,typeof o===l?o.call(r,{name:"book_name",hash:{},data:a}):o))+"</strong><br/>\n        <span>"+c((o=null!=(o=n.book_description||(null!=t?t.book_description:t))?o:s,typeof o===l?o.call(r,{name:"book_description",hash:{},data:a}):o))+"</span>\n    </div>\n</section>\n"},compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){var o,r,s,l=null!=t?t:e.nullContext||{},c=n.helperMissing,d="function",u=e.escapeExpression,p="";return r=null!=(r=n.Desktop||(null!=t?t.Desktop:t))?r:c,s={name:"Desktop",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a},o=typeof r===d?r.call(l,s):r,n.Desktop||(o=n.blockHelperMissing.call(t,o,s)),null!=o&&(p+=o),p+'\n<section>\n    <label for="share_email">'+u((n.t||t&&t.t||c).call(l,"general.email_address",{name:"t",hash:{},data:a}))+'</label>\n    <input type="email" name="share_email" class="form-control" id="share_email" placeholder="'+u((n.t||t&&t.t||c).call(l,"modal.share_email.address_placeholder",{name:"t",hash:{},data:a}))+'"/>\n</section>\n\n<section>\n    <label for="sender_username">'+u((n.t||t&&t.t||c).call(l,"general.name",{name:"t",hash:{},data:a}))+'</label>\n    <input type="text" name="sender_username" class="form-control" id="sender_username" placeholder="'+u((n.t||t&&t.t||c).call(l,"general.enter_your_name",{name:"t",hash:{},data:a}))+'" value="'+u((r=null!=(r=n.user_name||(null!=t?t.user_name:t))?r:c,typeof r===d?r.call(l,{name:"user_name",hash:{},data:a}):r))+'"/>\n</section>\n\n<section>\n    <label for="share_comments">'+u((n.t||t&&t.t||c).call(l,"common.share_message",{name:"t",hash:{},data:a}))+'</label>\n    <textarea name="share_comments" class="form-control" placeholder="'+u((n.t||t&&t.t||c).call(l,"editor.add_message_optional",{name:"t",hash:{},data:a}))+'"></textarea>\n</section>\n'},useData:!0})},{"hbsfy/runtime":535}],225:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({1:function(e,t,n,i,a){return'        <label for="bookName">'+e.escapeExpression((n.t||t&&t.t||n.helperMissing).call(null!=t?t:e.nullContext||{},"modal.share_embed.display_project",{name:"t",hash:{},data:a}))+"</label>\n"},compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){var o,r,s,l=null!=t?t:e.nullContext||{},c=n.helperMissing,d=e.escapeExpression,u="function",p=n.blockHelperMissing,h='<section style="display: block; float: left; margin-right: 10px;">\n    <span>'+d((n.t||t&&t.t||c).call(l,"modal.share_embed.type_label",{name:"t",hash:{},data:a}))+'</span>\n\n    <ul class="btnWrapper">\n        <li>\n            <a class="btn btn-squire btn-tag type active" tag="'+d((n.t||t&&t.t||c).call(l,"modal.share_embed.slideshow",{name:"t",hash:{},data:a}))+'" data-id="slide">\n                <div class="icon-wrapper"><i class="icon-square-o"></i></div>\n            </a>\n        </li>\n        <li>\n            <a class="btn btn-squire btn-tag type" tag="'+d((n.t||t&&t.t||c).call(l,"modal.share_embed.scrolling",{name:"t",hash:{},data:a}))+'" data-id="scroll">\n                <div class="icon-wrapper"><i class="icon-square-o"></i></div>\n            </a>\n        </li>\n    </ul>\n</section>\n\n<section style="display: block; float: left;" id="share-embed-size">\n    <span id="share-embed-size-text">'+d((n.t||t&&t.t||c).call(l,"modal.share_embed.size_label",{name:"t",hash:{},data:a}))+'</span>\n\n    <ul class="btnWrapper">\n        <li>\n            <a class="btn btn-squire btn-tag size active" tag="290 x 205" data-id="290">\n                <div class="icon-wrapper"><i class="icon-square-o" style="font-size:0.6em;"></i></div>\n            </a>\n        </li>\n        <li>\n            <a class="btn btn-squire btn-tag size" tag="500 x 354" data-id="500">\n                <div class="icon-wrapper"><i class="icon-square-o" style="font-size:0.8em;"></i></div>\n            </a>\n        </li>\n        <li>\n            <a class="btn btn-squire btn-tag size" tag="800 x 566" data-id="800">\n                <div class="icon-wrapper"><i class="icon-square-o" style="font-size:1.0em;"></i></div>\n            </a>\n        </li>\n        <li>\n            <a class="btn btn-squire btn-tag size" tag="'+d((n.t||t&&t.t||c).call(l,"modal.share_embed.custom",{name:"t",hash:{},data:a}))+'" data-id="custom">\n                <div class="icon-wrapper"><i class="icon-square-o" style="font-size:1.2em;"></i></div>\n            </a>\n        </li>\n        <li>\n            <div id="share-embed-custom-sizes" style="display: none;">\n                <input type="number" name="width" class="form-control small" value="'+d((r=null!=(r=n.width||(null!=t?t.width:t))?r:c,typeof r===u?r.call(l,{name:"width",hash:{},data:a}):r))+'"/>\n                <span>&nbsp;X&nbsp;<span>\n                <input type="number" name="height" class="form-control small" value="'+d((r=null!=(r=n.height||(null!=t?t.height:t))?r:c,typeof r===u?r.call(l,{name:"height",hash:{},data:a}):r))+'"/>\n            </div>\n        </li>\n    </ul>\n</section>\n\n<section style="clear: both;" id="share-embed-checkboxes">\n    <div class="checkbox">\n        <input type="checkbox" name="bookName" id="bookName" value="1"/>\n';return r=null!=(r=n.Desygner||(null!=t?t.Desygner:t))?r:c,s={name:"Desygner",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a},o=typeof r===u?r.call(l,s):r,n.Desygner||(o=p.call(t,o,s)),null!=o&&(h+=o),h+="\n",r=null!=(r=n.Photobooky||(null!=t?t.Photobooky:t))?r:c,s={name:"Photobooky",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a},o=typeof r===u?r.call(l,s):r,n.Photobooky||(o=p.call(t,o,s)),null!=o&&(h+=o),h+'    </div>\n    <div class="checkbox">\n        <input type="checkbox" name="bookViews" id="bookViews" value="1"/>\n        <label for="bookViews">'+d((n.t||t&&t.t||c).call(l,"modal.share_embed.display_numbers",{name:"t",hash:{},data:a}))+'</label>\n    </div>\n</section>\n\n<section style="clear: both;">\n    <label for="code">'+d((n.t||t&&t.t||c).call(l,"modal.share_embed.code_label",{name:"t",hash:{},data:a}))+'</label>\n    <textarea name="code" class="form-control" readonly="readonly"></textarea>\n</section>\n'},useData:!0})},{"hbsfy/runtime":535}],226:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){return'<li class="space" data-additional-menu="true" style="display: none;"></li>\n'},useData:!0})},{"hbsfy/runtime":535}],227:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({1:function(e,t,n,i,a){return'<li><a role="menuitem">'+e.escapeExpression(e.lambda(t,t))+" pt</a></li>"},compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){var o;return"<ul>\n    "+(null!=(o=n.each.call(null!=t?t:e.nullContext||{},t,{name:"each",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a}))?o:"")+"\n</ul>\n"},useData:!0})},{"hbsfy/runtime":535}],228:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){return'<li>\n    <a class="btn btn-onmenu" data-action="on_show_more">\n        '+e.escapeExpression((n.t||t&&t.t||n.helperMissing).call(null!=t?t:e.nullContext||{},"popupmenu.show_more",{name:"t",hash:{},data:a}))+"\n    </a>\n</li>\n"},useData:!0})},{"hbsfy/runtime":535}],229:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({1:function(e,t,n,i,a,o,r){var s=e.lambda,l=e.escapeExpression;return'    <li>\n        <svg width="200" height="30" version="1.1" xmlns="http://www.w3.org/2000/svg">\n            <line stroke-dasharray="'+l(s(t,t))+'" stroke-width="'+l(s(null!=r[1]?r[1].width:r[1],t))+'" x1="0" y1="15" x2="200" y2="15"/>\n        </svg>\n    </li>\n'},compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a,o,r){var s,l,c=null!=t?t:e.nullContext||{};return'<ul class="stroke-dasharray">\n    <li>\n        <svg width="200" height="30" version="1.1" xmlns="http://www.w3.org/2000/svg">\n            <line stroke-width="'+e.escapeExpression((l=null!=(l=n.width||(null!=t?t.width:t))?l:n.helperMissing,"function"==typeof l?l.call(c,{name:"width",hash:{},data:a}):l))+'" x1="0" y1="15" x2="200" y2="15"/>\n        </svg>\n    </li>\n'+(null!=(s=n.each.call(c,null!=t?t.dashArrays:t,{name:"each",hash:{},fn:e.program(1,a,0,o,r),inverse:e.noop,data:a}))?s:"")+"</ul>\n"},useData:!0,useDepths:!0})},{"hbsfy/runtime":535}],230:[function(e,t,n){var i={modal:e("./modal/base/modal.hbs"),modal_alert:e("./modal/base/alert.hbs"),modal_wrapper:e("./modal/base/wrapper.hbs"),modal_buttons:e("./modal/base/buttons.hbs"),modal_loader:e("./modal/base/loader.hbs"),modal_restricted_template_load:e("./modal/base/restricted-template-load.hbs"),modal_layout_load:e("./modal/base/layout-load.hbs"),alert_default:e("./modal/alert/default.hbs"),alert_delete_confirm:e("./modal/alert/delete-confirm.hbs"),alert_span:e("./modal/alert/span.hbs"),alert_bold:e("./modal/alert/bold.hbs"),popupmenu_showmore:e("./popupmenu/show-more.hbs"),popupmenu_additional:e("./popupmenu/additional.hbs"),popupmenu_font_size_list:e("./popupmenu/font-size-list.hbs"),popupmenu_stroke_dasharray:e("./popupmenu/stroke-dasharray.hbs")};t.exports=function(e,t){if(i[e])return i[e](t)}},{"./modal/alert/bold.hbs":206,"./modal/alert/default.hbs":207,"./modal/alert/delete-confirm.hbs":208,"./modal/alert/span.hbs":209,"./modal/base/alert.hbs":210,"./modal/base/buttons.hbs":211,"./modal/base/layout-load.hbs":212,"./modal/base/loader.hbs":213,"./modal/base/modal.hbs":214,"./modal/base/restricted-template-load.hbs":215,"./modal/base/wrapper.hbs":216,"./popupmenu/additional.hbs":226,"./popupmenu/font-size-list.hbs":227,"./popupmenu/show-more.hbs":228,"./popupmenu/stroke-dasharray.hbs":229}],231:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({1:function(e,t,n,i,a){return'class="vertical"'},compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){var o,r,s,l=null!=t?t:e.nullContext||{},c=n.helperMissing,d="function",u=e.escapeExpression,p='<g clip-path="url(#'+u((r=null!=(r=n.clipId||(null!=t?t.clipId:t))?r:c,typeof r===d?r.call(l,{name:"clipId",hash:{},data:a}):r))+')" height="'+u((r=null!=(r=n.size||(null!=t?t.size:t))?r:c,typeof r===d?r.call(l,{name:"size",hash:{},data:a}):r))+'" width="'+u((r=null!=(r=n.size||(null!=t?t.size:t))?r:c,typeof r===d?r.call(l,{name:"size",hash:{},data:a}):r))+'" y="'+u((r=null!=(r=n.y||(null!=t?t.y:t))?r:c,typeof r===d?r.call(l,{name:"y",hash:{},data:a}):r))+'" x="'+u((r=null!=(r=n.x||(null!=t?t.x:t))?r:c,typeof r===d?r.call(l,{name:"x",hash:{},data:a}):r))+'">\n    <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"\n     id="'+u((r=null!=(r=n.id||(null!=t?t.id:t))?r:c,typeof r===d?r.call(l,{name:"id",hash:{},data:a}):r))+'" height="'+u((r=null!=(r=n.size||(null!=t?t.size:t))?r:c,typeof r===d?r.call(l,{name:"size",hash:{},data:a}):r))+'" width="'+u((r=null!=(r=n.size||(null!=t?t.size:t))?r:c,typeof r===d?r.call(l,{name:"size",hash:{},data:a}):r))+'" y="'+u((r=null!=(r=n.y||(null!=t?t.y:t))?r:c,typeof r===d?r.call(l,{name:"y",hash:{},data:a}):r))+'" x="'+u((r=null!=(r=n.x||(null!=t?t.x:t))?r:c,typeof r===d?r.call(l,{name:"x",hash:{},data:a}):r))+'" ';return r=null!=(r=n.is_vertical||(null!=t?t.is_vertical:t))?r:c,s={name:"is_vertical",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a},o=typeof r===d?r.call(l,s):r,n.is_vertical||(o=n.blockHelperMissing.call(t,o,s)),null!=o&&(p+=o),p+'\n     viewBox="0 0 1280 1280" enable-background="new 0 0 1280 1280" xml:space="preserve">\n        <g id="bg">\n            <rect fill="#9BC9D4" width="1280" height="936"/>\n            <rect y="914" fill="#72A862" width="1280" height="366"/>\n        </g>\n        <g class="sky">\n            <g class="cloud">\n                <path fill-rule="evenodd" clip-rule="evenodd" fill="#FFFFFF" d="M199.331,430.797c-1.287-7.37,0.87-13.442,7.053-17.595\n                    c6.536-4.389,13.351-4.055,19.751-0.271c2.852-3.395,5.261-7.127,8.479-9.933c10.082-8.788,21.739-10.796,34.015-5.625\n                    c12.268,5.165,18.91,14.864,19.809,28.24c0.138,2.053,0.498,3.153,2.718,3.989c10.525,3.957,17.133,16.158,15.34,27.738\n                    c-1.622,10.467-6.968,17.88-17.418,20.954c-1.912,0.562-4,0.732-6.006,0.735c-26.073,0.048-52.145,0.045-78.218,0.025\n                    c-12.834-0.009-22.492-8.336-24.433-20.987c-1.78-11.604,5.839-23.202,17.576-26.768\n                    C198.429,431.171,198.845,430.982,199.331,430.797z"/>\n                <path fill-rule="evenodd" clip-rule="evenodd" fill="#F2F2F2" d="M405.854,465.442c11.737,3.564,19.356,15.162,17.576,26.766\n                    c-1.941,12.653-11.599,20.979-24.433,20.987c-26.073,0.021-73.944,0.023-100.018-0.024c-2.007-0.003-4.094-0.174-6.006-0.736\n                    c-10.45-3.073-15.797-10.487-17.418-20.953c-1.794-11.58,4.814-23.782,15.339-27.739c2.22-0.835,2.58-1.937,2.718-3.989\n                    c0.898-13.375,7.541-23.073,19.809-28.24c12.276-5.169,38.33-10.775,55.814,5.626c3.219,2.805,5.628,6.538,8.479,9.933\n                    c6.401-3.783,13.215-4.117,19.751,0.271c6.183,4.151,8.339,10.226,7.052,17.594C405.006,465.122,405.421,465.311,405.854,465.442z\n                    "/>\n            </g>\n            <circle class="sun" fill="#FFD300" cx="897.401" cy="443.524" r="97.165"/>\n        </g>\n        <g class="mountain">\n            <polygon class="small" fill="#927983" points="657.588,914 842.176,594.252 1026.777,914"/>\n            <g class="big">\n                <g>\n                    <polygon fill="#735C65" points="331.002,914 613.958,423.855 896.934,914"/>\n                </g>\n                <polygon fill="#FEFEFE" points="606.685,610.174 649.338,552.498 710.109,590.374 710.109,590.374 613.958,423.827\n                    518.706,588.824 573.51,560.886"/>\n            </g>\n            <g class="trees">\n                <g>\n                    <rect x="357" y="978" fill="#A76743" width="8" height="34"/>\n                    <polygon fill="#858651" points="329.142,995 363.145,936.109 397.153,995"/>\n                </g>\n                <g>\n                    <rect x="272" y="948" fill="#A76743" width="8" height="34"/>\n                    <polygon fill="#858651" points="244.142,965 278.145,906.109 312.153,965"/>\n                </g>\n                <g>\n                    <rect x="225" y="957" fill="#A76743" width="9" height="33"/>\n                    <polygon fill="#009245" points="195.77,973 230.921,912.12 266.08,973"/>\n                </g>\n                <g>\n                    <rect x="310" y="987" fill="#A76743" width="9" height="33"/>\n                    <polygon fill="#009245" points="280.77,1003 315.922,942.12 351.08,1003"/>\n                </g>\n            </g>\n        </g>\n        <g class="text">\n            <g>\n                <g>\n                    <g>\n                        <g>\n                            <path fill="#FFFFFF" d="M451.408,822.89V710.513h25.784c9.459,0,16.877,0.437,22.24,1.296\n                                c5.368,0.872,9.984,2.268,13.848,4.197c8.138,4.021,14.316,10.341,18.542,18.962c4.217,8.621,6.334,19.236,6.334,31.85\n                                c0,12.668-2.123,23.314-6.375,31.964c-4.245,8.655-10.416,14.86-18.501,18.617c-4.02,1.936-8.834,3.333-14.458,4.196\n                                c-5.619,0.867-12.832,1.295-21.63,1.295H451.408z M456.745,818.087h21.671c8.437,0,15.177-0.448,20.219-1.34\n                                c5.028-0.884,9.454-2.324,13.275-4.304c6.709-3.546,11.844-9.242,15.411-17.078c3.555-7.826,5.339-17.384,5.339-28.661\n                                c0-9.495-1.249-17.736-3.74-24.712c-2.491-6.948-6.207-12.621-11.135-16.995c-3.918-3.496-8.729-5.992-14.423-7.46\n                                c-5.697-1.483-14.014-2.211-24.947-2.211h-21.671V818.087z"/>\n                            <path fill="#FFFFFF" d="M556.994,822.89v-81.098h5.036v14.575c2.039-5.389,5.088-9.449,9.156-12.169\n                                c4.073-2.721,9.084-4.082,15.029-4.082v4.805c-8.751,0.355-14.964,3.406-18.651,9.156c-3.69,5.747-5.534,15.57-5.534,29.452\n                                v39.36H556.994z"/>\n                            <path fill="#FFFFFF" d="M664.566,823.35c-0.558,0.052-1.317,0.142-2.288,0.268c-0.967,0.131-1.675,0.188-2.136,0.188\n                                c-3.711,0-6.404-1.14-8.085-3.429c-1.679-2.29-2.519-6.028-2.519-11.213c-3.259,5.035-7.693,8.923-13.317,11.672\n                                c-5.614,2.747-12.063,4.116-19.333,4.116c-7.224,0-13.056-2.095-17.51-6.293c-4.452-4.19-6.676-9.701-6.676-16.517\n                                c0-7.176,2.445-12.643,7.324-16.403c4.881-3.765,13.224-6.484,25.023-8.163c2.083-0.302,4.911-0.656,8.469-1.07\n                                c10.683-1.225,16.021-3.994,16.021-8.314v-6.867c0-5.488-1.887-9.7-5.647-12.623c-3.756-2.926-9.181-4.389-16.249-4.389\n                                c-8.084,0-14.452,1.755-19.109,5.261c-4.656,3.515-7.188,8.469-7.592,14.879h-4.654c0.303-7.576,3.217-13.551,8.739-17.93\n                                c5.518-4.373,12.901-6.555,22.156-6.555c5.647,0,10.494,0.785,14.539,2.36c4.04,1.576,7.136,3.894,9.269,6.942\n                                c1.219,1.778,2.098,3.801,2.628,6.064c0.533,2.262,0.802,5.838,0.802,10.721v3.436v36.082c0,5.747,0.511,9.529,1.528,11.333\n                                c1.017,1.801,2.899,2.704,5.648,2.704c0.502,0,1.349-0.069,2.513-0.228c0.211-0.049,0.358-0.077,0.457-0.077V823.35z\n                                 M649.539,776.506c-1.267,1.732-6.971,3.181-17.086,4.35c-1.627,0.206-2.903,0.361-3.817,0.457\n                                c-11.546,1.479-19.572,3.727-24.073,6.752c-4.499,3.027-6.753,7.446-6.753,13.238c0,6,1.784,10.63,5.346,13.886\n                                c3.56,3.25,8.62,4.884,15.179,4.884c4.38,0,8.583-0.698,12.626-2.103c4.042-1.401,7.541-3.343,10.493-5.836\n                                c3.002-2.645,5.095-5.604,6.289-8.887c1.202-3.281,1.797-8.197,1.797-14.76V776.506z"/>\n                            <path fill="#FFFFFF" d="M740.171,805.573c-2.689,6.26-6.724,11.105-12.083,14.537c-5.37,3.431-11.663,5.147-18.887,5.147\n                                c-10.94,0-19.587-3.812-25.941-11.44c-6.354-7.632-9.538-18.036-9.538-31.207c0-13.228,3.194-23.612,9.573-31.163\n                                c6.387-7.558,15.122-11.331,26.215-11.331c7.37,0,13.769,1.751,19.186,5.26c5.414,3.514,9.246,8.373,11.476,14.577v-18.161\n                                h4.81v76.754c0,6.152-0.394,10.845-1.181,14.074c-0.792,3.231-2.099,6.192-3.927,8.886c-3.16,4.632-7.48,8.131-12.974,10.492\n                                c-5.496,2.371-12,3.544-19.533,3.544c-9.154,0-16.474-2.167-21.967-6.522c-5.498-4.343-8.292-10.13-8.395-17.354h4.732\n                                c0.299,6.1,2.82,10.887,7.552,14.341c4.733,3.46,11.164,5.188,19.297,5.188c6.767,0,12.481-1.153,17.13-3.467\n                                c4.654-2.316,8.272-5.761,10.871-10.342c1.277-2.284,2.192-4.957,2.75-8.007c0.563-3.052,0.834-8.243,0.834-15.562V805.573z\n                                 M740.171,782.61c0-11.854-2.744-21.169-8.237-27.966c-5.488-6.783-12.974-10.175-22.424-10.175\n                                c-9.459,0-16.95,3.392-22.473,10.175c-5.519,6.797-8.278,16.112-8.278,27.966c0,11.798,2.76,21.099,8.278,27.883\n                                c5.522,6.793,13.014,10.187,22.473,10.187c9.45,0,16.936-3.394,22.424-10.187C737.427,803.709,740.171,794.408,740.171,782.61z\n                                "/>\n                        </g>\n                        <g>\n                            <path fill="#FFFFFF" d="M618.807,833.938v110.425h-4.725v-17.729c-2.557,6.515-6.405,11.457-11.534,14.84\n                                c-5.132,3.38-11.357,5.073-18.669,5.073c-10.916,0-19.518-3.737-25.803-11.197c-6.283-7.46-9.429-17.682-9.429-30.656\n                                c0-12.97,3.157-23.184,9.466-30.646c6.306-7.46,14.898-11.194,25.766-11.194c7.212,0,13.459,1.683,18.738,5.035\n                                c5.292,3.358,9.109,8.086,11.465,14.199v-48.15H618.807z M614.082,904.694c0-11.662-2.711-20.839-8.116-27.523\n                                c-5.41-6.684-12.768-10.029-22.087-10.029c-9.31,0-16.688,3.346-22.121,10.029c-5.43,6.685-8.151,15.861-8.151,27.523\n                                c0,11.626,2.722,20.776,8.151,27.466c5.434,6.687,12.811,10.03,22.121,10.03c9.319,0,16.677-3.344,22.087-10.03\n                                C611.371,925.471,614.082,916.32,614.082,904.694z"/>\n                            <path fill="#FFFFFF" d="M640.144,944.363V864.51h4.958v14.352c2-5.31,5.007-9.309,9.02-11.98\n                                c4.002-2.687,8.936-4.026,14.789-4.026v4.739c-8.611,0.346-14.729,3.354-18.362,9.013c-3.63,5.659-5.446,15.324-5.446,29.001\n                                v38.756H640.144z"/>\n                            <path fill="#FFFFFF" d="M676.802,904.694c0-12.97,3.137-23.184,9.396-30.646c6.262-7.46,14.815-11.194,25.689-11.194\n                                c10.863,0,19.451,3.734,25.766,11.194c6.309,7.462,9.465,17.676,9.465,30.646c0,12.928-3.156,23.131-9.465,30.616\n                                c-6.314,7.487-14.902,11.237-25.766,11.237c-10.874,0-19.428-3.737-25.689-11.197\n                                C679.938,927.891,676.802,917.669,676.802,904.694z M681.759,904.694c0,11.626,2.697,20.776,8.081,27.466\n                                c5.382,6.687,12.733,10.03,22.047,10.03c9.314,0,16.692-3.344,22.159-10.03c5.454-6.689,8.188-15.84,8.188-27.466\n                                c0-11.662-2.733-20.839-8.188-27.523c-5.467-6.684-12.845-10.029-22.159-10.029c-9.313,0-16.665,3.346-22.047,10.029\n                                C684.456,883.855,681.759,893.032,681.759,904.694z"/>\n                            <path fill="#FFFFFF" d="M764.475,976.065V864.51h4.957v18.325c2.55-6.55,6.367-11.529,11.449-14.912\n                                c5.083-3.374,11.309-5.068,18.671-5.068c10.916,0,19.519,3.722,25.802,11.161c6.283,7.437,9.428,17.66,9.428,30.679\n                                c0,12.928-3.156,23.131-9.463,30.616c-6.312,7.487-14.901,11.237-25.767,11.237c-7.27,0-13.485-1.674-18.671-5.002\n                                c-5.177-3.327-9-8.128-11.449-14.383v48.902H764.475z M769.432,904.694c0,11.626,2.685,20.776,8.073,27.466\n                                c5.382,6.687,12.728,10.03,22.047,10.03c9.368,0,16.764-3.344,22.196-10.03c5.437-6.689,8.145-15.84,8.145-27.466\n                                c0-11.662-2.708-20.839-8.145-27.523c-5.433-6.684-12.828-10.029-22.196-10.029c-9.319,0-16.665,3.346-22.047,10.029\n                                C772.116,883.855,769.432,893.032,769.432,904.694z M778.844,874.899h-4.958v-20.423h4.958v10.627"/>\n                        </g>\n                    </g>\n                    <g>\n                        <path fill="#FFFFFF" d="M488.177,891.47l16.338,19.965c1.273-2.285,2.26-4.757,2.96-7.414c0.703-2.652,1.167-5.565,1.387-8.73\n                            h13.9c-0.305,5.098-1.219,9.895-2.73,14.394c-1.516,4.508-3.68,8.738-6.493,12.683l17.986,21.741h-18.907l-8.233-10.144\n                            c-3.865,4.215-8.271,7.367-13.211,9.457c-4.941,2.084-10.463,3.127-16.568,3.127c-8.258,0-15.079-2.7-20.452-8.098\n                            c-5.381-5.405-8.074-12.238-8.074-20.497c0-5.973,1.67-11.198,5.005-15.675c3.335-4.481,8.918-8.945,16.736-13.377\n                            c-3.782-4.478-6.403-8.301-7.878-11.462c-1.467-3.164-2.204-6.39-2.204-9.678c0-6.597,2.204-11.953,6.621-16.077\n                            c4.417-4.135,10.197-6.195,17.362-6.195c7.241,0,12.967,1.902,17.157,5.699c4.199,3.791,6.296,8.95,6.296,15.447\n                            c0,4.964-1.385,9.476-4.148,13.541C498.256,884.238,493.975,888.005,488.177,891.47z M496.146,923.749l-20.488-25.101\n                            c-5.005,2.903-8.637,5.809-10.898,8.731c-2.265,2.926-3.395,6.164-3.395,9.721c0,4.656,1.494,8.475,4.478,11.463\n                            c2.989,2.986,6.848,4.481,11.592,4.481c3.384,0,6.683-0.804,9.886-2.408C490.527,929.029,493.47,926.736,496.146,923.749z\n                             M480.534,882.581c3.87-2.372,6.723-4.809,8.566-7.319c1.844-2.501,2.764-5.22,2.764-8.161c0-3.075-0.88-5.519-2.633-7.322\n                            c-1.755-1.793-4.125-2.695-7.118-2.695c-3.291,0-5.862,0.854-7.704,2.567c-1.849,1.714-2.765,4.042-2.765,6.985\n                            c0,2.281,0.666,4.644,2.005,7.08C474.992,876.153,477.288,879.109,480.534,882.581z"/>\n                    </g>\n                    <path fill-rule="evenodd" clip-rule="evenodd" fill="#FFFFFF" d="M847.512,789.331c-2.453-0.247-4.932-0.68-7.282-1.405\n                        c-3.089-0.95-3.977-3.455-2.442-6.312c0.581-1.081,1.389-2.051,2.167-3.01c1.868-2.301,3.08-4.871,3.45-7.829\n                        c0.618-4.937,0.148-9.783-1.248-14.536c-2.104-7.146-2.537-14.366-1.257-21.713c4.244-24.352,27.95-41.397,52.297-37.578\n                        c24.851,3.898,41.795,25.813,39.293,50.819c-1.818,18.158-14.807,34.036-32.273,39.242c-10.099,3.011-20.497,3.871-31.021,4.237\n                        C861.965,790.618,854.731,790.055,847.512,789.331z M891.669,729.427c-0.023-3.225-2.114-5.452-4.878-5.321\n                        c-2.529,0.123-4.386,2.175-4.404,5.005c-0.033,5.825-0.009,11.65-0.009,18.033c-2.742-2.657-5.107-4.986-7.514-7.269\n                        c-2.413-2.288-5.22-2.416-7.195-0.39c-1.981,2.035-1.779,4.809,0.569,7.188c4.741,4.803,9.487,9.601,14.259,14.369\n                        c3.143,3.139,5.49,3.101,8.572-0.144c4.7-4.951,9.399-9.903,14.021-14.928c1.76-1.913,1.771-4.17,0.335-6.074\n                        c-1.264-1.676-3.67-2.4-5.519-1.436c-0.99,0.517-1.834,1.375-2.63,2.191c-1.72,1.764-3.364,3.6-5.042,5.405\n                        c-0.185-0.06-0.369-0.119-0.557-0.18C891.678,740.395,891.705,734.911,891.669,729.427z"/>\n                    <path fill-rule="evenodd" clip-rule="evenodd" fill="#FFFFFF" d="M766.341,867.598c-22.604,3.208-49.405-2.221-62.396-12.645\n                        c1.058-0.108,1.926-0.221,2.798-0.284c18.194-1.316,31.799-9.829,40.496-25.936c4.403-8.155,7.064-16.924,8.071-26.1\n                        c0.833-7.603,1.581-15.161,4.448-22.354c6.238-15.649,19.772-25.348,36.579-23.165c10.56,1.371,18.463,7.979,20.56,18.397\n                        c0.647,3.222,0.792,6.544,1.185,9.959c3.326,0.272,6.612,0.539,10.29,0.837c-0.592,0.512-0.838,0.748-1.108,0.955\n                        c-5.374,4.101-8.685,8.854-9.513,16.19c-2.904,25.753-14.197,46.524-38.134,58.827 M803.558,786.809\n                        c3.398,0.116,6.273-2.629,6.279-5.999c0.007-3.24-2.726-6.021-5.974-6.079c-3.238-0.057-6.035,2.654-6.1,5.909\n                        C797.699,784.001,800.231,786.696,803.558,786.809z"/>\n                </g>\n                <g>\n                    <path fill="#FFFFFF" d="M490.413,957.762h2.495v40.48h-2.495V957.762z"/>\n                    <path fill="#FFFFFF" d="M499.71,969.101h2.155v5.953h0.112c0.227-0.906,0.625-1.766,1.191-2.58\n                        c0.567-0.812,1.256-1.521,2.069-2.125c0.812-0.604,1.72-1.077,2.722-1.417c1.001-0.341,2.05-0.511,3.146-0.511\n                        c1.398,0,2.609,0.179,3.629,0.539c1.02,0.357,1.89,0.831,2.608,1.416c0.717,0.587,1.284,1.249,1.701,1.986\n                        c0.416,0.735,0.699,1.481,0.851,2.236h0.113c0.87-2.04,2.032-3.58,3.488-4.618c1.454-1.039,3.373-1.56,5.753-1.56\n                        c1.323,0,2.542,0.198,3.657,0.595c1.114,0.397,2.078,1.003,2.892,1.814c0.812,0.814,1.445,1.843,1.898,3.09\n                        c0.454,1.247,0.681,2.721,0.681,4.422v19.9h-2.155v-19.957c0-1.852-0.283-3.307-0.85-4.365c-0.568-1.058-1.238-1.862-2.013-2.409\n                        c-0.775-0.548-1.551-0.89-2.324-1.022c-0.775-0.13-1.371-0.196-1.786-0.196c-1.323,0-2.542,0.227-3.656,0.681\n                        c-1.116,0.452-2.079,1.133-2.892,2.04c-0.813,0.907-1.446,2.031-1.899,3.374c-0.454,1.341-0.68,2.884-0.68,4.619v17.236h-2.154\n                        v-19.957c0-1.813-0.274-3.259-0.822-4.336c-0.549-1.079-1.19-1.88-1.928-2.41c-0.737-0.529-1.493-0.869-2.267-1.021\n                        c-0.776-0.15-1.389-0.227-1.843-0.227c-1.02,0-2.079,0.208-3.174,0.622c-1.097,0.416-2.098,1.06-3.004,1.93\n                        c-0.908,0.868-1.645,1.983-2.212,3.345c-0.567,1.359-0.849,2.965-0.849,4.817v17.236h-2.155V969.101z"/>\n                    <path fill="#FFFFFF" d="M564.113,992.458H564c-0.34,0.87-0.833,1.693-1.475,2.466c-0.643,0.776-1.427,1.467-2.353,2.071\n                        c-0.927,0.604-1.975,1.076-3.146,1.416c-1.172,0.341-2.458,0.51-3.855,0.51c-3.1,0-5.499-0.672-7.2-2.013\n                        c-1.701-1.34-2.552-3.41-2.552-6.208c0-1.701,0.342-3.088,1.021-4.166c0.68-1.078,1.54-1.929,2.579-2.552\n                        c1.04-0.623,2.192-1.066,3.458-1.332c1.267-0.265,2.485-0.452,3.657-0.566l3.344-0.284c1.55-0.114,2.769-0.292,3.658-0.539\n                        c0.887-0.244,1.559-0.584,2.012-1.02c0.454-0.434,0.737-0.992,0.851-1.672c0.113-0.682,0.169-1.531,0.169-2.552\n                        c0-0.795-0.151-1.53-0.453-2.211c-0.304-0.68-0.775-1.285-1.418-1.815c-0.642-0.529-1.474-0.943-2.493-1.246\n                        c-1.021-0.304-2.269-0.453-3.743-0.453c-2.607,0-4.715,0.644-6.321,1.928c-1.608,1.285-2.486,3.229-2.637,5.84h-2.153\n                        c0.15-3.213,1.18-5.623,3.088-7.229c1.909-1.605,4.621-2.409,8.137-2.409c3.515,0,6.075,0.689,7.682,2.067\n                        c1.606,1.382,2.41,3.186,2.41,5.417v16.95c0,0.416,0.009,0.831,0.027,1.246c0.019,0.419,0.086,0.795,0.199,1.136\n                        c0.112,0.34,0.301,0.614,0.567,0.821c0.265,0.208,0.642,0.312,1.133,0.312c0.378,0,0.908-0.058,1.588-0.17v1.814\n                        c-0.567,0.152-1.153,0.228-1.757,0.228c-0.87,0-1.559-0.114-2.069-0.342s-0.898-0.53-1.163-0.905\n                        c-0.264-0.38-0.444-0.823-0.539-1.334c-0.095-0.51-0.142-1.065-0.142-1.674V992.458z M564.113,981.686\n                        c-0.529,0.644-1.333,1.079-2.409,1.305c-1.077,0.228-2.277,0.396-3.6,0.511l-3.628,0.34c-1.059,0.113-2.117,0.273-3.175,0.482\n                        c-1.059,0.208-2.013,0.558-2.863,1.048c-0.85,0.493-1.541,1.163-2.069,2.014c-0.529,0.851-0.793,1.956-0.793,3.315\n                        c0,2.155,0.68,3.753,2.042,4.79c1.359,1.042,3.231,1.561,5.612,1.561c2.456,0,4.402-0.444,5.838-1.332\n                        c1.438-0.888,2.533-1.907,3.289-3.062c0.757-1.152,1.237-2.268,1.446-3.346c0.208-1.075,0.312-1.802,0.312-2.181V981.686z"/>\n                    <path fill="#FFFFFF" d="M597.165,969.101v27.61c0,1.625-0.188,3.202-0.565,4.733c-0.378,1.53-1.027,2.882-1.951,4.055\n                        c-0.925,1.169-2.197,2.105-3.818,2.804c-1.621,0.7-3.677,1.051-6.165,1.051c-1.546,0-2.998-0.163-4.354-0.483\n                        c-1.357-0.32-2.545-0.832-3.564-1.531c-1.018-0.697-1.838-1.623-2.459-2.776c-0.622-1.153-0.971-2.58-1.046-4.28h2.154\n                        c0.113,1.284,0.434,2.383,0.965,3.288c0.528,0.906,1.217,1.653,2.068,2.238c0.851,0.587,1.805,1.013,2.863,1.277\n                        s2.191,0.396,3.401,0.396c2.003,0,3.675-0.301,5.018-0.906c1.34-0.605,2.409-1.39,3.202-2.352\n                        c0.794-0.966,1.352-2.062,1.673-3.289c0.32-1.229,0.481-2.467,0.481-3.713v-6.691h-0.165c-1.02,2.156-2.404,3.799-4.159,4.933\n                        c-1.753,1.134-3.874,1.702-6.362,1.702c-2.15,0-4.008-0.371-5.573-1.106c-1.564-0.738-2.867-1.759-3.903-3.061\n                        c-1.038-1.306-1.811-2.825-2.32-4.563s-0.763-3.63-0.763-5.67c0-1.929,0.273-3.762,0.821-5.501\n                        c0.547-1.736,1.351-3.259,2.409-4.563c1.058-1.304,2.372-2.342,3.94-3.118c1.569-0.772,3.374-1.161,5.414-1.161\n                        c2.305,0,4.431,0.585,6.378,1.756c1.947,1.174,3.336,2.836,4.167,4.99h0.114v-6.066H597.165z M584.409,970.292\n                        c-1.776,0-3.316,0.359-4.62,1.076c-1.304,0.72-2.381,1.664-3.232,2.834c-0.85,1.173-1.493,2.505-1.926,3.999\n                        c-0.436,1.491-0.653,3.014-0.653,4.563c0,1.699,0.217,3.315,0.653,4.848c0.433,1.531,1.095,2.862,1.983,3.996\n                        s1.984,2.032,3.29,2.691c1.303,0.664,2.806,0.992,4.506,0.992c1.776,0,3.325-0.338,4.649-1.02\n                        c1.322-0.682,2.428-1.606,3.317-2.777c0.887-1.172,1.548-2.506,1.984-3.997c0.434-1.492,0.652-3.072,0.652-4.733\n                        c0-1.625-0.218-3.194-0.652-4.705c-0.436-1.513-1.097-2.845-1.984-3.998c-0.889-1.151-1.995-2.07-3.317-2.75\n                        C587.734,970.633,586.186,970.292,584.409,970.292z"/>\n                    <path fill="#FFFFFF" d="M604.364,983.954v0.34c0,1.7,0.227,3.328,0.682,4.876c0.455,1.551,1.126,2.91,2.018,4.081\n                        c0.891,1.174,2.008,2.099,3.354,2.778c1.345,0.682,2.908,1.021,4.689,1.021c2.918,0,5.23-0.765,6.935-2.297\n                        c1.705-1.53,2.882-3.656,3.526-6.378h2.153c-0.643,3.402-2.031,6.01-4.166,7.824c-2.136,1.814-4.961,2.721-8.476,2.721\n                        c-2.155,0-4.036-0.389-5.642-1.162c-1.605-0.773-2.947-1.832-4.024-3.176c-1.077-1.34-1.88-2.929-2.409-4.76\n                        c-0.53-1.833-0.793-3.807-0.793-5.925c0-2.042,0.274-3.999,0.822-5.868c0.548-1.872,1.369-3.515,2.466-4.933\n                        c1.095-1.417,2.466-2.551,4.11-3.401c1.645-0.851,3.581-1.275,5.811-1.275c2.041,0,3.847,0.378,5.415,1.134\n                        c1.568,0.755,2.881,1.786,3.939,3.091c1.058,1.304,1.861,2.814,2.41,4.535c0.548,1.72,0.821,3.562,0.821,5.525\n                        c0,0.191-0.009,0.407-0.026,0.653c-0.022,0.246-0.029,0.445-0.029,0.595H604.364z M625.793,982.084\n                        c-0.075-1.589-0.339-3.091-0.794-4.508c-0.456-1.418-1.128-2.665-2.019-3.74c-0.89-1.079-1.971-1.937-3.239-2.58\n                        c-1.271-0.644-2.72-0.964-4.349-0.964c-1.744,0-3.279,0.329-4.604,0.991c-1.328,0.661-2.446,1.531-3.354,2.608\n                        c-0.91,1.077-1.611,2.334-2.104,3.77c-0.493,1.438-0.795,2.912-0.909,4.423H625.793z"/>\n                    <path fill="#FFFFFF" d="M650.909,957.762v17.575h0.114c0.376-1.096,0.916-2.07,1.614-2.92c0.7-0.851,1.513-1.578,2.438-2.182\n                        c0.925-0.605,1.938-1.059,3.032-1.361c1.098-0.303,2.212-0.453,3.345-0.453c1.703,0,3.147,0.209,4.338,0.623\n                        c1.191,0.416,2.164,0.964,2.921,1.645c0.755,0.68,1.35,1.446,1.786,2.296c0.433,0.852,0.745,1.711,0.935,2.579\n                        c0.187,0.87,0.301,1.712,0.34,2.523c0.038,0.813,0.057,1.521,0.057,2.125v18.03h-2.153v-18.427c0-0.717-0.059-1.624-0.173-2.72\n                        c-0.11-1.097-0.442-2.146-0.989-3.146c-0.549-1.002-1.381-1.861-2.497-2.581c-1.114-0.717-2.654-1.076-4.618-1.076\n                        c-1.663,0-3.139,0.303-4.423,0.905c-1.286,0.606-2.38,1.448-3.289,2.524c-0.905,1.077-1.597,2.362-2.069,3.854\n                        c-0.472,1.494-0.708,3.128-0.708,4.905v15.761h-2.154v-40.48H650.909z"/>\n                    <path fill="#FFFFFF" d="M678.973,983.954v0.34c0,1.7,0.228,3.328,0.683,4.876c0.453,1.551,1.125,2.91,2.018,4.081\n                        c0.89,1.174,2.007,2.099,3.353,2.778c1.346,0.682,2.908,1.021,4.689,1.021c2.918,0,5.23-0.765,6.936-2.297\n                        c1.706-1.53,2.88-3.656,3.525-6.378h2.153c-0.644,3.402-2.031,6.01-4.166,7.824c-2.136,1.814-4.961,2.721-8.477,2.721\n                        c-2.153,0-4.035-0.389-5.641-1.162c-1.606-0.773-2.947-1.832-4.024-3.176c-1.078-1.34-1.881-2.929-2.41-4.76\n                        c-0.528-1.833-0.793-3.807-0.793-5.925c0-2.042,0.273-3.999,0.822-5.868c0.547-1.872,1.368-3.515,2.466-4.933\n                        c1.096-1.417,2.466-2.551,4.109-3.401c1.645-0.851,3.581-1.275,5.812-1.275c2.04,0,3.847,0.378,5.414,1.134\n                        c1.568,0.755,2.882,1.786,3.939,3.091c1.06,1.304,1.861,2.814,2.412,4.535c0.545,1.72,0.82,3.562,0.82,5.525\n                        c0,0.191-0.011,0.407-0.027,0.653c-0.021,0.246-0.029,0.445-0.029,0.595H678.973z M700.402,982.084\n                        c-0.076-1.589-0.34-3.091-0.796-4.508c-0.456-1.418-1.129-2.665-2.017-3.74c-0.892-1.079-1.972-1.937-3.241-2.58\n                        c-1.271-0.644-2.721-0.964-4.349-0.964c-1.744,0-3.278,0.329-4.604,0.991c-1.327,0.661-2.446,1.531-3.355,2.608\n                        s-1.608,2.334-2.103,3.77c-0.493,1.438-0.797,2.912-0.909,4.423H700.402z"/>\n                    <path fill="#FFFFFF" d="M709.756,975.563h0.169c0.265-0.943,0.748-1.833,1.447-2.664c0.7-0.83,1.548-1.549,2.551-2.154\n                        c1.002-0.604,2.115-1.067,3.344-1.389c1.23-0.322,2.506-0.463,3.828-0.425v2.153c-1.133-0.149-2.429-0.037-3.883,0.34\n                        c-1.455,0.379-2.845,1.211-4.168,2.495c-0.528,0.567-0.991,1.114-1.389,1.644c-0.396,0.529-0.728,1.116-0.991,1.758\n                        c-0.265,0.643-0.475,1.36-0.625,2.154c-0.151,0.794-0.245,1.739-0.283,2.835v15.932h-2.154v-29.142h2.154V975.563z"/>\n                    <path fill="#FFFFFF" d="M723.477,983.954v0.34c0,1.7,0.227,3.328,0.683,4.876c0.454,1.551,1.126,2.91,2.018,4.081\n                        c0.89,1.174,2.008,2.099,3.354,2.778c1.344,0.682,2.908,1.021,4.689,1.021c2.918,0,5.23-0.765,6.935-2.297\n                        c1.705-1.53,2.88-3.656,3.526-6.378h2.153c-0.644,3.402-2.032,6.01-4.166,7.824c-2.136,1.814-4.962,2.721-8.478,2.721\n                        c-2.153,0-4.034-0.389-5.64-1.162c-1.606-0.773-2.948-1.832-4.025-3.176c-1.077-1.34-1.881-2.929-2.409-4.76\n                        c-0.53-1.833-0.794-3.807-0.794-5.925c0-2.042,0.273-3.999,0.823-5.868c0.547-1.872,1.368-3.515,2.465-4.933\n                        c1.095-1.417,2.467-2.551,4.11-3.401s3.58-1.275,5.812-1.275c2.04,0,3.847,0.378,5.414,1.134\n                        c1.568,0.755,2.882,1.786,3.939,3.091c1.059,1.304,1.86,2.814,2.409,4.535c0.547,1.72,0.822,3.562,0.822,5.525\n                        c0,0.191-0.01,0.407-0.028,0.653c-0.02,0.246-0.027,0.445-0.027,0.595H723.477z M744.905,982.084\n                        c-0.074-1.589-0.341-3.091-0.794-4.508c-0.456-1.418-1.127-2.665-2.019-3.74c-0.892-1.079-1.97-1.937-3.241-2.58\n                        c-1.27-0.644-2.719-0.964-4.348-0.964c-1.743,0-3.277,0.329-4.604,0.991c-1.326,0.661-2.444,1.531-3.353,2.608\n                        c-0.912,1.077-1.61,2.334-2.104,3.77c-0.494,1.438-0.798,2.912-0.91,4.423H744.905z"/>\n                </g>\n            </g>\n        </g>\n    </svg>\n</g>\n';
},useData:!0})},{"hbsfy/runtime":535}],232:[function(e,t,n){var i=e("../../../customize/contents/pattern/patterns");t.exports=i.extend({callbackName:"callbackAdminBackgrounds"})},{"../../../customize/contents/pattern/patterns":333}],233:[function(e,t,n){var i=e("./backgrounds"),a=e("../../../components/accordion-list/categories-director"),o=e("../../../components/mixins/create");t.exports=Backbone.mixin(a.extend({"class":"sub-category backgrounds",CategoriesView:i,views:{},addNewEvent:function(e,t){this.modalData=new INKIVE.ModalAdminBackground({data:t}),this.modal=INKIVE.Modal.modalWindow(this.modalData.getFormHtml(),{width:850,headerIcon:"icon-news",headerTitle:"modal.title.new_background",buttons:[{title:INKIVE.TranslateHelper.translate("modal.buttons.create_background"),onClick:_.bind(this.createTemplate,this)}]})},loadButtons:function(){var e=$.Deferred();return INKIVE.Tool.preloadBackgroundCategories(function(){var t=INKIVE.Tool._cache.backgroundCategories;e.resolve(_.map(t,function(e){return{key:e.id,tag:e.name,icon:"fa fa-ellipsis-v"}}))}),e.promise()},initialize:function(){this.createButtonMargin=31,this.modalData=new INKIVE.ModalAdminBackground,this.mode="template",this.addButtonText="tool.admin.new_background",this.createCallback=$.noop,a.prototype.initialize.call(this),this.render()},_render:function(){a.prototype._render.apply(this,arguments),this.$el.find(".wrapper").css("top",this.createButtonMargin+"px")},toggleAcordionElement:function(e,t){var n=e.closest("dt"),i=n.closest(".wrapper"),o=this.createButtonMargin-n.position().top;a.prototype.toggleAcordionElement.apply(this,arguments),i.css("top",t?o+"px":this.createButtonMargin+"px")}}),o)},{"../../../components/accordion-list/categories-director":250,"../../../components/mixins/create":266,"./backgrounds":232}],234:[function(e,t,n){var i=e("../sticker/stickersall");t.exports=i.extend({where:{isText:!0},idPrefix:"banner"})},{"../sticker/stickersall":242}],235:[function(e,t,n){var i=e("../../../components/accordion-list/categories-director"),a=e("./stickers"),o=e("../../../components/mixins/create");t.exports=Backbone.mixin(i.extend({CategoriesView:a,views:{},initialize:function(){this.createButtonMargin=31,this.tool=INKIVE.Tool.getInstance(),this.modalData=new INKIVE.ModalAdminSticker({isText:!0}),this.mode="banner",this.addButtonText="tool.admin.new_banner",this.createCallback=$.noop,i.prototype.initialize.call(this),this.render()},_render:function(){i.prototype._render.apply(this,arguments),this.$el.find(".wrapper").css("top",this.createButtonMargin+"px")},addNewEvent:function(e,t){this.modalData=new INKIVE.ModalAdminSticker({isText:!0,data:t}),this.modal=INKIVE.Modal.modalWindow(this.modalData.getFormHtml(),{width:600,headerIcon:"icon-news",headerTitle:"modal.title.new_banner",buttons:[{title:INKIVE.TranslateHelper.translate("modal.buttons.create_banner"),onClick:_.bind(this.createTemplate,this)}]})},toggleAcordionElement:function(e,t){var n=e.closest("dt"),a=n.closest(".wrapper"),o=this.createButtonMargin-n.position().top;i.prototype.toggleAcordionElement.apply(this,arguments),a.css("top",t?o+"px":this.createButtonMargin+"px")},extractData:function(e){return[]}}),o)},{"../../../components/accordion-list/categories-director":250,"../../../components/mixins/create":266,"./stickers":234}],236:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({1:function(e,t,n,i,a,o,r){var s,l,c,d="            ";return l=null!=(l=n.data||(null!=t?t.data:t))?l:n.helperMissing,c={name:"data",hash:{},fn:e.program(2,a,0,o,r),inverse:e.noop,data:a},s="function"==typeof l?l.call(null!=t?t:e.nullContext||{},c):l,n.data||(s=n.blockHelperMissing.call(t,s,c)),null!=s&&(d+=s),d+"\n"},2:function(e,t,n,i,a,o,r){var s,l=null!=t?t:e.nullContext||{},c=n.helperMissing,d="function",u=e.escapeExpression;return'<option value="'+u((s=null!=(s=n.id||(null!=t?t.id:t))?s:c,typeof s===d?s.call(l,{name:"id",hash:{},data:a}):s))+'">'+u(e.lambda(null!=r[1]?r[1].name:r[1],t))+": "+u((s=null!=(s=n.name||(null!=t?t.name:t))?s:c,typeof s===d?s.call(l,{name:"name",hash:{},data:a}):s))+"</option>"},compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a,o,r){var s,l,c,d=null!=t?t:e.nullContext||{},u=n.helperMissing,p="function",h=n.blockHelperMissing,m='<div class="antiscroll-wrap">\n  <div class="antiscroll-inner">\n    <div class="load-process">\n      <div class="select-wrapper">\n        <select class="from-format">\n          <option value="" disabled selected>From format...</option>\n';return l=null!=(l=n.groups||(null!=t?t.groups:t))?l:u,c={name:"groups",hash:{},fn:e.program(1,a,0,o,r),inverse:e.noop,data:a},s=typeof l===p?l.call(d,c):l,n.groups||(s=h.call(t,s,c)),null!=s&&(m+=s),m+='        </select>\n      </div>\n\n      <div class="select-wrapper">\n        <select class="to-format">\n          <option value="" disabled selected>To format...</option>\n',l=null!=(l=n.groups||(null!=t?t.groups:t))?l:u,c={name:"groups",hash:{},fn:e.program(1,a,0,o,r),inverse:e.noop,data:a},s=typeof l===p?l.call(d,c):l,n.groups||(s=h.call(t,s,c)),null!=s&&(m+=s),m+'        </select>\n      </div>\n      <button class="load btn btn-primary">Load</button>\n    </div>\n\n    <button class="generate btn btn-primary hidden">Generate missing</button>\n    <div class="progress hidden"><p class="message"></p></div>\n\n    <ul class="thumbnail-wrapper"></ul>\n  </div>\n</div>\n'},useData:!0,useDepths:!0})},{"hbsfy/runtime":535}],237:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({1:function(e,t,n,i,a){return"ok"},3:function(e,t,n,i,a){var o;return e.escapeExpression((o=null!=(o=n.url||(null!=t?t.url:t))?o:n.helperMissing,"function"==typeof o?o.call(null!=t?t:e.nullContext||{},{name:"url",hash:{},data:a}):o))},compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){var o,r,s,l=null!=t?t:e.nullContext||{},c=n.helperMissing,d="function",u=e.escapeExpression,p=n.blockHelperMissing,h='<div class="container" style="height: '+u((r=null!=(r=n.thumb_height||(null!=t?t.thumb_height:t))?r:c,typeof r===d?r.call(l,{name:"thumb_height",hash:{},data:a}):r))+'px">\n  <div class="wrapper from-format" style="transform: skewX(-'+u((r=null!=(r=n.angle||(null!=t?t.angle:t))?r:c,typeof r===d?r.call(l,{name:"angle",hash:{},data:a}):r))+'deg);">\n    <img src="'+u((r=null!=(r=n.url||(null!=t?t.url:t))?r:c,typeof r===d?r.call(l,{name:"url",hash:{},data:a}):r))+'" style="transform: skewX('+u((r=null!=(r=n.angle||(null!=t?t.angle:t))?r:c,typeof r===d?r.call(l,{name:"angle",hash:{},data:a}):r))+'deg);">\n  </div>\n\n  <div class="wrapper to-format ';return r=null!=(r=n.has_perfect_match||(null!=t?t.has_perfect_match:t))?r:c,s={name:"has_perfect_match",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a},o=typeof r===d?r.call(l,s):r,n.has_perfect_match||(o=p.call(t,o,s)),null!=o&&(h+=o),h+='" style="transform: skewX(-'+u((r=null!=(r=n.angle||(null!=t?t.angle:t))?r:c,typeof r===d?r.call(l,{name:"angle",hash:{},data:a}):r))+'deg);" >\n    <img src="',r=null!=(r=n.match||(null!=t?t.match:t))?r:c,s={name:"match",hash:{},fn:e.program(3,a,0),inverse:e.noop,data:a},o=typeof r===d?r.call(l,s):r,n.match||(o=p.call(t,o,s)),null!=o&&(h+=o),h+'" style="transform: skewX('+u((r=null!=(r=n.angle||(null!=t?t.angle:t))?r:c,typeof r===d?r.call(l,{name:"angle",hash:{},data:a}):r))+'deg);">\n  </div>\n</div>\n'},useData:!0})},{"hbsfy/runtime":535}],238:[function(e,t,n){var i=e("./template.hbs"),a=e("./thumbnail.hbs"),o=e("../../../components/mixins/scrollable"),r=e("../../../../../factory/formats"),s=e("../../../../../facade/design/design"),l=e("../../../../editor-mode-manager");t.exports=Backbone.mixin(Backbone.View.extend({mismatchPerfect:20,mismatchSame:50,events:{"click button.load":"loadEvent","click button.generate":"generateEvent","click li.thumbnail":"migrateEvent"},loadEvent:function(){var e=this.$el.find("select.from-format").val(),t=this.$el.find("select.to-format").val();this.$el.find(".load-process").addClass("hidden"),this.$el.find(".progress").removeClass("hidden"),INKIVE.Modal.loader(this.$el.find(".progress")),$.when(this.loadAllTemplatesByFormat(e,1),this.loadAllTemplatesByFormat(t,0)).then(this.preloadThumbnails).then(this.compare).then(this.renderThumbnails).then(_.bind(function(){INKIVE.Modal.loaderClose(this.$el.find(".progress")),this.$el.find("button.generate").removeClass("hidden"),this.$el.find(".progress").addClass("hidden")},this)),$.when(r.getFormat(e),r.getFormat(t)).then(_.bind(function(e,t){this.fromFormat=e,this.toFormat=t},this))},generateEvent:function(){function e(){if(INKIVE.Modal.togglePageLoader(!1),t.length){try{this.generateMatch(t.pop()).then(e)}catch(i){e()}INKIVE.Modal.togglePageLoader(!0,"Generating matching template "+(n-t.length)+" of "+n)}}var e=_.bind(e,this),t=_.filter(this.templates,function(e){return!e.match}),n=t.length;e()},migrateEvent:function(e){var t=$(e.currentTarget),n=_.findWhere(this.templates,{id:t.data("templateid")});if(n.match||this.generateMatch(n),n.match)var i=INKIVE.Modal.modalWindow("Edit copy or create a new one?",{headerIcon:"icon-info",headerTitle:"Migrate template",buttons:[{title:"Edit current",onClick:_.bind(function(){this.editMatch(n.match),i.close()},this)},{title:"Create new",onClick:_.bind(function(){this.generateMatch(n),i.close()},this)}]})},editMatch:function(e){INKIVE.Helpers.api("search/layout","GET",{id:e.id},_.bind(function(e){l.setMode("template",e)},this))},generateMatch:function(e){function t(){var t=$.Deferred();return INKIVE.Helpers.api("search/layout","GET",{id:e.id},function(e){t.resolve(e)}),t.promise()}function n(e){var t=$.Deferred(),n=INKIVE.Helpers.convertUnitsToPixels,i={name:e.name,orientation:e.orientation,text:e.text,isBackground:e.background?1:0,set:e.set,num:e.num,active:0,format_id:this.toFormat.id,format_width:n(this.toFormat.width,this.toFormat.unit),format_height:n(this.toFormat.height,this.toFormat.unit),tag:e.tag};return INKIVE.Helpers.api("management/layoutinfo","POST",{info:i},function(e){e&&"success"==e.status?t.resolve(_.extend(i,{id:e.id})):t.reject()}),t.promise()}function i(t){var n=$.Deferred();return l.setMode("template",t),s.once("template.update.designed",function(){n.resolve(t)}),s.set("template",{keep_stage_size:!0,designed:{id:e.id}}),n.promise()}function a(t){var n=$.Deferred();return this.tool.save(null,function(){n.resolve(e,t.id)}),n.promise()}return t.call(this).then(_.bind(n,this)).then(_.bind(i,this)).then(_.bind(a,this)).then(this.updateThumbnail)},updateThumbnail:function(e,t){var n=$.Deferred(),i=this.mismatchPerfect,a=_.find(this.$el.find("ul.thumbnail-wrapper li.thumbnail"),function(t){return $(t).data("templateid")==e.id});return INKIVE.Helpers.api("search/layout","GET",{id:t},function(t){$(a).find(".to-format img").attr("src",t.url),e.match=t,resemble(e.url).compareTo(t.url.replace(/\/\/static\./,"//oregon.")).onComplete(function(e){var t=parseFloat(e.misMatchPercentage)<i;$(a).find(".to-format").toggleClass("ok",t),n.resolve()})}),n.promise()},loadAllTemplatesByFormat:function(e,t){function n(){var s={from:i,limit:a,where:{format:e,active:t}};i+=a,this.$el.find(".progress p").text("Loading format "+e+", page "+Math.round(i/a)),INKIVE.Helpers.api("search/layouts","GET",s,_.bind(function(e){e&&e.data&&e.data.length?(o=_.union(o,e.data),n.call(this)):r.resolve(o)},this))}var i=0,a=10,o=[],r=$.Deferred();return n.call(this),r.promise()},preloadThumbnails:function(e,t){function n(){var s=o.length>3?3:o.length,l=_.after(s,_.bind(n,this)),c=Math.round((r-o.length)/r*100);for(this.$el.find(".progress p").text("Loading thumbnails "+c+"%"),o.length||i.resolve(e,t,a);s-- >0&&o.length;){var d=o.pop();if(d.url){var u=new Image;u.setAttribute("crossOrigin","anonymous"),u.src=INKIVE.Helpers.getCORSSecureUrl(d.url),u.onerror=l,u.onload=function(){_.defer(l);var e=document.createElement("canvas");e.width=this.naturalWidth,e.height=this.naturalHeight,e.getContext("2d").drawImage(this,0,0),this.rawData=e.toDataURL("image/png")},a[d.id]=u}else l()}}var i=$.Deferred(),a={},o=_.union(e,t),r=o.length;return n.call(this),i.promise()},compare:function(e,t,n){function i(e){return n[e.id]}function a(){function p(){var n=[],i=[];_.each(_.sortBy(c,"misMatch"),function(a){var o=!_.contains(n,a.toId)&&!_.contains(i,a.fromId);if(o){var r=_.find(e,{id:a.fromId});r.match=_.find(t,{id:a.toId}),r.hasPerfectMatch=a.misMatch<u,n.push(a.toId),i.push(a.fromId)}}),s.resolve()}if(!o.length)return this.templates=_.filter(e,i),void p();var h=o.pop().id,m=_.after(r.length,_.bind(a,this)),f=Math.round((l-o.length)/l*100);this.$el.find(".progress p").text("Matching templates "+f+"%"),r.length||a.call(this),_.each(r,function(e){var t=e.id,i=n[h].rawData,a=n[t].rawData;return i&&a?void resemble(i).compareTo(a).onComplete(function(e){var n=parseFloat(e.misMatchPercentage);n<d&&c.push({fromId:h,toId:t,misMatch:n}),_.defer(m)}):void _.defer(m)})}var o=_.filter(e,i),r=_.filter(t,i),s=$.Deferred(),a=_.bind(a,this),l=o.length,c=[],d=this.mismatchSame,u=this.mismatchPerfect;return a(),s.promise()},renderThumbnails:function(){_.each(this.templates,function(e){e.url&&this.$el.find("ul.thumbnail-wrapper").append($('<li class="thumbnail"></li>').html(this.getThumbnailHTML(e)).data("templateid",e.id))},this),this.initScroll()},getThumbnailHTML:function(e){function t(e){return{url:e.url,has_perfect_match:e.hasPerfectMatch,thumb_height:255*(e.format_height/e.format_width)}}var n=(Math.PI/2-Math.atan(this.fromFormat.height/this.fromFormat.width))/(Math.PI/180),i=_.extend(t(e),{angle:n});return e.match&&(i.match=t(e.match)),a(i)},initialize:function(){_.bindAll(this,"render","compare","updateThumbnail","renderThumbnails","preloadThumbnails","loadAllTemplatesByFormat"),r.getGroups().then(this.render),this.tool=INKIVE.Tool.getInstance()},render:function(e){this.$el.html(i({groups:e}))}}),o)},{"../../../../../facade/design/design":34,"../../../../../factory/formats":101,"../../../../editor-mode-manager":162,"../../../components/mixins/scrollable":269,"./template.hbs":236,"./thumbnail.hbs":237}],239:[function(e,t,n){var i=e("../sticker/stickersall");t.exports=i.extend({where:{isPlaceholder:!0},idPrefix:"placeholder"})},{"../sticker/stickersall":242}],240:[function(e,t,n){var i=e("../../../components/accordion-list/categories-director"),a=e("./stickers"),o=e("../../../components/mixins/create");t.exports=Backbone.mixin(i.extend({"class":"sub-category stickers",CategoriesView:a,views:{},initialize:function(){this.createButtonMargin=31,this.tool=INKIVE.Tool.getInstance(),this.modalData=new INKIVE.ModalAdminSticker({isPlaceholder:!0}),this.mode="sticker",this.addButtonText="tool.admin.new_placeholder",this.createCallback=$.noop,i.prototype.initialize.call(this),this.render()},_render:function(){i.prototype._render.apply(this,arguments),this.$el.find(".wrapper").css("top",this.createButtonMargin+"px")},addNewEvent:function(e,t){this.modalData=new INKIVE.ModalAdminSticker({isPlaceholder:!0,data:t}),this.modal=INKIVE.Modal.modalWindow(this.modalData.getFormHtml(),{width:600,headerIcon:"icon-news",headerTitle:"modal.title.new_placeholder",buttons:[{title:INKIVE.TranslateHelper.translate("modal.buttons.create_placeholder"),onClick:_.bind(this.createTemplate,this)}]})},toggleAcordionElement:function(e,t){var n=e.closest("dt"),a=n.closest(".wrapper"),o=this.createButtonMargin-n.position().top;i.prototype.toggleAcordionElement.apply(this,arguments),a.css("top",t?o+"px":this.createButtonMargin+"px")},extractData:function(e){return[]}}),o)},{"../../../components/accordion-list/categories-director":250,"../../../components/mixins/create":266,"./stickers":239}],241:[function(e,t,n){var i=e("../../../customize/contents/sticker/stickers");t.exports=i.extend({callbackName:"callbackAdminStickers",getParams:function(){var e={from:this.from,limit:this.limit,where:{category:this.category.name,active:INKIVE.C.USER.IS_SUPER?0:1}};return this.from+=this.limit,e}})},{"../../../customize/contents/sticker/stickers":334}],242:[function(e,t,n){var i=e("../../../components/accordion-list/content"),a=e("../../../../../analytics/decorate");t.exports=a(e("../../../customize/analytics/stickers"),i.extend({apiCall:"search/stickers",dataName:"stickerCategories",callbackName:"callbackAdminStickers",where:{},idPrefix:"",initialize:function(e){this.category={id:0,name:"All"},i.prototype.initialize.call(this,e)},getScrollHeight:function(e){return e.closest(".tool-content").height()},getParams:function(){var e={from:this.from,limit:this.limit,where:$.extend(this.where,{active:INKIVE.C.USER.IS_SUPER?0:1})};return this.from+=this.limit,e},extractData:function(e){var t=this;return _.map(e,function(e){var n=t.idPrefix?t.idPrefix+"-":"";return n+="sticker-"+e.id,{id:n,src:e.url,width:e.width,height:e.height,cls:parseInt(e.active)?"":" grayscale",isNocover:!0,data:{name:e.name,count:e.count,changeable:e.changeable,width:e.width,height:e.height}}})}}))},{"../../../../../analytics/decorate":5,"../../../components/accordion-list/content":252,"../../../customize/analytics/stickers":331}],243:[function(e,t,n){var i=e("./stickers"),a=e("../../../customize/contents/sticker/view"),o=e("../../../components/mixins/create");t.exports=Backbone.mixin(a.extend({CategoriesView:i,views:{},initialize:function(){this.createButtonMargin=31,this.tool=INKIVE.Tool.getInstance(),this.modalData=new INKIVE.ModalAdminSticker,this.mode="sticker",this.addButtonText="tool.admin.new_sticker",this.createCallback=$.noop,a.prototype.initialize.call(this),this.render()},_render:function(){a.prototype._render.apply(this,arguments),this.$el.find(".wrapper").css("top",this.createButtonMargin+"px")},addNewEvent:function(e,t){this.modalData=new INKIVE.ModalAdminSticker({data:t}),this.modal=INKIVE.Modal.modalWindow(this.modalData.getFormHtml(),{width:600,headerIcon:"icon-news",headerTitle:"modal.title.new_sticker",buttons:[{title:INKIVE.TranslateHelper.translate("modal.buttons.create_sticker"),onClick:_.bind(this.createTemplate,this)}]})},toggleAcordionElement:function(e,t){var n=e.closest("dt"),i=n.closest(".wrapper"),o=this.createButtonMargin-n.position().top;a.prototype.toggleAcordionElement.apply(this,arguments),i.css("top",t?o+"px":this.createButtonMargin+"px")},extractData:function(e){return[]}}),o)},{"../../../components/mixins/create":266,"../../../customize/contents/sticker/view":335,"./stickers":241}],244:[function(e,t,n){var i=e("../../../templates/sub-categories");t.exports=i.extend({TemplatesView:e("./templates")})},{"../../../templates/sub-categories":443,"./templates":245}],245:[function(e,t,n){var i=e("../../../templates/templates-base"),a=e("../../../components/accordion-list/content");t.exports=i.extend({callbackName:"callbackAdminLayouts",appendThumbnails:a.prototype.appendThumbnails,render:function(){i.prototype.render.apply(this,arguments),this.$el.find("ul.thumbnail-wrapper").toggleClass("thumbnail-wrapper thumbnail-wrapper").css("padding-left","5px")},extractData:function(e){var t=255;return _.compact(_.map(e,function(e){var n=parseInt(e.format_width),i=parseInt(e.format_height),a=i/n*t;if(e.id)return{id:"layout-"+e.id,src:e.url,width:t,height:a,isNocover:INKIVE.C.USER.IS_SUPER,cls:parseInt(e.active)?"":"grayscale",data:{count:e.count,set:e.set,num:e.num,orientation:e.orientation,text:e.text,active:e.active}}}))}})},{"../../../components/accordion-list/content":252,"../../../templates/templates-base":444}],246:[function(e,t,n){var i=e("./sub-categories"),a=e("../../../templates/view-base"),o=e("../../../components/mixins/create");t.exports=Backbone.mixin(a.extend({CategoriesView:i,views:{},addNewEvent:function(e,t){this.modalData=new INKIVE.ModalAdminLayout({data:t}),this.modal=INKIVE.Modal.modalWindow(this.modalData.getFormHtml(),{width:500,headerIcon:"icon-news",headerTitle:"modal.title.new_template",buttons:[{title:INKIVE.TranslateHelper.translate("modal.buttons.create_template"),onClick:_.bind(this.createTemplate,this)}]})},listContentToggleEvent:function(e){a.prototype.listContentToggleEvent.apply(this,arguments),e.stopPropagation()},initialize:function(){this.createButtonMargin=31,this.modalData=new INKIVE.ModalAdminLayout,this.mode="template",this.addButtonText="tool.admin.new_template",this.createCallback=$.noop,a.prototype.initialize.call(this),this.render(),this.$el.find(".wrapper").css("top",this.createButtonMargin+"px")},toggleAcordionElement:function(e,t){var n=e.closest("dt"),i=n.closest(".wrapper"),o=this.createButtonMargin-n.position().top;a.prototype.toggleAcordionElement.apply(this,arguments),i.css("top",t?o+"px":this.createButtonMargin+"px")},extractData:function(e){return[]}}),o)},{"../../../components/mixins/create":266,"../../../templates/view-base":447,"./sub-categories":244}],247:[function(e,t,n){var i=e("../components/accordion-list/director");t.exports=i.extend({"class":"admin",views:{},Views:{templates:e("./contents/template/view"),backgrounds:e("./contents/background/view"),stickers:e("./contents/sticker/view"),banners:e("./contents/banners/view"),placeholders:e("./contents/placeholders/view"),migrate:e("./contents/migrate/view")},buttons:[{key:"templates",tag:"editor.templates",icon:"icon-news"},{key:"backgrounds",tag:"editor.backgrounds",icon:"icon-backgrounds"},{key:"stickers",tag:"editor.stickers",icon:"icon-hipster"},{key:"banners",tag:"editor.text_banners",icon:"icon-font_download"},{key:"placeholders",tag:"common.image_placeholders",icon:"icon-image"},{key:"migrate",tag:"tool.admin.migrate",icon:"icon-forward"}],render:function(){var e=this.template({"class":this["class"],buttons:this.buttons});this.$el.html(e)}})},{"../components/accordion-list/director":254,"./contents/background/view":233,"./contents/banners/view":235,"./contents/migrate/view":238,"./contents/placeholders/view":240,"./contents/sticker/view":243,"./contents/template/view":246}],248:[function(e,t,n){t.exports={initializeUploadCheckOnce:function(){return window.Android},initializeUpload:function(){function e(){this.showListContent(o),o.parent().addClass("active")}var t=this.loadListContent(this.uploadViewKey),n="ik.editor.photoupload",i=this.$el.find('dt a[data-key="add"]'),a=_.debounce(_.bind(e,this),600),o=this.$el.find('dt a[data-key="'+this.uploadViewKey+'"]');this.appBridge.on(n,function(e,n){var i=n.photoId;a(),t.views[i]=t.getNewThumbnail(),t.views[i].toggleProgressBar(!0),t.views[i].updateProgressBar(1),t.complete(i,n)}),i.on("click",_.bind(function(e){var t="o";this.appBridge.callAndroid("photo_upload",{size_name:t})},this))}}},{}],249:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({1:function(e,t,n,i,a){return'      <div class="tool-static-block" style="z-index: 3; position: relative; margin: 0 20px; background: #2B3031;">\n        <a class="btn btn-black btn-new-item">'+e.escapeExpression((n.t||t&&t.t||n.helperMissing).call(null!=t?t:e.nullContext||{},t,{name:"t",hash:{},data:a}))+"</a>\n      </div>\n"},3:function(e,t,n,i,a){var o,r,s,l=null!=t?t:e.nullContext||{},c=n.helperMissing,d="function",u=e.escapeExpression,p=n.blockHelperMissing,h='        <dt>\n          <a class="btn btn-accordion" data-key="'+u((r=null!=(r=n.key||(null!=t?t.key:t))?r:c,typeof r===d?r.call(l,{name:"key",hash:{},data:a}):r))+'" data-type="'+u((r=null!=(r=n.type||(null!=t?t.type:t))?r:c,typeof r===d?r.call(l,{name:"type",hash:{},data:a}):r))+'">\n            ';return r=null!=(r=n.icon||(null!=t?t.icon:t))?r:c,s={name:"icon",hash:{},fn:e.program(4,a,0),inverse:e.noop,data:a},o=typeof r===d?r.call(l,s):r,n.icon||(o=p.call(t,o,s)),null!=o&&(h+=o),h+="\n            ",r=null!=(r=n.image||(null!=t?t.image:t))?r:c,s={name:"image",hash:{},fn:e.program(6,a,0),inverse:e.noop,data:a},o=typeof r===d?r.call(l,s):r,n.image||(o=p.call(t,o,s)),null!=o&&(h+=o),h+'\n            <i class="collapse fa fa-chevron-up hidden"></i>\n            <i class="back fa fa-chevron-left hidden"></i>\n            <span class="name">'+u((n.t||t&&t.t||c).call(l,null!=t?t.tag:t,{name:"t",hash:{},data:a}))+"</span>\n          </a>\n        </dt>\n"},4:function(e,t,n,i,a){return'<i class="'+e.escapeExpression(e.lambda(t,t))+' main"></i>'},6:function(e,t,n,i,a){var o=e.escapeExpression;return'<img class="'+o(e.lambda(t,t))+' main" src="'+o((n.route||t&&t.route||n.helperMissing).call(null!=t?t:e.nullContext||{},t,{name:"route",hash:{},data:a}))+'"/>'},compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){var o,r,s,l=null!=t?t:e.nullContext||{},c=n.helperMissing,d="function",u='<div class="antiscroll-wrap">\n  <div class="antiscroll-inner">\n    <div class="tab-content '+e.escapeExpression((r=null!=(r=n["class"]||(null!=t?t["class"]:t))?r:c,typeof r===d?r.call(l,{name:"class",hash:{},data:a}):r))+' accordion active">\n';return r=null!=(r=n.add_button||(null!=t?t.add_button:t))?r:c,s={name:"add_button",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a},o=typeof r===d?r.call(l,s):r,n.add_button||(o=n.blockHelperMissing.call(t,o,s)),null!=o&&(u+=o),u+'      <div class="wrapper">\n'+(null!=(o=n.each.call(l,null!=t?t.buttons:t,{name:"each",hash:{},fn:e.program(3,a,0),inverse:e.noop,data:a}))?o:"")+"      </div>\n    </div>\n  </div>\n</div>\n"},useData:!0})},{"hbsfy/runtime":535}],250:[function(e,t,n){var i=e("./director"),a=e("../mixins/scrollable");t.exports=Backbone.mixin(i.extend({views:{},template:e("./categories-director.hbs"),CategoriesView:null,loadListContent:function(e){function t(){var e=$("<div></div>").addClass("image-list");return i.length?e.insertAfter(i):n.find(".wrapper").append(e),e}var n=this.$el,i=n.find('dt a[data-key="'+e+'"]');return this.views[e]=new this.CategoriesView({el:t(),key:e}),this.views[e].on("open_new_view",_.partial(this.openSubView,i)),this.views[e]},listContentToggleEvent:function(e){i.prototype.listContentToggleEvent.apply(this,arguments),e.stopPropagation()},initialize:function(){_.bindAll(this,"_render","initScroll"),this.scrollRefresh=_.debounce(this.initScroll,2e3),i.prototype.initialize.apply(this,arguments)},toggleAcordionElement:function(e,t){this.$el.find(".antiscroll-wrap:first > .antiscroll-inner").scrollTop(0),this.toggleScroll(t),i.prototype.toggleAcordionElement.apply(this,arguments)},openSubView:function(e,t){if(e.children(".collapse").addClass("hidden"),e.children(".back").removeClass("hidden"),!INKIVE.C.IS_MOBILE){var n=this.getCategoryName(t),i=$('<span class="category">').text(": "+n);e.children(".category").remove(),e.append(i)}},closeView:function(){var e=this.$el.find(".wrapper dt.active").length;return e&&this.closeAccordion(),!e},closeSubView:function(e){var t=e.data("key"),n=!this.views[t].closeView||this.views[t].closeView();n&&(e.children(".category").remove(),e.children(".collapse").removeClass("hidden"),e.children(".back").addClass("hidden"))},getCategoryName:function(e){return""},refreshView:function(){this.scrollRefresh()},render:function(){INKIVE.Modal.loader(this.$el),this.loadButtons().then(this._render)},_render:function(e){INKIVE.Modal.loaderClose(this.$el),this.$el.html(this.template({"class":this["class"],buttons:e,add_button:this.addButtonText})),this.scrollRefresh(),e.length||(this.loadListContent(0),this.$el.find(".image-list").css({top:10,height:this.$el.closest('[role="tabpanel"]').height()}))},getScrollHeight:function(){return this.$el.closest(".image-list").height()},loadButtons:function(){var e=$.Deferred();return e.resolve([]),e.promise()}}),a)},{"../mixins/scrollable":269,"./categories-director.hbs":249,"./director":254}],251:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){return'<div class="antiscroll-wrap">\n  <div class="antiscroll-inner"></div>\n</div>\n'},useData:!0})},{"hbsfy/runtime":535}],252:[function(e,t,n){var i=e("../mixins/scrollable"),a=e("../../../../factory/images");t.exports=Backbone.mixin(Backbone.mixin(Backbone.View.extend({from:0,limit:10,apiCall:"",callbackName:"callbackImages",template:e("./content.hbs"),initialize:function(){_.bindAll(this,"masonryReload","render","loadData","onMoreData","closeView"),this.views={},this.tool=INKIVE.Tool.getInstance(),this.editor=this.tool.editor,this.canvas=this.editor.canvas,this.imagesFactory=a,this.scrollRefresh=_.debounce(_.bind(this.initScroll,this),2e3),this.render(),INKIVE.Modal.loader(this.$el.find(".antiscroll-inner")),_.delay(_.bind(function(){this.initScroll(),this.initDataLoading()},this),1e3)},initDataLoading:function(){var e=this.$el.find(".thumbnail-wrapper");this.end&&this.end(),this.tool.initScrollDetect(e,this.loadData)},loadData:function(e,t){this.end=t,this.repeat=e,INKIVE.Modal.loader(this.$el.find(".antiscroll-inner")),INKIVE.Helpers.api(this.apiCall,"GET",this.getParams(),this.onMoreData)},onMoreData:function(e){var t=e&&e.data&&e.data.length>0;INKIVE.Modal.loaderClose(this.$el.find(".antiscroll-inner")),t?(this.appendThumbnails(e.data),this.repeat()):this.end(),this.scrollRefresh()},appendThumbnails:function(e){var t=_.bind(this.tool[this.callbackName],this.tool);this.tool.addThumbItem(this.$el,this.extractData(e),t),this.masonryReload()},render:function(){this.$el.html(this.template()),this.$el.find(".antiscroll-inner").addThumb()},remove:function(){this.undelegateEvents(),this.$el.removeData().unbind(),Backbone.View.prototype.remove.call(this)},getParams:function(){return{}},extractData:function(e){return e},openNewView:function(e,t,n){var i=$("<div></div>").addClass("image-list out right");i.insertAfter(this.$el),this.$el.addClass("out left"),this.views[e]=new t(_.extend({el:i},n)),this.trigger("open_new_view",n),_.defer(function(){i.removeClass("out right")})},closeView:function(){return this.$el.removeClass("out left"),_.each(this.views,function(e,t){"uploadThumbnail"!==t&&(e.$el.addClass("out right"),_.delay(function(){e.remove()},1e3))}),this.views={},!0},getScrollHeight:function(e){var t=e.closest(".tool-content").height(),n=e.siblings(".btn.btn-accordion").height();return t-n},masonryReload:function(){this.$el.find(".thumbnail-wrapper").masonry({gutter:10}),this.initScroll(),this.scrollRefresh()}}),Backbone.Events),i)},{"../../../../factory/images":102,"../mixins/scrollable":269,"./content.hbs":251}],253:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({1:function(e,t,n,i,a){return'  <div class="tool-static-block" style="z-index: 3; position: relative; margin: 0 10px; background: #2B3031;">\n    <a class="btn btn-black btn-new-item">'+e.escapeExpression((n.t||t&&t.t||n.helperMissing).call(null!=t?t:e.nullContext||{},t,{name:"t",hash:{},data:a}))+"</a>\n  </div>\n"},3:function(e,t,n,i,a){var o,r,s,l=null!=t?t:e.nullContext||{},c=n.helperMissing,d="function",u=e.escapeExpression,p=n.blockHelperMissing,h='    <dt>\n      <a class="btn btn-accordion" data-key="'+u((r=null!=(r=n.key||(null!=t?t.key:t))?r:c,typeof r===d?r.call(l,{name:"key",hash:{},data:a}):r))+'" data-type="'+u((r=null!=(r=n.type||(null!=t?t.type:t))?r:c,typeof r===d?r.call(l,{name:"type",hash:{},data:a}):r))+'">\n        ';return r=null!=(r=n.icon||(null!=t?t.icon:t))?r:c,s={name:"icon",hash:{},fn:e.program(4,a,0),inverse:e.noop,data:a},o=typeof r===d?r.call(l,s):r,n.icon||(o=p.call(t,o,s)),null!=o&&(h+=o),h+="\n        ",r=null!=(r=n.image||(null!=t?t.image:t))?r:c,s={name:"image",hash:{},fn:e.program(6,a,0),inverse:e.noop,data:a},o=typeof r===d?r.call(l,s):r,n.image||(o=p.call(t,o,s)),null!=o&&(h+=o),h+'\n        <i class="collapse fa fa-chevron-up hidden"></i>\n        <i class="back fa fa-chevron-left hidden"></i>\n        <span class="name">'+u((n.t||t&&t.t||c).call(l,null!=t?t.tag:t,{name:"t",hash:{},data:a}))+"</span>\n      </a>\n    </dt>\n"},4:function(e,t,n,i,a){return'<i class="'+e.escapeExpression(e.lambda(t,t))+' main"></i>'},6:function(e,t,n,i,a){var o=e.escapeExpression;return'<img class="'+o(e.lambda(t,t))+' main" src="'+o((n.route||t&&t.route||n.helperMissing).call(null!=t?t:e.nullContext||{},t,{name:"route",hash:{},data:a}))+'"/>'},compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){var o,r,s,l=null!=t?t:e.nullContext||{},c=n.helperMissing,d="function",u='<div class="tab-content '+e.escapeExpression((r=null!=(r=n["class"]||(null!=t?t["class"]:t))?r:c,
typeof r===d?r.call(l,{name:"class",hash:{},data:a}):r))+' accordion active">\n';return r=null!=(r=n.add_button||(null!=t?t.add_button:t))?r:c,s={name:"add_button",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a},o=typeof r===d?r.call(l,s):r,n.add_button||(o=n.blockHelperMissing.call(t,o,s)),null!=o&&(u+=o),u+'  <div class="wrapper">\n'+(null!=(o=n.each.call(l,null!=t?t.buttons:t,{name:"each",hash:{},fn:e.program(3,a,0),inverse:e.noop,data:a}))?o:"")+"  </div>\n</div>\n"},useData:!0})},{"hbsfy/runtime":535}],254:[function(e,t,n){var i=e("../../../../app/decorate");t.exports=i(e("./app/director"),Backbone.View.extend({views:{},Views:{},uploadViewKey:"",buttons:[],template:e("./director.hbs"),events:{'click dt > a:not([data-key="add"])':"listContentToggleEvent"},listContentToggleEvent:function(e){function t(){var e=this.hideListContent(i);e&&a.removeClass("active")}function n(){this.showListContent(i),a.addClass("active")}var i=$(e.currentTarget),a=i.closest("dt"),o=a.hasClass("active");if(o){var r=!i.children(".back").is(".hidden");r&&this.closeSubView(i),r||t.call(this)}else n.call(this)},initialize:function(){_.bindAll(this,"show","render","hideListContent","closeAccordion","openSubView")},render:function(){var e=this.template({"class":this["class"],buttons:this.buttons.filter(function(e){return!e.disabled})});this.$el.html(e),this.initializeUpload()},initializeUpload:function(){function e(){this.showListContent(n),n.parent().addClass("active")}var t=this.loadListContent(this.uploadViewKey),n=this.$el.find('dt a[data-key="'+this.uploadViewKey+'"]'),i=this.$el.find('dt a[data-key="add"]').parent(),a=_.debounce(_.bind(e,this),600);i.fineUploaderS3(t.getUploaderOptions(i)).on("progress",t.progressEvent).on("error",t.errorEvent).on("cancel",t.cancelEvent).on("complete",t.completeEvent).on("submitted",_.bind(function(){a(),t.submittedEvent.apply(t,arguments)},this)),this.beforeSubmitEvent&&i.on("click",this.beforeSubmitEvent)},show:function(){var e=new Date,t=this.$el.find(".tab-content."+this["class"].split(" ").join(".")).length,n=e-this.showingTime<600;t||this.render(),t&&n&&this.closeAccordion(),this.showingTime=e},closeAccordion:function(){_.each(this.views,function(e,t){var n=this.$el.find('dt a[data-key="'+t+'"]'),i=n.closest("dt");i.removeClass("active"),this.hideListContent(n,t)},this)},loadListContent:function(e,t){function n(){var t=$("<div></div>").addClass("image-list content "+e);return t.insertAfter(i),t}var i=t||this.$el.find('dt a[data-key="'+e+'"]');return this.views[e]=new this.Views[e]({el:n()}),this.views[e].on("open_new_view",_.partial(this.openSubView,i)),this.views[e]},openSubView:function(e,t){e.children(".collapse").addClass("hidden"),e.children(".back").removeClass("hidden")},closeSubView:function(e){var t=e.data("key"),n=!this.views[t].closeView||this.views[t].closeView();n&&(e.children(".collapse").removeClass("hidden"),e.children(".back").addClass("hidden"))},showListContent:function(e,t){t="undefined"!=typeof t?t:e.data("key"),this.toggleAcordionElement(e,!0),this.views[t]||this.loadListContent(t,e),this.views[t]&&this.views[t].refreshView&&this.views[t].refreshView()},hideListContent:function(e,t){if(t=t||e.data("key"),this.toggleAcordionElement(e,!1),!this.views[t].closeView)return!0;for(;!this.views[t].closeView(););return!0},toggleAcordionElement:function(e,t){var n=e.closest("dt"),i=n.closest(".wrapper");e.children("i").addClass("hidden",t),e.children(".main").toggleClass("hidden",t),e.children(".collapse").toggleClass("hidden",!t);var a=t?"-"+n.position().top+"px":0,o=t?n.closest('[role="tabpanel"]').height():"";i.css("top",a),n.height(o)}}))},{"../../../../app/decorate":8,"./app/director":248,"./director.hbs":253}],255:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({1:function(e,t,n,i,a){var o;return null!=(o=n.unless.call(null!=t?t:e.nullContext||{},null!=t?t.canUseUpload:t,{name:"unless",hash:{},fn:e.program(2,a,0),inverse:e.noop,data:a}))?o:""},2:function(e,t,n,i,a){return'        <div class="premium">\n          <i class="fa fa-lock"></i>\n        </div>\n'},compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){var o,r,s=null!=t?t:e.nullContext||{},l=n.helperMissing,c="function",d=e.escapeExpression;return'<div class="thumbnail-wrapper"></div>\n\n<div class="import-button uploader progress-button">\n  <div class="drag-drop-file">\n    <i class="fa fa-upload"></i>\n    <div>'+d((r=null!=(r=n.dragdrop_text||(null!=t?t.dragdrop_text:t))?r:l,typeof r===c?r.call(s,{name:"dragdrop_text",hash:{},data:a}):r))+'</div>\n  </div>\n\n  <div data-key="'+d((r=null!=(r=n.type||(null!=t?t.type:t))?r:l,typeof r===c?r.call(s,{name:"type",hash:{},data:a}):r))+'-import" class="button">\n    '+d((n.t||t&&t.t||l).call(s,"tool.general.import_from_file",{name:"t",hash:{},data:a}))+"\n"+(null!=(o=n["if"].call(s,null!=t?t.isDesygner:t,{name:"if",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a}))?o:"")+'  </div>\n</div>\n\n<div class="imported-elements">\n</div>\n'},useData:!0})},{"hbsfy/runtime":535}],256:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({1:function(e,t,n,i,a){var o,r,s,l=null!=t?t:e.nullContext||{},c=n.helperMissing,d="function",u=e.escapeExpression,p=n.blockHelperMissing,h='      <div data-key="'+u((r=null!=(r=n.key||(null!=t?t.key:t))?r:c,typeof r===d?r.call(l,{name:"key",hash:{},data:a}):r))+'">\n        ';return r=null!=(r=n.icon||(null!=t?t.icon:t))?r:c,s={name:"icon",hash:{},fn:e.program(2,a,0),inverse:e.noop,data:a},o=typeof r===d?r.call(l,s):r,n.icon||(o=p.call(t,o,s)),null!=o&&(h+=o),h+="\n        ",r=null!=(r=n.label||(null!=t?t.label:t))?r:c,s={name:"label",hash:{},fn:e.program(4,a,0),inverse:e.noop,data:a},o=typeof r===d?r.call(l,s):r,n.label||(o=p.call(t,o,s)),null!=o&&(h+=o),h+'\n        <span class="name">'+u((n.t||t&&t.t||c).call(l,null!=t?t.tag:t,{name:"t",hash:{},data:a}))+"</span>\n      </div>\n"},2:function(e,t,n,i,a){return'<i class="'+e.escapeExpression(e.lambda(t,t))+'"></i>'},4:function(e,t,n,i,a){return e.escapeExpression((n.t||t&&t.t||n.helperMissing).call(null!=t?t:e.nullContext||{},t,{name:"t",hash:{},data:a}))+" "},6:function(e,t,n,i,a){var o;return'    <div class="'+e.escapeExpression((o=null!=(o=n.key||(null!=t?t.key:t))?o:n.helperMissing,"function"==typeof o?o.call(null!=t?t:e.nullContext||{},{name:"key",hash:{},data:a}):o))+'"></div>\n'},compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){var o,r,s=null!=t?t:e.nullContext||{},l=n.helperMissing,c=e.escapeExpression;return'<div class="tab-content '+c((r=null!=(r=n.type||(null!=t?t.type:t))?r:l,"function"==typeof r?r.call(s,{name:"type",hash:{},data:a}):r))+' accordion active inner-tabs">\n  <div class="header-links">\n'+(null!=(o=n.each.call(s,null!=t?t.tabs:t,{name:"each",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a}))?o:"")+'  </div>\n  <div class="search-container">\n    <input type="text" name="search" placeholder="'+c((n.t||t&&t.t||l).call(s,null!=t?t.searchTitle:t,{name:"t",hash:{},data:a}))+'"/>\n    <div class="search-button">\n      <i class="tool-menu-icon-search"></i>\n    </div>\n  </div>\n'+(null!=(o=n.each.call(s,null!=t?t.tabs:t,{name:"each",hash:{},fn:e.program(6,a,0),inverse:e.noop,data:a}))?o:"")+"</div>"},useData:!0})},{"hbsfy/runtime":535}],257:[function(e,t,n){var i=e("../../../../factory/user-info"),a=e("./library-component"),o=e("../../embeded-import/view"),r=e("../../../../utils/humps"),s=e("./add-template.hbs"),l=e("../../../../facade/restrictions/decorate");t.exports=l(e("./restrict/view"),Backbone.View.extend({commonTemplate:e("./common-component.hbs"),events:{"click .header-links > div":"selectTabEvent","click .header-links > div[data-key]":"toggleTabViewEvent","keyup .search-container input":"searchKeyupEvent","click .search-container input":"searchClickEvent","focusout .search-container input":"searchFocusoutEvent","click .search-container .search-button":"searchTriggerEvent","click .search-container .search-options":"selectSearchOptionEvent"},selectSearchOptionEvent:function(e){this.invokeChildSearch("selectSearchOptionEvent",e)},searchClickEvent:function(e){this.invokeChildSearch("searchClickEvent",e)},searchFocusoutEvent:function(e){this.invokeChildSearch("searchFocusoutEvent",e)},searchKeyupEvent:function(e){var t=$(e.currentTarget);"Enter"===e.key&&t.val()&&this.invokeChildSearch("search",t)},searchTriggerEvent:function(e){var t=$(e.currentTarget).siblings("input");t.val()&&this.invokeChildSearch("search",t)},invokeChildSearch:function(e,t){this.selectedTab.searchable&&this.selectedTab.view&&this.selectedTab.view[e]&&this.selectedTab.view[e](t)},toggleTabViewEvent:function(e){var t=$(e.currentTarget).data("key");if(this.tabs[t].view)this.tabs[t].view.$el.show(),"add"===t&&this.embededImportView&&this.embededImportView.refresh();else{var n="init"+r.pascalize(t)+"View";this[n](e)}},selectTabEvent:function(e){var t=$(e.currentTarget),n=this.$el.find(">.tab-content>div:not(.header-links)");this.selectedTab=_.clone(this.tabs[t.data("key")]),t.siblings().removeClass("active"),this.$el.find(".library").hide(),n.hide(),this.updateSearchContainer(),n.filter("."+this.selectedTab.key).show(),this.refreshView(this.selectedTab.key),t.addClass("active")},show:function(){this.isAlreadyThere&&(this.isAlreadyThere()?this.refresh():this.render())},initialize:function(){this.isCompanyProject=INKIVE.Helpers.projectIsLinkedToRestrictions(),this.tabs=JSON.parse(JSON.stringify(e("./tabs.json"))),this.isCompanyProject&&(this.tabs.library.tag="tool.general.company"),i.get().then(_.bind(function(e){function t(t){return _(e.roles).contains(t)}this.canUseUpload=t("ROLE_PREMIUM"),this.canUseLibrary=t("ROLE_LIBRARY")||INKIVE.Helpers.projectIsLinkedToRestrictions(),t("ROLE_COMPANY_MEMBER")&&this.isCompanyProject&&(this.canUseUpload=this.canUseLibrary=!0)},this))},render:function(){function e(e){return _.contains(e.type,this.type)}this.$el.html(this.commonTemplate({type:this.type,tabs:_.filter(this.tabs,e,this)})),this.$headerLinks=this.$el.find(".header-links > div")},refresh:function(){for(var e in this.tabs)this.refreshView(e);this.embededImportView&&this.embededImportView.refresh()},refreshView:function(e){this.tabs[e].view&&this.tabs[e].view.refresh&&this.tabs[e].view.refresh()},initAddView:function(){var e=s({type:this.type,dragdrop_text:INKIVE.TranslateHelper.translate("tool.general.dragdrop."+this.type),isDesygner:!this.isCompanyProject,canUseUpload:this.canUseUpload});this.$el.find(".tab-content > .add").html(e),this.embededImportView=new o({canUse:this.canUseUpload}),this.embededImportView.loadImportedListContent(this.type,this.$el.find('[data-key="'+this.type+'-import"]'))},initStockView:function(){var e=this.$el.find(".tab-content > .stock");this.registerTabView("stock",new this.StockView({el:e[0]}))},initLibraryView:function(){var e=this.$el.find(".tab-content > .library");this.registerTabView("library",new a({el:e})),this.tabs.library.view.initLibraryView(this.canUseLibrary,this.type),e.show()},updateSearchContainer:function(){this.selectedTab.searchable&&this.displaySearchContainer(this.$el.find(".search-container"))},displaySearchContainer:function(e){var t=e.find("input");t.attr("autocomplete","off"),e.show(),this.setSelectedTabSearchTitle(),t.attr("placeholder",this.selectedTab.searchTitle),t.val(""),this.selectedTab.view&&this.selectedTab.view.getSearchOptions&&this.initSearchOptions()},initSearchOptions:function(){var e=this.selectedTab.view.getSearchOptions(),t=this.$el.find(".search-container");t.append(e),this.delegateEvents()},setSelectedTabSearchTitle:function(){this.selectedTab.searchTitle=INKIVE.TranslateHelper.translate("tool.search."+this.selectedTab.key,{type:INKIVE.TranslateHelper.translate("tool.library."+this.type),origin:INKIVE.TranslateHelper.translate("tool.general."+(INKIVE.C.BOOK.book_type===INKIVE.C.BOOK_TYPE.DESIGN?"my_library":"company"))})},registerTabView:function(e,t){this.tabs[e].view=t,this.selectedTab.key===e&&(this.selectedTab.view=t,this.tabs[e].view.getSearchOptions&&this.initSearchOptions())}}))},{"../../../../facade/restrictions/decorate":90,"../../../../factory/user-info":132,"../../../../utils/humps":482,"../../embeded-import/view":358,"./add-template.hbs":255,"./common-component.hbs":256,"./library-component":258,"./restrict/view":259,"./tabs.json":262}],258:[function(e,t,n){var i=e("../../library/contents/folders"),a=e("../../library/helper");t.exports=Backbone.mixin(Backbone.View.extend({events:{"click .library-link a.empty":"goToLibraryEvent"},goToLibraryEvent:_.partial(Backbone.Events.trigger,"go_to_libray"),initialize:function(){_.bindAll(this,"initHelper")},initLibraryView:function(e,t){e?(this.folderLibraryView=new i({el:this.$el}),this.folderLibraryView.loadData(t)):this.initHelper()},refresh:function(){this.folderLibraryView&&this.folderLibraryView.refresh()},initHelper:function(){if(this.$el.siblings(".search-container").hide(),!this.$el.find(".helper-view").length){var e=$('<div class="helper-view">');this.$el.append(e),this.helperView=new a({el:e}),this.helperView.on("toggle",_.bind(function(e){this.$el.find(".wrapper").toggleClass("blur",e)},this)),this.helperView.toggle(!0)}}}),Backbone.Events)},{"../../library/contents/folders":383,"../../library/helper":391}],259:[function(e,t,n){t.exports={render:function(){var t=e("../../../../../facade/restrictions/restrictions"),n=_.bind(t.isFunctionalityAllowed,t);t.initialize().then(_.bind(function(){_.each(this.tabs,function(e){switch(e.key){case"add":e.type=n("icon_add")?e.type:_.without(e.type,"icon"),e.type=n("function_use_own_images")?e.type:_.without(e.type,"image");break;case"stock":e.type=n("vector_add")?e.type:_.without(e.type,"icon"),"image"===this.type&&(e.searchable=n("function_use_web_images"),e.type=n("function_use_desygner_background")||e.searchable?e.type:_.without(e.type,"image"));break;case"library":e.type=n("icon_add")?e.type:_.without(e.type,"icon"),e.type=n("function_use_asset_vector")?e.type:_.without(e.type,"icon"),e.type=n("function_use_asset_images")?e.type:_.without(e.type,"image")}},this),this._parentObject.prototype.render.call(this)},this))}}},{"../../../../../facade/restrictions/restrictions":94}],260:[function(e,t,n){var i=e("../../components/accordion-list/categories-director");t.exports=i.extend({selectedCategory:"all",views:{},template:e("./stock-template.hbs"),events:_.extend({"click .search-close":"closeSearchEvent","click .categories-container .category-list .category-element":"selectCategoryEvent","click .categories-container .category-title":"toggleCategoryDropdownEvent","click .categories-container .category-title + i":"toggleCategoryDropdownEvent"},i.prototype.events),toggleCategoryDropdownEvent:function(e){this.$el.find(".category-list").toggleClass("hidden")},searchClickEvent:function(e){this.$searchOptions&&this.$searchOptions.toggle()},searchFocusoutEvent:function(e){this.$el.siblings(".search-container").find(".search-options:hover").length||this.$searchOptions&&this.$searchOptions.hide()},selectCategoryEvent:function(e){var t=$(e.currentTarget),n=t.closest(".category-list");n.addClass("hidden"),n.find(".category-element").removeClass("selected"),this.$el.find(".category-title").html(t.html()),t.addClass("selected"),this.loadListContent(t.data("key"))},closeSearchEvent:function(e){var t=$(e.currentTarget).parents(".search-title"),n=t.siblings(".categories-container"),i=n.find(".category-element:first-child").html();t.addClass("hidden"),this.$searchOptions&&this.$searchOptions.hide(),n.removeClass("hidden"),n.find(".category-title").html(i),this.$el.closest(".tab-content").find(".search-container input").val(""),this.hasDefaults&&this.loadListContent("all")},initialize:function(e){_.bindAll(this,"refreshAntiscroll"),this.tool=INKIVE.Tool.getInstance(),this.hasDefaults=!e.simplified,i.prototype.initialize.call(this),this.render()},_render:function(e){INKIVE.Modal.loaderClose(this.$el),this.$el.find("input[name=search]").addClass("disabled"),this.$el.html(this.template({categories:this.hasDefaults&&e})),this.hasDefaults&&this.loadListContent("all"),this.hasDefaults&&this.initCategoryGroup()},loadListContent:function(e){return this.selectedCategory=this.cid+e,this.views[this.cid+e]=new this.CategoriesView({el:this.$el.find(".image-list"),key:e}),this.views[this.cid+e]},initCategoryGroup:function(){var e=this.$el.find(".category-list");this.tool.initScroll(e),e.addClass("hidden")},refreshAntiscroll:function(){this.$el.find(".antiscroll-wrap").antiscroll({horizontal:!1})},refresh:function(){this.refreshAntiscroll(),_.each(this.views,function(e){function t(){e.$el.find(".antiscroll-inner").trigger("scroll")}e.masonryReload(),t(),_.delay(t,2e3)})}})},{"../../components/accordion-list/categories-director":250,"./stock-template.hbs":261}],261:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({1:function(e,t,n,i,a){var o,r=null!=t?t:e.nullContext||{},s=n.helperMissing,l=e.escapeExpression;return'  <div class="categories-container">\n    <span class="category-title">'+l((n.t||t&&t.t||s).call(r,"tool.general.all",{name:"t",hash:{},data:a}))+'</span>\n    <i class="desygner-icon-arrow-down"></i>\n    <div role="tabpanel" class="category-list antiscroll-wrap">\n      <div class="antiscroll-inner">\n        <div data-key="all" class="category-element">'+l((n.t||t&&t.t||s).call(r,"tool.general.all",{name:"t",hash:{},data:a}))+"</div>\n"+(null!=(o=n.each.call(r,null!=t?t.categories:t,{name:"each",hash:{},fn:e.program(2,a,0),inverse:e.noop,data:a}))?o:"")+"      </div>\n    </div>\n  </div>\n"},2:function(e,t,n,i,a){var o,r=null!=t?t:e.nullContext||{},s=n.helperMissing,l="function",c=e.escapeExpression;return'          <div class="category-element" data-key="'+c((o=null!=(o=n.key||(null!=t?t.key:t))?o:s,typeof o===l?o.call(r,{name:"key",hash:{},data:a}):o))+'">'+c((o=null!=(o=n.tag||(null!=t?t.tag:t))?o:s,typeof o===l?o.call(r,{name:"tag",hash:{},data:a}):o))+"</div>\n"},compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){var o,r=null!=t?t:e.nullContext||{};return'<div class="stock-content">\n  <div class="search-title hidden">\n    <span>\n      '+e.escapeExpression((n.t||t&&t.t||n.helperMissing).call(r,"tool.search.results",{name:"t",hash:{},data:a}))+'\n    </span>\n    <div class="search-close pull-right">\n      <i class="desygner-icon-close"></i>\n    </div>\n  </div>\n\n'+(null!=(o=n["if"].call(r,null!=t?t.categories:t,{name:"if",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a}))?o:"")+'\n  <div class="image-list">\n    <div class="antiscroll-wrap">\n      <div class="antiscroll-inner">\n        <ul class="thumbnail-wrapper"></ul>\n      </div>\n    </div>\n  </div>\n</div>\n'},useData:!0})},{"hbsfy/runtime":535}],262:[function(e,t,n){t.exports={add:{key:"add",tag:"tool.general.add",type:["text","icon","image","video","template"],searchable:!0},stock:{key:"stock",tag:"tool.general.stock",type:["icon","image"],searchable:!0},banners:{key:"banners",tag:"tool.general.banners",type:["text"]},grid:{key:"grid",tag:"tool.customize.grids",type:["template"]},library:{key:"library",tag:"tool.general.my_library",type:["text","icon","image","logo","video"]},images:{key:"images",tag:"editor.images",type:["search"],searchable:!0},icons:{key:"icons",tag:"editor.icons",type:["search"],searchable:!0}}},{}],263:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({1:function(e,t,n,i,a){return"<h3>"+e.escapeExpression((n.t||t&&t.t||n.helperMissing).call(null!=t?t:e.nullContext||{},t,{name:"t",hash:{},data:a}))+"</h3>"},compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){var o,r,s,l=null!=t?t:e.nullContext||{},c=n.helperMissing,d="function",u='<div class="helper-display">\n  <div class="helper-content">\n    <h2>'+e.escapeExpression((n.t||t&&t.t||c).call(l,null!=t?t.title:t,{name:"t",hash:{},data:a}))+"</h2>\n    ";return r=null!=(r=n.sub_title||(null!=t?t.sub_title:t))?r:c,s={name:"sub_title",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a},o=typeof r===d?r.call(l,s):r,n.sub_title||(o=n.blockHelperMissing.call(t,o,s)),null!=o&&(u+=o),u+"\n    "+(null!=(r=null!=(r=n.content||(null!=t?t.content:t))?r:c,o=typeof r===d?r.call(l,{name:"content",hash:{},data:a}):r)?o:"")+"\n  </div>\n</div>\n\n"},useData:!0})},{"hbsfy/runtime":535}],264:[function(e,t,n){var i=e("../../../../../../bower_components/plyr/dist/plyr");t.exports=Backbone.mixin(Backbone.View.extend({template:e("./template.hbs"),displayDelay:500,data:{title:"",sub_title:null,content:"",button:"fa fa-info"},toggle:function(e){_.delay(_.bind(this._toggle,this,e),this.displayDelay)},_toggle:function(e){this.$el.toggleClass("show",e),this.trigger("toggle",this.$el.hasClass("show"))},initialize:function(){_.bindAll(this,"toggle"),this.$el.addClass("helper")},render:function(e){e=_.extend({},this.data,e),this.$el.html(this.template(e)),this.setElementStyle()},setElementStyle:function(){var e=this.$el.closest(".tool-content"),t=e.outerWidth(),n=e.outerHeight(),i=e.offset();this.$el.addClass("helper").css({top:i.top+"px",left:i.left+"px",height:n+"px",width:t+"px"}),this.$el.find(".helper-content").css({height:n+"px",width:t+"px"})},openVideoContent:function(e){INKIVE.Modal.modalWindow('<div class="plyr-player" data-type="youtube" data-video-id="'+e+'"></div>',{headerTitle:"general.close"}),i.setup(document.querySelector(".plyr-player"),{controls:[]})}}),Backbone.Events)},{"../../../../../../bower_components/plyr/dist/plyr":2,"./template.hbs":263}],265:[function(e,t,n){t.exports={initializeUploadCheckOnce:function(){return window.Android},initializeUpload:function(){var e=this.$el.find(".uploader.progress-button");e.on("click",_.bind(function(e){var t="o";this.appBridge.callAndroid("photo_upload",{size_name:t})},this))}}},{}],266:[function(e,t,n){var i=e("../../../editor-mode-manager");t.exports={events:{"click .btn-new-item":"addNewEvent"},addNewEvent:function(){},createTemplate:function(){this.$el.find(".btn-new-item").addClass("disabled"),this.modalData.saveForm(_.bind(this.onFormSaved,this))},onFormSaved:function(e,t){if(e&&t.id){this.modal.close(),i.setMode(this.mode,t);var n=this.extractData([t]),a=_.bind(this.createCallback,this.tool);this.tool.addThumbItem(this.$el,n,a,"prepend")}else this.$el.find(".btn-new-item").removeClass("disabled")},render:function(){this.$el.html(this.template({placeholder:this.filterPlaceholder,add_button:this.addButtonText})),this.$el.find(".antiscroll-inner").addThumb()}}},{"../../../editor-mode-manager":162}],267:[function(e,t,n){t.exports={draggableOpacity:1,outline:0,mouseDownEvent:function(e){},mouseMoveEvent:function(e){},mouseUpEvent:function(e){},clickEvent:function(e){},mouseDown:function(e){this.$draggableClone=this.createDraggableClone(),this.$draggable.css("outline",this.outline),this.uppdateDraggableCloneDataPosition(e),this.bindDragDrop(),this.mouseDownEvent(e)},createDraggableClone:function(){var e=this.$draggable.get(0).getBoundingClientRect();return $draggableClone=this.$draggable.clone(!0).off(),$("#draggingObject").remove(),$draggableClone.attr("id","draggingObject"),$draggableClone.attr("style",this.$draggable.attr("style")),$draggableClone.css({position:"absolute",left:e.left,top:e.top,width:e.width,height:e.height,"z-index":5e3,opacity:"0"}),$draggableClone.find(".tooltip").remove(),$draggableClone.find("svg *").each(function(){var e=$(this).attr("id");e&&$(this).attr("id","clone-"+e)}),$("body").append($draggableClone),$draggableClone},uppdateDraggableCloneDataPosition:function(e){var t=this.$draggable.get(0).getBoundingClientRect(),n=this.getCursorPosition(e);this.$draggableClone.data("offset",{x:(n.x-t.left)/t.width,y:(n.y-t.top)/t.height})},bindDragDrop:function(){$(window).unbind("mousemove touchmove",this.mouseMove),$(window).unbind("mouseup touchend touchcancel",this.mouseUp),$(window).on("mousemove touchmove",this.mouseMove),$(window).on("mouseup touchend touchcancel",this.mouseUp)},mouseMove:function(e){var t=_.partial(this.processDraggable,e);$("#draggingObject").length&&_.defer(t)},mouseUp:function(e){e.preventDefault();var t=$("#canvas-panel").offset();if(this.$draggableClone.length){var n=this.getCursorPosition(e);n.x>t.left?this.mouseUpEvent(e):this.$draggableClone.data("dragging")||this.clickEvent(e),this.endDragging()}},endDragging:function(){this.$draggable.css("outline","none"),this.$draggableClone.remove(),$(window).unbind("mousemove touchmove",this.mouseMove),$(window).unbind("mouseup touchend",this.mouseUp)},processDraggable:function(e){function t(){var t=this.getCursorPosition(e);return{x:t.x-o.width*a.x,y:t.y-o.height*a.y}}function n(){var e=s<122.5,t=c<80,n=t?o.left:r.x,i=e?o.top:r.y;$draggableClone.css("left",n),$draggableClone.css("top",i),$draggableClone.css("opacity",t&&e?"0":this.draggableOpacity)}function i(){var e=130,t=300,n=2,i=1;c>e&&(i+=(c-e)/(t-e),i>n&&(i=n)),$draggableClone.css("transform","scale("+i+")")}var a=this.$draggableClone.data("offset");if(this.$draggableClone.length&&a){var o=this.$draggable.get(0).getBoundingClientRect(),r=t.call(this),s=Math.abs(r.x-o.left),l=Math.abs(r.y-o.top),c=Math.round(Math.sqrt(s*s+l*l));n.call(this),i(),s>122.5&&e.preventDefault(),c>10&&this.$draggableClone.data("dragging",!0),this.mouseMoveEvent(e)}},getCursorPosition:function(e){if(0===e.type.indexOf("touch")){var t=e.originalEvent?e.originalEvent.changedTouches:e.changedTouches,n={x:t&&t[0].clientX,y:t&&t[0].clientY};return e.clientX=n.x,e.clientY=n.y,n}return{x:e.clientX,y:e.clientY}},initDraggable:function(){_.bindAll(this,"mouseMove","mouseUp","processDraggable")}}},{}],268:[function(e,t,n){var i=e("../thumbnail/upload"),a=INKIVE.Helpers.getBucketUrl(INKIVE.C.BUCKET);a=a.substr(0,a.lastIndexOf("/")),t.exports={uploadingThumbs:{},uploadAttempt:{},files:{},uploadPath:"/uploads",uploadConfig:{request:{endpoint:a,accessKey:INKIVE.C.UPLOAD_KEY,forceMultipart:!1}},initialize:function(e){_.bindAll(this,"complete","errorEvent","getUploadKey","completeEvent","uploadFileContent"),this.uploadPath=e||this.uploadPath,this.addUploadThumbnail(),this.initializeUpload()},addUploadThumbnail:function(){this.$el.find(".thumbnail-wrapper:not(.folders)").after($('<ul class="uploader-wrapper hidden"></ul>'));var e=this.$el.find(".uploader-wrapper");this.$uploaderThumbnail=$("<div></div>").addClass("thumbnail uploader"),e.append(this.$uploaderThumbnail),this.views={},this.views.uploadThumbnail=new i({el:this.$uploaderThumbnail})},initializeUpload:function(){this.$container=this.$el.find(".uploader.progress-button"),this.$container.fineUploaderS3(this.getUploaderOptions()).on("error",this.errorEvent).on("complete",this.completeEvent)},uploadFileContent:function(e){var t=new Blob([new Uint8Array([239,187,191]),e],{type:"text/plain;charset=utf-8"}),n=new File([t],"logo"+(new Date).valueOf()+".svg");this.$container.fineUploaderS3("addFiles",n)},getUploaderOptions:function(){var e=INKIVE.C.DEFAULT_FINEUPLOADER,t=$.extend(!0,{button:this.$el.find(".uploader.progress-button"),objectProperties:{acl:"public-read",key:this.getUploadKey}},e,this.uploadConfig);return t.uploadSuccess={},t},getUploadKey:function(e){var t=/(?:\.([^.]+))?$/,n=this.$container.fineUploaderS3("getName",e),i=this.$container.fineUploaderS3("getUuid",e),a=t.exec(n)[1],o=INKIVE.Helpers.getBucketUrl(INKIVE.C.BUCKET).split("/").pop().split(".")[0];return o+this.uploadPath+"/"+i+"."+a},errorEvent:function(e,t){var n=this.views[t];return INKIVE.Modal.alertMessage(INKIVE.TemplatesHelper("alert_default",{message:"modal.alert.upload_image",try_again:!0})),this.clean(t),_.delay(function(){n&&n.remove()},1e3),$(document).trigger("file-content-upload:error"),!0},completeEvent:function(e,t,n,i,a){var o=$(e.currentTarget);i.success?this.complete(t,i):this.errorEvent(e,t)&&o.fineUploaderS3("cancel",t)},complete:function(e,t){var n=this.getUploadKey(e);this.clean(e),$(document).trigger("file-content-upload:complete",a+"/"+n)},clean:function(e){this.files=_.omit(this.files,e),this.uploadAttempt=_.omit(this.uploadAttempt,e)},forceFallbackUpload:function(){INKIVE.C.USE_FALLBACK_UPLOAD="FORCE"},isFallbackUploadForced:function(){return"FORCE"===INKIVE.C.USE_FALLBACK_UPLOAD}}},{"../thumbnail/upload":326}],269:[function(e,t,n){t.exports={initScroll:function(e,t){e=e||this.$el;var n=e.find(".accordion dd:visible"),i=n.length;if(i)return this.initScroll(n,t);var t=$.extend({autoHide:!1,width:this.getScrollWidth(e),height:this.getScrollHeight(e)},t);e.hasClass("antiscroll-wrap")?e.antiscroll(t):e.find(".antiscroll-wrap").antiscroll(t)},getScrollWidth:function(e){return e.parents(".tool-content").width()},getScrollHeight:function(e){return e.parents(".tool-content").height()},toggleScroll:function(e){var t=this.$el.find(".antiscroll-wrap:first");t.children(".antiscroll-inner").css("overflow",e?"hidden":"auto"),t.children(".antiscroll-scrollbar").toggleClass("antiscroll-scrollbar-shown",!e)}}},{}],270:[function(e,t,n){var i=e("../thumbnail/upload"),a=e("../../../../app/decorate"),o=e("../../../../factory/images");t.exports=a(e("./app/upload-list"),{uploadingThumbs:{},uploadAttempt:{},files:{},uploadConfig:{validation:{acceptFiles:"image/*;capture=camera",allowedExtensions:["jpg","jpeg","gif","png"]},scaling:{includeExif:!1,sendOriginal:!1,sizes:[{name:"o",maxSize:INKIVE.C.VersionUploadSize.o}]}},initialize:function(){_.bindAll(this,"complete","submittedEvent","progressEvent","errorEvent","cancelEvent","completeEvent","getUploaderOptions"),this.debouncedMasonryReload=_.debounce(this.masonryReload,800),this.addUploadThumbnail(),this.initializeUpload()},addUploadThumbnail:function(){var e=this.$el.find(".thumbnail-wrapper");this.$uploaderThumbnail=$("<div></div>").addClass("thumbnail uploader"),e.prependThumb(this.$uploaderThumbnail),this.views.uploadThumbnail=new i({el:this.$uploaderThumbnail})},getNewThumbnail:function(){var e=$("<div></div>").addClass("thumbnail uploading");return e.insertAfter(this.$uploaderThumbnail),this.$uploaderThumbnail.parent().masonry("prepended",e),new i({el:e})},initializeUpload:function(){var e=this.$el.find(".uploader.progress-button");e.fineUploaderS3(this.getUploaderOptions(e)).on("submitted",this.submittedEvent).on("progress",this.progressEvent).on("error",this.errorEvent).on("cancel",this.cancelEvent).on("complete",this.completeEvent)},getUploaderOptions:function(e){function t(t){var n=/(?:\.([^.]+))?$/,i=e.fineUploaderS3("getName",t),a=e.fineUploaderS3("getUuid",t),o=n.exec(i)[1],r=INKIVE.C.UPLOAD_SERVER.split("/").pop().split(".")[0];return r+"/original/"+a+"."+o}var n=INKIVE.C.DEFAULT_FINEUPLOADER,i=$.extend(!0,{button:e,objectProperties:{acl:"public-read",key:t}},n,this.uploadConfig);return i},submittedEvent:function(e,t,n){var i=$(e.currentTarget);this.views[t]=this.getNewThumbnail(),this.views[t].toggleProgressBar(!0),this.files[t]=i.fineUploaderS3("getFile",t),this.views[t].on("thumbnail_load_error",_.bind(function(){this.errorEvent(null,t)},this)),this.views[t].on("cancel",_.bind(function(){var e=this.uploadAttempt[t];e&&e.abort&&e.abort(),i.fineUploaderS3("cancel",t)},this)),this.isFallbackUploadForced()&&_.defer(_.bind(function(){i.fineUploaderS3("cancel",t),this.regularUploadFallback(t)},this))},progressEvent:function(e,t,n,i,a){this.views[t]&&this.views[t].updateProgressBar(i/a)},cancelEvent:function(e,t){if(!this.isFallbackUploadForced()||this.uploadAttempt[t]){var n=this.views[t];this.tool.editor.canvas.call("advice.show","upload-cancel"),this.clean(t),_.delay(_.bind(function(){n.remove(),this.debouncedMasonryReload()},this),1e3)}},errorEvent:function(e,t){var n=this.views[t],i=!this.uploadAttempt[t]||"complete"===e.type;return i?("complete"!==(e&&e.type)&&this.regularUploadFallback(t),!1):(INKIVE.Modal.alertMessage(INKIVE.TemplatesHelper("alert_default",{message:"modal.alert.upload_image",try_again:!0})),this.clean(t),_.delay(_.bind(function(){n&&n.remove(),this.debouncedMasonryReload()},this),1e3),!0)},regularUploadFallback:function(e){function t(){var t=_.bind(this.progressEvent,this),a=new FormData;a.append("userfile",i),a.append("project_id",INKIVE.C.BOOK.id),this.uploadAttempt[e]=$.ajax({url:this.regularUploadFallbackUrl,
type:"POST",success:n,error:_.bind(function(t){this.errorEvent(t,e)},this),data:a,cache:!1,contentType:!1,processData:!1,dataType:"json",xhr:function(){var n=$.ajaxSettings.xhr();return n.upload&&n.upload.addEventListener("progress",function(n){t(n,e,null,n.loaded,n.total)},!1),n}})}function n(t){var n=t.key;$.ajax({url:INKIVE.C.BASE_URL+"upload/successasync",type:"POST",dataType:"json",success:o,error:_.bind(function(t){a(t,e)},this),data:{type:"editor",scrapbookId:INKIVE.C.BOOK.id,key:n,name:i.name,bucket:"virginia.inkive.com"}})}var i=this.files[e],a=this.errorEvent,o=_.partial(this.complete,e);this.$el.find(".uploader.progress-button");this.uploadAttempt[e]=!0,this.forceFallbackUpload(),this.regularUploadFallbackUrl&&t.call(this),this.regularUploadFallbackUrl||$.get(BASE_URL+"upload/getdirectuploadendpoint",_.bind(function(e){this.regularUploadFallbackUrl=e,t.call(this)},this))},completeEvent:function(e,t,n,i,a){var o=$(e.currentTarget);i.success?this.complete(t,i):this.errorEvent(e,t)&&o.fineUploaderS3("cancel",t)},complete:function(e,t){var n=o.getVersionUrl(t.tempLink,"thumb");this.clean(e),this.views[e].setImage("photo-saved-"+t.photoId,n),this.views[e].on("resize",this.debouncedMasonryReload)},clean:function(e){this.files=_.omit(this.files,e),this.uploadAttempt=_.omit(this.uploadAttempt,e)},forceFallbackUpload:function(){INKIVE.C.USE_FALLBACK_UPLOAD="FORCE"},isFallbackUploadForced:function(){return"FORCE"===INKIVE.C.USE_FALLBACK_UPLOAD}})},{"../../../../app/decorate":8,"../../../../factory/images":102,"../thumbnail/upload":326,"./app/upload-list":265}],271:[function(e,t,n){var i=e("./base"),a=e("../../../../../facade/design/design");t.exports=i.extend({addElement:function(e){a.create("sticker",_.extend({sticker_id:this.svg.id,thumb_src:this.svg.url},e))},initialize:function(e){this.svg=e.svg,i.prototype.initialize.call(this),this.setImageListeners()},setImageListeners:function(){this.$el.find("img")[0].onload=this.resize},getTemplateRenderData:function(){return{image:{src:this.svg.url}}}})},{"../../../../../facade/design/design":34,"./base":272}],272:[function(e,t,n){var i=e("../../mixins/draggable"),a=e("../../../../../facade/editor/editor");t.exports=Backbone.mixin(Backbone.mixin(Backbone.View.extend({template:e("../templates/base.hbs"),elementType:"",height:86,width:122.5,events:{"touchstart .item":"mouseDown","mousedown .item":"mouseDown"},getClickElementData:function(e){var t=this.$draggableClone?this.$draggableClone.get(0).getBoundingClientRect():this.$el.get(0).getBoundingClientRect(),n=Math.min(this.canvas.contentW,this.canvas.contentH);return n/=Math.max(t.width,t.height),{position:{x:(this.canvas.contentW-t.width*(n/2))/2,y:(this.canvas.contentH-t.height*(n/2))/2},size:{width:t.width*(n/2),height:t.height*(n/2)}}},getMouseUpElementData:function(e){var t=this.$draggableClone.get(0).getBoundingClientRect(),n=a.handle("zoom","get"),i=this.editor.getOffset();return{position:{x:Math.floor4((t.left-i.x)/n),y:Math.floor4((t.top-i.y)/n)},size:{width:Math.floor4(t.width/n),height:Math.floor4(t.height/n)}}},clickEvent:function(e){this.addElement(this.getClickElementData(e),e.target)},mouseUpEvent:function(e){this.addElement(_.extend(this.getMouseUpElementData(e),{selected:!$(e.target).parents(".root-popupmenu").length}))},addElement:function(e){var t=this.editor.addElement(this.elementType,e);INKIVE.Tool.blinkScreen(t)},initialize:function(){_.bindAll(this,"resize"),this.editor=INKIVE.Tool.getInstance().editor,this.canvas=this.editor.canvas,this.render(),this.initDraggable()},render:function(){var e=this.template(this.getTemplateRenderData());this.$el.html(e),this.width&&this.$el.css("width",this.width),this.height&&this.$el.css("height",this.height),this.$draggable=this.$el.find("a.item")},remove:function(){this.undelegateEvents(),this.$el.removeData().unbind(),Backbone.View.prototype.remove.call(this)},resize:function(){var e=this.$el.find("img").height();this.$el.height(e),this.trigger("resize")},getTemplateRenderData:function(){}}),Backbone.Events),i)},{"../../../../../facade/editor/editor":76,"../../mixins/draggable":267,"../templates/base.hbs":306}],273:[function(e,t,n){var i=e("./base"),a=e("../../../../../analytics/decorate");t.exports=a(e("../analytics/template"),i.extend({events:{click:"addEvent"},addEvent:function(e){var t=0===$("#svgroot .main").find(":not(title)").length;!this.isSameSize()&&!this.isCustomFormat&&!t;t||this.setCurrentPage?this.setTemplate():this.displayModalOptions()},initialize:function(){this.tool=INKIVE.Tool.getInstance(),this.editor=this.tool.editor,this.canvas=this.editor.canvas,_.bindAll(this,"setTemplate","onTemplateSet","acceptModal","closeModal")},displayModalOptions:function(){var e=0;this.modal=INKIVE.Modal.modalWindow(INKIVE.TemplatesHelper("modal_layout_load",{new_size:e,current_size:Math.round(this.canvas.contentW)+"x"+Math.round(this.canvas.contentH),keep_images:!INKIVE.C.MODE.IS_DESYGNER,has_images:$("#svgcontent .main image").length>0,keep_size:!INKIVE.C.MODE.IS_DESYGNER,is_same_size:!0}),{width:600,headerIcon:"icon-cloud-download",headerTitle:"modal.title.change_name",buttons:[{title:INKIVE.TranslateHelper.translate("modal.buttons.apply_name"),onClick:this.acceptModal},{title:INKIVE.TranslateHelper.translate("general.cancel"),onClick:this.closeModal}]}),$('[data-id="'+this.modal.id+'"] [type=checkbox]').iCheck({checkboxClass:"icheckbox_square-yellow"})},acceptModal:function(){this.keepSize=$('input[name="keep-size-input"]').is(":checked"),this.keepImages=$('input[name="keep-images-input"]').is(":checked"),this.setTemplate(),this.modal.close()},closeModal:function(){this.modal.close()},setTemplate:function(){this.oldImages=_.map($("#svgcontent .main image"),function(e){return e.getAttribute("xlink:href")}),this.editor.loadingElement(1),INKIVE.DesignFacade.once(this.designAddedEvent,this.onTemplateSet)},onTemplateSet:function(){INKIVE.Tool.blinkScreen();var e=$("#svgcontent .main .layoutBox");this.keepImages&&_.any(e,function(e,t){return!(this.oldImages.length>t)||void this.canvas.runExtensions("addLayoutImage",{elem:e,data:this.oldImages[t]})},this),INKIVE.C.IS_MOBILE&&this.canvas.call("advice.show","template-back"),INKIVE.C.IS_MOBILE||e.length&&INKIVE.C.MODE.IS_DESYGNER&&this.canvas.call("advice.show","template-placeholders"),INKIVE.Helpers.displayImagesLoadingAnimation(),this.editor.loadingElement(0)}}))},{"../../../../../analytics/decorate":5,"../analytics/template":280,"./base":272}],274:[function(e,t,n){t.exports={eventCategory:"Editor UI | Tool Menu | customize",clickEvent:function(){this.trackEvent({eventAction:"backgrounds_set_color",eventLabel:this.color})}}},{}],275:[function(e,t,n){t.exports={}},{}],276:[function(e,t,n){arguments[4][275][0].apply(n,arguments)},{dup:275}],277:[function(e,t,n){arguments[4][275][0].apply(n,arguments)},{dup:275}],278:[function(e,t,n){arguments[4][275][0].apply(n,arguments)},{dup:275}],279:[function(e,t,n){arguments[4][275][0].apply(n,arguments)},{dup:275}],280:[function(e,t,n){t.exports={eventCategory:"Editor UI | Tool Menu | templates",addEvent:function(e){var t=0===$("#svgroot .main").find(":not(title)").length,n=!this.isSameSize()&&!t;(n||t)&&this.trackEvent({eventAction:"add_"+(this.design?"designed":"grid"),eventLabel:n?"new_page":"current_empty_page"})},acceptModal:function(e){this.trackEvent({eventAction:"add_"+(this.design?"designed":"grid"),eventLabel:"current_page"})},closeModal:{eventAction:"cancel_adding"}}},{}],281:[function(e,t,n){t.exports={eventCategory:"Editor UI | Tool Menu | text banners",clickEvent:function(e){this.trackEvent({eventAction:"add_click",eventLabel:this.svg.id})},mouseUpEvent:function(){this.trackEvent({eventAction:"add_drop",eventLabel:this.svg.id})}}},{}],282:[function(e,t,n){t.exports={eventCategory:"Editor UI | Tool Menu | text",eventAction:"text_edit",toggleBoldFontEvent:{eventLabel:"toggle_bold"},toggleItalicFontEvent:{eventLabel:"toggle_italic"},toggleOptionsEvent:{eventLabel:"toggle_options"},endEditingEvent:{eventLabel:"change_content"},toggleUnderlineFontEvent:{eventLabel:"toggle_underline"},clickEvent:{eventAction:"add_click"},mouseUpEvent:{eventAction:"add_drop"},changeFontFamilyEvent:function(e){var t=$(e.currentTarget).css("font-family");this.trackEvent({eventLabel:"change_font_family "+this.getQuoteScaped(t)})}}},{}],283:[function(e,t,n){t.exports={displayFontFamiliesEventCheckOnce:function(){return this.appBridge.version.isApp("webrand")||this.appBridge.version.isApp("pdf")||!window.Android&&this.appBridge.version.isGreaterThan("1.1.1")||window.Android&&!this.appBridge.version.isLowerThan("1.1.3")},displayFontFamiliesEvent:function(e){var t=this.$el.find(".fonts-list");this.appBridge.callBoth("pick_font",_.extend(this.getTextData("_"),{position:_.extend(t.offset(),{height:t.height(),width:t.width()})})),t.find(".ui-dropdown-items").removeAttr("style").hide(),this.appBridge.off("ik.editor.text_update"),this.appBridge.on("ik.editor.text_update",_.bind(function(e,t){this.setTextData(t)},this))}}},{}],284:[function(e,t,n){var i=e("../../../../facade/design/design"),a=e("./templates/color.hbs"),o=e("../../../../analytics/decorate");t.exports=o(e("./analytics/color"),Backbone.View.extend({events:{click:"clickEvent"},clickEvent:function(e){i.set("background",{color:this.color})},initialize:function(e){this.editor=INKIVE.Tool.getInstance().editor,this.color=e.color,this.render()},render:function(){this.$el.html(a({color:this.color})),this.$el.data("attr","fill fill-opacity"),this.$el.attr("title",this.color)}}))},{"../../../../analytics/decorate":5,"../../../../facade/design/design":34,"./analytics/color":274,"./templates/color.hbs":307}],285:[function(e,t,n){function i(e){this.$el=e,this.caption="",this.captionLength=0,_.bindAll(this,"type","erase","startTyping","startErasing");var t=this.$el.height();this.$el.empty(),this.$text=$('<span class="content avoid-shortcuts"></span>').height(t).appendTo(this.$el),this.$cursor=$('<span class="cursor">|</span>').appendTo(this.$el)}t.exports=i,i.prototype.hide=function(){this.$cursor.hide()},i.prototype.show=function(){this.$cursor.show()},i.prototype.startTyping=function(e){return this.deferred=$.Deferred(),this.show(),this.caption=e,this.captionLength=0,this.type(),this.deferred.promise()},i.prototype.startErasing=function(){return this.deferred=$.Deferred(),this.show(),this.caption=this.$text.text(),this.captionLength=this.caption.length,this.erase(),this.deferred.promise()},i.prototype.type=function(){this.$text.html(this.caption.substr(0,this.captionLength++)||"&nbsp;"),this.captionLength<=this.caption.length?_.delay(this.type,100):(this.captionLength=0,this.caption="",this.deferred.resolve())},i.prototype.erase=function(){this.$text.html(this.caption.substr(0,this.captionLength--)||"&nbsp;"),this.captionLength>=0?_.delay(this.erase,50):(this.captionLength=0,this.caption="",this.deferred.resolve())}},{}],286:[function(e,t,n){function i(){var e=document.createElement("p").style;return"transition"in e?"transitionend":"WebkitTransition"in e?"webkitTransitionEnd":"MozTransition"in e?"transitionend":"msTransition"in e?"MSTransitionEnd":"OTransition"in e?"oTransitionEnd":null}function a(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}function o(e){this.el=e,this.paths=[].slice.call(this.el.querySelectorAll("path")),this.pathsArr=new Array,this.lengthsArr=new Array,this._init()}function r(e,t){this.el=e,this.options=a({},this.options),a(this.options,t),this._init()}t.exports=r;i();o.prototype._init=function(){var e=this;this.paths.forEach(function(t,n){e.pathsArr[n]=t,t.style.strokeDasharray=e.lengthsArr[n]=t.getTotalLength()}),this.draw(0)},o.prototype.draw=function(e){for(var t=0,n=this.pathsArr.length;t<n;++t)this.pathsArr[t].style.strokeDashoffset=this.lengthsArr[t]*(1-e)},r.prototype.options={},r.prototype._init=function(){this.progressEl=new o(this.el.querySelector("svg.progress-circle")),this.successEl=new o(this.el.querySelector("svg.checkmark")),this.errorEl=new o(this.el.querySelector("svg.cross")),$(this.el).addClass("error plus"),this.errorEl.draw(1)},r.prototype._submit=function(){$(this.el).addClass("loading").removeClass("plus")},r.prototype.stop=function(e){var t=this,n=function(){if(t.progressEl.draw(0),"number"==typeof e){var n=e>=0?"success":"error",i=e>=0?t.successEl:t.errorEl;i.draw(1),$(t.el).addClass(n),t.clear=function(){$(t.el).removeClass(n),i.draw(0)}}$(t.el).removeClass("loading error")};setTimeout(n,300)},r.prototype.clear=function(){},r.prototype.setProgress=function(e){this.progressEl.draw(e)}},{}],287:[function(e,t,n){var i=e("./abstract/template"),a=e("../../../../factory/user-info"),o=e("../../../../facade/project/project"),r=e("./templates/locked-template.hbs");t.exports=i.extend({height:null,template:e("./templates/template.hbs"),designAddedEvent:"template.update.designed",events:{"click .base":"addEvent",'click .options li[data-type="this-page"]':"addEvent",'click .options li[data-type="new-page"]':"addToNewPageEvent"},addEvent:function(e){if(e.stopPropagation(),this.design){var t="1"===this.design.is_premium&&!this.canUse;this.keepImages=!0,t?this.displayLockedTemplateModal():this._addEvent()}},addToNewPageEvent:function(e){if(e.stopPropagation(),this.design){var t="1"===this.design.is_premium&&!this.canUse;this.keepImages=!1,t?this.displayLockedTemplateModal():o.handle("design","add").then(_.bind(this._addEvent,this))}},displayLockedTemplateModal:function(){var e=INKIVE.Modal.modalWindow(r({src:this.design.url}),{width:700,headerIcon:"fa fa-lock",headerTitle:"tool.templates.helper.title"});e.getWrapper().find(".modal").css("height",430),e.getWrapper().find(".content").css("padding",0),e.refresh()},_addEvent:function(e){i.prototype.addEvent.apply(this,arguments)},initialize:function(e){i.prototype.initialize.call(this),this.width=e.width,this.design=e.design,this.isCustomFormat=e.isCustomFormat,a.get().then(_.bind(function(e){function t(t){return _(e.roles).contains(t)}this.canUse=t("ROLE_PREMIUM")||INKIVE.Helpers.projectIsLinkedToRestrictions(),this.render(),this.initImageLoad()},this))},render:function(){i.prototype.render.apply(this,arguments),this.$el.toggleClass("locked",this.design&&"1"===this.design.is_premium&&!this.canUse),INKIVE.Helpers.initTooltips(this.$el)},getTemplateRenderData:function(){var e=this.isCustomFormat?this.canvas.contentW/this.canvas.contentH:this.design.format_width/this.design.format_height,t=this.width*(1/e);return{url:this.design.url,can_use:this.canUse,show_options:!0,is_premium_template:"1"===this.design.is_premium,thumb_height:Math.floor(t)}},initImageLoad:function(){function e(){var e=$(this);if(e.closest(".thumbnail.image").removeClass("loading"),t){var i=this.naturalWidth/this.naturalHeight,a=e.parent();a.height(e.height()).addClass("custom"),n>i&&e.removeAttr("height")}else e.removeAttr("height")}var t=this.isCustomFormat,n=this.canvas.contentW/this.canvas.contentH;this.$el.find("img").each(function(){this.onload=e,this.src=$(this).data("src")})},setTemplate:function(){i.prototype.setTemplate.apply(this,arguments),INKIVE.DesignFacade.set("template",{keep_stage_size:this.isCustomFormat,designed:{id:this.design.id}})},isSameSize:function(){return this.canvas.contentW==this.design.format_width&&this.canvas.contentH==this.design.format_height}})},{"../../../../facade/project/project":89,"../../../../factory/user-info":132,"./abstract/template":273,"./templates/locked-template.hbs":315,"./templates/template.hbs":322}],288:[function(e,t,n){var i=e("./abstract/template");e("../../../../facade/project/project"),e("./templates/locked-template.hbs");t.exports=i.extend({height:null,template:e("./templates/template.hbs"),addEvent:$.noop,initialize:function(e){i.prototype.initialize.call(this),this.width=e.width,this.format=e.format,this.design=e.design,this.isCustomFormat=e.isCustomFormat,this.render(),this.initImageLoad()},getTemplateRenderData:function(){return this.getFormatRenderData()},getFormatRenderData:function(){var e=56,t=this.format.thumb_width?this.format.thumb_width/this.format.thumb_height:this.format.width/this.format.height,n=this.width*(1/t);return _.extend(this.format,{url:this.format.url||this.format.thumbnail,is_single_line:n<e,thumb_width:Math.floor(this.format.thumb_width||this.format.width),thumb_height:Math.floor(n)})},initImageLoad:function(){function e(){var e=$(this);if(e.closest(".thumbnail.image").removeClass("loading"),t){var n=e.parent();n.height(e.height()).addClass("custom"),n.width()>e.width()&&e.width(n.width()).removeAttr("height")}else e.removeAttr("height")}var t=this.isCustomFormat;this.$el.find("img").each(function(){this.onload=e,this.src=$(this).data("src")})}})},{"../../../../facade/project/project":89,"./abstract/template":273,"./templates/locked-template.hbs":315,"./templates/template.hbs":322}],289:[function(e,t,n){var i=e("./abstract/template"),a=0;t.exports=i.extend({width:null,height:null,setCurrentPage:!1,template:e("./templates/grid.hbs"),designAddedEvent:"template.update.grid",initialize:function(e){i.prototype.initialize.call(this),this.setCurrentPage=e.setCurrentPage,this.size=e.size,this.format=e.format,this.numberOfPhotos=e.numberOfPhotos,this.processSVGData(e.data),this.render()},getTemplateRenderData:function(){return{defs:this.defs,content:this.svg,width:this.size.width,height:this.size.height}},processSVGData:function(e){function t(e,t){INKIVE.SVGPlaceholderImage.setClipsData(t);var n=/<image xmlns:xlink="[^"]*" id="([^"]*)" clip-path="url\(#([^"]*)\)" [^>]*">[^<]*<\/image>/g;return e.replace(n,function(e,t,n){var i=INKIVE.SVGPlaceholderImage.render(t,n);return i?i.svgString:e})}function n(e){return e.replace(/id="(.*?)"/g,'id="$1-thumb-'+a+'"')}function i(e){return e.replace(/clip-path="url\(#(.*?)\)"/g,'clip-path="url(#$1-thumb-'+a+')"')}a++,this.defs=n(e.defs),this.svg=t(e.svg,e.defs),this.svg=n(this.svg),this.svg=i(this.svg),this.name=e.name},setTemplate:function(){i.prototype.setTemplate.apply(this,arguments),INKIVE.DesignFacade.set("template",{size:this.format,setCurrentPage:this.setCurrentPage,grid:{index_in_set:this.name,number_of_photos:this.numberOfPhotos}})},isSameSize:function(){return this.canvas.contentW==this.format.width&&this.canvas.contentH==this.format.height}})},{"./abstract/template":273,"./templates/grid.hbs":308}],290:[function(e,t,n){var i=e("../abstract/base"),a=e("../../../../../facade/design/design"),o=e("../../../../../facade/editor/editor"),r=e("../../../../../analytics/decorate"),s=e("../../../../../facade/restrictions/decorate");t.exports=r(e("../analytics/library-color"),s(e("../restrict/library-color"),i.extend({template:e("../templates/library-color.hbs"),events:{mouseover:"overThumbnailEvent",'click ul.options li[data-type="font"]':"setFontColorEvent",'click ul.options li[data-type="fill"]':"setFillColorEvent",'click ul.options li[data-type="stroke"]':"setStrokeColorEvent",'click ul.options li[data-type="background"]':"setBackgroundColorEvent"},setBackgroundColorEvent:function(e){var t=$(e.currentTarget).closest(".color").find(".info .code").text();a.set("background",{color:t})},setFontColorEvent:function(e){function t(e){_.each(e,function(e){a.set(e.id,{color:r})})}function n(e){_.each(e,function(e){var t={};_.each(a.get(e.id,"texts"),function(e,n){t[n]={color:r}}),a.set(e.id,{texts:t})})}var i=this.getSelectionFacadeElements(),o=this.getElementsWithText(i),r=$(e.currentTarget).closest(".color").find(".info .code").text();t(_.filter(o,this.isText)),n(_.filter(o,this.isSticker))},setFillColorEvent:function(e){function t(e){_.each(e,function(e){a.set(e.id,{fill:{color:r}})})}function n(e){_.each(e,function(e){var t={};_.each(a.get(e.id,"shapes"),function(e,n){e.fill&&e.fill.color&&(t[n]={fill:{color:r}})}),a.set(e.id,{shapes:t})})}var i=this.getSelectionFacadeElements(),o=this.getElementsWithFill(i),r=$(e.currentTarget).closest(".color").find(".info .code").text();t(_.filter(o,this.isShape)),n(_.filter(o,this.isSticker))},setStrokeColorEvent:function(e){function t(e){_.each(e,function(e){a.set(e.id,{stroke:{color:s}})})}function n(e){_.each(e,function(e){a.set(e.id,{stroke:{color:s}})})}function i(e){_.each(e,function(e){var t={};_.each(a.get(e.id,"shapes"),function(e,n){e.stroke&&e.stroke.color&&0!==e.stroke.width&&(t[n]={stroke:{color:s}})}),a.set(e.id,{shapes:t})})}var o=this.getSelectionFacadeElements(),r=this.getElementsWithStroke(o),s=$(e.currentTarget).closest(".color").find(".info .code").text();t(_.filter(r,this.isText)),n(_.filter(r,this.isShape)),i(_.filter(r,this.isSticker))},overThumbnailEvent:function(e){var t=this.$el.find("ul.options li"),n=this.getSelectionFacadeElements();t.filter('[data-type="font"]').toggleClass("disabled",!this.getElementsWithText(n).length),t.filter('[data-type="fill"]').toggleClass("disabled",!this.getElementsWithFill(n).length),t.filter('[data-type="stroke"]').toggleClass("disabled",!this.getElementsWithStroke(n).length)},getSelectionFacadeElements:function(){var e=_.compact(_.toArray(this.canvas.getSelectedElems()));return _.map(e,function(e){return{type:o.getType(e),id:e.getAttribute("id")}})},getElementsWithText:function(e){var t=_.filter(e,this.isSticker);return _.union(_.filter(e,this.isText),_.filter(t,function(e){return!_.isEmpty(a.get(e.id,"texts"))}))},getElementsWithStroke:function(e){var t=_.filter(e,this.isText),n=_.filter(e,this.isShape),i=_.filter(e,this.isSticker);return _.union(_.filter(t,function(e){var t=a.get(e.id,"stroke");return t&&t.color&&0!==t.width}),_.filter(n,function(e){var t=a.get(e.id,"stroke");return t&&t.color&&0!==t.width}),_.filter(i,function(e){return _.any(a.get(e.id,"shapes"),function(e){return e.stroke&&e.stroke.color&&0!==e.stroke.width})}))},getElementsWithFill:function(e){var t=_.filter(e,this.isShape),n=_.filter(e,this.isSticker);return _.union(_.filter(t,function(e){return a.get(e.id,"fill.color")}),_.filter(n,function(e){return _.any(a.get(e.id,"shapes"),function(e){return e.fill&&e.fill.color})}))},isText:function(e){return"text"===e.type},isShape:function(e){return"shape"===e.type},isSticker:function(e){return"sticker"===e.type},initialize:function(e){this.item=e.item,i.prototype.initialize.call(this)},render:function(){this.$el.html(this.template(this.item))}})))},{"../../../../../analytics/decorate":5,"../../../../../facade/design/design":34,"../../../../../facade/editor/editor":76,"../../../../../facade/restrictions/decorate":90,"../abstract/base":272,"../analytics/library-color":275,"../restrict/library-color":302,"../templates/library-color.hbs":309}],291:[function(e,t,n){var i=e("../abstract/base"),a=e("../../../../../facade/design/design");t.exports=i.extend({template:e("../templates/library-folder.hbs"),addElement:function(e){a.create("image",_.extend({source:{url:this.item.data.thumb}},e))},initialize:function(e){var t=INKIVE.Tool.getInstance();this.item=e.item,this.editor=t.editor,this.canvas=this.editor.canvas,i.prototype.initialize.call(this)},render:function(){this.$el.html(this.template(this.item))}})},{"../../../../../facade/design/design":34,"../abstract/base":272,"../templates/library-folder.hbs":310}],292:[function(e,t,n){var i=e("./logo"),a=e("../abstract/base"),o=e("../../../../../facade/design/design"),r=e("../../../../../analytics/decorate");t.exports=r(e("../analytics/library-icon"),i.extend({addElement:function(e){this.iconOnPosition?(o.set(this.iconOnPosition.getAttribute("id"),{is_vector:1!=this.item.data.type,thumb_src:this.getSource()}),this.canvas.runExtensions("outIcon")):o.create("icon",_.extend({is_vector:1!=this.item.data.type,thumb_src:this.getSource()},e))},mouseMove:function(e){a.prototype.mouseMove.apply(this,arguments);var t=this.editor.getOffset();this.iconOnPosition=this.canvas.runExtensions("dragIcon",{thumb:this.getSource(),x:e.clientX-t.x,y:e.clientY-t.y}),this.draggableOpacity=this.iconOnPosition?.2:1}}))},{"../../../../../analytics/decorate":5,"../../../../../facade/design/design":34,"../abstract/base":272,"../analytics/library-icon":276,"./logo":294}],293:[function(e,t,n){var i=e("../abstract/base"),a=e("../../../../../facade/design/design"),o=e("../../../../../analytics/decorate");t.exports=o(e("../analytics/library-image"),i.extend({template:e("../templates/library-image.hbs"),events:{"touchstart .item":"mouseDown","mousedown .item":"mouseDown",'click ul.options li[data-type="background"]':"setBackgroundImageEvent",'click ul.options li[data-type="replace-image"]':"replaceImageEvent"},addElement:function(e,t){$(t).hasClass("replace-image")||a.create("image",_.extend({source:{url:this.getSource()}},e))},getMouseUpElementData:function(e){return _.extend({placeholder:!1},i.prototype.getMouseUpElementData.call(this,e))},initialize:function(e){var t=INKIVE.Tool.getInstance();this.item=e.item,this.editor=t.editor,this.canvas=this.editor.canvas,i.prototype.initialize.call(this),this.setImageListeners()},render:function(){this.$el.html(this.template(this.item)),this.$draggable=this.$el.find(".draggable")},mouseMove:function(e){i.prototype.mouseMove.apply(this,arguments);var t=this.editor.getOffset(),n=e.clientX,a=e.clientY,o=this.canvas.runExtensions("overLayoutImage",{elem:this.$draggableClone.get(0),mouse_x:n-t.x,mouse_y:a-t.y});this.layoutTarget=o},mouseUp:function(e){return e.preventDefault(),"background"==$(e.target).closest("li").attr("data-type")?void this.endDragging():(INKIVE.EditorFacade.editor.canvas._t.layout_prvElem&&(INKIVE.EditorFacade.editor.canvas._t.layout_prvElem=null,INKIVE.EditorFacade.editor.canvas._t.layout_prvAttr=null),this.layoutTarget&&this.dropOverLayoutbox(),void(this.layoutTarget||i.prototype.mouseUp.apply(this,arguments)))},dropOverLayoutbox:function(){this.endDragging(),a.set(this.layoutTarget.getAttribute("id"),{source:{url:this.getSource()}})},setImageListeners:function(){var e=new Image,t=this.$el;e.src=this.getSource(),e.onload=_.bind(function(){var n=e.width/e.height;t.find(".loading").addClass("disappear"),t.height(t.width()/n),t.find("img").attr("src",e.src),this.trigger("resize")},this),e.onerror=_.bind(function(){this.setSource(this.item.data.original),e.src=this.getSource(),e.onerror=_.bind(this.remove,this)},this)},setBackgroundImageEvent:function(e){e.preventDefault(),a.set("background",{source:this.getSource()})},replaceImageEvent:function(e){e.preventDefault();var t=this.canvas.getSelectedElems();1===t.length&&"image"===t[0].tagName&&$(t[0]).hasClass("element")?INKIVE.DesignFacade.set(t[0].id,{source:{url:this.getSource(),preload:!0},keep_box_size:!0}):this.canvas.call("advice.show","image-replacement-selection")},getSource:function(){return this.item.data.thumb},setSource:function(e){this.item.data.thumb=e}}))},{"../../../../../analytics/decorate":5,"../../../../../facade/design/design":34,"../abstract/base":272,"../analytics/library-image":277,"../templates/library-image.hbs":311}],294:[function(e,t,n){var i=e("../abstract/base"),a=e("../../../../../facade/design/design"),o=e("../../../../../analytics/decorate");t.exports=o(e("../analytics/library-logo"),i.extend({template:e("../templates/library-logo.hbs"),addElement:function(e){this.logoOnPosition?(a.set(this.logoOnPosition.getAttribute("id"),{is_vector:1!=this.item.data.type,thumb_src:this.getSource()}),this.canvas.runExtensions("outLogo")):a.create("logo",_.extend({is_vector:1!=this.item.data.type,thumb_src:this.getSource()},e))},initialize:function(e){this.item=e.item,i.prototype.initialize.call(this),this.setImageListeners()},render:function(){this.$el.html(this.template(this.item)),this.$draggable=this.$el.find(".draggable")},mouseMove:function(e){i.prototype.mouseMove.apply(this,arguments);var t=this.editor.getOffset();this.logoOnPosition=this.canvas.runExtensions("dragLogo",{thumb:this.getSource(),x:e.clientX-t.x,y:e.clientY-t.y}),this.draggableOpacity=this.logoOnPosition?.2:1},setImageListeners:function(){var e=new Image,t=this.$el;e.src=this.getSource(),e.onload=function(){t.find(".loading").addClass("disappear"),t.find("img.draggable").attr("src",e.src),t.find(".image").css("background-image",'url("'+e.src+'")')},e.onerror=_.bind(function(){this.setSource(this.item.data.original),e.src=this.getSource(),e.onerror=_.bind(this.remove,this)},this)},getSource:function(){var e=1==this.item.data.type;return e?this.item.data.thumb:this.item.data.original},setSource:function(e){this.item.data.thumb=e}}))},{"../../../../../analytics/decorate":5,"../../../../../facade/design/design":34,"../abstract/base":272,"../analytics/library-logo":278,"../templates/library-logo.hbs":312}],295:[function(e,t,n){var i=e("../abstract/base"),a=e("../../../../../facade/design/design"),o=e("../../../../../analytics/decorate");t.exports=o(e("../analytics/library-text"),i.extend({template:e("../templates/library-text.hbs"),addElement:function(e){var t=this.item.data;a.once("text.create",function(e){a.set(e.id,{color:t.color_code,spacing:{letter:t.letter_spacing,word:t.word_spacing,line:t.line_spacing},stroke:{color:t.stroke_width?t.stroke_color:null,width:t.stroke_width,dasharray:t.stroke_dasharray}})}),a.create("text",_.extend({content:t.default_content||t.name||t.family,decoration:t.underline?"underline":null,font:{family:t.family,size:t.size,weight:t.weight,style:t.italic?"italic":null}},e,{size:this.getContainerSize(t)}))},initialize:function(e){this.item=e.item,i.prototype.initialize.call(this)},render:function(){this.$el.html(this.template(this.item)),this.$draggable=this.$el.find(".draggable")},getContainerSize:function(e){var t=this.$el.find(".draggable"),n=t[0].getBoundingClientRect().width,i=n*(e.size/14);return{width:Math.floor4(i)}}}))},{"../../../../../analytics/decorate":5,"../../../../../facade/design/design":34,"../abstract/base":272,"../analytics/library-text":279,"../templates/library-text.hbs":313}],296:[function(e,t,n){var i=e("../abstract/base"),a=e("../../../../../facade/design/design");t.exports=i.extend({template:e("../templates/library-video.hbs"),addElement:function(t){function n(){var t=e("../../../../../modal/prompt"),n=new t({label:INKIVE.TranslateHelper.translate("modal.prompt.add_video_source")}),a=INKIVE.Modal.modalWindow(n.getFormHtml(),{width:400,headerIcon:"fa fa-film",headerTitle:"tool.customize.add_video",buttons:[{title:INKIVE.TranslateHelper.translate("modal.buttons.add_video"),onClick:function(){a.close(),n.getValue()&&i(n.getValue())}}]})}function i(e){a.create("video",_.extend({thumb_src:this.thumb||this.item.data.original,source:e},t))}i=_.bind(i,this),this.item.data.source&&i(this.item.data.source),this.item.data.source||n()},initialize:function(e){this.item=e.item,i.prototype.initialize.call(this),this.setImageListeners()},render:function(){this.$el.html(this.template(this.item)),this.$draggable=this.$el.find(".draggable")},setImageListeners:function(){var e=new Image,t=this.$el;e.src=INKIVE.Helpers.getCORSSecureUrl(this.item.data.thumb),e.onload=_.bind(function(){this.thumb=e.src,t.find(".loading").addClass("disappear"),t.find("img.draggable").attr("src",e.src),t.find(".image").css("background-image",'url("'+e.src+'")')},this),e.onerror=_.bind(function(){e.src=this.item.data.original,e.onerror=_.bind(this.remove,this)},this)}})},{"../../../../../facade/design/design":34,"../../../../../modal/prompt":139,"../abstract/base":272,"../templates/library-video.hbs":314}],297:[function(e,t,n){var i=e("../../../../../facade/design/design");t.exports=Backbone.View.extend({template:e("../templates/option-color.hbs"),events:{"click .item":"addElementEvent"},addElementEvent:function(){i.set("background",{color:this.item.color})},initialize:function(e){this.item=e.item,this.render()},render:function(){this.$el.html(this.template(this.item))}})},{"../../../../../facade/design/design":34,"../templates/option-color.hbs":316}],298:[function(e,t,n){var i=e("../abstract/base"),a=e("../../../../../facade/design/design");t.exports=i.extend({template:e("../templates/option-image.hbs"),getClickElementData:function(){return!0},getMouseUpElementData:function(){return this.layoutTarget},addElement:function(e){e&&a.set({
keep_box_size:!0,source:{url:this.item.source}})},initialize:function(e){var t=INKIVE.Tool.getInstance();this.item=e.item,this.selection=e.selection,this.editor=t.editor,this.canvas=this.editor.canvas,i.prototype.initialize.call(this),this.setImageListeners()},render:function(){this.$el.html(this.template(this.item)),this.$draggable=this.$el.find(".draggable")},mouseMove:function(e){i.prototype.mouseMove.apply(this,arguments);var t=this.editor.getOffset(),n=e.clientX,a=e.clientY,o=this.canvas.runExtensions("overLayoutImage",{elem:this.$draggableClone.get(0),selection:this.selection,mouse_x:n-t.x,mouse_y:a-t.y});this.layoutTarget=o},setImageListeners:function(){var e=new Image,t=this.$el;e.src=this.item.source,e.onload=_.bind(function(){var n=e.width/e.height;t.find(".loading").addClass("disappear"),t.height(t.width()/n),this.trigger("resize")},this)}})},{"../../../../../facade/design/design":34,"../abstract/base":272,"../templates/option-image.hbs":317}],299:[function(e,t,n){var i=e("../abstract/base"),a=e("../../../../../facade/design/design");t.exports=i.extend({template:e("../templates/option-logo.hbs"),getClickElementData:function(){return!0},getMouseUpElementData:function(){return this.logoOnPosition},addElement:function(e){this.logoOnPosition&&(this.canvas.runExtensions("outLogo"),this.logoOnPosition=null),e&&a.set(this.item)},initialize:function(e){var t=INKIVE.Tool.getInstance();this.item=e.item,this.selection=e.selection,this.editor=t.editor,this.canvas=this.editor.canvas,i.prototype.initialize.call(this),this.setImageListeners()},render:function(){this.$el.html(this.template(this.item)),this.$draggable=this.$el.find(".draggable")},mouseMove:function(e){i.prototype.mouseMove.apply(this,arguments);var t=this.editor.getOffset();this.logoOnPosition=this.canvas.runExtensions("dragLogo",{thumb:this.item.thumb_src,x:e.clientX-t.x,y:e.clientY-t.y}),this.draggableOpacity=this.logoOnPosition?.2:1},setImageListeners:function(){var e=new Image,t=this.$el;e.src=this.item.thumb_src,e.onload=_.bind(function(){var n=e.width/e.height;t.find(".loading").addClass("disappear"),t.height(t.width()/n),this.trigger("resize")},this)}})},{"../../../../../facade/design/design":34,"../abstract/base":272,"../templates/option-logo.hbs":318}],300:[function(e,t,n){var i=(e("../abstract/base"),e("../../../../../facade/design/design"));t.exports=Backbone.View.extend({template:e("../templates/option-text.hbs"),events:{"click .item":"setContentEvent"},setContentEvent:function(){i.set({content:this.item.content,text_content:this.item.content,force_redraw:!0})},initialize:function(e){this.item=e.item,this.selection=e.selection,this.render()},render:function(){var e=_.extend({family:this.selection.font.family,weight:this.selection.font.weight,italic:this.selection.font.style,underline:this.selection.decoration,word_spacing:this.selection.spacing.word,letter_spacing:this.selection.spacing.letter},this.item);this.$el.html(this.template(e))}})},{"../../../../../facade/design/design":34,"../abstract/base":272,"../templates/option-text.hbs":319}],301:[function(e,t,n){var i=e("../abstract/base"),a=e("../../../../../facade/design/design");t.exports=i.extend({template:e("../templates/option-video.hbs"),addElement:function(e){a.set(this.item)},mouseMove:function(e){},initialize:function(e){var t=INKIVE.Tool.getInstance();this.item=e.item,this.selection=e.selection,this.editor=t.editor,this.canvas=this.editor.canvas,i.prototype.initialize.call(this),this.setImageListeners()},render:function(){this.$el.html(this.template(this.item)),this.$draggable=this.$el.find(".draggable")},setImageListeners:function(){var e=new Image,t=this.$el;e.src=this.item.thumb_src,e.onload=_.bind(function(){var n=e.width/e.height;t.find(".loading").addClass("disappear"),t.height(t.width()/n),this.trigger("resize")},this)}})},{"../../../../../facade/design/design":34,"../abstract/base":272,"../templates/option-video.hbs":320}],302:[function(e,t,n){var i=e("../../../../../facade/restrictions/restrictions");t.exports={overThumbnailEvent:function(e){var t=this.$el.find("ul.options li"),n=this.getSelectionFacadeElements();this.backgroundPermissions||this.readBackgroundPermissions(),this.readColorChangePermissions(n),t.filter('[data-type="background"]').toggleClass("disabled",!this.canChangeBackgroundColor()),t.filter('[data-type="font"]').toggleClass("disabled",!this.getElementsWithText(n).length||!this.canChangeElementColor(["text_colour"])),t.filter('[data-type="fill"]').toggleClass("disabled",!this.getElementsWithFill(n).length||!this.canChangeElementColor(["vector_colour"])),t.filter('[data-type="stroke"]').toggleClass("disabled",!this.getElementsWithStroke(n).length||!this.canChangeElementColor(["text_colour","vector_colour"]))},canChangeBackgroundColor:function(){return _.any(this.backgroundPermissions,function(e){return e.basic&&e.basic.color})},canChangeElementColor:function(e){return _.any(this.colorChangePermissions,function(t){var n=!1;return _.each(e,function(e){t.basic&&t.basic[e]&&(n=!0)}),n})},readBackgroundPermissions:function(){this.backgroundPermissions=i.getAllElementPermissions("background")},readColorChangePermissions:function(e){e.length&&(this.colorChangePermissions=i.getAllElementPermissions(e[0].id))}}},{"../../../../../facade/restrictions/restrictions":94}],303:[function(e,t,n){var i=e("../../../../utils/md5"),a=e("./abstract/template"),o=e("../../../../facade/project/project"),r=(e("../../../../factory/company").instance,e("../../../../factory/user-info"),e("./templates/locked-template.hbs"),e("../../../../factory/restrictions"));t.exports=a.extend({height:null,setLoaded:!1,template:e("./templates/template.hbs"),designAddedEvent:"template.update.restricted",events:{"click .base":"addEvent",'click .options li[data-type="this-page"]':"addToCurrentPageEvent",'click .options li[data-type="new-page"]':"addToNewPageEvent","click .set ul li":"addPageEvent","click .set .close":"closeSetEvent"},closeSetEvent:function(){this.toggleSet(!1)},addToCurrentPageEvent:function(e){e.stopPropagation(),this.setTemplate()},addToNewPageEvent:function(e){e.stopPropagation(),o.handle("design","add").then(_.bind(this._setTemplate,this))},addEvent:function(e){this.baseTemplate.is_multipage?this.toggleSet():this.setTemplate()},addPageEvent:function(e){this.setTemplate($(e.currentTarget).index()+1)},setTemplate:function(e){this.page=e||1,INKIVE.Modal.togglePageLoader(!0),$.when(r.getTemplatePermissions(),r.getElementPermissions()).then(_.bind(function(e,t){INKIVE.Modal.togglePageLoader(!1),this.templatePermissions=e,this.elementPermissions=t;var n=INKIVE.C.BOOK.book_type==INKIVE.C.BOOK_TYPE.TEMPLATE&&(this.templatePermissions.length||this.templatePermissions.length);n&&this.displayModalOptions(),n||this._setTemplate()},this))},displayModalOptions:function(){var e=this.templatePermissions.length||this.elementPermissions.length;this.modal=INKIVE.Modal.modalWindow(INKIVE.TemplatesHelper("modal_restricted_template_load",{has_restrictions:e}),{width:600,headerIcon:"icon-cloud-download",headerTitle:"modal.title.change_name",buttons:[{title:INKIVE.TranslateHelper.translate("modal.buttons.apply_name"),onClick:this.acceptModal},{title:INKIVE.TranslateHelper.translate("general.cancel"),onClick:this.closeModal}]}),$('[data-id="'+this.modal.id+'"] [type=checkbox]').iCheck({checkboxClass:"icheckbox_square-yellow"})},acceptModal:function(){var e=$('input[name="copy-restrictions"]').is(":checked"),t=this.templatePermissions.length||this.elementPermissions.length;this.modal.close(),this._setTemplate(),t&&e&&this._copyRestrictions()},_copyRestrictions:function(){this._copyTemplatePermissions(this.templatePermissions),this._copyElementPermissions(this.elementPermissions)},_copyTemplatePermissions:function(e){if(_.size(e)){var t=Object.keys(e)[0],n=e[t];return r.setGlobalTemplateRestriction(t,n).then(_.bind(this._copyTemplatePermissions,this,_(e).omit(t)))}var i=$.Deferred();return i.resolve(),i.promise()},_copyElementPermissions:function(e){if(_.size(e)){var t=e.pop();return t.page_number==this.page?r.setGlobalElementRestriction(t.element_id,t.restrictions).then(_.bind(this._copyTemplatePermissions,this,e)):this._copyTemplatePermissions(e)}var n=$.Deferred();return n.resolve(),n.promise()},_setTemplate:function(){a.prototype.setTemplate.call(this),INKIVE.DesignFacade.set("template",{restricted:{page:this.page,id:this.baseTemplate.encoded_id}})},toggleSet:function(e){var t=this.$el.find(".set"),n="undefined"!=typeof e;n||t.toggleClass("collapsed"),n&&t.toggleClass("collapsed",!e),t.is(".collapsed")?t.removeAttr("style"):(this.setLoaded||(this.setLoaded=!0,this.initImageLoad(t)),t.height(t.find("ul").outerHeight(!0)+t.find(".line").outerHeight(!0)+t.find(".info").outerHeight(!0)))},initialize:function(e){a.prototype.initialize.call(this),this.width=e.width,this.format=e.format,this.baseTemplate=e.baseTemplate,this.render(),INKIVE.Helpers.initTooltips(this.$el),this.initImageLoad(this.$el.find(".base")),this.baseTemplate.is_multipage&&e.openSet&&this.toggleSet()},getTemplateRenderData:function(){function e(){return _.map(this.baseTemplate.pages,t,this)}function t(e){if(!e&&this.baseTemplate)return this.baseTemplate.cover;e=e||this.baseTemplate.pages[0];var t=i(e.design_id),n=INKIVE.Helpers.getBucketUrl(this.baseTemplate.master_bucket);return n+"/344/"+this.baseTemplate.encoded_id+"/"+t+".jpg?"+e.last_mod}var n=5,a=this.format.width/this.format.height,o=this.width*(1/a),r=(this.width-n)/2*(1/a);return{url:t.call(this),show_options:INKIVE.Helpers.isDesygnerProject()||INKIVE.C.BOOK.book_type==INKIVE.C.BOOK_TYPE.TEMPLATE,thumb_height:Math.floor(o),half_thumb_height:Math.floor(r),is_set:this.baseTemplate.is_multipage,name:this.baseTemplate.name||"Multiple pages set",set:e.call(this)}},initImageLoad:function(e){function t(){$(this).removeAttr("height").closest(".thumbnail.image").removeClass("loading")}e.find("img").each(function(){this.onload=t,this.src=$(this).data("src")})}})},{"../../../../facade/project/project":89,"../../../../factory/company":98,"../../../../factory/restrictions":122,"../../../../factory/user-info":132,"../../../../utils/md5":485,"./abstract/template":273,"./templates/locked-template.hbs":315,"./templates/template.hbs":322}],304:[function(e,t,n){var i=(e("../../../../facade/design/design"),e("../../../../facade/editor/editor")),a=e("./abstract/base");t.exports=a.extend({width:66,height:66,template:e("./templates/shape.hbs"),addElement:function(e){INKIVE.Tool.blinkScreen(),INKIVE.DesignFacade.create("shape",_.extend(e,{content:this.item.path}))},getClickElementData:function(e){var t=svgedit.utilities.getBBox(this.$draggableClone.find("svg path")[0]),n=Math.min(this.canvas.contentW,this.canvas.contentH);return n/=Math.max(t.width,t.height),{position:{x:(this.canvas.contentW-t.width*(n/2))/2,y:(this.canvas.contentH-t.height*(n/2))/2},size:{width:t.width*(n/2),height:t.height*(n/2)}}},getMouseUpElementData:function(e){var t=svgedit.utilities.getBBox(this.$draggableClone.find("svg path")[0]),n=this.$draggableClone.get(0).getBoundingClientRect(),a=i.handle("zoom","get"),o=this.editor.getOffset(),r=Math.min(this.canvas.contentW,this.canvas.contentH)/Math.max(t.width,t.height),s=$(e.target).parents(".root-popupmenu").length?{x:(this.canvas.contentW-t.width*(r/4))/2,y:(this.canvas.contentH-t.height*(r/4))/2}:{x:Math.floor4((n.left-o.x)/a),y:Math.floor4((n.top-o.y)/a)},l={width:Math.floor4(t.width*(r/4)),height:Math.floor4(t.height*(r/4))};return{position:s,size:l,selected:!$(e.target).parents(".root-popupmenu").length}},initialize:function(e){e.width&&(this.width=e.width),e.height&&(this.height=e.height),this.item=e.item,a.prototype.initialize.call(this)},getTemplateRenderData:function(){return{path:this.item.path,size:this.width,view_box:this.getViewBox(),stroke_width:1}},getViewBox:function(){var e=this.item.size,t=.05*e;return[-t,-t,e+2*t,e+2*t].join(" ")}})},{"../../../../facade/design/design":34,"../../../../facade/editor/editor":76,"./abstract/base":272,"./templates/shape.hbs":321}],305:[function(e,t,n){var i=e("../../../../utils/md5"),a=e("./abstract/template"),o=e("../../../../facade/design/design"),r=e("../../../../facade/project/project");t.exports=a.extend({height:null,template:e("./templates/template.hbs"),events:{"click .base":"addEvent",'click .options li[data-type="new-page"]':"addToNewPageEvent",'click .options li[data-type="this-page"]':"addToThisPageEvent"},addEvent:function(e){this.setOnNewPage()},addToNewPageEvent:function(e){e.stopPropagation(),this.setOnNewPage()},addToThisPageEvent:function(e){e.stopPropagation(),this.setTemplate()},setOnNewPage:function(){r.handle("design","add").then(this.setTemplate)},setTemplate:function(){this.editor.loadingElement(1),o.once("template.update.restricted",_.partial(this.editor.loadingElement,0)),o.set("template",{restricted:{keep_permissions:!0,page:this.pageNumber+1,id:this.baseTemplate.encoded_id}})},initialize:function(e){_.bindAll(this,"setTemplate","setOnNewPage"),a.prototype.initialize.call(this),this.width=e.width,this.format=e.format,this.pageNumber=e.pageNumber,this.baseTemplate=e.template,this.canChangePageOrder=e.canChangePageOrder,this.render(),this.initImageLoad(this.$el.find(".base"))},getTemplateRenderData:function(){function e(){var e=this.baseTemplate.pages[this.pageNumber],t=i(e.design_id),n=INKIVE.Helpers.getBucketUrl(this.baseTemplate.master_bucket);return n+"/344/"+this.baseTemplate.encoded_id+"/"+t+".jpg?"+e.last_mod}var t=this.format.width/this.format.height,n=this.width*(1/t);return{url:e.call(this),show_options:this.canChangePageOrder,thumb_height:Math.floor(n)}},initImageLoad:function(e){function t(){$(this).removeAttr("height").closest(".thumbnail.image").removeClass("loading")}e.find("img").each(function(){this.onload=t,this.src=$(this).data("src")})}})},{"../../../../facade/design/design":34,"../../../../facade/project/project":89,"../../../../utils/md5":485,"./abstract/template":273,"./templates/template.hbs":322}],306:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({1:function(e,t,n,i,a){return'<div class="uploader progress-button">\n  <svg class="progress-circle" width="70" height="70">\n    <path d="m35,2.5c17.955803,0 32.5,14.544199 32.5,32.5c0,17.955803 -14.544197,32.5 -32.5,32.5c-17.955803,0 -32.5,-14.544197 -32.5,-32.5c0,-17.955801 14.544197,-32.5 32.5,-32.5z"/>\n  </svg>\n\n  <svg class="checkmark" width="70" height="70">\n    <path d="m31.5,46.5l15.3,-23.2"/>\n    <path d="m31.5,46.5l-8.5,-7.1"/>\n  </svg>\n\n  <svg class="cross" width="70" height="70">\n    <path d="m35,35l-9.3,-9.3"/>\n    <path d="m35,35l9.3,9.3"/>\n    <path d="m35,35l-9.3,9.3"/>\n    <path d="m35,35l9.3,-9.3"/>\n  </svg>\n</div>\n'},3:function(e,t,n,i,a){return" hidden"},5:function(e,t,n,i,a){return'style="opacity: 0"'},7:function(e,t,n,i,a){var o,r=null!=t?t:e.nullContext||{},s=n.helperMissing,l="function",c=e.escapeExpression;return'<img id="'+c((o=null!=(o=n.id||(null!=t?t.id:t))?o:s,typeof o===l?o.call(r,{name:"id",hash:{},data:a}):o))+'" src="'+c((o=null!=(o=n.src||(null!=t?t.src:t))?o:s,typeof o===l?o.call(r,{name:"src",hash:{},data:a}):o))+'">'},9:function(e,t,n,i,a){var o=e.escapeExpression;return'  <div class="thumb_sticker" data-popover="tooltip" data-original-title="'+o((n.t||t&&t.t||n.helperMissing).call(null!=t?t:e.nullContext||{},"tool.images.times_used",t,{name:"t",hash:{},data:a}))+'">'+o(e.lambda(t,t))+"</div>\n"},compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){var o,r,s,l=null!=t?t:e.nullContext||{},c=n.helperMissing,d="function",u=n.blockHelperMissing,p="";return r=null!=(r=n.upload||(null!=t?t.upload:t))?r:c,s={name:"upload",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a},o=typeof r===d?r.call(l,s):r,n.upload||(o=u.call(t,o,s)),null!=o&&(p+=o),p+='\n<a class="item',r=null!=(r=n.image||(null!=t?t.image:t))?r:c,s={name:"image",hash:{},fn:e.noop,inverse:e.program(3,a,0),data:a},o=typeof r===d?r.call(l,s):r,n.image||(o=u.call(t,o,s)),null!=o&&(p+=o),p+='"',r=null!=(r=n.no_opacity||(null!=t?t.no_opacity:t))?r:c,s={name:"no_opacity",hash:{},fn:e.program(5,a,0),inverse:e.noop,data:a},o=typeof r===d?r.call(l,s):r,n.no_opacity||(o=u.call(t,o,s)),null!=o&&(p+=o),p+=">\n  ",r=null!=(r=n.image||(null!=t?t.image:t))?r:c,s={name:"image",hash:{},fn:e.program(7,a,0),inverse:e.noop,data:a},o=typeof r===d?r.call(l,s):r,n.image||(o=u.call(t,o,s)),null!=o&&(p+=o),p+="\n</a>\n\n",r=null!=(r=n.times_used||(null!=t?t.times_used:t))?r:c,s={name:"times_used",hash:{},fn:e.program(9,a,0),inverse:e.noop,data:a},o=typeof r===d?r.call(l,s):r,n.times_used||(o=u.call(t,o,s)),null!=o&&(p+=o),p},useData:!0})},{"hbsfy/runtime":535}],307:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({1:function(e,t,n,i,a){var o;return null!=(o=(n.neq||t&&t.neq||n.helperMissing).call(null!=t?t:e.nullContext||{},null!=t?t.color:t,"none",{name:"neq",hash:{},fn:e.program(2,a,0),inverse:e.noop,data:a}))?o:""},2:function(e,t,n,i,a){var o;return'style="background: '+e.escapeExpression((o=null!=(o=n.color||(null!=t?t.color:t))?o:n.helperMissing,"function"==typeof o?o.call(null!=t?t:e.nullContext||{},{name:"color",hash:{},data:a}):o))+'"'},compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){var o;return"<span "+(null!=(o=(n.neq||t&&t.neq||n.helperMissing).call(null!=t?t:e.nullContext||{},null!=t?t.color:t,"NONE",{name:"neq",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a}))?o:"")+"></span>\n"},useData:!0})},{"hbsfy/runtime":535}],308:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){var o,r,s=null!=t?t:e.nullContext||{},l=n.helperMissing,c="function",d=e.escapeExpression;return'<a class="item">\n  <svg width="'+d((r=null!=(r=n.width||(null!=t?t.width:t))?r:l,typeof r===c?r.call(s,{name:"width",hash:{},data:a}):r))+'" height="'+d((r=null!=(r=n.height||(null!=t?t.height:t))?r:l,typeof r===c?r.call(s,{name:"height",hash:{},data:a}):r))+'">\n    <defs>'+(null!=(r=null!=(r=n.defs||(null!=t?t.defs:t))?r:l,o=typeof r===c?r.call(s,{name:"defs",hash:{},data:a}):r)?o:"")+"</defs>\n    "+(null!=(r=null!=(r=n.content||(null!=t?t.content:t))?r:l,o=typeof r===c?r.call(s,{name:"content",hash:{},data:a}):r)?o:"")+"\n  </svg>\n</a>\n"},useData:!0})},{"hbsfy/runtime":535}],309:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({1:function(e,t,n,i,a){return" dark"},3:function(e,t,n,i,a){return'<span class="name">'+e.escapeExpression(e.lambda(t,t))+"</span><br>"},compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){var o,r=null!=t?t:e.nullContext||{},s=e.lambda,l=e.escapeExpression,c=n.helperMissing;return'<div class="color'+(null!=(o=n["if"].call(r,null!=(o=null!=t?t.data:t)?o.is_dark:o,{name:"if",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a}))?o:"")+'" style="background-color: '+l(s(null!=(o=null!=t?t.data:t)?o.color_code:o,t))+'">\n  <div class="info">\n    '+(null!=(o=n.blockHelperMissing.call(t,s(null!=(o=null!=t?t.data:t)?o.name:o,t),{name:"data.name",hash:{},fn:e.program(3,a,0),inverse:e.noop,data:a}))?o:"")+'\n    <span class="code">'+l(s(null!=(o=null!=t?t.data:t)?o.color_code:o,t))+'</span>\n  </div>\n\n  <div class="overlay">\n    <ul class="options">\n      <li data-type="fill" data-popover="tooltip" data-original-title="'+l((n.t||t&&t.t||c).call(r,"tool.library.tooltip.fill",{name:"t",hash:{},data:a}))+'"><i class="fa fa-circle"></i></li>\n      <li data-type="stroke" data-popover="tooltip" data-original-title="'+l((n.t||t&&t.t||c).call(r,"tool.library.tooltip.stroke",{name:"t",hash:{},data:a}))+'"><i class="fa fa-circle-o"></i></li>\n      <li data-type="font" data-popover="tooltip" data-original-title="'+l((n.t||t&&t.t||c).call(r,"tool.library.tooltip.font",{name:"t",hash:{},data:a}))+'"><i class="fa fa-font"></i></li>\n      <li data-type="background" data-popover="tooltip" data-original-title="'+l((n.t||t&&t.t||c).call(r,"popupmenu.tooltip.set_background",{name:"t",hash:{},data:a}))+'"><i class="fa fa-th"></i></li>\n    </ul>\n  </div>\n</div>\n'},useData:!0})},{"hbsfy/runtime":535}],310:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){var o;return'<div class="folder">\n  <a href="javascript:void(0)" class="folder-name">'+e.escapeExpression(e.lambda(null!=(o=null!=t?t.data:t)?o.name:o,t))+"</a>\n</div>\n"},useData:!0})},{"hbsfy/runtime":535}],311:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({1:function(e,t,n,i,a){var o;return"<span>"+e.escapeExpression(e.lambda(null!=(o=null!=t?t.data:t)?o.name:o,t))+"</span>"},compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){var o,r=null!=t?t:e.nullContext||{},s=n.helperMissing,l=e.escapeExpression;return'<div class="image item">\n  <div class="loading" style="background-image: url(\''+l((n.route||t&&t.route||s).call(r,"assets/img/editor/loading-128.gif",{name:"route",hash:{},data:a}))+'\')"></div>\n  <img class="draggable" src="'+l(e.lambda(null!=(o=null!=t?t.data:t)?o.thumb:o,t))+'" width="100%"/>\n\n  <div class="overlay image">\n    <ul class="options">\n      <li data-type="image" data-popover="tooltip" data-original-title="'+l((n.t||t&&t.t||s).call(r,"tool.library.tooltip.image",{name:"t",hash:{},data:a}))+'"><i class="fa fa-picture-o"></i></li>\n      <li data-type="replace-image" class="hidden" data-popover="tooltip" data-original-title="'+l((n.t||t&&t.t||s).call(r,"tool.images.tooltip.replace_image",{name:"t",hash:{},data:a}))+'"><i class="fa fa-file-image-o replace-image"></i></li>\n      <li data-type="background" data-popover="tooltip" data-original-title="'+l((n.t||t&&t.t||s).call(r,"popupmenu.tooltip.set_background",{name:"t",hash:{},data:a}))+'"><i class="fa fa-th"></i></li>\n    </ul>\n    '+(null!=(o=n["if"].call(r,null!=(o=null!=t?t.data:t)?o.name:o,{name:"if",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a}))?o:"")+"\n  </div>\n</div>\n"},useData:!0})},{"hbsfy/runtime":535}],312:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({1:function(e,t,n,i,a){var o;return"<span>"+e.escapeExpression(e.lambda(null!=(o=null!=t?t.data:t)?o.name:o,t))+"</span>"},compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){var o,r=null!=t?t:e.nullContext||{},s=e.escapeExpression;return'<div class="image item">\n  <div class="loading" style="background-image: url(\''+s((n.route||t&&t.route||n.helperMissing).call(r,"assets/img/editor/loading-128.gif",{name:"route",hash:{},data:a}))+'\')"></div>\n  <img class="draggable" src="'+s(e.lambda(null!=(o=null!=t?t.data:t)?o.thumb:o,t))+'" />\n  <div class="overlay">'+(null!=(o=n["if"].call(r,null!=(o=null!=t?t.data:t)?o.name:o,{name:"if",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a}))?o:"")+"</div>\n</div>\n"},useData:!0})},{"hbsfy/runtime":535}],313:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({1:function(e,t,n,i,a){return" dark"},3:function(e,t,n,i,a){var o;return"font-weight: "+e.escapeExpression(e.lambda(null!=(o=null!=t?t.data:t)?o.weight:o,t))+";"},5:function(e,t,n,i,a){return"font-style: italic;"},7:function(e,t,n,i,a){return"text-decoration: underline;"},9:function(e,t,n,i,a){var o;return"      "+(null!=(o=(n.ln2br||t&&t.ln2br||n.helperMissing).call(null!=t?t:e.nullContext||{},null!=(o=null!=t?t.data:t)?o.default_content:o,{name:"ln2br",hash:{},data:a}))?o:"")+"\n"},11:function(e,t,n,i,a){var o;return"      "+e.escapeExpression(e.lambda(null!=(o=null!=t?t.data:t)?o.name:o,t))+"\n"},13:function(e,t,n,i,a){var o;return" "+(null!=(o=(n.ln2br||t&&t.ln2br||n.helperMissing).call(null!=t?t:e.nullContext||{},null!=(o=null!=t?t.data:t)?o.default_content:o,{name:"ln2br",hash:{},data:a}))?o:"")+" "},compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){var o,r=null!=t?t:e.nullContext||{},s=e.lambda,l=e.escapeExpression,c=n.helperMissing;return'<div class="text item'+(null!=(o=n["if"].call(r,null!=(o=null!=t?t.data:t)?o.is_dark:o,{name:"if",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a}))?o:"")+'">\n  <span class="color">\n    <i class="fa fa-circle" style="color: '+l(s(null!=(o=null!=t?t.data:t)?o.color_code:o,t))+';"></i>\n  </span>\n  <span class="content">\n    <span class="name" style="\n      font-family: \''+l((n.font_quote||t&&t.font_quote||c).call(r,null!=(o=null!=t?t.data:t)?o.family:o,{name:"font_quote",hash:{},data:a}))+"';\n      letter-spacing: "+l(s(null!=(o=null!=t?t.data:t)?o.letter_spacing:o,t))+"px;\n      word-spacing: "+l(s(null!=(o=null!=t?t.data:t)?o.word_spacing:o,t))+"px;\n      "+(null!=(o=n["if"].call(r,null!=(o=null!=t?t.data:t)?o.weight:o,{name:"if",hash:{},fn:e.program(3,a,0),inverse:e.noop,data:a}))?o:"")+"\n      "+(null!=(o=n["if"].call(r,null!=(o=null!=t?t.data:t)?o.italic:o,{name:"if",hash:{},fn:e.program(5,a,0),inverse:e.noop,data:a}))?o:"")+"\n      "+(null!=(o=n["if"].call(r,null!=(o=null!=t?t.data:t)?o.underline:o,{name:"if",hash:{},fn:e.program(7,a,0),inverse:e.noop,data:a}))?o:"")+'">\n'+(null!=(o=n["if"].call(r,null!=(o=null!=t?t.data:t)?o.default_content:o,{name:"if",hash:{},fn:e.program(9,a,0),inverse:e.program(11,a,0),data:a}))?o:"")+'    </span>\n    <span class="size">['+l(s(null!=(o=null!=t?t.data:t)?o.size:o,t))+'pt]</span>\n  </span>\n  <div class="draggable" style="\n    font-family: \''+l((n.font_quote||t&&t.font_quote||c).call(r,null!=(o=null!=t?t.data:t)?o.family:o,{name:"font_quote",hash:{},data:a}))+"';\n    color: "+l(s(null!=(o=null!=t?t.data:t)?o.color_code:o,t))+";\n    letter-spacing: "+l(s(null!=(o=null!=t?t.data:t)?o.letter_spacing:o,t))+"px;\n    word-spacing: "+l(s(null!=(o=null!=t?t.data:t)?o.word_spacing:o,t))+"px;\n    "+(null!=(o=n["if"].call(r,null!=(o=null!=t?t.data:t)?o.weight:o,{name:"if",hash:{},fn:e.program(3,a,0),inverse:e.noop,data:a}))?o:"")+"\n    "+(null!=(o=n["if"].call(r,null!=(o=null!=t?t.data:t)?o.italic:o,{name:"if",hash:{},fn:e.program(5,a,0),inverse:e.noop,data:a}))?o:"")+"\n    "+(null!=(o=n["if"].call(r,null!=(o=null!=t?t.data:t)?o.underline:o,{name:"if",hash:{},fn:e.program(7,a,0),inverse:e.noop,data:a}))?o:"")+'">\n    '+(null!=(o=n["if"].call(r,null!=(o=null!=t?t.data:t)?o.default_content:o,{name:"if",hash:{},fn:e.program(13,a,0),inverse:e.noop,data:a}))?o:"")+"\n  </div>\n</div>\n"},useData:!0})},{"hbsfy/runtime":535}],314:[function(e,t,n){arguments[4][312][0].apply(n,arguments)},{dup:312,"hbsfy/runtime":535}],315:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){var o,r=null!=t?t:e.nullContext||{},s=n.helperMissing,l=e.escapeExpression;return'<div class="upgrade-modal">\n    <h2>'+l((n.t||t&&t.t||s).call(r,"tool.templates.helper.title",{name:"t",hash:{},data:a}))+'</h2>\n    <table>\n        <tr>\n            <td><img src="'+l((o=null!=(o=n.src||(null!=t?t.src:t))?o:s,"function"==typeof o?o.call(r,{name:"src",hash:{},data:a}):o))+'"></td>\n            <td><p>'+l((n.t||t&&t.t||s).call(r,"tool.templates.helper.description",{name:"t",hash:{},data:a}))+'</p></td>\n        </tr>\n    </table>\n    <!--<a class="video" target="_blank" href="/"><i class="icon-restriction_video"></i></a>-->\n\n    <a href="'+l((n.route||t&&t.route||s).call(r,"library?r=upgrade",{name:"route",hash:{},data:a}))+'" target="_blank" class="btn btn-primary locked">\n        '+l((n.t||t&&t.t||s).call(r,"general.upgrade_account",{name:"t",hash:{},data:a}))+'\n    </a>\n\n    <!--<a class="learnmore" target="_blank" href="/">'+l((n.t||t&&t.t||s).call(r,"general.learn_more",{name:"t",hash:{},data:a}))+"</a>-->\n</div>\n"},useData:!0})},{"hbsfy/runtime":535}],316:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){var o;return'<a class="item" style="background-color: '+e.escapeExpression((o=null!=(o=n.color||(null!=t?t.color:t))?o:n.helperMissing,"function"==typeof o?o.call(null!=t?t:e.nullContext||{},{name:"color",hash:{},data:a}):o))+'"></a>\n'},useData:!0})},{"hbsfy/runtime":535}],317:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){var o,r=null!=t?t:e.nullContext||{},s=n.helperMissing,l=e.escapeExpression;return'<a class="item">\n  <div class="loading" style="background-image: url(\''+l((n.route||t&&t.route||s).call(r,"assets/img/editor/loading-128.gif",{name:"route",hash:{},data:a}))+'\')"></div>\n  <img class="draggable" src="'+l((o=null!=(o=n.source||(null!=t?t.source:t))?o:s,"function"==typeof o?o.call(r,{name:"source",hash:{},data:a}):o))+'" />\n</a>\n'},useData:!0})},{"hbsfy/runtime":535}],318:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){var o,r=null!=t?t:e.nullContext||{},s=n.helperMissing,l=e.escapeExpression;return'<a class="item">\n  <div class="loading" style="background-image: url(\''+l((n.route||t&&t.route||s).call(r,"assets/img/editor/loading-128.gif",{name:"route",hash:{},data:a}))+'\')"></div>\n  <img class="draggable" src="'+l((o=null!=(o=n.thumb_src||(null!=t?t.thumb_src:t))?o:s,"function"==typeof o?o.call(r,{name:"thumb_src",hash:{},data:a}):o))+'" />\n</a>\n'},useData:!0})},{"hbsfy/runtime":535}],319:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({1:function(e,t,n,i,a){var o;return"font-weight: "+e.escapeExpression((o=null!=(o=n.weight||(null!=t?t.weight:t))?o:n.helperMissing,"function"==typeof o?o.call(null!=t?t:e.nullContext||{},{name:"weight",hash:{},data:a}):o))+";"},3:function(e,t,n,i,a){return"font-style: italic;"},5:function(e,t,n,i,a){return"text-decoration: underline;"},compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){var o,r,s=null!=t?t:e.nullContext||{},l=n.helperMissing,c="function",d=e.escapeExpression;return'<span class="item content" style="\n  font-family: '+d((r=null!=(r=n.family||(null!=t?t.family:t))?r:l,typeof r===c?r.call(s,{name:"family",hash:{},data:a}):r))+";\n  letter-spacing: "+d((r=null!=(r=n.letter_spacing||(null!=t?t.letter_spacing:t))?r:l,typeof r===c?r.call(s,{name:"letter_spacing",hash:{},data:a}):r))+"px;\n  word-spacing: "+d((r=null!=(r=n.word_spacing||(null!=t?t.word_spacing:t))?r:l,typeof r===c?r.call(s,{name:"word_spacing",hash:{},data:a}):r))+"px;\n  "+(null!=(o=n["if"].call(s,null!=t?t.weight:t,{name:"if",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a}))?o:"")+"\n  "+(null!=(o=n["if"].call(s,null!=t?t.italic:t,{name:"if",hash:{},fn:e.program(3,a,0),inverse:e.noop,data:a}))?o:"")+"\n  "+(null!=(o=n["if"].call(s,null!=t?t.underline:t,{name:"if",hash:{},fn:e.program(5,a,0),inverse:e.noop,data:a}))?o:"")+'">\n  '+d((r=null!=(r=n.content||(null!=t?t.content:t))?r:l,typeof r===c?r.call(s,{name:"content",hash:{},data:a}):r))+"\n</span>\n"},useData:!0})},{"hbsfy/runtime":535}],320:[function(e,t,n){arguments[4][318][0].apply(n,arguments)},{dup:318,"hbsfy/runtime":535}],321:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){var o,r=null!=t?t:e.nullContext||{},s=n.helperMissing,l="function",c=e.escapeExpression;return'<a class="item" href="#">\n  <svg xmlns="http://www.w3.org/2000/svg" width="'+c((o=null!=(o=n.size||(null!=t?t.size:t))?o:s,typeof o===l?o.call(r,{name:"size",hash:{},data:a}):o))+'" height="'+c((o=null!=(o=n.size||(null!=t?t.size:t))?o:s,typeof o===l?o.call(r,{name:"size",hash:{},data:a}):o))+'" viewBox="'+c((o=null!=(o=n.view_box||(null!=t?t.view_box:t))?o:s,typeof o===l?o.call(r,{name:"view_box",hash:{},data:a}):o))+'">\n    <path fill="#405E7F" stroke="#000" stroke-width="'+c((o=null!=(o=n.stroke_width||(null!=t?t.stroke_width:t))?o:s,typeof o===l?o.call(r,{name:"stroke_width",hash:{},data:a}):o))+'" d="'+c((o=null!=(o=n.path||(null!=t?t.path:t))?o:s,typeof o===l?o.call(r,{name:"path",hash:{},data:a}):o))+'" />\n  </svg>\n</a>\n'},useData:!0})},{"hbsfy/runtime":535}],322:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({1:function(e,t,n,i,a){return'data-original-title="'+e.escapeExpression(e.lambda(t,t))+'"'},3:function(e,t,n,i,a){var o,r,s,l=null!=t?t:e.nullContext||{},c=n.helperMissing,d="function",u=e.escapeExpression,p='  <p class="description';return r=null!=(r=n.is_single_line||(null!=t?t.is_single_line:t))?r:c,
s={name:"is_single_line",hash:{},fn:e.program(4,a,0),inverse:e.noop,data:a},o=typeof r===d?r.call(l,s):r,n.is_single_line||(o=n.blockHelperMissing.call(t,o,s)),null!=o&&(p+=o),p+'">\n    <label>'+u((r=null!=(r=n.name||(null!=t?t.name:t))?r:c,typeof r===d?r.call(l,{name:"name",hash:{},data:a}):r))+"</label>\n    <span>"+u((r=null!=(r=n.width||(null!=t?t.width:t))?r:c,typeof r===d?r.call(l,{name:"width",hash:{},data:a}):r))+"x"+u((r=null!=(r=n.height||(null!=t?t.height:t))?r:c,typeof r===d?r.call(l,{name:"height",hash:{},data:a}):r))+u((r=null!=(r=n.unit||(null!=t?t.unit:t))?r:c,typeof r===d?r.call(l,{name:"unit",hash:{},data:a}):r))+"</span>\n  </p>\n"},4:function(e,t,n,i,a){return" no-break"},6:function(e,t,n,i,a){var o,r,s,l=null!=t?t:e.nullContext||{},c=n.helperMissing,d="function",u=n.blockHelperMissing,p='  <div class="premium">\n    ';return r=null!=(r=n.can_use||(null!=t?t.can_use:t))?r:c,s={name:"can_use",hash:{},fn:e.program(7,a,0),inverse:e.noop,data:a},o=typeof r===d?r.call(l,s):r,n.can_use||(o=u.call(t,o,s)),null!=o&&(p+=o),p+="\n    ",r=null!=(r=n.can_use||(null!=t?t.can_use:t))?r:c,s={name:"can_use",hash:{},fn:e.noop,inverse:e.program(9,a,0),data:a},o=typeof r===d?r.call(l,s):r,n.can_use||(o=u.call(t,o,s)),null!=o&&(p+=o),p+"\n  </div>\n"},7:function(e,t,n,i,a){return'<i class="fa fa-unlock-alt" aria-hidden="true"></i>'},9:function(e,t,n,i,a){return'<i class="fa fa-lock" aria-hidden="true"></i>'},11:function(e,t,n,i,a){var o;return'<span class="set-size">'+e.escapeExpression(e.lambda(null!=(o=null!=t?t.set:t)?o.length:o,t))+"</span>"},13:function(e,t,n,i,a){var o=null!=t?t:e.nullContext||{},r=n.helperMissing,s=e.escapeExpression;return'  <div class="overlay template">\n    <div class="overlay-background"></div>\n    <ul class="options">\n      <li data-type="this-page" data-popover="tooltip" data-original-title="'+s((n.t||t&&t.t||r).call(o,"tool.templates.tooltip.this_page",{name:"t",hash:{},data:a}))+'"><i class="fa fa-th"></i></li>\n      <li data-type="new-page" data-popover="tooltip" data-original-title="'+s((n.t||t&&t.t||r).call(o,"tool.templates.tooltip.add_page",{name:"t",hash:{},data:a}))+'"><i class="fa fa-plus"></i></li>\n    </ul>\n  </div>\n'},15:function(e,t,n,i,a,o,r){var s,l,c=null!=t?t:e.nullContext||{};return'<div class="set collapsed">\n  <div class="line"><div class="triangle"></div></div>\n  <h3 class="info">'+e.escapeExpression((l=null!=(l=n.name||(null!=t?t.name:t))?l:n.helperMissing,"function"==typeof l?l.call(c,{name:"name",hash:{},data:a}):l))+'</h3>\n  <span class="close"><i class="fa fa-times"></i></span>\n  <ul>'+(null!=(s=n.each.call(c,null!=t?t.set:t,{name:"each",hash:{},fn:e.program(16,a,0,o,r),inverse:e.noop,data:a}))?s:"")+"</ul>\n</div>\n"},16:function(e,t,n,i,a,o,r){var s=e.lambda,l=e.escapeExpression;return'<!--\n  --><li><img data-src="'+l(s(t,t))+'" height="'+l(s(null!=r[1]?r[1].half_thumb_height:r[1],t))+'" /></li><!--\n  -->'},compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a,o,r){var s,l,c,d=null!=t?t:e.nullContext||{},u=n.helperMissing,p="function",h=e.escapeExpression,m='<div class="base">\n  <div class="image-wrapper">\n    <img data-src="'+h((l=null!=(l=n.url||(null!=t?t.url:t))?l:u,typeof l===p?l.call(d,{name:"url",hash:{},data:a}):l))+'" data-popover="tooltip" ';return l=null!=(l=n.name||(null!=t?t.name:t))?l:u,c={name:"name",hash:{},fn:e.program(1,a,0,o,r),inverse:e.noop,data:a},s=typeof l===p?l.call(d,c):l,n.name||(s=n.blockHelperMissing.call(t,s,c)),null!=s&&(m+=s),m+' height="'+h((l=null!=(l=n.thumb_height||(null!=t?t.thumb_height:t))?l:u,typeof l===p?l.call(d,{name:"thumb_height",hash:{},data:a}):l))+'" />\n  </div>\n  <span class="overlay"></span>\n'+(null!=(s=n["if"].call(d,null!=t?t.width:t,{name:"if",hash:{},fn:e.program(3,a,0,o,r),inverse:e.noop,data:a}))?s:"")+"\n"+(null!=(s=n["if"].call(d,null!=t?t.is_premium_template:t,{name:"if",hash:{},fn:e.program(6,a,0,o,r),inverse:e.noop,data:a}))?s:"")+"\n  "+(null!=(s=n["if"].call(d,null!=t?t.is_set:t,{name:"if",hash:{},fn:e.program(11,a,0,o,r),inverse:e.noop,data:a}))?s:"")+"\n\n"+(null!=(s=n["if"].call(d,null!=t?t.show_options:t,{name:"if",hash:{},fn:e.program(13,a,0,o,r),inverse:e.noop,data:a}))?s:"")+"</div>\n\n"+(null!=(s=n["if"].call(d,null!=t?t.is_set:t,{name:"if",hash:{},fn:e.program(15,a,0,o,r),inverse:e.noop,data:a}))?s:"")},useData:!0,useDepths:!0})},{"hbsfy/runtime":535}],323:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({1:function(e,t,n,i,a){return" applied"},3:function(e,t,n,i,a){var o,r,s,l='    <li class="underline-font">\n      <a class="btn btn-onmenu';return r=null!=(r=n.text_decoration||(null!=t?t.text_decoration:t))?r:n.helperMissing,s={name:"text_decoration",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a},o="function"==typeof r?r.call(null!=t?t:e.nullContext||{},s):r,n.text_decoration||(o=n.blockHelperMissing.call(t,o,s)),null!=o&&(l+=o),l+'" data-popover="tooltip" data-original-title="Underline" data-title="Underline">\n        <i class="icon-underline2"></i>\n      </a>\n    </li>\n'},compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){var o,r,s,l=null!=t?t:e.nullContext||{},c=n.helperMissing,d="function",u=e.escapeExpression,p=n.blockHelperMissing,h='<div class="line-container">\n  <a id="'+u((r=null!=(r=n.id||(null!=t?t.id:t))?r:c,typeof r===d?r.call(l,{name:"id",hash:{},data:a}):r))+'" class="item" data-popover="tooltip" data-original-title="'+u((r=null!=(r=n.font_family||(null!=t?t.font_family:t))?r:c,typeof r===d?r.call(l,{name:"font_family",hash:{},data:a}):r))+": "+u((r=null!=(r=n.font_size||(null!=t?t.font_size:t))?r:c,typeof r===d?r.call(l,{name:"font_size",hash:{},data:a}):r))+'" style="font-size: '+u((r=null!=(r=n.font_size||(null!=t?t.font_size:t))?r:c,typeof r===d?r.call(l,{name:"font_size",hash:{},data:a}):r))+"; font-family: '"+u((n.font_quote||t&&t.font_quote||c).call(l,null!=t?t.font_family:t,{name:"font_quote",hash:{},data:a}))+"'; font-weight: "+u((r=null!=(r=n.font_weight||(null!=t?t.font_weight:t))?r:c,typeof r===d?r.call(l,{name:"font_weight",hash:{},data:a}):r))+"; font-style: "+u((r=null!=(r=n.font_style||(null!=t?t.font_style:t))?r:c,typeof r===d?r.call(l,{name:"font_style",hash:{},data:a}):r))+"; text-decoration: "+u((r=null!=(r=n.text_decoration||(null!=t?t.text_decoration:t))?r:c,typeof r===d?r.call(l,{name:"text_decoration",hash:{},data:a}):r))+'">&nbsp;</a>\n\n  <input type="text" />\n  <a href="#" class="toggle-options"><i class="icon-sound-mix"></i></a>\n</div>\n\n<div class="menu options hidden">\n  <ul>\n    <li class="fonts-list">\n      <a class="btn btn-onmenu toggle">\n        <i class="icon-font"></i>\n        <span class="ui-dropdown-title">'+u((r=null!=(r=n.font_family||(null!=t?t.font_family:t))?r:c,typeof r===d?r.call(l,{name:"font_family",hash:{},data:a}):r))+'</span>\n        <i class="icon-unfold_more"></i>\n      </a>\n      <div class="ui-dropdown-items ui-dropdown-div hidden"></div>\n    </li>\n\n    <li class="bold-font">\n      <a class="btn btn-onmenu';return r=null!=(r=n.font_weight||(null!=t?t.font_weight:t))?r:c,s={name:"font_weight",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a},o=typeof r===d?r.call(l,s):r,n.font_weight||(o=p.call(t,o,s)),null!=o&&(h+=o),h+='" data-original-title="Bold" data-title="Bold">\n        <i class="icon-bold2"></i>\n      </a>\n    </li>\n\n    <li class="italic-font">\n      <a class="btn btn-onmenu',r=null!=(r=n.font_style||(null!=t?t.font_style:t))?r:c,s={name:"font_style",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a},o=typeof r===d?r.call(l,s):r,n.font_style||(o=p.call(t,o,s)),null!=o&&(h+=o),h+='" data-original-title="Italic" data-title="Italic">\n        <i class="icon-italic2"></i>\n      </a>\n    </li>\n\n',r=null!=(r=n.Mobile||(null!=t?t.Mobile:t))?r:c,s={name:"Mobile",hash:{},fn:e.noop,inverse:e.program(3,a,0),data:a},o=typeof r===d?r.call(l,s):r,n.Mobile||(o=p.call(t,o,s)),null!=o&&(h+=o),h+'\n    <li>\n      <a class="btn btn-onmenu begin-edit" data-popover="tooltip" data-original-title="'+u((n.t||t&&t.t||c).call(l,"popupmenu.dropdown_title.text_begin_edit",{name:"t",hash:{},data:a}))+'" data-title="'+u((n.t||t&&t.t||c).call(l,"popupmenu.dropdown_title.text_begin_edit",{name:"t",hash:{},data:a}))+'">\n        <i class="icon-edit"></i>\n      </a>\n    </li>\n  </ul>\n</div>\n'},useData:!0})},{"hbsfy/runtime":535}],324:[function(e,t,n){var i=e("./abstract/SVG"),a=e("../../../../analytics/decorate");t.exports=a(e("./analytics/text-banner"),i.extend({invertFilter:{"-webkit-filter":"grayscale(1) invert(1)",filter:"grayscale(1) invert(1)"},regularFilter:{"-webkit-filter":"grayscale(1)",filter:"grayscale(1)"},setImageListeners:function(e){var t=this.$el.find("img");t[0].crossOrigin="Anonymous",t.on("load",_.bind(this.processImage,this,t))},getTemplateRenderData:function(){return{no_opacity:!0,image:{src:this.svg.url}}},processImage:function(e){function t(){var t=$("<canvas>")[0],n=t.getContext("2d"),i=e.width(),a=e.height();return t.width=i,t.height=a,n.drawImage(e[0],0,0,i,a),n.getImageData(0,0,i,a).data}try{for(var n,i,a=127.5,o=t(),r=[],s=0,l=o.length;s<l;s+=4){var c=o[s+0],d=o[s+1],u=o[s+2];o[s+3]&&r.push((c+d+u)/3)}n=r.length,i=_.reduce(r,function(e,t){return e+t},0),r=i/n,e.css(r<a?this.invertFilter:this.regularFilter)}catch(p){e.css(this.invertFilter)}this.resize(),e.parent().css("opacity",1)}}))},{"../../../../analytics/decorate":5,"./abstract/SVG":271,"./analytics/text-banner":281}],325:[function(e,t,n){var i=e("./abstract/base"),a=e("./components/type-effect"),o=e("../../../../utils/humps"),r=e("../../../../app/decorate"),s=e("../../../../facade/design/design"),l=e("../../../../analytics/decorate"),c=e("../../../../facade/editor/editor");t.exports=l(e("./analytics/text"),r(e("./app/text"),i.extend({template:e("./templates/text.hbs"),width:null,height:null,events:_.extend({"click a.toggle-options":"toggleOptionsEvent","click  .btn.begin-edit":"startEditingEvent","blur .line-container input":"endEditingEvent","keyup .line-container input":"keyupEvent","keydown .line-container input":"keydownEvent","click .options .fonts-list":"displayFontFamiliesEvent","click .options .bold-font a":"toggleBoldFontEvent","click .options .italic-font a":"toggleItalicFontEvent","click .options .underline-font a":"toggleUnderlineFontEvent","click .options .fonts-list .ui-dropdown-items a":"changeFontFamilyEvent"},i.prototype.events),changeFontFamilyEvent:function(e){var t=this.$el.find(".line-container > .item"),n=this.$el.find(".options"),i=$(e.currentTarget).css("font-family");t.css({"font-family":i,"font-weight":"","font-style":"","text-decoration":""}),n.find(".fonts-list .ui-dropdown-title").text(this.getQuoteScaped(i)),n.find(".btn-onmenu").removeClass("applied"),this.toggleFontAvailableOptions($(e.currentTarget).data("fontid")),this.trigger("change")},getQuoteScaped:function(e){return e.replace(/^['|"](.*)['|"]$/,function(e,t){return t})},toggleBoldFontEvent:function(e){this.cssToggle(e,"font-weight","bold"),!this.currentFont.support.bi&&this.currentFont.support.i&&this.$el.find(".options .italic-font").toggleClass("disabled",$(e.currentTarget).hasClass("applied"))},toggleItalicFontEvent:function(e){this.cssToggle(e,"font-style","italic"),!this.currentFont.support.bi&&this.currentFont.support.b&&this.$el.find(".options .bold-font").toggleClass("disabled",$(e.currentTarget).hasClass("applied"))},toggleUnderlineFontEvent:function(e){this.cssToggle(e,"text-decoration","underline")},cssToggle:function(e,t,n){var i=this.$el.find(".line-container > .item"),a=$(e.currentTarget).toggleClass("applied");i.css(t,a.hasClass("applied")?n:""),this.trigger("change")},clickEvent:function(e){var t=this.isBeingEdit();t||this.addElement(this.getClickElementData(e))},mouseUpEvent:function(e){var t=this.isBeingEdit();t||this.addElement(this.getMouseUpElementData(e))},toggleOptionsEvent:function(e){var t=this.$el.height(),n=t>this.minimizedHeight,i=this.isBeingEdit();$(e.currentTarget).toggleClass("active"),n||this.startEditingEvent(),n&&this.$el.css("overflow","hidden"),n&&i&&this.blurEditableContent(),this.$el.height(n?this.minimizedHeight:this.fullHeight)},keydownEvent:function(e){13===e.which&&(e.preventDefault(),this.blurEditableContent())},keyupEvent:function(e){var t=this.$el.find(".line-container input").val()||"&nbsp;";this.$el.find(".line-container > .item .content").html(t)},blurEditableContent:function(){this.$el.find(".line-container input").blur()},startEditingEvent:function(e){var t=new Date;if(!(t-this.editEndTime<1e3)){this.preEditText=this.$el.find(".line-container > .item .content").text();var n=this.$el.find(".line-container input").val("").show();this.$el.css("overflow",""),this.$el.find(".btn.begin-edit").addClass("applied");var i=this.$el.find(".ui-dropdown-div");_.isEmpty(i.html())&&this.appendFontItems(i),this.erase().then(function(){n.focus()})}},appendFontItems:function(e){_.each(INKIVE.FontsFactory.getUsableFonts(),function(t,n){t.support.isDefault&&e.append('<a style="font-family: '+t.family.replace(/'/g,"\\'")+';" data-fontid="'+n+'">'+t.family+"</a>")})},endEditingEvent:function(e){var t=this.$el.find(".line-container input");this.$el.find(".btn.begin-edit").removeClass("applied"),this.editEndTime=new Date,t.val()?(this.endTyping(),this.trigger("change")):this.type(this.preEditText).then(_.bind(function(){this.endTyping()},this))},addElement:function(e){s.create("text",e)},getClickElementData:function(e){var t=this.editor.getOffset(),n=this.getBaseElementData(t),i=(t.width-n.size.width)/2;return _.extend(n,{position:{x:Math.floor4(i),y:Math.floor4((t.height-n.font.size)/2)}})},getMouseUpElementData:function(e){var t=c.handle("zoom","get"),n=this.editor.getOffset(),i=this.$draggableClone[0].getBoundingClientRect(),a=this.getBaseElementData(n),o=e.clientX-a.size.width/2*t-n.x;return _.extend(a,{position:{x:Math.floor4(o),y:Math.floor4((i.top-n.y)/t)}})},getBaseElementData:function(e){var t=this.editor.canvas,n=this.$el.find(".line-container > .item .content"),i=_.min([t.contentW,t.contentH]),a=n[0].getBoundingClientRect().width,o=Math.round(i*this.data.size),r=a*(o/25),s=this.getTextData();return{content:s.text,decoration:s.textDecoration,font:{family:s.fontFamily,weight:s.fontWeight,style:s.fontStyle,size:o},size:{width:Math.floor4(r)}}},initialize:function(e){_.bindAll(this,"type","erase","refresh","initAccordion","getTextData"),this.data=e.data,i.prototype.initialize.call(this)},refresh:function(){var e=this.$el.find(".menu.options");this.minimizedHeight=this.$el.find(".line-container").height(),this.$el.height(this.minimizedHeight),this.fullHeight=this.minimizedHeight+e.outerHeight()},initAccordion:function(){var e=this.$el.find(".menu.options");this.minimizedHeight=this.$el.height(),this.$el.height(this.minimizedHeight),e.removeClass("hidden"),this.fullHeight=this.minimizedHeight+e.outerHeight(),this.$draggable=this.$el.find("a.item > .content"),this.toggleFontAvailableOptions()},render:function(){i.prototype.render.call(this),this.$el.find(".fonts-list").popupmenudropdown({left:0,onShow:_.bind(function(){this.$el.css("overflow","visible").find(".line-container input").hide()},this),forceBottom:!0}),this.$el.find(".fonts-list .ui-dropdown-items").removeClass("hidden");var e=this.$el.find(".line-container > .item").height();this.$el.find(".line-container > .item").height(e)},getTemplateRenderData:function(){return _.extend(this.data,{id:this.data.uuid,font_size:this.data.font_size+"px",fonts:[]})},type:function(e){var t=e||this.data.text;return this.typeEffect=this.typeEffect||new a(this.$el.find("a.item")),this.typeEffect.startTyping(t)},erase:function(){return this.typeEffect=this.typeEffect||new a(this.$el.find("a.item")),this.typeEffect.startErasing()},endTyping:function(){this.typeEffect.hide(),this.$el.find(".menu.options").hasClass("hidden")&&this.initAccordion()},isBeingEdit:function(){return this.$el.find(".line-container input").is(":focus")},toggleFontAvailableOptions:function(e){function t(){var e=this.$el.find(".fonts-list .ui-dropdown-title"),t=e.text();return INKIVE.FontsFactory.get(t)}var n=this.$el.find(".options"),i=INKIVE.FontsFactory.get();this.currentFont=e?i[e]:t.call(this),this.currentFont&&(n.find(".bold-font").toggleClass("disabled",!this.currentFont.support.b),n.find(".italic-font").toggleClass("disabled",!this.currentFont.support.i))},createDraggableClone:function(){var e=i.prototype.createDraggableClone.call(this);return e.css(_.omit(this.getTextData("-"),"text")),e},setTextData:function(e){var t=this.$el.find(".line-container > .item .content"),n=this.$el.find(".options");e=o.camelizeKeys(e),e.text&&t.text(e.text),t.css("font-family",e.fontFamily),this.$el.find(".fonts-list .ui-dropdown-title").text(e.fontFamily),this.toggleFontAvailableOptions(),n.find(".bold-font a").toggleClass("applied",e.fontWeight||!1),t.css("font-weight",e.fontWeight),n.find(".italic-font a").toggleClass("applied",e.fontStyle||!1),t.css("font-style",e.fontStyle),n.find(".underline-font a").toggleClass("applied",e.textDecoration||!1),t.css("text-decoration",e.textDecoration)},getTextData:function(e){var t=this.$el.find(".line-container > .item .content"),n=this.$el.find(".options"),i={fontFamily:this.getQuoteScaped(t.css("font-family")),text:"&nbsp;"===t.text()?this.preEditText:t.text()};return n.find(".bold-font a").hasClass("applied")&&(i.fontWeight=t.css("font-weight")),n.find(".italic-font a").hasClass("applied")&&(i.fontStyle=t.css("font-style")),n.find(".underline-font a").hasClass("applied")&&(i.textDecoration=t.css("text-decoration")),e?o.decamelizeKeys(i,{separator:e}):i}})))},{"../../../../analytics/decorate":5,"../../../../app/decorate":8,"../../../../facade/design/design":34,"../../../../facade/editor/editor":76,"../../../../utils/humps":482,"./abstract/base":272,"./analytics/text":282,"./app/text":283,"./components/type-effect":285,"./templates/text.hbs":323}],326:[function(e,t,n){var i=e("./abstract/base"),a=e("./components/upload-effect.js");t.exports=i.extend({events:{"click .uploader.progress-button.loading":"cancelEvent"},cancelEvent:function(e){this.trigger("cancel"),this.cancel()},cancel:function(){this.canceled=!0,this.progressBar.setProgress(0)},initialize:function(){this.attemptsLeft=3,this.attemptDelay=2e3,i.prototype.initialize.call(this),_.bindAll(this,"setImage","onImageLoaded","onImageError","cancel")},render:function(){var e=this.template(this.getTemplateRenderData());this.$el.html(e).css({width:122.5,height:86}),this.progressBar=new a(this.$el.find(".progress-button")[0])},toggleProgressBar:function(e){e&&this.progressBar._submit()},updateProgressBar:function(e){this.canceled||(this.progressBar.setProgress(e),1===e&&this.progressBar.stop(1))},setImage:function(e,t){if(!this.canceled){var n=$("<img>").attr("id",e).attr("src",t).on("error",this.onImageError).on("load",this.onImageLoaded);t.match("/original/")&&_.delay(_.bind(function(){this.$el.find("a.item").is(".loaded")||n.attr("src","")},this),1e4),this.$el.find("a.item").removeClass("hidden").append(n)}},onImageLoaded:function(){var e=this.$el.find(".uploader");this.$el.find("a.item").addClass("loaded"),this.progressBar.clear(),this.resize(),_.delay(function(){e.remove()},1e3)},onImageError:function(e){var t=$(e.currentTarget),n=--this.attemptsLeft>0;1===this.attemptsLeft&&t.attr("src",INKIVE.ImagesFactory.getVersionUrl(t.attr("src"),"original"));var i=_.partial(this.setImage,t.attr("id"),t.attr("src"));t.remove(),n&&_.delay(i,this.attemptDelay),n||(this.progressBar.setProgress(0),this.trigger("thumbnail_load_error"))},getTemplateRenderData:function(){return{upload:!0}}})},{"./abstract/base":272,"./components/upload-effect.js":286}],327:[function(e,t,n){t.exports={eventCategory:"Editor UI | Tool Menu | customize | background",render:function(){this.trackEvent({eventAction:"show",eventLabel:this.category.id})}}},{}],328:[function(e,t,n){t.exports={eventCategory:"Editor UI | Tool Menu | customize | grids",render:function(){this.trackEvent({eventAction:"show",eventLabel:""})}}},{}],329:[function(e,t,n){t.exports={eventCategory:"Editor UI | Tool Menu | customize | placeholders",render:function(){this.trackEvent({eventAction:"show",eventLabel:this.categoryKey})}}},{}],330:[function(e,t,n){t.exports={eventCategory:"Editor UI | Tool Menu | customize | shapes",render:function(){this.trackEvent({eventAction:"show",eventLabel:this.categoryKey})}}},{}],331:[function(e,t,n){t.exports={eventCategory:"Editor UI | Tool Menu | customize | stickers",render:function(){this.trackEvent({eventAction:"show",eventLabel:this.category.id})}}},{}],332:[function(e,t,n){var i=e("../../../components/accordion-list/content"),a=e("../../../../../analytics/decorate"),o=e("../../../../../factory/formats"),r=e("../../../components/thumbnail/grid");t.exports=a(e("../../analytics/grids"),i.extend({apiCall:"grid/fetch",columnWidth:INKIVE.C.IS_MOBILE?210:255,numberOfPhotos:0,initialize:function(){this.tool=INKIVE.Tool.getInstance(),this.canvas=this.tool.editor.canvas,this.getFormat().then(_.bind(function(){this.setGridTemplateFormat(),i.prototype.initialize.call(this)},this))},getFormat:function(){function e(e){function t(e){var t=INKIVE.Helpers.convertUnitsToPixels(e.width,e.unit),n=INKIVE.Helpers.convertUnitsToPixels(e.height,e.unit);return _.extend(e,{width:t,height:n,ratio:t/n})}var n,i=1/0,a=1/0,o=this.canvas.contentW,r=this.canvas.contentH,s=o/r;return _.each(e,function(e){var l,c=t(e),d=Math.abs(s-c.ratio);d<a&&(l=Math.abs(o-c.width)+Math.abs(r-c.height),l<i&&(n=e,i=l,a=d))}),n}var t=$.Deferred(),n=_.bind(e,this);return o.getFormats().then(function(e){t.resolve(n(e))}),t.promise()},loadData:function(e,t){var n=_.partial(this.onMoreData,this.filterActionId);this.end=t,this.repeat=e,INKIVE.Modal.loader(this.$el.find(".antiscroll-inner")),INKIVE.Helpers.sendCmd(INKIVE.C.BASE_URL+this.apiCall,this.getParams(),n),this.$el.find(".thumbnail-wrapper").css({height:"auto"})},getParams:function(){return _.extend({number_of_photos:++this.numberOfPhotos},this.size)},onMoreData:function(e,t){if(e===this.filterActionId){t=JSON.parse(t);var n="SUCCESS"===t.STATUS;n?(this.appendGridThumbnails(t.MESSAGE),this.repeat()):(this.end(),INKIVE.Modal.loaderClose(this.$el.find(".antiscroll-inner"))),this.scrollRefresh()}},appendGridThumbnails:function(e){var t=this.$el.find(".thumbnail-wrapper .scrollDetect");_.each(e,function(e){var n=$("<div>").addClass("thumbnail grid").insertBefore(t);new r({setCurrentPage:!0,el:n,size:this.size,format:this.callFormat,data:e,numberOfPhotos:this.numberOfPhotos})},this)},setGridTemplateFormat:function(){var e=this.columnWidth,t=this.tool.editor.canvas;this.callFormat={width:t.contentW,height:t.contentH},this.size={width:e,height:e*(this.callFormat.height/this.callFormat.width)}},getScrollHeight:function(e){var t=e.closest(".tab-content.inner-tabs"),n=t.height();return n-=t.find(".header-links").height()}}))},{"../../../../../analytics/decorate":5,"../../../../../factory/formats":101,"../../../components/accordion-list/content":252,"../../../components/thumbnail/grid":289,"../../analytics/grids":328}],333:[function(e,t,n){var i=e("../../../components/accordion-list/content"),a=e("../../../components/thumbnail/color"),o=e("../../../../../analytics/decorate");t.exports=o(e("../../analytics/backgrounds"),i.extend({apiCall:"search/backgrounds",dataName:"backgroundCategories",callbackName:"callbackImages",where:{},initialize:function(e){this.category=_.find(INKIVE.Tool._cache.backgroundCategories,function(t){return t.id==e.key}),i.prototype.initialize.call(this,e)},getParams:function(){var e={from:this.from,limit:this.limit,where:{category:this.category.name}};return this.from+=this.limit,e},extractData:function(e){return _.map(e,function(e){var t=this.getImageData(e);return this.imagesFactory.addImageData(t),{id:"background-"+e.id,src:t.version.thumb,cls:parseInt(e.active)?"":" grayscale",data:t,width:125,height:78}},this)},getImageData:function(e){return{name:e.readable_name,count:e.count,version:{original:e.url,largeweb:e.url,web:e.url,tab:e.url,mobile:e.url&&e.url.replace("-web","-mobile"),thumb:e.url&&e.url.replace("-web","-thumb")}}},getScrollHeight:function(e){return e.closest(".tab-content").height()-this.$el.siblings().height()},render:function(){this.$el.html(this.template({placeholder:this.filterPlaceholder,colors:!0})),this.$el.find(".antiscroll-inner").addThumb(),this.renderColors()},renderColors:function(){this.$el.find(".colorLineWrapper .addmore");_.each(this.tool.editor.getFavColors(),this.addColorThumb,this),this.initColorPicker()},addColorThumb:function(e){var t=$('<div class="palette-item">');new a({el:t,color:e});t.insertBefore(this.$el.find(".colorLineWrapper .addmore"))},initColorPicker:function(){var e=this.$el.find(".colorLineWrapper");e.find(".addmore").colorpicker({defaultColor:"#FFFFFF",onSubmit:_.bind(function(e,t){this.addColorThumb(e)},this)})}}))},{"../../../../../analytics/decorate":5,"../../../components/accordion-list/content":252,"../../../components/thumbnail/color":284,"../../analytics/backgrounds":327}],334:[function(e,t,n){var i=e("../../../components/accordion-list/content"),a=(e("../../../components/thumbnail/color"),e("../../../../../analytics/decorate"));t.exports=a(e("../../analytics/stickers"),i.extend({apiCall:"search/stickers",dataName:"stickerCategories",callbackName:"callbackStickers",where:{},initialize:function(e){this.category=_.find(INKIVE.Tool._cache.stickerCategories,function(t){return t.id==e.key}),i.prototype.initialize.call(this,e)},getScrollHeight:function(e){return e.closest(".tab-content").height()-this.$el.siblings().height()},getParams:function(){var e={from:this.from,limit:this.limit,where:{category:this.category.name,active:INKIVE.C.USER.IS_SUPER?0:1}};return this.from+=this.limit,e},extractData:function(e){return _.map(e,function(e){return{id:"sticker-"+e.id,src:e.url,width:e.width,height:e.height,cls:parseInt(e.active)?"":" grayscale",data:{name:e.name,count:e.count,changeable:e.changeable,width:e.width,height:e.height}}})}}))},{"../../../../../analytics/decorate":5,"../../../components/accordion-list/content":252,"../../../components/thumbnail/color":284,"../../analytics/stickers":331}],335:[function(e,t,n){var i=e("../../../components/accordion-list/categories-director"),a=e("./stickers");t.exports=i.extend({"class":"sub-category stickers",CategoriesView:a,views:{},loadButtons:function(){var e=$.Deferred();return INKIVE.Tool.preloadStickerCategories(function(){var t=INKIVE.Tool._cache.stickerCategories;e.resolve(_.map(t,function(e){return{key:e.id,tag:e.name,icon:"fa fa-ellipsis-v"}}))}),e.promise()},initialize:function(){i.prototype.initialize.call(this),this.render()}})},{"../../../components/accordion-list/categories-director":250,"./stickers":334}],336:[function(e,t,n){var i=e("./components/helper/view"),a=e("../../facade/editor/editor"),o={text:e("./element-options/text/handler"),logo:e("./element-options/logo/handler"),image:e("./element-options/image/handler"),video:e("./element-options/video/handler"),background:e("./element-options/background/handler")},r={text:e("./element-options/text/view"),logo:e("./element-options/logo/view"),image:e("./element-options/image/view"),video:e("./element-options/video/view"),background:e("./element-options/background/view")},s=i.extend({initialize:function(e){i.prototype.initialize.call(this),this.render(),a.on("select",_.bind(this.onElementSelection,this))},onElementSelection:function(e){if(1===e.length){var t=e[0],n=t.type;if(o[n]&&r[n]&&o[n].haveOptions(t))return this.contentView&&this.contentView.remove(),this.contentView=new r[n]({el:$("<div>").appendTo(this.$el.find(".helper-content")),selection:t}),this.$el.find("h2").text(INKIVE.TranslateHelper.translate("tool.restricted.option."+n)),this.$el.removeClass("out").find(".helper-content").scrollTop(0),void _.defer(_.bind(this._toggle,this,!0))}this._toggle(!1)},_toggle:function(e){this.$el.toggleClass("show",e),this.$el.toggleClass("out",!e),this.trigger("toggle",this.$el.hasClass("show"))},render:function(e){this.$el.html(this.template())}});t.exports=new s({el:$('<div id="element-options">').appendTo("#tool-panel .tool-content")})},{"../../facade/editor/editor":76,"./components/helper/view":264,"./element-options/background/handler":337,"./element-options/background/view":339,"./element-options/image/handler":340,"./element-options/image/view":342,"./element-options/logo/handler":343,"./element-options/logo/view":345,"./element-options/text/handler":346,"./element-options/text/view":348,"./element-options/video/handler":349,"./element-options/video/view":351}],337:[function(e,t,n){var i=e("../../../../facade/restrictions/decorate");t.exports=i({haveOptions:function(t){var n=e("../../../../facade/restrictions/restrictions"),i=_.partial(n.getElementRestrictions,t.id);return i("images").length||i("colors").length}},{haveOptions:function(){return!1}})},{"../../../../facade/restrictions/decorate":90,"../../../../facade/restrictions/restrictions":94}],338:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){return'<div class="color-list content"></div>\n<div class="image-list content"></div>\n'},useData:!0})},{"hbsfy/runtime":535}],339:[function(e,t,n){var i=e("../../../../facade/restrictions/restrictions"),a=e("../../components/thumbnail/options/color"),o=e("../../components/thumbnail/options/image");t.exports=Backbone.View.extend({template:e("./template.hbs"),initialize:function(e){this.selection=e.selection;var t=_.partial(i.getElementRestrictions,this.selection.id),n=_.chain(t("colors")).pluck("list").flatten().value(),a=_.chain(t("images")).pluck("list").flatten().value();this.render(n,a)},render:function(e,t){this.$el.html(this.template()),_(e).each(this.addColorThumbnail,this),_(t).each(this.addImageThumbnail,this)},addImageThumbnail:function(e,t){var n=this.getNewView(t);new o({el:n,item:{source:e},selection:this.selection}),this.$el.find(".image-list").append(n)},addColorThumbnail:function(e,t){var n=this.getNewView(t,"third");new a({el:n,item:{color:e},selection:this.selection}),this.$el.find(".color-list").append(n)},getNewView:function(e,t){return $('<div class="thumbnail">').addClass(t).css({"-webkit-transition-delay":"."+e+"s","transition-delay":"."+e+"s"})},remove:function(){this.undelegateEvents(),this.$el.removeData().unbind(),Backbone.View.prototype.remove.call(this)}})},{"../../../../facade/restrictions/restrictions":94,"../../components/thumbnail/options/color":297,"../../components/thumbnail/options/image":298,"./template.hbs":338}],340:[function(e,t,n){var i=e("../../../../facade/restrictions/decorate");t.exports=i({haveOptions:function(t){var n=e("../../../../facade/restrictions/restrictions"),i=_.partial(n.getElementRestrictions,t.id);return i("source").length}},{haveOptions:function(){return!1}})},{"../../../../facade/restrictions/decorate":90,"../../../../facade/restrictions/restrictions":94}],341:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){return'<div class="image-list content"></div>\n'},useData:!0})},{"hbsfy/runtime":535}],342:[function(e,t,n){var i=e("../../../../facade/restrictions/restrictions"),a=e("../../components/thumbnail/options/image");t.exports=Backbone.View.extend({template:e("./template.hbs"),initialize:function(e){this.selection=e.selection;var t=_.partial(i.getElementRestrictions,this.selection.id);this.render(_.chain(t("source")).pluck("list").flatten().value())},render:function(e){this.$el.html(this.template()),_(e).each(this.addThumbnail,this)},addThumbnail:function(e,t){var n=$('<div class="thumbnail">').css({"-webkit-transition-delay":"."+t+"s","transition-delay":"."+t+"s"});new a({el:n,item:{source:e},selection:this.selection});this.$el.find(".image-list").append(n)},remove:function(){this.undelegateEvents(),this.$el.removeData().unbind(),Backbone.View.prototype.remove.call(this)}})},{"../../../../facade/restrictions/restrictions":94,
"../../components/thumbnail/options/image":298,"./template.hbs":341}],343:[function(e,t,n){arguments[4][340][0].apply(n,arguments)},{"../../../../facade/restrictions/decorate":90,"../../../../facade/restrictions/restrictions":94,dup:340}],344:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){return'<div class="logo-list content"></div>\n'},useData:!0})},{"hbsfy/runtime":535}],345:[function(e,t,n){var i=e("../../../../facade/restrictions/restrictions"),a=e("../../components/thumbnail/options/logo");t.exports=Backbone.View.extend({template:e("./template.hbs"),initialize:function(e){this.selection=e.selection;var t=_.partial(i.getElementRestrictions,this.selection.id);this.render(_.chain(t("source")).pluck("list").flatten().value())},render:function(e){this.$el.html(this.template()),_(e).each(this.addThumbnail,this)},addThumbnail:function(e,t){var n=$('<div class="thumbnail">').css({"-webkit-transition-delay":"."+t+"s","transition-delay":"."+t+"s"});new a({el:n,item:e,selection:this.selection});this.$el.find(".logo-list").append(n)},remove:function(){this.undelegateEvents(),this.$el.removeData().unbind(),Backbone.View.prototype.remove.call(this)}})},{"../../../../facade/restrictions/restrictions":94,"../../components/thumbnail/options/logo":299,"./template.hbs":344}],346:[function(e,t,n){var i=e("../../../../facade/restrictions/decorate");t.exports=i({haveOptions:function(t){var n=e("../../../../facade/restrictions/restrictions"),i=_.partial(n.getElementRestrictions,t.id);return i("dictionary").length}},{haveOptions:function(){return!1}})},{"../../../../facade/restrictions/decorate":90,"../../../../facade/restrictions/restrictions":94}],347:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){return'<div class="content-list content"></div>\n'},useData:!0})},{"hbsfy/runtime":535}],348:[function(e,t,n){var i=e("../../../../facade/restrictions/restrictions"),a=e("../../components/thumbnail/options/text");t.exports=Backbone.View.extend({template:e("./template.hbs"),initialize:function(e){this.selection=e.selection;var t=_.partial(i.getElementRestrictions,this.selection.id);this.render(_.chain(t("dictionary")).pluck("list").flatten().value())},render:function(e){this.$el.html(this.template()),_(e).each(this.addThumbnail,this)},addThumbnail:function(e,t){var n=$('<div class="thumbnail">').css({"-webkit-transition-delay":"."+t+"s","transition-delay":"."+t+"s"});new a({el:n,selection:this.selection,item:{content:e}});this.$el.find(".content-list").append(n)},remove:function(){this.undelegateEvents(),this.$el.removeData().unbind(),Backbone.View.prototype.remove.call(this)}})},{"../../../../facade/restrictions/restrictions":94,"../../components/thumbnail/options/text":300,"./template.hbs":347}],349:[function(e,t,n){arguments[4][340][0].apply(n,arguments)},{"../../../../facade/restrictions/decorate":90,"../../../../facade/restrictions/restrictions":94,dup:340}],350:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){return'<div class="video-list content"></div>\n'},useData:!0})},{"hbsfy/runtime":535}],351:[function(e,t,n){var i=e("../../../../facade/restrictions/restrictions"),a=e("../../components/thumbnail/options/video");t.exports=Backbone.View.extend({template:e("./template.hbs"),initialize:function(e){this.selection=e.selection;var t=_.partial(i.getElementRestrictions,this.selection.id);this.render(_.chain(t("source")).pluck("list").flatten().value())},render:function(e){this.$el.html(this.template()),_(e).each(this.addThumbnail,this)},addThumbnail:function(e,t){var n=$('<div class="thumbnail">').css({"-webkit-transition-delay":"."+t+"s","transition-delay":"."+t+"s"});new a({el:n,selection:this.selection,item:e});this.$el.find(".video-list").append(n)},remove:function(){this.undelegateEvents(),this.$el.removeData().unbind(),Backbone.View.prototype.remove.call(this)}})},{"../../../../facade/restrictions/restrictions":94,"../../components/thumbnail/options/video":301,"./template.hbs":350}],352:[function(e,t,n){t.exports={eventCategory:"Editor UI | Tool Menu | import",show:{eventAction:"show"},listContentToggleEvent:function(e){var t=$(e.currentTarget),n=t.closest("dt");n.hasClass("active")||this.trackEvent({eventAction:"content_toggle",eventLabel:t.data("key")})}}},{}],353:[function(e,t,n){var i=e("../../components/accordion-list/content"),a=e("../../components/mixins/upload-list");t.exports=Backbone.mixin(i.extend({apiCall:"photo/imported",limit:20,initialize:function(e){_.bindAll(this,"beforeSubmitEvent"),this.$uploadButton=e.$uploadButton,this.type=e.type,i.prototype.initialize.call(this),a.initialize.call(this),this.refreshView=_.debounce(_.bind(function(){this.masonryReload(),this.from-=2*this.limit,this.from=this.from<0?0:this.from,this.initDataLoading()},this),2e3)},getParams:function(){var e={id:INKIVE.C.BOOK.id,from:this.from,limit:this.limit};return this.from+=this.limit,e},extractSvgData:function(e){return _.compact(_.map(e,function(e){if("svg"===e.type)return new INKIVE.ThumbSvg(e)},this))},extractTextData:function(e){return _.compact(_.map(e,function(t){if("text"===t.type)return new INKIVE.ThumbText($.extend(t,{tooltip:e.text}))},this))},extractImageData:function(e){return _.compact(_.map(e,function(e){if("svg"!==e.type&&"text"!==e.type&&e.image&&e.image.thumb.trim()){var t="photo-saved-"+e.image.original.hashCode();if(!this.$el.find("#"+t).length){var n=this.getImageData(e);return this.imagesFactory.addImageData(n),{id:t,src:e.image.thumb,width:e.image.original_width,height:e.image.original_height,times_used:e.count,data:n,sticker_value:e.count,sticker_tooltip:"used "+e.count+" time"+(e.count>1?"s":"")}}}},this))},getImageData:function(e){return{version:_.clone(e.image)}},initializeUpload:function(){var t=this.$uploadButton.parent();t.fineUploaderS3(this.getUploaderOptions(t)).on("progress",this.progressEvent).on("error",this.errorEvent).on("cancel",this.cancelEvent).on("complete",this.completeEvent).on("submitted",_.bind(function(){var n=e("../../../../utils/advice"),i=t.find("input").val(),a=i.substring(i.lastIndexOf(".")+1);this.submittedEvent.apply(this,arguments),_.contains(["pdf","psd"],a)&&n.show("imported-results")},this)),t.on("click",this.beforeSubmitEvent)},beforeSubmitEvent:function(e){var t=$(e.target),n=t.closest(".button.enabled").length;n&&t.closest(".add").find("input").trigger("click")},complete:function(e,t){var n=this.views[e];n.cancel(),INKIVE.Helpers.afterRendering(_.bind(function(){n.remove(),this.refreshView()},this))}}),a)},{"../../../../utils/advice":477,"../../components/accordion-list/content":252,"../../components/mixins/upload-list":270}],354:[function(e,t,n){var i=e("./base");t.exports=i.extend({uploadConfig:{validation:{acceptFiles:".svg",allowedExtensions:["svg"]},uploadSuccess:{params:{loadType:120}}},appendThumbnails:function(e){var t=this.$el.find(".thumbnail-wrapper");_.delay(_.bind(function(){var n=_.each(this.extractSvgData(e),function(e){this.$el.find("#"+e.uuid).length||e.appendTo(t)},this);n.length&&this.$el.siblings(".section-title").css("visibility",""),this.masonryReload()},this),500)},getScrollHeight:function(e){var t=e.closest(".tab-content"),n=t.height();return n-=t.find(".header-links").height(),e.siblings().add(e.parent().siblings()).each(function(){n-=$(this).height()}),n}})},{"./base":353}],355:[function(e,t,n){var i=e("./base"),a=e("../../components/mixins/upload-list"),o=e("../../../../factory/company").instance;t.exports=i.extend({apiCall:"photo/saved",allProjects:[],otherProjects:[],limit:50,uploadConfig:{validation:{acceptFiles:".jpg, .jpeg, .png, .gif, .pdf, .psd",allowedExtensions:["jpg","jpeg","png","gif","pdf","psd"]},uploadSuccess:{params:{loadType:120}}},initialize:function(e){this.deferred=$.Deferred();var t=_.bind(function(e){e&&(this.otherProjects=_.sortBy(e,"modified_date").reverse(),this.otherProjects=_.without(_.pluck(this.otherProjects,"id"),INKIVE.C.BOOK.id),this.allProjects=this.otherProjects,this.deferred.resolve())},this);if(INKIVE.Helpers.projectIsLinkedToRestrictions()){var n=function(e){o.get(e).then(function(e){var n=_.map(e,function(e){return{id:e.encoded_id,modified_date:e.pages[0]?e.pages[0].last_mod:null}});t(n)})};INKIVE.C.BOOK.book_type===INKIVE.C.BOOK_TYPE.TEMPLATE?INKIVE.FormatFactory.getCurrentFormat().then(function(e){n("campaigns/"+e.campaign+"/templates")}):n("designs")}else INKIVE.Helpers.api("photo/saved","GET",{id:INKIVE.C.BOOK.id,type:"albums"},_.bind(function(e){t(e.data)},this));e.premium||(this.uploadConfig.validation.acceptFiles=".jpg, .jpeg, .png, .gif",this.uploadConfig.validation.allowedExtensions=["jpg","jpeg","png","gif"]),i.prototype.initialize.call(this,e),e.premium||e.$uploadButton.siblings("input").css("height",e.$uploadButton.siblings(".drag-drop-file").css("height")),this.refreshView=_.debounce(_.bind(function(){this.masonryReload(),this.from=0,this.stopLoading=!1,this.otherProjects=this.allProjects,this.projectId=INKIVE.C.BOOK.id,this.$el.find(".thumbnail:not(.uploader)").remove(),this.$el.find(".thumbnail-wrapper").height(40),INKIVE.Modal.loader(this.$el.find(".antiscroll-inner")),_.delay(_.bind(this.initDataLoading,this),6e3)},this),2e3)},getParams:function(){var e={id:this.projectId||INKIVE.C.BOOK.id,type:"photos",from:this.from,limit:this.limit};return this.from+=this.limit,e},extractData:function(e){return _.compact(_.map(e,function(e,t){if(e.image.thumb.trim()){var n=_.find(this.addedThumbnails,function(t){return t.image.original===e.image.original});if(!n){this.addedThumbnails.push(e);var i=this.getImageData(e);return this.imagesFactory.addImageData(i),{id:"photo-saved-"+e.image.original.hashCode(),src:e.image.thumb,width:e.image.original_width,height:e.image.original_height,times_used:e.count,data:i,sticker_value:e.count,sticker_tooltip:"used "+e.count+" time"+(e.count>1?"s":"")}}}},this))},initializeUpload:function(){i.prototype.initializeUpload.call(this),this.setFileUploadButton()},complete:function(e,t){if(t.photoId){var n=this.views[e].$el;a.complete.call(this,e,t),t.tempLink&&this.views[e].$el.find(".item").data("version",{original:t.tempLink}),this.tool.callbackImages(n,this.$el),this.$el.siblings(".section-title").css("visibility",""),n.find("a").after(this.tool.getImageOverlayHtml()),INKIVE.Helpers.initTooltips()}else i.prototype.complete.call(this,e,t);this.setFileUploadButton()},errorEvent:function(e,t){i.prototype.errorEvent.call(this,e,t),this.setFileUploadButton()},setFileUploadButton:function(){var e=this.$uploadButton.parent(),t=e.find(".drag-drop-file"),n=e.find("input");n.css("padding",t.css("padding")).height(t.outerHeight()).show()},appendThumbnails:function(e){var t=(this.$el.find(".thumbnail-wrapper"),_.bind(this.tool.callbackImages,this.tool)),n=[];_.each(e,function(e){var t=_.contains(_.pluck(_.pluck(n,"image"),"original"),e.image.original);t||e.image.active!==!1&&n.push(e)}),this.tool.addThumbItem(this.$el,this.extractImageData(n),t),this.$el.siblings(".section-title").css("visibility",""),this.masonryReload()},initScroll:function(){var e=this.$el.parents(".add"),t=e.hasClass("antiscroll-wrap");t||e.addClass("antiscroll-wrap").wrapInner('<div class="antiscroll-inner"></div>'),e.antiscroll({autoHide:!1,width:e.parents(".tab").width(),height:e.height()||40})},onMoreData:function(e){var t=e&&e.data&&e.data.length>0;this.stopLoading=!this.$el.find(".loader-wrapper").isOnScreen(),INKIVE.Modal.loaderClose(this.$el.find(".antiscroll-inner"));var n=t?null:this.otherProjects.shift();t?(this.appendThumbnails(e.data),this.repeat()):n?(this.projectId=n,this.from=0,this.loadData(this.repeat,this.end),this.repeat()):this.end(),this.scrollRefresh()},loadData:function(e,t){this.stopLoading?this.$el.closest(".antiscroll-inner").off("scroll").on("scroll",_.bind(function(n){var a=$(n.target),o=a.get(0).scrollHeight,r=a.get(0).scrollTop,s=a.height(),l=Math.round((r+s)/o*100);l>=99&&(a.off(),i.prototype.loadData.call(this,e,t))},this)):this.deferred.then(_.bind(function(){i.prototype.loadData.call(this,e,t)},this))}})},{"../../../../factory/company":98,"../../components/mixins/upload-list":270,"./base":353}],356:[function(e,t,n){var i=e("./base");t.exports=i.extend({uploadConfig:{validation:{acceptFiles:".pdf, .psd,  .ppt, .pptx",allowedExtensions:["pdf","psd","ppt","pptx"]},uploadSuccess:{params:{loadType:120}}},appendThumbnails:function(e){var t=this.$el.find(".thumbnail-wrapper"),n=_.each(this.extractTextData(e),function(e){this.$el.find("#"+e.uuid).length||e.appendTo(t)},this);if(n.length){var i=this.$el.parents(".inner-tabs"),a=i.find(".header-links").find(".active");"add"===a.data("key")&&this.$el.siblings(".section-title").css("visibility","")}this.masonryReload()},getScrollHeight:function(e){var t=e.closest(".tab-content"),n=t.height();return n-=t.find(".header-links").height(),n-=parseInt(t.find(".search-container").css("height")),e.siblings().add(e.parent().siblings()).each(function(){n-=$(this).height()}),n},getScrollWidth:function(e){return e.width()}})},{"./base":353}],357:[function(e,t,n){t.exports={render:function(t){function n(e){if(e.disabled)return!1;switch(e.key){case"image":return a("function_use_own_images")&&a("image_add");case"text":return a("text_add");case"icon":return a("vector_add")}return!0}var i=e("../../../../facade/restrictions/restrictions"),a=i.isFunctionalityAllowed;this.lockedLibrary=t,this.$el.html(this.template({"class":this["class"],buttons:this.buttons.filter(n)})),this.helperView&&this.helperView.remove(),t&&this.initHelper()}}},{"../../../../facade/restrictions/restrictions":94}],358:[function(e,t,n){var i=e("../components/accordion-list/director"),a=e("../../../analytics/decorate"),o=e("../../../facade/restrictions/decorate");t.exports=a(e("./analytics/view"),o(e("./restrict/view"),i.extend({"class":"import",uploadViewKey:"all",views:{},Views:{image:e("./contents/image"),text:e("./contents/text"),icon:e("./contents/icon")},buttons:[{key:"images",tag:"tool.import.image"},{key:"text",tag:"tool.import.text"},{key:"icons",tag:"tool.import.svg"}],beforeSubmitEvent:function(e){this.canUse||e.preventDefault()},initialize:function(e){this.canUse=e.canUse,_.bindAll(this,"beforeSubmitEvent")},render:function(){i.prototype.render.call(this),this.canUse||this.initHelper()},refresh:function(){_.each(this.views,function(e){e.refresh?e.refresh():e.masonryReload&&e.masonryReload()})},showCantUseModal:function(){INKIVE.Modal.alertMessage(INKIVE.TemplatesHelper("alert_span",{text:INKIVE.TranslateHelper.translate("tool.import.helper.description")}),{callback:[function(){window.open(INKIVE.C.BASE_URL+"library?r=upgrade")},$.noop]})},loadImportedListContent:function(e,t){var n=function(){var n=$('<div class="section-title imported"><span>'+INKIVE.TranslateHelper.translate("tool.import."+e)+"</span></div>").css("visibility","hidden"),i=$("<div></div>").addClass("image-list content "+e);return t.parent().siblings(".imported-elements").append(n),i.insertAfter(n),i};(this.canUse||"image"===e)&&(this.views[e]=new this.Views[e]({el:n(),$uploadButton:t,type:e,premium:this.canUse})),this.canUse?t.addClass("enabled"):("image"===e||t.siblings(".drag-drop-file").hide(),t.on("click",this.showCantUseModal))}})))},{"../../../analytics/decorate":5,"../../../facade/restrictions/decorate":90,"../components/accordion-list/director":254,"./analytics/view":352,"./contents/icon":354,"./contents/image":355,"./contents/text":356,"./restrict/view":357}],359:[function(e,t,n){t.exports={eventCategory:"Editor UI | Tool Menu | icons | stickers",render:function(){this.trackEvent({eventAction:"show",eventLabel:this.category.id})}}},{}],360:[function(e,t,n){t.exports={eventCategory:"Editor UI | Tool Menu | icons",show:{eventAction:"show"}}},{}],361:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){var o=null!=t?t:e.nullContext||{},r=n.helperMissing,s=e.escapeExpression;return'<div class="search-options" data-type="icons">\n  <div data-key="desygner">\n    '+s((n.t||t&&t.t||r).call(o,"tool.search.desygner_icons",{name:"t",hash:{},data:a}))+'\n  </div>\n\n  <div data-key="free">\n    '+s((n.t||t&&t.t||r).call(o,"tool.search.free",{name:"t",hash:{},data:a}))+'\n  </div>\n\n  <div data-key="all" class="selected">\n    '+s((n.t||t&&t.t||r).call(o,"tool.search.all_icons",{name:"t",hash:{},data:a}))+'\n    <i class="desygner-icon-check"></i>\n  </div>\n</div>\n'},useData:!0})},{"hbsfy/runtime":535}],362:[function(e,t,n){var i=e("../components/accordion-list/content"),a=e("../../../analytics/decorate");t.exports=a(e("./analytics/stickers"),i.extend({apiCall:"search/stickers",dataName:"stickerCategories",callbackName:"callbackStickers",where:{},initialize:function(e){this.category="all"===e.key?"all":_.find(INKIVE.Tool._cache.stickerCategories,function(t){return parseInt(t.id)===e.key}),i.prototype.initialize.call(this,e)},getScrollHeight:function(e){return e.closest(".tab-content").height()-this.$el.siblings().height()-80},getParams:function(){var e={from:this.from,limit:this.limit,where:{category:"all"===this.category?null:this.category.name,active:INKIVE.C.USER.IS_SUPER?0:1}};return this.from+=this.limit,e},extractData:function(e){return this.searchInput.removeClass("disabled"),_.map(e,function(e){return{id:"sticker-"+e.id,src:e.url,width:e.width,height:e.height,cls:parseInt(e.active)?"":" grayscale",data:{name:e.name,count:e.count,changeable:e.changeable,width:e.width,height:e.height}}})},render:function(){this.searchInput=this.$el.parents(".inner-tabs").find("input[name=search]"),this.searchInput.addClass("disabled"),i.prototype.render.call(this)}}))},{"../../../analytics/decorate":5,"../components/accordion-list/content":252,"./analytics/stickers":359}],363:[function(e,t,n){var i=e("./search-options.hbs"),a=e("../components/common/stock-component");t.exports=a.extend({CategoriesView:e("./stickers"),selectSearchOptionEvent:function(e){var t=$(e.target),n=this.$searchOptions.find("> div");t.is(n)&&(n.removeClass("selected"),n.find(".desygner-icon-check").appendTo(t),t.addClass("selected")),n.closest(".search-container").children("input").focus()},search:function(e){var t=this.$el.find(".image-list"),n=t.find(".thumbnail-wrapper");n.removeClass("thumbnail-wrapper").addClass("tab-content"),n.empty().css("height",""),this.$el.find(".categories-container").addClass("hidden"),this.$el.find(".search-title").removeClass("hidden"),this.$el.parent().find(".search-options").hide(),t.find(".antiscroll-scrollbar").remove(),t.find(".tab-content").empty().removeData();var i=this.$searchOptions.find(".selected").data("key");this.tool.initSearch(t,{query:e.val(),type:"sticker"+("all"===i?"":" "+i),callback:this.refreshAntiscroll})},loadButtons:function(){var e=$.Deferred();return INKIVE.Tool.preloadStickerCategories(function(){var t=INKIVE.Tool._cache.stickerCategories;e.resolve(_.map(t,function(e){return{key:e.id,tag:e.name}}))}),e.promise()},getSearchOptions:function(e){return this.$searchOptions||(this.$searchOptions=$(i()),INKIVE.Helpers.initPopover(this.$searchOptions)),this.$searchOptions}})},{"../components/common/stock-component":260,"./search-options.hbs":361,"./stickers":362}],364:[function(e,t,n){var i=e("../components/common/common-component"),a=e("../../../analytics/decorate");t.exports=a(e("./analytics/view"),i.extend({type:"icon",uploadViewKey:"icons-import",StockView:e("./stock"),categories:null,isAlreadyThere:function(){return!!this.$el.find(".tab-content.icon").length},render:function(){i.prototype.render.call(this);var e=this.$headerLinks.filter("[data-key=stock]");e.length?e.trigger("click"):this.$headerLinks.filter("[data-key=library]").trigger("click")},updateSearchContainer:function(){"add"===this.selectedTab.key&&(this.selectedTab.searchable=!1),this.selectedTab.searchable&&this.displaySearchContainer(this.$el.find(".search-container"))}}))},{"../../../analytics/decorate":5,"../components/common/common-component":257,"./analytics/view":360,"./stock":363}],365:[function(e,t,n){t.exports={eventCategory:"Editor UI | Tool Menu | customize | background",render:function(){this.category&&this.trackEvent({eventAction:"show",eventLabel:this.category.id})}}},{}],366:[function(e,t,n){t.exports={eventCategory:"Editor UI | Tool Menu | images",show:{eventAction:"show"},openSearchTabEvent:{eventAction:"open_search_tab"},listContentToggleEvent:function(e){var t=$(e.currentTarget),n=t.closest("dt");n.hasClass("active")||this.trackEvent({eventAction:"content_toggle",eventLabel:t.data("key")})}}},{}],367:[function(e,t,n){var i=e("../components/accordion-list/content"),a=e("../../../analytics/decorate");t.exports=a(e("./analytics/backgrounds"),i.extend({apiCall:"search/backgrounds",dataName:"backgroundCategories",callbackName:"callbackImages",where:{},initialize:function(e){this.category="all"===e.key?"all":_.find(INKIVE.Tool._cache.backgroundCategories,function(t){return parseInt(t.id)===e.key}),i.prototype.initialize.call(this,e)},getScrollHeight:function(e){var t=123;return $("#tool-panel").height()-this.$el.siblings().height()-t},getParams:function(){var e={from:this.from,limit:this.limit,where:{category:"all"===this.category?null:this.category.name}};return this.from+=this.limit,e},extractData:function(e){return this.searchInput.removeClass("disabled"),_.map(e,function(e){var t=this.getImageData(e);return this.imagesFactory.addImageData(t),{id:"background-"+e.id,src:t.version.thumb,cls:parseInt(e.active)?"":" grayscale",data:t,width:125,height:78}},this)},getImageData:function(e){return{name:e.readable_name,count:e.count,version:{original:e.url,largeweb:e.url,web:e.url,tab:e.url,mobile:e.url&&e.url.replace("-web","-mobile"),thumb:e.url&&e.url.replace("-web","-thumb")}}},render:function(){this.searchInput=this.$el.parents(".inner-tabs").find("input[name=search]").addClass("disabled"),this.$el.html(this.template({placeholder:this.filterPlaceholder})),this.$el.find(".antiscroll-inner").addThumb()}}))},{"../../../analytics/decorate":5,"../components/accordion-list/content":252,"./analytics/backgrounds":365}],368:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){var o=null!=t?t:e.nullContext||{},r=n.helperMissing,s=e.escapeExpression;return'<div class="search-options" data-type="images">\n  <div data-key="google">\n    '+s((n.t||t&&t.t||r).call(o,"tool.search.google",{name:"t",hash:{},data:a}))+'\n  </div>\n\n  <div data-key="free" class="selected">\n    '+s((n.t||t&&t.t||r).call(o,"tool.search.free",{name:"t",hash:{},data:a}))+'\n    <i class="desygner-icon-check"></i>\n  </div>\n\n  <div data-key="all">\n    '+s((n.t||t&&t.t||r).call(o,"tool.search.all",{name:"t",hash:{},data:a}))+"\n  </div>\n</div>\n"},useData:!0})},{"hbsfy/runtime":535}],369:[function(e,t,n){var i=e("../../components/accordion-list/content");t.exports=i.extend({page:0,initDataLoading:function(){this.end&&this.end(),INKIVE.Modal.loader(this.$el.find(".antiscroll-inner"))},initAuthenticatedDataLoading:function(){this.authenticated=!0,i.prototype.initDataLoading.call(this)},authenticate:function(){var e=$.Deferred();return this.authenticated&&e.resolve(),this.authenticated||window.dbAsynInit(_.bind(function(t){t?(this.initAuthenticatedDataLoading(),e.resolve()):(this.trigger("no_access"),INKIVE.Modal.loaderClose(this.$el.find(".antiscroll-inner")),e.reject())},this)),e.promise()},loadData:function(e,t){this.end=t,this.repeat=e,this.canvas.call("advice.show","dropbox-view"),INKIVE.Modal.loader(this.$el.find(".antiscroll-inner")),this.imagesFactory.getDropboxPhotos({page:this.page++},this.onMoreData)},onMoreData:function(e,t,n){if(INKIVE.Modal.loaderClose(this.$el.find(".antiscroll-inner")),!e||!n.length)return void this.end();var i=_.bind(this.tool.callbackImages,this.tool);this.tool.addThumbItem(this.$el,this.extractData(t,n),i),this.scrollRefresh(),this.end()},getScrollHeight:function(e){var t=65;return e.closest(".add").height()-t},extractData:function(e,t){return _.map(t,function(t){return{id:"photo-fl-"+t.object_id,src:t.src,data:e[t.src_big]}})}})},{"../../components/accordion-list/content":252}],370:[function(e,t,n){var i=e("./facebook/access"),a=e("./facebook/images");t.exports=i.extend({scope:"user_photos",apiCall:"load/albums/facebook",thumbnailClickEvent:function(e){this.openNewView("images",a,{albumId:e})}})},{"./facebook/access":372,"./facebook/images":373}],371:[function(e,t,n){var i=e("./facebook/access"),a=e("./facebook/page");t.exports=i.extend({scope:"manage_pages",apiCall:"load/albums/facebook/pages",thumbnailClickEvent:function(e){this.openNewView("page",a,{pageId:e})},closeView:function(){var e=!0;return _.each(this.views,function(t){e&=t.closeView()}),e&&i.prototype.closeView.call(this)}})},{"./facebook/access":372,"./facebook/page":374}],372:[function(e,t,n){var i=e("../../../components/accordion-list/content");t.exports=i.extend({initialize:function(){_.bindAll(this,"thumbnailClickEvent"),i.prototype.initialize.call(this)},thumbnailClickEvent:function(){},initDataLoading:function(){this.end&&this.end(),INKIVE.Modal.loader(this.$el.find(".antiscroll-inner"))},initAuthenticatedDataLoading:function(){this.authenticated=!0,i.prototype.initDataLoading.call(this)},authenticate:function(){function e(e){e.authResponse?(t.resolve(),this.initAuthenticatedDataLoading()):(this.trigger("no_access"),t.reject(),INKIVE.Modal.loaderClose(this.$el.find(".antiscroll-inner")))}var t=$.Deferred();return this.authenticated&&t.resolve(),this.authenticated||FB.login(_.bind(e,this),{scope:this.scope}),t.promise()},loadData:function(e,t){this.end=t,this.repeat=e,INKIVE.Modal.loader(this.$el.find(".antiscroll-inner")),INKIVE.Helpers.sendCmd(INKIVE.C.BASE_URL+this.apiCall,this.getParams(),this.onMoreData)},getParams:function(){return{width:107,height:73,fb_token:this.tool.facebookToken||FB.getAccessToken()}},onMoreData:function(e){this.end(),this.appendThumbnails(e),INKIVE.Modal.loaderClose(this.$el.find(".antiscroll-inner"))},appendThumbnails:function(e){var t=this.$el.find(".thumbnail-wrapper");_.each(this.extractData(e),function(e){var n=_.partial(this.thumbnailClickEvent,e.id),i=new INKIVE.ThumbGroupImage($.extend(e,{tooltip:e.name,thumb:e.src,onItemLoad:function(e){$(e).on("click",n)}}));i.appendTo(t)},this)},masonryReload:function(){var e=this.$el.is(".out");if(e)for(var t in this.views)this.views[t].masonryReload();else i.prototype.masonryReload.call(this);this.$el.closest(".add.antiscroll-wrap").children(".antiscroll-scrollbar").hide()},getScrollHeight:function(e){var t=65;return e.closest(".add").height()-t},extractData:function(e){return $.parseJSON(e)}})},{"../../../components/accordion-list/content":252}],373:[function(e,t,n){var i=e("../../../components/accordion-list/content");t.exports=i.extend({initialize:function(e){this.albumId=e.albumId,i.prototype.initialize.call(this)},loadData:function(e,t){this.end=t,this.repeat=e,INKIVE.Modal.loader(this.$el.find(".antiscroll-inner")),this.imagesFactory.getFacebookPhotos(this.getParams(),this.onMoreData)},getParams:function(){return{albums:[{id:this.albumId,after:this.after}],fb_token:this.tool.facebookToken||FB.getAccessToken()}},onMoreData:function(e,t,n){var i=_.bind(this.tool.callbackImages,this.tool),a=this.extractData(t,n[this.albumId].data);INKIVE.Modal.loaderClose(this.$el.find(".antiscroll-inner")),this.after=n[this.albumId].paging.cursors.after,this.tool.addThumbItem(this.$el,a,i),this.scrollRefresh(),n[this.albumId].paging.next?this.repeat():this.end()},getScrollHeight:function(e){var t=65;return e.closest(".add").height()-t},extractData:function(e,t){return _.map(t,function(t,n){return{id:"photo-fb-"+t.object_id,src:t.src,data:e[t.src_big],width:125,height:84}})}})},{"../../../components/accordion-list/content":252}],374:[function(e,t,n){var i=e("./access"),a=e("./images");t.exports=i.extend({apiCall:"load/albums/facebook",initialize:function(e){this.pageId=e.pageId,_.bindAll(this,"thumbnailClickEvent"),i.prototype.initialize.call(this)},initDataLoading:function(){this.end&&this.end(),INKIVE.Modal.loader(this.$el.find(".antiscroll-inner")),this.initAuthenticatedDataLoading()},getParams:function(){var e={page_ids:'["'+this.pageId+'"]'};return e.fb_token=this.tool.facebookToken||FB.getAccessToken(),e},thumbnailClickEvent:function(e){this.openNewView("images",a,{albumId:e})},closeView:function(){var e=_.size(this.views)>0;return!e||(i.prototype.closeView.call(this),!1)}})},{"./access":372,"./images":373}],375:[function(e,t,n){var i=e("../../components/accordion-list/content");t.exports=i.extend({page:0,initDataLoading:function(){this.end&&this.end(),INKIVE.Modal.loader(this.$el.find(".antiscroll-inner"))},initAuthenticatedDataLoading:function(){this.authenticated=!0,i.prototype.initDataLoading.call(this)},authenticate:function(){var e=$.Deferred();return this.authenticated&&e.resolve(),this.authenticated||window.gdAsynInit(_.bind(function(t){t?(this.initAuthenticatedDataLoading(),e.resolve()):(this.trigger("no_access"),INKIVE.Modal.loaderClose(this.$el.find(".antiscroll-inner")),e.reject())},this)),e.promise()},loadData:function(e,t){this.end=t,this.repeat=e,INKIVE.Modal.loader(this.$el.find(".antiscroll-inner")),this.imagesFactory.getGooglePhotos({page:this.page++},this.onMoreData)},onMoreData:function(e,t,n){if(INKIVE.Modal.loaderClose(this.$el.find(".antiscroll-inner")),!e||!n.length)return void this.end();var i=_.bind(this.tool.callbackImages,this.tool);this.tool.addThumbItem(this.$el,this.extractData(t,n),i),this.scrollRefresh(),this.repeat()},getScrollHeight:function(e){var t=65;return e.closest(".add").height()-t},extractData:function(e,t){return _.map(t,function(t){return{id:"photo-gd-"+t.object_id,src:t.src,data:e[t.src_big]}})}})},{"../../components/accordion-list/content":252}],376:[function(e,t,n){var i=e("../../components/accordion-list/content");t.exports=i.extend({initialize:function(){_.bindAll(this,"initAuthenticatedDataLoading"),i.prototype.initialize.call(this)},initDataLoading:function(){this.end&&this.end(),INKIVE.Modal.loader(this.$el.find(".antiscroll-inner"))},initAuthenticatedDataLoading:function(){this.authenticated=!0,i.prototype.initDataLoading.call(this)},authenticate:function(){var e=$.Deferred();return this.authenticated&&e.resolve(),this.authenticated||window.inAsynInit(_.bind(function(t){t?(this.initAuthenticatedDataLoading(),e.resolve()):(this.trigger("no_access"),INKIVE.Modal.loaderClose(this.$el.find(".antiscroll-inner")),e.reject())},this)),e.promise()},loadData:function(e,t){this.end=t,this.repeat=e,INKIVE.Modal.loader(this.$el.find(".antiscroll-inner")),this.imagesFactory.getInstagramPhotos(null,this.onMoreData)},onMoreData:function(e,t,n){if(INKIVE.Modal.loaderClose(this.$el.find(".antiscroll-inner")),e){var i=_.bind(this.tool.callbackImages,this.tool);this.tool.addThumbItem(this.$el,this.extractData(t,n),i),this.scrollRefresh(),this.end()}},getScrollHeight:function(e){var t=65;return e.closest(".add").height()-t},extractData:function(e,t){return _.map(t,function(t){return{id:"photo-in-"+t.object_id,src:t.src,width:t.src_web_width,height:t.src_web_height,data:e[t.src_big]}})}})},{"../../components/accordion-list/content":252}],377:[function(e,t,n){var i=e("../components/accordion-list/director");t.exports=i.extend({views:{},Views:{facebookAlbums:e("./social-media-contents/facebook-albums"),facebookPages:e("./social-media-contents/facebook-pages"),instagram:e("./social-media-contents/instagram"),gdrive:e("./social-media-contents/gdrive"),dropbox:e("./social-media-contents/dropbox")},buttons:[],events:{'click dt > a:not([data-key="add"]):not([data-key="search"])':"listContentToggleEvent"},loadListContent:function(e){if(e){var t=this.$el.find('dt a[data-key="'+e+'"]'),n=i.prototype.loadListContent.apply(this,arguments);return n.on("no_access",function(){t.addClass("blink")}),n}},listContentToggleEvent:function(e){
function t(){i.prototype.listContentToggleEvent.call(this,e);var t=r.hasClass("active");a.call(this,!t),n.call(this,t)}function n(e){if(e)this.$el.siblings().css("visibility","hidden");else{var t=!o.children(".back").is(".hidden");t||_.delay(_.bind(function(){this.$el.siblings().hide(),this.$el.siblings().css("visibility",""),this.$el.siblings().fadeIn()},this),200)}}function a(e){var t=this.$el.parents(".add").children(".antiscroll-inner");e&&t.css("overflow","auto").siblings(".antiscroll-scrollbar").show(),e||t.css("overflow","hidden").siblings(".antiscroll-scrollbar").hide()}var o=$(e.currentTarget),r=o.closest("dt"),s=o.data("key");this.views[s]||this.loadListContent(s),!r.hasClass("active")&&this.views[s].authenticate?(o.removeClass("blink"),this.views[s].authenticate().then(_.bind(t,this))):t.call(this)},refresh:function(){for(var e in this.views)this.views[e].masonryReload()},initialize:function(){this.buttons=_.union(this.buttons,[{key:"facebookAlbums",tag:"tool.images.facebook_albums"},{key:"facebookPages",tag:"tool.images.facebook_pages"},{key:"instagram",tag:"social.instagram"},{key:"gdrive",tag:"tool.images.gdrive",disabled:!INKIVE.C.USER.IS_SUPER},{key:"dropbox",tag:"tool.images.dropbox"}]),i.prototype.initialize.call(this)},render:function(){this.$el.html(this.template({buttons:this.buttons}))}})},{"../components/accordion-list/director":254,"./social-media-contents/dropbox":369,"./social-media-contents/facebook-albums":370,"./social-media-contents/facebook-pages":371,"./social-media-contents/gdrive":375,"./social-media-contents/instagram":376}],378:[function(e,t,n){var i=e("./search-options.hbs"),a=e("../components/common/stock-component");t.exports=a.extend({CategoriesView:e("./patterns"),selectSearchOptionEvent:function(e){var t=$(e.target),n=this.$searchOptions.find("> div");t.is(n)&&(n.removeClass("selected"),n.find(".desygner-icon-check").appendTo(t),t.addClass("selected")),n.closest(".search-container").children("input").focus()},search:function(e){var t=this.$el.find(".image-list"),n=t.find(".thumbnail-wrapper");n.removeClass("thumbnail-wrapper").addClass("tab-content"),n.empty().css("height",""),this.$el.find(".categories-container").addClass("hidden"),this.$el.find(".search-title").removeClass("hidden"),this.$el.parent().find(".search-options").hide(),t.find(".antiscroll-scrollbar").remove(),t.find(".tab-content").empty().removeData();var i=this.$searchOptions.find(".selected").data("key");this.tool.initSearch(t,{query:e.val(),type:"image"+("all"===i?"":" "+i),callback:this.refreshAntiscroll})},loadButtons:function(){var e=$.Deferred();return INKIVE.Tool.preloadBackgroundCategories(function(){var t=INKIVE.Tool._cache.backgroundCategories;e.resolve(_.map(t,function(e){return{key:e.id,tag:e.name}}))}),e.promise()},getSearchOptions:function(e){return this.$searchOptions||(this.$searchOptions=$(i()),INKIVE.Helpers.initPopover(this.$searchOptions)),this.$searchOptions},refresh:function(){a.prototype.refresh.call(this);var e=this.$el.find(".image-list .thumbnail-wrapper");e.data("masonry")&&e.masonry({gutter:10})}})},{"../components/common/stock-component":260,"./patterns":367,"./search-options.hbs":368}],379:[function(e,t,n){var i=e("../components/common/common-component"),a=e("./social-media"),o=e("../../../analytics/decorate");t.exports=o(e("./analytics/view"),i.extend({type:"image",uploadViewKey:"image-import",StockView:e("./stock"),isAlreadyThere:function(){return!!this.$el.find(".tab-content.image").length},render:function(){i.prototype.render.call(this);var e=this.$headerLinks.filter("[data-key=add]");e.length&&e.trigger("click"),e.length||this.$headerLinks.filter("[data-key=library]").trigger("click")},initAddView:function(){i.prototype.initAddView.call(this);var e=$('<div class="social-media"/>'),t=new a({el:e});this.registerTabView("add",t),t.render(),this.$el.find(".import-button").before(e)},updateSearchContainer:function(){"add"===this.selectedTab.key&&(this.selectedTab.searchable=!1),this.selectedTab.searchable&&this.displaySearchContainer(this.$el.find(".search-container"))}}))},{"../../../analytics/decorate":5,"../components/common/common-component":257,"./analytics/view":366,"./social-media":377,"./stock":378}],380:[function(e,t,n){var i=e("../../components/mixins/scrollable"),a=e("../../../../factory/library"),o=e("../../../../factory/library/library-populator");t.exports=Backbone.mixin(Backbone.mixin(Backbone.View.extend({template:e("./template.hbs"),events:{"click .library-link a.empty":"goToLibraryEvent"},goToLibraryEvent:_.partial(Backbone.Events.trigger,"go_to_libray"),initialize:function(e){_.bindAll(this,"render","loadData"),this.isSubview=e.isSubview,this.hasParentContent=e.hasParentContent},loadData:function(){this.listeningNewElements||this.initPopulatorListener(),this.isSubview||INKIVE.Modal.loader(this.$el.empty()),this.isSubview&&INKIVE.Modal.loader(this.$el.find(".thumbnail-wrapper:not(.folders)")),a.get(this.type,this.filter).then(this.render)},initPopulatorListener:function(){this.listeningNewElements=!0,o.on("new."+this.type,this.loadData)},loadResourceData:function(e){return a.getResource(this.type,e)},render:function(e){var t=(INKIVE.Helpers.projectIsLinkedToRestrictions(),INKIVE.TranslateHelper.translate("tool.library."+this.subResource)),n={resourceTitle:t,folder:e.length&&"Folder"===e[0].type};this.$el.html(this.template(n)),_.each(e,this.addThumbnail,this),this.toggleNoContentHint(e),this.initScroll(),$(document).trigger("library-content-rendered")},emptyView:function(){this.isSubview&&this.$el.find(".thumbnail-wrapper:not(.folders)").empty(),this.isSubview||this.$el.html(this.template())},toggleNoContentHint:function(e){var t=INKIVE.Helpers.projectIsLinkedToRestrictions();!e.length&&this.hasParentContent&&this.$el.find("ul.thumbnail-wrapper.folders + .section-title").hide(),e.length||this.hasParentContent||t||"folders"===this.type||INKIVE.C.BOOK.book_type===INKIVE.C.BOOK_TYPE.RESTRICTED_DESIGN||this.$el.find(".library-link").removeClass("hidden")},addThumbnail:function(e){var t=$("<li>"),n=new this.ThumbnailView({el:t,item:e});return this.$el.find("ul.thumbnail-wrapper").append(t),n},remove:function(){this.undelegateEvents(),this.$el.removeData().unbind(),Backbone.View.prototype.remove.call(this)},getScrollHeight:function(e){var t=e.closest(".tab-content").height(),n=e.siblings(".btn.btn-accordion").is(":visible")?e.siblings(".btn.btn-accordion").height():$("#ik-menu-back").height();if(!n&&e.siblings(".header-links").is(":visible")){n=e.siblings(".header-links").height();var i=e.siblings(".search-container");i.is(":visible")&&(n+=i.outerHeight(!0))}return t-n}}),Backbone.Events),i)},{"../../../../factory/library":103,"../../../../factory/library/library-populator":110,"../../components/mixins/scrollable":269,"./template.hbs":387}],381:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({1:function(e,t,n,i,a){var o,r=null!=t?t:e.nullContext||{};return'    <div class="palettes">\n      <div class="select-wrapper">\n        <select>\n          <option>'+e.escapeExpression((n.t||t&&t.t||n.helperMissing).call(r,"tool.library.default_palette",{name:"t",hash:{},data:a}))+"</option>\n"+(null!=(o=n.each.call(r,null!=t?t.palettes:t,{name:"each",hash:{},fn:e.program(2,a,0),inverse:e.noop,data:a}))?o:"")+"        </select>\n      </div>\n    </div>\n"},2:function(e,t,n,i,a){var o,r=e.lambda,s=e.escapeExpression;return'          <option value="'+s(r(null!=(o=null!=t?t.data:t)?o.id:o,t))+'">'+s(r(null!=(o=null!=t?t.data:t)?o.name:o,t))+"</option>\n"},compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){var o,r=null!=t?t:e.nullContext||{},s=n.helperMissing,l=e.escapeExpression;return'<div class="antiscroll-wrap">\n  <div class="antiscroll-inner">\n'+(null!=(o=n["if"].call(r,null!=t?t.palettes:t,{name:"if",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a}))?o:"")+'\n    <ul class="thumbnail-wrapper"></ul>\n    <div class="library-link hidden">\n      <p>'+l((n.t||t&&t.t||s).call(r,"tool.library.empty.message",{name:"t",hash:{},data:a}))+'</p>\n      <a href="'+l((n.route||t&&t.route||s).call(r,"library",{name:"route",hash:{},data:a}))+'" target="_blank" class="btn btn-primary empty">'+l((n.t||t&&t.t||s).call(r,"tool.library.empty.button",{name:"t",hash:{},data:a}))+"</a>\n    </div>\n  </div>\n</div>\n"},useData:!0})},{"hbsfy/runtime":535}],382:[function(e,t,n){var i=e("./base"),a=e("../../../../factory/library");t.exports=i.extend({type:"colors",template:e("./colors-template.hbs"),ThumbnailView:e("../../components/thumbnail/library/color"),events:_.extend({"change select":"selectPaletteEvent"},i.prototype.events),selectPaletteEvent:function(e){var t=_.find(this.palettes,function(t){return t.data.id===parseInt(e.currentTarget.value)}),n=[];_.each(this.colors,function(e){!t&&!e.data.palette&&n.push(e),t&&t.data.id===e.data.palette&&n.push(e)}),t&&(n=_.union(n,t.data.colors)),_.invoke(this.views,"remove"),this.renderColors(n,t)},loadData:function(){INKIVE.Modal.loader(this.$el.empty()),this.listeningNewElements||this.initPopulatorListener();var e=a.get(this.type),t=a.get("palettes");$.when(e,t).then(this.render)},render:function(e,t){this.colors=e,this.palettes=t,this.$el.html(this.template({palettes:t})),this.renderColors(e)},renderColors:function(e,t){var n=INKIVE.Helpers.projectIsLinkedToRestrictions(),i=null;this.$el.find(".library-added-thumbnail").remove(),_.each(a.addedColors,_.bind(function(e){t&&t.data.id===e.data.palette?i=this.addThumbnail(e):t||e.data.palette||(i=this.addThumbnail(e)),i&&$(i.el).addClass("library-added-thumbnail")},this)),t||(e=_.filter(e,function(e){return!e.data.palette})),this.views=_.map(e,this.addThumbnail,this),i||e.length||n||this.$el.find(".library-link").removeClass("hidden"),(i||e.length||n)&&this.$el.find(".library-link").addClass("hidden"),this.initScroll(),INKIVE.Helpers.initTooltips(this.$el)}})},{"../../../../factory/library":103,"../../components/thumbnail/library/color":290,"./base":380,"./colors-template.hbs":381}],383:[function(e,t,n){var i=e("./base"),a=(e("./images"),e("../../../../factory/library"));t.exports=i.extend({type:"folders",subResource:"",filter:{},navigationHistory:[],Views:{text:e("./texts"),logo:e("./logos"),color:e("./colors"),image:e("./images"),icon:e("./icons"),video:e("./videos")},ThumbnailView:e("../../components/thumbnail/library/folder"),events:{"click .folder:not(.parent)":"goToFolderEvent","click .folder.parent":"goBackEvent"},loadData:function(e){a.currentFolderId=null,this.subResource=e,this.filter={types:[e]},i.prototype.loadData.call(this),this.navigationHistory=["root"]},addThumbnail:function(e){var t=$('<li data-id="'+e.id+'" data-folder-id="'+e.data.id+'">'),n=new this.ThumbnailView({el:t,item:e});return this.$el.is(".library")&&t.find(".folder").prepend('<i class="desygner-icon-folder"/>'),this.$el.find("ul.thumbnail-wrapper.folders").append(t),n},goToFolderEvent:function(e){this._goToFolder($(e.currentTarget).closest("li").data("folder-id"))},goBackEvent:function(e){this.navigationHistory.pop(),this._goToFolder(this.navigationHistory[this.navigationHistory.length-1])},_goToFolder:function(e){var t=this.$el.find(".thumbnail-wrapper.folders"),n=this.$el.find(".folder.parent").closest("li");this.$el.find(".thumbnail-wrapper").empty(),INKIVE.Modal.loader(this.$el.find(".thumbnail-wrapper.folders")),"root"===e?this.loadData(this.subResource):(e!==this.navigationHistory[this.navigationHistory.length-1]&&this.navigationHistory.push(e),this.loadResourceData(e+"/resources").then(_.bind(function(i){a.currentFolderId=e;var o=i,r=_.where(o,{type:"Folder"}),s=_.filter(o,function(e){return"Folder"!==e.type});INKIVE.Modal.loaderClose(),this.render(r),t.prepend(n.removeClass("hidden")),this.subview.render(s),this.initScroll()},this)))},render:function(e){var t=this.$el.find(".thumbnail-wrapper.folders"),n=t.length>0;n?(t.empty(),_.each(e,this.addThumbnail,this)):(i.prototype.render.apply(this,arguments),this.initSubview(e.length))},initSubview:function(e){this.subview=new this.Views[this.subResource]({el:this.$el,isSubview:!0,hasParentContent:e}),this.subview.loadData()},refresh:function(){this.initScroll(),this.subview.masonryReload&&this.subview.masonryReload(),this.subview.masonryRefresh&&this.subview.masonryRefresh()}})},{"../../../../factory/library":103,"../../components/thumbnail/library/folder":291,"./base":380,"./colors":382,"./icons":384,"./images":385,"./logos":386,"./texts":388,"./videos":389}],384:[function(e,t,n){var i=e("./base");e("../../../../factory/library");t.exports=i.extend({type:"icons",ThumbnailView:e("../../components/thumbnail/library/icon"),render:function(e){INKIVE.Helpers.projectIsLinkedToRestrictions();this.emptyView(),_.each(e,this.addThumbnail,this),this.toggleNoContentHint(e),this.initScroll()},addThumbnail:function(e){var t=$("<li>"),n=new this.ThumbnailView({el:t,item:e});return this.$el.find("ul.thumbnail-wrapper:not(.folders)").append(t),n}})},{"../../../../factory/library":103,"../../components/thumbnail/library/icon":292,"./base":380}],385:[function(e,t,n){var i=e("./base");e("../../../../factory/library");t.exports=i.extend({type:"images",ThumbnailView:e("../../components/thumbnail/library/image"),initialize:function(){i.prototype.initialize.apply(this,arguments),this.masonryRefresh=_.debounce(_.bind(this.masonryReload,this),1e3),this.scrollRefresh=_.debounce(_.bind(this.initScroll,this),2e3)},render:function(e){INKIVE.Helpers.projectIsLinkedToRestrictions();this.emptyView(),_.each(e,this.addThumbnail,this),this.toggleNoContentHint(e),this.initScroll(),INKIVE.Helpers.initTooltips(this.$el),this.$el.find(".thumbnail-wrapper:not(.folders)").masonry({gutter:10}),INKIVE.ImagesFactory.toggleReplaceImageOverlayButton()},addThumbnail:function(e){var t=$("<li>"),n=new this.ThumbnailView({el:t,item:e});return this.$el.find("ul.thumbnail-wrapper:not(.folders)").append(t),n.on("resize",this.masonryRefresh),n},masonryReload:function(){var e=this.$el.find(".thumbnail-wrapper:not(.folders)");e.masonry({gutter:10}),this.scrollRefresh()}})},{"../../../../factory/library":103,"../../components/thumbnail/library/image":293,"./base":380}],386:[function(e,t,n){var i=e("./base");e("../../../../factory/library");t.exports=i.extend({type:"logos",ThumbnailView:e("../../components/thumbnail/library/logo"),render:function(e){INKIVE.Helpers.projectIsLinkedToRestrictions();this.emptyView(),_.each(e,this.addThumbnail,this),this.toggleNoContentHint(e),this.initScroll()},addThumbnail:function(e){var t=$("<li>"),n=new this.ThumbnailView({el:t,item:e});return this.$el.find("ul.thumbnail-wrapper:not(.folders)").append(t),n}})},{"../../../../factory/library":103,"../../components/thumbnail/library/logo":294,"./base":380}],387:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({1:function(e,t,n,i,a){var o,r=null!=t?t:e.nullContext||{},s=n.helperMissing,l=e.escapeExpression;return'      <div class="section-title">\n        <span>\n          '+l((n.t||t&&t.t||s).call(r,"tool.library.folder",{name:"t",hash:{},data:a}))+'\n        </span>\n      </div>\n      <ul class="thumbnail-wrapper folders">\n        <li class="hidden">\n          <div class="folder parent">\n            <a href="javascript:void(0)" class="folder-name"><i class="fa fa-ellipsis-h"></i></a>\n          </div>\n        </li>\n      </ul>\n      <div class="section-title">\n        <span>\n          '+l((o=null!=(o=n.resourceTitle||(null!=t?t.resourceTitle:t))?o:s,"function"==typeof o?o.call(r,{name:"resourceTitle",hash:{},data:a}):o))+"\n        </span>\n      </div>\n"},compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){var o,r,s=null!=t?t:e.nullContext||{},l=n.helperMissing,c=e.escapeExpression;return'<div class="antiscroll-wrap '+c((r=null!=(r=n.folder||(null!=t?t.folder:t))?r:l,"function"==typeof r?r.call(s,{name:"folder",hash:{},data:a}):r))+'">\n  <div class="antiscroll-inner">\n'+(null!=(o=n["if"].call(s,null!=t?t.folder:t,{name:"if",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a}))?o:"")+'    <ul class="thumbnail-wrapper"></ul>\n    <div class="library-link hidden">\n      <p>'+c((n.t||t&&t.t||l).call(s,"tool.library.empty.message",{name:"t",hash:{},data:a}))+'</p>\n      <a href="'+c((n.route||t&&t.route||l).call(s,"library",{name:"route",hash:{},data:a}))+'" target="_blank" class="btn btn-primary empty">'+c((n.t||t&&t.t||l).call(s,"tool.library.empty.button",{name:"t",hash:{},data:a}))+"</a>\n    </div>\n  </div>\n</div>\n"},useData:!0})},{"hbsfy/runtime":535}],388:[function(e,t,n){var i=e("./base");e("../../../../factory/library");t.exports=i.extend({type:"texts",ThumbnailView:e("../../components/thumbnail/library/text"),render:function(e){INKIVE.Helpers.projectIsLinkedToRestrictions();this.emptyView(),_.each(e,this.addThumbnail,this),this.toggleNoContentHint(e),this.initScroll()},addThumbnail:function(e){var t=$("<li>");e.data.size&&(e.data.size=Math.round(parseFloat(e.data.size)));var n=new this.ThumbnailView({el:t,item:e});return t.find(".name").find("br").remove(),this.$el.find("ul.thumbnail-wrapper:not(.folders)").append(t),n}})},{"../../../../factory/library":103,"../../components/thumbnail/library/text":295,"./base":380}],389:[function(e,t,n){var i=e("./base");e("../../../../factory/library");t.exports=i.extend({type:"videos",ThumbnailView:e("../../components/thumbnail/library/video"),render:function(e){this.emptyView(),_.each(e,this.addThumbnail,this),this.initScroll()},addThumbnail:function(e){var t=$("<li>"),n=new this.ThumbnailView({el:t,item:e});return this.$el.find("ul.thumbnail-wrapper:not(.folders)").append(t),n}})},{"../../../../factory/library":103,"../../components/thumbnail/library/video":296,"./base":380}],390:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){var o=null!=t?t:e.nullContext||{},r=n.helperMissing,s=e.escapeExpression;return'<div class="big-icon"><img src="../assets/img/restrictions/restriction_library.svg"/></div>\n<!--<a class="video" target="_blank" href="/"><i class="icon-restriction_video"></i></a>-->\n\n<a href="'+s((n.route||t&&t.route||r).call(o,"library?r=unlock",{name:"route",hash:{},data:a}))+'" target="_blank" class="btn btn-primary locked">\n    '+s((n.t||t&&t.t||r).call(o,"tool.library.locked.button",{name:"t",hash:{},data:a}))+'\n</a>\n\n<!--<a class="learnmore" target="_blank" href="/">'+s((n.t||t&&t.t||r).call(o,"general.learn_more",{name:"t",hash:{},data:a}))+"</a>-->\n"},useData:!0})},{"hbsfy/runtime":535}],391:[function(e,t,n){var i=e("../components/helper/view"),a=e("./helper.hbs");t.exports=i.extend({events:_.extend({},i.prototype.events,{"click a.locked":"goToLibraryEvent"}),goToLibraryEvent:function(){$('#tool-panel .tool-menu a[href="#tabTutorial"]').trigger("click")},initialize:function(){i.prototype.initialize.call(this),this.data.title="tool.library.locked.message",this.data.content=a(),this.render()}})},{"../components/helper/view":264,"./helper.hbs":390}],392:[function(e,t,n){t.exports={eventCategory:"Editor UI | Tool Menu | logos",show:{eventAction:"show"}}},{}],393:[function(e,t,n){var i=e("../components/common/common-component"),a=e("../../../analytics/decorate");t.exports=a(e("./analytics/view"),i.extend({type:"logo",isAlreadyThere:function(){return!!this.$el.find(".tab-content.logo").length},render:function(){i.prototype.render.call(this),this.$headerLinks.filter("[data-key=library]").trigger("click")}}))},{"../../../analytics/decorate":5,"../components/common/common-component":257,"./analytics/view":392}],394:[function(e,t,n){t.exports={text:[{name:"Content",data:["company_name","company_email","company_instagram","company_twitter","company_facebook","company_linkedin","company_phone_number","company_website","company_youtube","slogan_short","slogan_medium","slogan_long","address_line_1","address_line_2"]},{name:"Font",data:["font_primary","font_secondary","font_tertiary","font_quaternary"]},{name:"Colour",data:["colour_black","colour_white","colour_primary","colour_secondary","colour_tertiary","colour_quaternary"]}],logo:[{name:"Logo",data:["logo_primary_colour","logo_secondary_colour","logo_black_colour","logo_white_colour","logo_icon_primary_colour","logo_icon_secondary_colour","logo_icon_black_colour","logo_icon_white_colour"]}],icon:[{name:"Colour",data:["colour_black","colour_white","colour_primary","colour_secondary","colour_tertiary","colour_quaternary"]}],shape:[{name:"Colour",data:["colour_black","colour_white","colour_primary","colour_secondary","colour_tertiary","colour_quaternary"]}],image:[{name:"Image",data:["image_general_1","image_general_2","image_general_3","image_general_4","image_general_5","image_general_6"]}],background:[{name:"Colour",data:["colour_black","colour_white","colour_primary","colour_secondary","colour_tertiary","colour_quaternary"]},{name:"Image",data:["image_background_1","image_background_2","image_background_3","image_background_4"]}],sticker:[{name:"Colour",data:["colour_primary","colour_secondary","colour_tertiary","colour_quaternary"]},{name:"Icon",data:["logo_primary_colour","logo_secondary_colour","logo_black_colour","logo_white_colour","logo_icon_primary_colour","logo_icon_secondary_colour","logo_icon_black_colour","logo_icon_white_colour"]}],video:[]}},{}],395:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({1:function(e,t,n,i,a){var o,r,s=null!=t?t:e.nullContext||{};return"    <label>"+e.escapeExpression((r=null!=(r=n.name||(null!=t?t.name:t))?r:n.helperMissing,"function"==typeof r?r.call(s,{name:"name",hash:{},data:a}):r))+':</label>\n    <div class="select-wrapper">\n      <select>\n        <option value="">none</option>\n'+(null!=(o=n.each.call(s,null!=t?t.data:t,{name:"each",hash:{},fn:e.program(2,a,0),inverse:e.noop,data:a}))?o:"")+"      </select>\n    </div>\n"},2:function(e,t,n,i,a){var o=e.lambda,r=e.escapeExpression;return'        <option value="'+r(o(t,t))+'">'+r(o(t,t))+"</option>\n"},compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){var o;return'<div class="tab-content placeholders">\n  <div class="wrapper">\n    <h2>Placeholders</h2>\n'+(null!=(o=n.each.call(null!=t?t:e.nullContext||{},t,{name:"each",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a}))?o:"")+"  </div>\n</div>\n"},useData:!0})},{"hbsfy/runtime":535}],396:[function(e,t,n){var i=e("./template.hbs"),a=e("./placeholders.json"),o=e("../../../facade/editor/editor");t.exports=Backbone.View.extend({events:{"change select":"selectPlaceholderEvent"},selectPlaceholderEvent:function(){var e=_.chain(this.$el.find("select")).map(function(e){return $(e).val()}).compact().value().join(",");this.$selectedElement.attr("custom-placeholder",e)},initialize:function(){o.on("select",_.bind(this.setSelection,this))},show:function(){this.render()},setSelection:function(e){this.selectedElement=_(e).first(),this.$selectedElement=this.selectedElement&&("background"===this.selectedElement.id?$("#svgcontent").children("g.background"):$("#"+this.selectedElement.id)),this.$el.is(":visible")&&this.render()},render:function(){if(this.selectedElement){var e=this.$selectedElement.attr("custom-placeholder");this.$el.html(i(a[this.selectedElement.type])),e&&_.each(e.split(","),function(e){this.$el.find('option[value="'+e+'"]').closest("select").val(e)},this)}else this.$el.html(i())},updatePlaceholderSelector:function(e,t){var n="background"===t.id?$("#svgcontent").children("g.background"):$("#"+t.id),i=this.$el.find(".placeholders"),a=i.children('input[name="list"]');i.removeClass("hidden"),a.val(n.attr("custom-placeholder")).tagsinput({typeahead:{source:placeholdersByType[e]||[]},freeInput:!1}),a.on("change",function(){n.attr("custom-placeholder",a.val())})}})},{"../../../facade/editor/editor":76,"./placeholders.json":394,"./template.hbs":395}],397:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({1:function(e,t,n,i,a){return"        <p>"+e.escapeExpression((n.t||t&&t.t||n.helperMissing).call(null!=t?t:e.nullContext||{},"tool.restricted.locked",{name:"t",hash:{},data:a}))+'</p>\n        <div class="u-cant-touch-this">\n          <img src="https://static.inkive.com/assets/img/hammer.svg" />\n          <span>U Can\'t Touch This</span>\n        </div>\n'},3:function(e,t,n,i,a){return"<p>"+e.escapeExpression((n.t||t&&t.t||n.helperMissing).call(null!=t?t:e.nullContext||{},"tool.restricted.description",{name:"t",hash:{},data:a}))+"</p>"},5:function(e,t,n,i,a){var o,r=null!=t?t:e.nullContext||{};return'      <p class="base">'+e.escapeExpression((n.t||t&&t.t||n.helperMissing).call(r,"tool.restricted.change",{name:"t",hash:{},data:a}))+'</p>\n      <ul class="restrictions-list">\n'+(null!=(o=n.each.call(r,null!=t?t.changeList:t,{name:"each",hash:{},fn:e.program(6,a,0),inverse:e.noop,data:a}))?o:"")+"      </ul>\n"},6:function(e,t,n,i,a){var o,r,s,l=null!=t?t:e.nullContext||{},c=n.helperMissing,d="function",u=e.escapeExpression,p=n.blockHelperMissing,h='          <li data-element="'+u((r=null!=(r=n.element||(null!=t?t.element:t))?r:c,typeof r===d?r.call(l,{name:"element",hash:{},data:a}):r))+'">\n            <span>'+u((r=null!=(r=n.name||(null!=t?t.name:t))?r:c,typeof r===d?r.call(l,{name:"name",hash:{},data:a}):r))+'</span>\n            <button class="show-restriction">'+u((n.t||t&&t.t||c).call(l,"editor.view",{name:"t",hash:{},data:a}))+"</button>\n            ";return r=null!=(r=n.change_style||(null!=t?t.change_style:t))?r:c,s={name:"change_style",hash:{},fn:e.program(7,a,0),inverse:e.noop,data:a},o=typeof r===d?r.call(l,s):r,n.change_style||(o=p.call(t,o,s)),null!=o&&(h+=o),h+="\n            ",r=null!=(r=n.change_text||(null!=t?t.change_text:t))?r:c,s={name:"change_text",hash:{},fn:e.program(9,a,0),inverse:e.noop,data:a},o=typeof r===d?r.call(l,s):r,n.change_text||(o=p.call(t,o,s)),null!=o&&(h+=o),h+="\n            ",r=null!=(r=n.change_image||(null!=t?t.change_image:t))?r:c,s={name:"change_image",hash:{},fn:e.program(11,a,0),inverse:e.noop,data:a},o=typeof r===d?r.call(l,s):r,n.change_image||(o=p.call(t,o,s)),null!=o&&(h+=o),h+"\n          </li>\n"},7:function(e,t,n,i,a){return'<i class="icon-design" data-popover="tooltip" data-original-title="'+e.escapeExpression((n.t||t&&t.t||n.helperMissing).call(null!=t?t:e.nullContext||{},"tool.restricted.change_style",{name:"t",hash:{},data:a}))+'"></i>'},9:function(e,t,n,i,a){return'<i class="icon-text-editor" data-popover="tooltip" data-original-title="'+e.escapeExpression((n.t||t&&t.t||n.helperMissing).call(null!=t?t:e.nullContext||{},"tool.restricted.change_text",{name:"t",hash:{},data:a}))+'"></i>'},11:function(e,t,n,i,a){return'<i class="icon-image-replace" data-popover="tooltip" data-original-title="'+e.escapeExpression((n.t||t&&t.t||n.helperMissing).call(null!=t?t:e.nullContext||{},"tool.restricted.change_image",{name:"t",hash:{},data:a}))+'"></i>'},13:function(e,t,n,i,a){var o,r=null!=t?t:e.nullContext||{};return'      <p class="base">'+e.escapeExpression((n.t||t&&t.t||n.helperMissing).call(r,"tool.restricted.add.title",{name:"t",hash:{},data:a}))+'</p>\n      <ul class="restrictions-list">\n'+(null!=(o=n.each.call(r,null!=t?t.addList:t,{name:"each",hash:{},fn:e.program(14,a,0),inverse:e.noop,data:a}))?o:"")+"      </ul>\n"},14:function(e,t,n,i,a){var o,r=null!=t?t:e.nullContext||{},s=n.helperMissing,l=e.escapeExpression;return'          <li data-element="'+l((o=null!=(o=n.element||(null!=t?t.element:t))?o:s,"function"==typeof o?o.call(r,{name:"element",hash:{},data:a}):o))+'">\n            <span>'+l((n.t||t&&t.t||s).call(r,t,{name:"t",hash:{},data:a}))+"</span>\n          </li>\n"},16:function(e,t,n,i,a){var o,r=null!=t?t:e.nullContext||{};return'      <p class="base">'+e.escapeExpression((n.t||t&&t.t||n.helperMissing).call(r,"tool.restricted.do.title",{name:"t",hash:{},data:a}))+'</p>\n      <ul class="restrictions-list">\n'+(null!=(o=n.each.call(r,null!=t?t.doList:t,{name:"each",hash:{},fn:e.program(14,a,0),inverse:e.noop,data:a}))?o:"")+"      </ul>\n"},compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){var o,r,s,l=null!=t?t:e.nullContext||{},c=n.helperMissing,d="function",u=n.blockHelperMissing,p='<div class="antiscroll-wrap">\n  <div class="antiscroll-inner">\n    <div class="accordion tab-content restricted active sub-category">\n      <h2>'+e.escapeExpression((n.t||t&&t.t||c).call(l,"tool.restricted.title",{name:"t",hash:{},data:a}))+"</h2>\n";return r=null!=(r=n.locked||(null!=t?t.locked:t))?r:c,s={name:"locked",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a},o=typeof r===d?r.call(l,s):r,n.locked||(o=u.call(t,o,s)),null!=o&&(p+=o),p+="\n      ",r=null!=(r=n.locked||(null!=t?t.locked:t))?r:c,s={name:"locked",hash:{},fn:e.noop,inverse:e.program(3,a,0),data:a},o=typeof r===d?r.call(l,s):r,n.locked||(o=u.call(t,o,s)),null!=o&&(p+=o),p+"\n\n"+(null!=(o=n["if"].call(l,null!=t?t.hasChangeList:t,{name:"if",hash:{},fn:e.program(5,a,0),inverse:e.noop,data:a}))?o:"")+"\n"+(null!=(o=n["if"].call(l,null!=t?t.hasAddList:t,{name:"if",hash:{},fn:e.program(13,a,0),inverse:e.noop,data:a}))?o:"")+"\n"+(null!=(o=n["if"].call(l,null!=t?t.hasDoList:t,{name:"if",hash:{},fn:e.program(16,a,0),inverse:e.noop,data:a}))?o:"")+"    </div>\n  </div>\n</div>\n"},useData:!0})},{"hbsfy/runtime":535}],398:[function(e,t,n){var i=e("./template.hbs"),a=e("../../../facade/editor/editor"),o=e("../../../facade/design/design"),r=e("../components/mixins/scrollable"),s=e("../../../facade/restrictions/restrictions");t.exports=Backbone.mixin(Backbone.View.extend({events:{"click button.show-restriction":"showRestrictionEvent"},initialize:function(){function e(){var e=this.$el.find(".restricted").length;e&&this.render()}e=_.bind(e,this),o.on("template.update.restricted",e),a.on("page.move_to",e)},showRestrictionEvent:function(e){var t=INKIVE.Tool.getInstance().editor.canvas,n=$(e.currentTarget).closest("li").data("element"),i="background"===n?$("#svgcontent").children("g.background"):$("#"+n);t.setMode("select"),t.selectOnly([i[0]],!0)},show:function(){var e=this.$el.find(".restricted").length;e||this.render()},render:function(){var e={doList:this.getDoList(),addList:this.getAddList(),changeList:this.getChangeList()};_.extend(e,{hasDoList:e.doList.length>0,hasAddList:e.addList.length>0,hasChangeList:e.changeList.length>0}),_.extend(e,{locked:!e.hasDoList&&!e.hasAddList&&!e.hasChangeList}),this.$el.html(i(e)),INKIVE.Helpers.initTooltips(this.$el)},getDoList:function(){return _.chain(["function_print_file","function_share_file","function_download_file"]).filter(s.isFunctionalityAllowed).map(function(e){return"tool.restricted.do."+e}).value()},getAddList:function(){return _.chain(["image_add","text_add","vector_add","logo_add","icon_add","video_add","function_draw"]).filter(s.isFunctionalityAllowed).map(function(e){return"tool.restricted.add."+e}).value()},getChangeList:function(){function e(e){var t="image"==e.type||"background"==e.type||"logo"==e.type||"icon"==e.type||"video"==e.type;return!!t&&("background"==e.type?_.any(s.getAllElementPermissions("background"),function(e){return e.basic&&e.basic.image}):s.isActionAllowed("image_replace",e.id)||s.isActionAllowed("logo_replace",e.id)||s.isActionAllowed("icon_replace",e.id)||s.isActionAllowed("video_replace",e.id))}function t(e){return"text"==e.type&&s.isActionAllowed("text_change_content",e.id)}function n(e){if("background"==e.type)return _.any(s.getAllElementPermissions("background"),function(e){return e.basic&&_.any(e.basic,function(e,t){return"image"!==t&&e})});var t=["image_add","text_add","vector_add","logo_add","icon_add","video_add","image_replace","video_replace","logo_replace","text_change_content"];return _.any(s.getAllDefaultPermissions(),function(n,i){return t.indexOf(i)===-1&&0===i.indexOf(e.type)&&s.isActionAllowed(i,e.id)})}return _.compact(_.map(o.get(),function(i){if(i.name)var a=i.name;else{var o=i.id.split("_"),a=i.type;o.length>1&&(a+=" "+o[1]),a=a.charAt(0).toUpperCase()+a.slice(1)}var r={name:a,element:i.id,change_image:e(i),change_text:t(i),change_style:n(i)};return r.change_image||r.change_text||r.change_style?r:null}))}}),r)},{"../../../facade/design/design":34,
"../../../facade/editor/editor":76,"../../../facade/restrictions/restrictions":94,"../components/mixins/scrollable":269,"./template.hbs":397}],399:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({1:function(e,t,n,i,a){var o;return"<span>"+e.escapeExpression(e.lambda(null!=(o=null!=t?t.restrictions:t)?o.length:o,t))+"</span>"},3:function(e,t,n,i,a){var o;return'  <p class="restrictions-list">'+(null!=(o=(n.t||t&&t.t||n.helperMissing).call(null!=t?t:e.nullContext||{},"tool.restrictions.element.empty",{name:"t",hash:{},data:a}))?o:"")+"</p>\n"},5:function(e,t,n,i,a){var o,r=null!=t?t:e.nullContext||{},s=n.helperMissing,l="function",c=e.escapeExpression;return'      <li data-element="'+c((o=null!=(o=n.element||(null!=t?t.element:t))?o:s,typeof o===l?o.call(r,{name:"element",hash:{},data:a}):o))+'">\n        <div class="name-container">\n          '+c((n.math||t&&t.math||s).call(r,a&&a.index,"+",1,{name:"math",hash:{},data:a}))+') <span class="name">'+c((o=null!=(o=n.name||(null!=t?t.name:t))?o:s,typeof o===l?o.call(r,{name:"name",hash:{},data:a}):o))+'</span>\n        </div>\n\n        <div class="actions">\n          <button class="change-name">Change name</button>\n          <button class="show-restriction">'+c((n.t||t&&t.t||s).call(r,"editor.view",{name:"t",hash:{},data:a}))+'</button>\n          <i class="fa fa-trash remove"></i>\n        </div>\n      </li>\n'},compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){var o,r,s,l=null!=t?t:e.nullContext||{},c=n.helperMissing,d=e.escapeExpression,u="function",p=n.blockHelperMissing,h='<div class="group no-top-margin">\n  <div>\n    <h4>\n      '+d((n.t||t&&t.t||c).call(l,"tool.restrictions.element.title",{name:"t",hash:{},data:a}))+"\n      ";return r=null!=(r=n.has_restrictions||(null!=t?t.has_restrictions:t))?r:c,s={name:"has_restrictions",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a},o=typeof r===u?r.call(l,s):r,n.has_restrictions||(o=p.call(t,o,s)),null!=o&&(h+=o),h+="\n    </h4>\n  </div>\n\n",r=null!=(r=n.has_restrictions||(null!=t?t.has_restrictions:t))?r:c,s={name:"has_restrictions",hash:{},fn:e.noop,inverse:e.program(3,a,0),data:a},o=typeof r===u?r.call(l,s):r,n.has_restrictions||(o=p.call(t,o,s)),null!=o&&(h+=o),h+'\n  <ul class="restrictions-list">\n'+(null!=(o=n.each.call(l,null!=t?t.restrictions:t,{name:"each",hash:{},fn:e.program(5,a,0),inverse:e.noop,data:a}))?o:"")+'  </ul>\n\n  <div class="element-selected hidden">\n    '+d((n.t||t&&t.t||c).call(l,"tool.restrictions.element.selected",{name:"t",hash:{},data:a}))+'\n    <br><i class="fa fa-check-circle-o" /> '+d((n.t||t&&t.t||c).call(l,"tool.restrictions.template.can",{name:"t",hash:{},data:a}))+'\n    <br><i class="fa fa-ban" /> '+d((n.t||t&&t.t||c).call(l,"tool.restrictions.template.cannot",{name:"t",hash:{},data:a}))+"\n  </div>\n</div>\n"},useData:!0})},{"hbsfy/runtime":535}],400:[function(e,t,n){var i=e("./element-restrictions.hbs"),a=e("../../../facade/editor/editor"),o=e("../../../facade/design/design"),r=e("../../../factory/restrictions"),s=e("../../../facade/restrictions/restrictions"),l={logo:e("./element/logo-type"),icon:e("./element/icon-type"),text:e("./element/text-type"),image:e("./element/image-type"),vector:e("./element/vector-type"),video:e("./element/video-type"),background:e("./element/background-type")};t.exports=Backbone.mixin(Backbone.View.extend({events:{"click .remove":"removeRestrictionEvent","click button.show-restriction":"showRestrictionEvent","click button.change-name":"changeNameEvent"},removeRestrictionEvent:function(e){INKIVE.Modal.alertMessage("Sure you want to remove element restrictions?",{width:450,callback:[_.bind(function(){r.setGlobalElementRestriction($(e.currentTarget).closest("li").data("element")),this.refresh()},this),$.noop]})},showRestrictionEvent:function(e){var t=$(e.currentTarget).closest("li").data("element"),n=INKIVE.Tool.getInstance().editor.canvas,i="background"===t?$("#svgcontent").children("g.background").children(":not(title)").last():$("#"+t);n.setMode("select"),n.selectOnly([i[0]],!0)},changeNameEvent:function(t){var n=e("../../../modal/prompt"),i=$(t.currentTarget).closest("li").data("element"),a=$("[data-element="+i+"]").find(".name").text(),o=new n({label:"New name",defaultValue:a}),s=INKIVE.Modal.modalWindow(o.getFormHtml(),{width:400,headerIcon:"fa fa-edit",headerTitle:"Change restriction name",buttons:[{title:"Ok",onClick:function(){s.close();var e=o.getValue();$("[data-element="+i+"]").find(".name").text(e),r.setGlobalRestrictionName(i,e)}}]})},initialize:function(){_.bindAll(this,"render","refresh","setSelection"),a.on("select",this.setSelection),this.refresh()},refresh:function(){var e=$.Deferred();return r.getElementPermissions().then(_.bind(function(t){this.render(t),e.resolve()},this)),e.promise()},setSelection:function(e){var t=_(e).first();if($("#margin-box, #vertical-line, #horizontal-line").remove(),this.$el.find("input:focus").blur(),e.length<2){this.currentRestrictionsView&&this.currentRestrictionsView.remove();var n=t&&s.getType(t.type);if(t&&l[n]){var i=$('<div class="group content"></div>');return this.$el.append(i),this.currentRestrictionsView=new l[n]({el:i,selection:t}),this.currentRestrictionsView.on("update",_.bind(this.trigger,this,"update")),this.$el.find(".restrictions-list").addClass("hidden"),void this.$el.find(".element-selected").removeClass("hidden")}}this.refresh()},render:function(e){var t=this.getSingleElementPermissions(e);this.$el.html(i({has_restrictions:t.length>0,restrictions:t})),this.trigger("update")},getSingleElementPermissions:function(e){var t=[],n=_.map(e,function(e){var t=e.page_number==INKIVE.Tool._current_page_number&&o.get(e.element_id);if(t)if(e.name)var n=e.name;else{var i=e.element_id.split("_"),n=t.type;i.length>1&&(n+=" "+i[1])}return t?{name:n,element:e.element_id}:{}});return _.each(n,function(e){var n=_(t).findWhere({element:e.element}),i="background"==e.element||$("#"+e.element).length;!n&&i&&t.push(e)}),t}}),Backbone.Events)},{"../../../facade/design/design":34,"../../../facade/editor/editor":76,"../../../facade/restrictions/restrictions":94,"../../../factory/restrictions":122,"../../../modal/prompt":139,"./element-restrictions.hbs":399,"./element/background-type":403,"./element/icon-type":415,"./element/image-type":417,"./element/logo-type":419,"./element/text-type":421,"./element/vector-type":423,"./element/video-type":425}],401:[function(e,t,n){var i=(e("./text-type.hbs"),e("../../../../factory/company").instance),a=e("../../../../factory/restrictions");t.exports=Backbone.mixin(Backbone.View.extend({type:null,basicHide:[],groupHeight:{},events:{"change .restrictions.group > input":"toggleSectionEvent","change .restrictions.group .options input":"toggleRestrictionEvent","change .restrictions.group .options select":"toggleRestrictionEvent"},toggleSectionEvent:function(e){this.onSectionChange($(e.currentTarget))},toggleRestrictionEvent:function(e){this.persistOptionRestriction($(e.currentTarget))},onSectionChange:function(e){var t=e.closest(".restrictions.group"),n=t.data("name");n?(this.toggleRestrictionsGroup(t,e.is(":checked")),a.getElementPermissions().then(_.bind(function(t){var i=_(t).findWhere({page_number:INKIVE.Tool._current_page_number,element_id:this.selection.id}),o=i?JSON.parse(i.restrictions):{};if(e.is(":checked")){var r=e.siblings(".options");r.length?r.find("input, select").trigger("change"):(o[n]=!0,a.setGlobalElementRestriction(this.selection.id,JSON.stringify(o)))}else o=_(o).omit(n),a.setGlobalElementRestriction(this.selection.id,JSON.stringify(o))},this))):(_(t.find(".restrictions.group > input:checked")).each(function(e){$(e).prop("checked",!1),this.onSectionChange($(e))},this),this.toggleRestrictionsGroup(t,e.is(":checked")),this.persistOptionRestriction(e))},persistOptionRestriction:function(e){var t=e.closest(".restrictions.group").data("name");(t||"undefined"==typeof t)&&(t=t||"basic",a.getElementPermissions().then(_.bind(function(n){var i=_(n).findWhere({page_number:INKIVE.Tool._current_page_number,element_id:this.selection.id}),o=e.attr("name"),r=e.closest(".restrictions.group[data-field]").data("field"),s=i?JSON.parse(i.restrictions):{},l=this.getOptionValue(e);s[t]=s[t]||{},r&&(s.basic||(s.basic={}),s.basic[r]=!!l),o&&(s[t][o]=l),"undefined"==typeof l&&(s[t]=_(s[t]).omit(o)),"basic"!==t&&this.isEmptyOption(l)&&(o?s[t]=_(s[t]).omit(o):_.size(s[t])||(s=_(s).omit(t))),a.setGlobalElementRestriction(this.selection.id,JSON.stringify(s))},this)))},isEmptyOption:function(e){return e===!1||null===e||""===e||_.isObject(e)&&!_.size(e)},getOptionValue:function(e){return e.is('input[type="checkbox"]')?e.is(":checked"):e.is('input[type="text"]')?e.val():e.is('input[type="number"]')?""===e.val()?null:parseFloat(e.val()):e.is("select")?e.val():void 0},initialize:function(e){this.selection=e.selection,_.bindAll(this,"refresh"),this.refresh()},refresh:function(){$.when(i.get("groups"),a.getElementPermissions(),a.getTemplatePermissions()).then(_.bind(function(e,t,n){this.groups=e,this.ePermissions=t,this.tPermissions=n,this.groupHeight={},this.render()},this))},renderRestrictions:function(){var e=_(this.ePermissions).findWhere({page_number:INKIVE.Tool._current_page_number,element_id:this.selection.id});if(this.renderDefaultRestrictions(),e){var t=JSON.parse(e.restrictions);_.each(this.$el.find(".restrictions.group[data-field]"),_.bind(function(e){var n=$(e).data("field"),i=t.basic&&t.basic[n];$(e).children('input[type="checkbox"]').prop("checked",!!i),this.toggleRestrictionsGroup($(e),i)},this)),_.each(this.$el.find(".restrictions.group[data-name]"),_.bind(function(e){var n=$(e).data("name"),i=$(e).parents(".restrictions.group[data-field]").attr("data-field"),a=t.basic&&t.basic[i];this._renderRestrictions(t,n),a&&this.toggleRestrictionsGroup($(e),"basic"===n||t[n])},this))}},renderDefaultRestrictions:function(){var e={},t=new RegExp("^"+this.type+"_.*");_(this.tPermissions[0]).each(function(n,i){i.match(t)&&(e[i]=n)}),this._renderRestrictions({basic:e},"basic"),_.each(this.$el.find(".restrictions.group[data-field]"),_.bind(function(t){var n=$(t).data("field"),i=e[n];$(t).children('input[type="checkbox"]').prop("checked",!!i),this.toggleRestrictionsGroup($(t),i)},this)),_.each(this.$el.find(".restrictions.group[data-name]"),_.bind(function(e){var t=$(e).children('input[type="checkbox"]');this.toggleRestrictionsGroup($(e),!t.length),t.prop("checked",!1)},this))},_renderRestrictions:function(e,t){var n=e[t],i=this.$el.find('.restrictions.group[data-name="'+t+'"]');i.children('input[type="checkbox"]').prop("checked",n),_.each(n,function(e,t){i.find('input[type="checkbox"][name="'+t+'"]').prop("checked",e),i.find('input[type="number"][name="'+t+'"]').val(e),i.find('input[type="text"][name="'+t+'"]').val(e),i.find('select[name="'+t+'"]').val(e)},this)},toggleRestrictionsGroup:function(e,t){t&&this.openRestrictionsGroup(e),t||this.closeRestrictionsGroup(e),this.trigger("update")},openRestrictionsGroup:function(e,t){var n=t||0,i=this.getGroupHeight(e);if(e.children(".options").length&&(_(e.contents()).each(function(e){1===e.nodeType&&(n+=$(e).outerHeight(!0))}),this.setGroupHeight(e,i<n?n:i),i<n)){var a=e.parents(".restrictions.group[data-field]");a.length&&this.resizeRestrictionsGroup(a,n-i)}e.data("radiogroup")&&this.toggleGroupSiblings(e)},closeRestrictionsGroup:function(e){var t=(e.data("name")||e.data("field"),e.children("label").height()),n=this.getGroupHeight(e);this.setGroupHeight(e,t);var i=e.parents(".restrictions.group[data-field]");this.resizeRestrictionsGroup(i,t-n)},toggleGroupSiblings:function(e){var t=e.data("radiogroup"),n=this.$el.find('.restrictions.group[data-radiogroup="'+t+'"]');_.each(n,function(t){if(t!=e[0]){t=$(t);var n=t.children('input[type="checkbox"]');n.is(":checked")&&(n.prop("checked",!1),this.onSectionChange(t))}},this)},resizeRestrictionsGroup:function(e,t){e.data("name")||e.data("field");if(t){var n=this.getGroupHeight(e)+t;this.setGroupHeight(e,n)}},getGroupHeight:function(e){var t=e.data("name")||e.data("field");return"undefined"==typeof t||"undefined"==typeof this.groupHeight[t]?e.height():this.groupHeight[t]},setGroupHeight:function(e,t){var n=e.data("name")||e.data("field");"undefined"!=typeof n&&(this.groupHeight[n]=t),e.height(t)}}),Backbone.Events)},{"../../../../factory/company":98,"../../../../factory/restrictions":122,"./text-type.hbs":420}],402:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){var o=null!=t?t:e.nullContext||{},r=n.helperMissing,s=e.escapeExpression;return'<div class="wrapper">\n  <div class="restrictions group" data-name="opacity">\n    <input tabindex="-1" type="checkbox" id="element-restrictions-opacity" />\n    <label for="element-restrictions-opacity">'+s((n.t||t&&t.t||r).call(o,"tool.restrictions.element.background.opacity",{name:"t",hash:{},data:a}))+'</label>\n  </div>\n\n  <div class="restrictions group" data-name="flip">\n    <input tabindex="-1" type="checkbox" id="element-restrictions-flip" />\n    <label for="element-restrictions-flip">'+s((n.t||t&&t.t||r).call(o,"tool.restrictions.element.background.flip",{name:"t",hash:{},data:a}))+'</label>\n  </div>\n\n  <div class="restrictions group" data-field="image">\n    <input tabindex="-1" type="checkbox" id="element-restrictions-image-content" />\n    <label for="element-restrictions-image-content">'+s((n.t||t&&t.t||r).call(o,"tool.restrictions.element.background.image",{name:"t",hash:{},data:a}))+'</label>\n    <ul class="options">\n      <li>\n        <div class="restrictions group" data-name="images">\n          <input tabindex="-1" type="checkbox" id="element-restrictions-images" />\n          <label for="element-restrictions-images">'+s((n.t||t&&t.t||r).call(o,"tool.restrictions.element.common.source_list",{name:"t",hash:{},data:a}))+'</label>\n          <ul class="options"><li></li></ul>\n        </div>\n      </li>\n    </ul>\n  </div>\n\n  <div class="restrictions group" data-field="color">\n    <input tabindex="-1" type="checkbox" id="element-restrictions-color-content" />\n    <label for="element-restrictions-color-content">'+s((n.t||t&&t.t||r).call(o,"tool.restrictions.element.background.color",{name:"t",hash:{},data:a}))+'</label>\n    <ul class="options">\n      <li>\n        <div class="restrictions group" data-name="colors">\n          <input tabindex="-1" type="checkbox" id="element-restrictions-colors" />\n          <label for="element-restrictions-colors">'+s((n.t||t&&t.t||r).call(o,"tool.restrictions.element.common.color_list",{name:"t",hash:{},data:a}))+'</label>\n          <ul class="options"><li></li></ul>\n        </div>\n      </li>\n    </ul>\n  </div>\n\n</div>\n'},useData:!0})},{"hbsfy/runtime":535}],403:[function(e,t,n){var i=e("./abstract-type"),a=e("./background-type.hbs"),o=(e("../../components/thumbnail/color"),e("./element-list/view")),r=e("../../../../facade/design/design");t.exports=i.extend({type:"background",toggleSectionEvent:function(e){$(e.currentTarget).is("#element-restrictions-images:checked")&&!this.imagesListView.getData().length&&this.imagesListView.addElement(this.selection.source),$(e.currentTarget).is("#element-restrictions-colors:checked")&&!this.colorsListView.getData().length&&this.colorsListView.addElement(this.selection.color),i.prototype.toggleSectionEvent.apply(this,arguments)},render:function(e){this.$el.html(a()),this.initImagesList(),this.initColorsList(),this.renderRestrictions()},initImagesList:function(){this.imagesListView&&this.imagesListView.remove(),this.imagesListView=new o({el:this.$el.find('.restrictions.group[data-name="images"] li'),type:"background",uuid:"background"}),this.imagesListView.on("change",_.bind(this.elementListChange,this,this.imagesListView)),this.imagesListView.on("apply",function(e){r.set("background",{source:e})})},initColorsList:function(){this.colorsListView&&this.colorsListView.remove(),this.colorsListView=new o({el:this.$el.find('.restrictions.group[data-name="colors"] li'),type:"color",uuid:"color"}),this.colorsListView.on("change",_.bind(this.elementListChange,this,this.colorsListView)),this.colorsListView.on("apply",function(e){r.set("background",{color:e})})},elementListChange:function(e){var t=e.$el.find("input");this.persistOptionRestriction(t),this.toggleRestrictionsGroup(t.closest(".restrictions.group"),!0)},getOptionValue:function(e){return e.is(".element-list")?"background"==e.data("uuid")?this.imagesListView.getData():this.colorsListView.getData():i.prototype.getOptionValue.apply(this,arguments)},_renderRestrictions:function(e,t){"images"==t&&e[t]&&_(e[t].list).each(this.imagesListView.addElement),"colors"==t&&e[t]&&_(e[t].list).each(this.colorsListView.addElement),i.prototype._renderRestrictions.apply(this,arguments)}})},{"../../../../facade/design/design":34,"../../components/thumbnail/color":284,"./abstract-type":401,"./background-type.hbs":402,"./element-list/view":413}],404:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({1:function(e,t,n,i,a){return"<label>"+e.escapeExpression((n.t||t&&t.t||n.helperMissing).call(null!=t?t:e.nullContext||{},"tool.restrictions.element.common.background_list_empty",{name:"t",hash:{},data:a}))+"</label>"},3:function(e,t,n,i,a){return"<label>"+e.escapeExpression((n.t||t&&t.t||n.helperMissing).call(null!=t?t:e.nullContext||{},"tool.restrictions.element.common.background_list_desc",{name:"t",hash:{},data:a}))+"</label>"},5:function(e,t,n,i,a){var o=e.lambda,r=e.escapeExpression;return'    <div class="thumbnail image" data-value="'+r(o(t,t))+'" style="background-image: url('+r(o(t,t))+')">\n      <span class="remove"><i class="fa fa-times"></i></span>\n    </div>\n'},compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){var o,r,s=null!=t?t:e.nullContext||{};return'<div class="thumbnails-wrapper">\n  <input type="hidden" name="list" class="element-list" data-uuid="'+e.escapeExpression((r=null!=(r=n.uuid||(null!=t?t.uuid:t))?r:n.helperMissing,"function"==typeof r?r.call(s,{name:"uuid",hash:{},data:a}):r))+'"/>\n  '+(null!=(o=n["if"].call(s,null!=t?t.no_data:t,{name:"if",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a}))?o:"")+"\n  "+(null!=(o=n["if"].call(s,null!=t?t.show_hint:t,{name:"if",hash:{},fn:e.program(3,a,0),inverse:e.noop,data:a}))?o:"")+"\n\n"+(null!=(o=n.each.call(s,null!=t?t.data:t,{name:"each",hash:{},fn:e.program(5,a,0),inverse:e.noop,data:a}))?o:"")+"</div>\n"},useData:!0})},{"hbsfy/runtime":535}],405:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({1:function(e,t,n,i,a){var o=e.lambda,r=e.escapeExpression;return'    <div class="thumbnail color" data-value="'+r(o(t,t))+'" style="background-color: '+r(o(t,t))+'">\n      <span class="remove"><i class="fa fa-times"></i></span>\n    </div>\n'},compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){var o,r,s=null!=t?t:e.nullContext||{};return'<div class="thumbnails-wrapper">\n  <input type="hidden" name="list" class="element-list" data-uuid="'+e.escapeExpression((r=null!=(r=n.uuid||(null!=t?t.uuid:t))?r:n.helperMissing,"function"==typeof r?r.call(s,{name:"uuid",hash:{},data:a}):r))+'"/>\n\n'+(null!=(o=n.each.call(s,null!=t?t.data:t,{name:"each",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a}))?o:"")+'\n  <div class="addmore add">\n    <i class="icon-plus"></i>\n  </div>\n</div>\n'},useData:!0})},{"hbsfy/runtime":535}],406:[function(e,t,n){var i=e("./logos-view");t.exports=i.extend({template:e("./icons.hbs")})},{"./icons.hbs":407,"./logos-view":409}],407:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({1:function(e,t,n,i,a){return"<label>"+e.escapeExpression((n.t||t&&t.t||n.helperMissing).call(null!=t?t:e.nullContext||{},"tool.restrictions.element.common.icon_list_empty",{name:"t",hash:{},data:a}))+"</label>"},3:function(e,t,n,i,a){return"<label>"+e.escapeExpression((n.t||t&&t.t||n.helperMissing).call(null!=t?t:e.nullContext||{},"tool.restrictions.element.common.icon_list_desc",{name:"t",hash:{},data:a}))+"</label>"},5:function(e,t,n,i,a){var o,r=null!=t?t:e.nullContext||{},s=n.helperMissing,l="function",c=e.escapeExpression;return'    <div class="thumbnail logo" data-thumb="'+c((o=null!=(o=n.thumb_src||(null!=t?t.thumb_src:t))?o:s,typeof o===l?o.call(r,{name:"thumb_src",hash:{},data:a}):o))+'" data-isvector="'+c((o=null!=(o=n.is_vector||(null!=t?t.is_vector:t))?o:s,typeof o===l?o.call(r,{name:"is_vector",hash:{},data:a}):o))+'" style="background-image: url('+c((o=null!=(o=n.thumb_src||(null!=t?t.thumb_src:t))?o:s,typeof o===l?o.call(r,{name:"thumb_src",hash:{},data:a}):o))+')">\n      <span class="remove"><i class="fa fa-times"></i></span>\n    </div>\n'},compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){var o,r,s=null!=t?t:e.nullContext||{};return'<div class="thumbnails-wrapper">\n  <input type="hidden" name="list" class="element-list" data-uuid="'+e.escapeExpression((r=null!=(r=n.uuid||(null!=t?t.uuid:t))?r:n.helperMissing,"function"==typeof r?r.call(s,{name:"uuid",hash:{},data:a}):r))+'"/>\n  '+(null!=(o=n["if"].call(s,null!=t?t.no_data:t,{name:"if",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a}))?o:"")+"\n  "+(null!=(o=n["if"].call(s,null!=t?t.show_hint:t,{name:"if",hash:{},fn:e.program(3,a,0),inverse:e.noop,data:a}))?o:"")+"\n\n"+(null!=(o=n.each.call(s,null!=t?t.data:t,{name:"each",hash:{},fn:e.program(5,a,0),inverse:e.noop,data:a}))?o:"")+"</div>\n"},useData:!0})},{"hbsfy/runtime":535}],408:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({1:function(e,t,n,i,a){return"<label>"+e.escapeExpression((n.t||t&&t.t||n.helperMissing).call(null!=t?t:e.nullContext||{},"tool.restrictions.element.common.source_list_empty",{name:"t",hash:{},data:a}))+"</label>"},3:function(e,t,n,i,a){return"<label>"+e.escapeExpression((n.t||t&&t.t||n.helperMissing).call(null!=t?t:e.nullContext||{},"tool.restrictions.element.common.source_list_desc",{name:"t",hash:{},data:a}))+"</label>"},5:function(e,t,n,i,a){var o=e.lambda,r=e.escapeExpression;return'    <div class="thumbnail image" data-value="'+r(o(t,t))+'" style="background-image: url('+r(o(t,t))+')">\n      <span class="remove"><i class="fa fa-times"></i></span>\n    </div>\n'},compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){var o,r,s=null!=t?t:e.nullContext||{};return'<div class="thumbnails-wrapper">\n  <input type="hidden" name="list" class="element-list" data-uuid="'+e.escapeExpression((r=null!=(r=n.uuid||(null!=t?t.uuid:t))?r:n.helperMissing,"function"==typeof r?r.call(s,{name:"uuid",hash:{},data:a}):r))+'"/>\n  '+(null!=(o=n["if"].call(s,null!=t?t.no_data:t,{name:"if",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a}))?o:"")+"\n  "+(null!=(o=n["if"].call(s,null!=t?t.show_hint:t,{name:"if",hash:{},fn:e.program(3,a,0),inverse:e.noop,data:a}))?o:"")+"\n\n"+(null!=(o=n.each.call(s,null!=t?t.data:t,{name:"each",hash:{},fn:e.program(5,a,0),inverse:e.noop,data:a}))?o:"")+"</div>\n"},useData:!0})},{"hbsfy/runtime":535}],409:[function(e,t,n){var i=e("./view");t.exports=i.extend({template:e("./logos.hbs"),applyElementEvent:function(e){var t=$(e.currentTarget).closest(".thumbnail");this.trigger("apply",{thumb_src:t.data("thumb"),is_vector:t.data("isvector")})},removeElementEvent:function(e){var t=$(e.currentTarget).closest(".thumbnail").data("thumb");this.data=_(this.data).filter(function(e){return e.thumb_src!=t}),this.render(),this.trigger("change",this.getData()),e.stopPropagation()},render:function(){this.$el.html(this.template({uuid:this.uuid,data:this.data,no_data:this.data.length<1,show_hint:1==this.data.length}))}})},{"./logos.hbs":410,"./view":413}],410:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({1:function(e,t,n,i,a){return"<label>"+e.escapeExpression((n.t||t&&t.t||n.helperMissing).call(null!=t?t:e.nullContext||{},"tool.restrictions.element.common.logo_list_empty",{name:"t",hash:{},data:a}))+"</label>"},3:function(e,t,n,i,a){return"<label>"+e.escapeExpression((n.t||t&&t.t||n.helperMissing).call(null!=t?t:e.nullContext||{},"tool.restrictions.element.common.logo_list_desc",{name:"t",hash:{},data:a}))+"</label>"},5:function(e,t,n,i,a){var o,r=null!=t?t:e.nullContext||{},s=n.helperMissing,l="function",c=e.escapeExpression;return'    <div class="thumbnail logo" data-thumb="'+c((o=null!=(o=n.thumb_src||(null!=t?t.thumb_src:t))?o:s,typeof o===l?o.call(r,{name:"thumb_src",hash:{},data:a}):o))+'" data-isvector="'+c((o=null!=(o=n.is_vector||(null!=t?t.is_vector:t))?o:s,typeof o===l?o.call(r,{name:"is_vector",hash:{},data:a}):o))+'" style="background-image: url('+c((o=null!=(o=n.thumb_src||(null!=t?t.thumb_src:t))?o:s,typeof o===l?o.call(r,{name:"thumb_src",hash:{},data:a}):o))+')">\n      <span class="remove"><i class="fa fa-times"></i></span>\n    </div>\n'},compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){var o,r,s=null!=t?t:e.nullContext||{};return'<div class="thumbnails-wrapper">\n  <input type="hidden" name="list" class="element-list" data-uuid="'+e.escapeExpression((r=null!=(r=n.uuid||(null!=t?t.uuid:t))?r:n.helperMissing,"function"==typeof r?r.call(s,{name:"uuid",hash:{},data:a}):r))+'"/>\n  '+(null!=(o=n["if"].call(s,null!=t?t.no_data:t,{name:"if",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a}))?o:"")+"\n  "+(null!=(o=n["if"].call(s,null!=t?t.show_hint:t,{name:"if",hash:{},fn:e.program(3,a,0),inverse:e.noop,data:a}))?o:"")+"\n\n"+(null!=(o=n.each.call(s,null!=t?t.data:t,{name:"each",hash:{},fn:e.program(5,a,0),inverse:e.noop,data:a}))?o:"")+"</div>\n"},useData:!0})},{"hbsfy/runtime":535}],411:[function(e,t,n){var i=e("./view");e("./videos.hbs");t.exports=i.extend({applyElementEvent:function(e){var t=$(e.currentTarget).closest(".thumbnail");this.trigger("apply",{thumb_src:t.data("thumb"),source:t.data("source")})},removeElementEvent:function(e){var t=$(e.currentTarget).closest(".thumbnail").data("thumb");this.data=_(this.data).filter(function(e){return e.thumb_src!=t}),this.render(),this.trigger("change",this.getData()),e.stopPropagation()}})},{"./videos.hbs":412,"./view":413}],412:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({1:function(e,t,n,i,a){return"<label>"+e.escapeExpression((n.t||t&&t.t||n.helperMissing).call(null!=t?t:e.nullContext||{},"tool.restrictions.element.common.video_list_empty",{name:"t",hash:{},data:a}))+"</label>"},3:function(e,t,n,i,a){return"<label>"+e.escapeExpression((n.t||t&&t.t||n.helperMissing).call(null!=t?t:e.nullContext||{},"tool.restrictions.element.common.video_list_desc",{name:"t",hash:{},data:a}))+"</label>"},5:function(e,t,n,i,a){var o,r=null!=t?t:e.nullContext||{},s=n.helperMissing,l="function",c=e.escapeExpression;return'    <div class="thumbnail image" data-thumb="'+c((o=null!=(o=n.thumb_src||(null!=t?t.thumb_src:t))?o:s,typeof o===l?o.call(r,{name:"thumb_src",hash:{},data:a}):o))+'" data-source="'+c((o=null!=(o=n.source||(null!=t?t.source:t))?o:s,typeof o===l?o.call(r,{name:"source",hash:{},data:a}):o))+'" style="background-image: url('+c((o=null!=(o=n.thumb_src||(null!=t?t.thumb_src:t))?o:s,typeof o===l?o.call(r,{name:"thumb_src",hash:{},data:a}):o))+')">\n      <span class="remove"><i class="fa fa-times"></i></span>\n    </div>\n'},compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){var o,r,s=null!=t?t:e.nullContext||{};return'<div class="thumbnails-wrapper">\n  <input type="hidden" name="list" class="element-list" data-uuid="'+e.escapeExpression((r=null!=(r=n.uuid||(null!=t?t.uuid:t))?r:n.helperMissing,"function"==typeof r?r.call(s,{name:"uuid",hash:{},data:a}):r))+'"/>\n  '+(null!=(o=n["if"].call(s,null!=t?t.no_data:t,{name:"if",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a}))?o:"")+"\n  "+(null!=(o=n["if"].call(s,null!=t?t.show_hint:t,{name:"if",hash:{},fn:e.program(3,a,0),inverse:e.noop,data:a}))?o:"")+"\n\n"+(null!=(o=n.each.call(s,null!=t?t.data:t,{name:"each",hash:{},fn:e.program(5,a,0),inverse:e.noop,data:a}))?o:"")+"</div>\n"},useData:!0})},{"hbsfy/runtime":535}],413:[function(e,t,n){var i={color:e("./colors.hbs"),image:e("./images.hbs"),video:e("./videos.hbs"),background:e("./backgrounds.hbs")};t.exports=_.extend(Backbone.View.extend({events:{"click .thumbnail":"applyElementEvent","click .remove":"removeElementEvent"},applyElementEvent:function(e){this.trigger("apply",$(e.currentTarget).closest(".thumbnail").data("value"))},removeElementEvent:function(e){var t=$(e.currentTarget).closest(".thumbnail").data("value");this.data=_(this.data).without(t),this.render(),this.trigger("change",this.getData()),e.stopPropagation()},addElement:function(e){this.data.push(e),this.render(),this.trigger("change",this.getData())},initialize:function(e){_.bindAll(this,"render","addElement","getData"),this.uuid=e.uuid,this.type=e.type,this.data=[],this.debouncedRender=_.debounce(this.render,500),this.render()},render:function(){this.$el.html(i[this.type]({uuid:this.uuid,data:this.data,no_data:this.data.length<1,show_hint:1==this.data.length})),"color"===this.type&&this.initColorPicker()},initColorPicker:function(){this.$el.find(".addmore").colorpicker({defaultColor:"#FFF",onSubmit:this.addElement})},getData:function(){return _(this.data).clone()}}),Backbone.Events)},{"./backgrounds.hbs":404,"./colors.hbs":405,"./images.hbs":408,"./videos.hbs":412}],414:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({1:function(e,t,n,i,a){var o,r=null!=t?t:e.nullContext||{},s=n.helperMissing,l="function",c=e.escapeExpression;return'        <li>\n          <input tabindex="-1" type="checkbox" name="'+c((o=null!=(o=n.name||(null!=t?t.name:t))?o:s,typeof o===l?o.call(r,{name:"name",hash:{},data:a}):o))+'" id="template-restriction-'+c((o=null!=(o=n.name||(null!=t?t.name:t))?o:s,typeof o===l?o.call(r,{name:"name",hash:{},data:a}):o))+'" />\n          <label for="template-restriction-'+c((o=null!=(o=n.name||(null!=t?t.name:t))?o:s,typeof o===l?o.call(r,{name:"name",hash:{},data:a}):o))+'">'+c((n.t||t&&t.t||s).call(r,null!=t?t.tag:t,{name:"t",hash:{},data:a}))+"</label>\n        </li>\n"},compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){var o,r,s=null!=t?t:e.nullContext||{},l=n.helperMissing,c=e.escapeExpression;return'<div class="wrapper">\n\n  <div class="restrictions group" data-field="icon_replace">\n    <input tabindex="-1" type="checkbox" id="element-restrictions-icon-replace" />\n    <label for="element-restrictions-icon-replace">'+c((n.t||t&&t.t||l).call(s,"tool.restrictions.template.permission.icon_replace",{name:"t",hash:{},data:a}))+'</label>\n    <ul class="options">\n      <li>\n        <div class="restrictions group" data-name="source">\n          <input tabindex="-1" type="checkbox" id="element-restrictions-source" />\n          <label for="element-restrictions-source">'+c((n.t||t&&t.t||l).call(s,"tool.restrictions.element.common.icon_list",{name:"t",hash:{},data:a}))+'</label>\n          <ul class="options"><li></li></ul>\n        </div>\n      </li>\n    </ul>\n  </div>\n\n  <div class="restrictions group" data-field="icon_position">\n    <input tabindex="-1" type="checkbox" id="element-restrictions-icon-position" />\n    <label for="element-restrictions-icon-position">'+c((n.t||t&&t.t||l).call(s,"tool.restrictions.template.permission.icon_position",{name:"t",hash:{},data:a}))+'</label>\n    <ul class="options">\n      <li>\n        <div class="restrictions group" data-name="margin">\n          <input tabindex="-1" type="checkbox" id="element-restrictions-margin" />\n          <label for="element-restrictions-margin">'+c((n.t||t&&t.t||l).call(s,"tool.restrictions.element.common.margin",{name:"t",hash:{},data:a}))+'</label>\n          <ul class="options">\n            <li>\n              <div class="slider"></div>\n              <input tabindex="-1" name="size" value="0" type="number" min="0" max="'+c((r=null!=(r=n.max_margin||(null!=t?t.max_margin:t))?r:l,"function"==typeof r?r.call(s,{name:"max_margin",hash:{},data:a}):r))+'">\n            </li>\n          </ul>\n        </div>\n      </li>\n\n      <li>\n        <div class="restrictions group" data-name="movement">\n          <input tabindex="-1" type="checkbox" id="element-restrictions-movement" />\n          <label for="element-restrictions-movement">'+c((n.t||t&&t.t||l).call(s,"tool.restrictions.element.common.movement",{
name:"t",hash:{},data:a}))+'</label>\n          <ul class="options">\n            <li>\n              <input tabindex="-1" name="horizontal" type="checkbox" id="element-restrictions-horizontal-move" checked />\n              <label for="element-restrictions-horizontal-move">'+c((n.t||t&&t.t||l).call(s,"tool.restrictions.element.common.movement_h",{name:"t",hash:{},data:a}))+'</label>\n            </li>\n            <li>\n              <input tabindex="-1" name="vertical" type="checkbox" id="element-restrictions-vertical-move" checked />\n              <label for="element-restrictions-vertical-move">'+c((n.t||t&&t.t||l).call(s,"tool.restrictions.element.common.movement_v",{name:"t",hash:{},data:a}))+'</label>\n            </li>\n          </ul>\n        </div>\n      </li>\n    </ul>\n  </div>\n\n  <div class="restrictions group" data-name="basic">\n    <label for="element-restrictions-basic">'+c((n.t||t&&t.t||l).call(s,"tool.restrictions.element.basic",{name:"t",hash:{},data:a}))+'</label>\n    <ul class="options">\n'+(null!=(o=n.each.call(s,null!=t?t.basic:t,{name:"each",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a}))?o:"")+"    </ul>\n  </div>\n\n</div>\n"},useData:!0})},{"hbsfy/runtime":535}],415:[function(e,t,n){var i=e("./logo-type");t.exports=i.extend({type:"icon",template:e("./icon-type.hbs"),ElementListView:e("./element-list/icons-view"),basicHide:["icon_add","icon_replace","icon_position"],getTypeFilterRegex:function(){return/^icon_/}})},{"./element-list/icons-view":406,"./icon-type.hbs":414,"./logo-type":419}],416:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({1:function(e,t,n,i,a){var o,r=null!=t?t:e.nullContext||{},s=n.helperMissing,l="function",c=e.escapeExpression;return'        <li>\n          <input tabindex="-1" type="checkbox" name="'+c((o=null!=(o=n.name||(null!=t?t.name:t))?o:s,typeof o===l?o.call(r,{name:"name",hash:{},data:a}):o))+'" id="template-restriction-'+c((o=null!=(o=n.name||(null!=t?t.name:t))?o:s,typeof o===l?o.call(r,{name:"name",hash:{},data:a}):o))+'" />\n          <label for="template-restriction-'+c((o=null!=(o=n.name||(null!=t?t.name:t))?o:s,typeof o===l?o.call(r,{name:"name",hash:{},data:a}):o))+'">'+c((n.t||t&&t.t||s).call(r,null!=t?t.tag:t,{name:"t",hash:{},data:a}))+"</label>\n        </li>\n"},compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){var o,r=null!=t?t:e.nullContext||{},s=n.helperMissing,l=e.escapeExpression;return'<div class="wrapper">\n\n  <div class="restrictions group" data-field="image_content">\n    <input tabindex="-1" type="checkbox" id="element-restrictions-image-content" />\n    <label for="element-restrictions-image-content">'+l((n.t||t&&t.t||s).call(r,"tool.images.tooltip.replace_image",{name:"t",hash:{},data:a}))+'</label>\n    <ul class="options">\n      <li>\n        <div class="restrictions group" data-name="source">\n          <input tabindex="-1" type="checkbox" id="element-restrictions-source" />\n          <label for="element-restrictions-source">'+l((n.t||t&&t.t||s).call(r,"tool.restrictions.element.common.source_list",{name:"t",hash:{},data:a}))+'</label>\n          <ul class="options"><li></li></ul>\n        </div>\n      </li>\n    </ul>\n  </div>\n\n  <div class="restrictions group" data-name="basic">\n    <label>'+l((n.t||t&&t.t||s).call(r,"tool.restrictions.element.basic",{name:"t",hash:{},data:a}))+'</label>\n    <ul class="options">\n'+(null!=(o=n.each.call(r,null!=t?t.basic:t,{name:"each",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a}))?o:"")+"    </ul>\n  </div>\n\n</div>\n"},useData:!0})},{"hbsfy/runtime":535}],417:[function(e,t,n){var i=e("./image-type.hbs"),a=e("./abstract-type"),o=e("./element-list/view"),r=e("../../../../facade/design/design"),s=e("../../../../factory/restrictions");t.exports=a.extend({type:"image",basicHide:["image_add","image_content","image_replace"],toggleSectionEvent:function(e){$(e.currentTarget).is("#element-restrictions-source:checked")&&!this.sourceListView.getData().length&&this.sourceListView.addElement(this.selection.source.url),a.prototype.toggleSectionEvent.apply(this,arguments)},render:function(){var e=_(this.groups).find(function(e){return e.permissions&&e.permissions.template});if(e){var t=_.chain(e.permissions.template).map(function(e,t){return{name:t,tag:"tool.restrictions.template.permission."+t}}).filter(function(e){return this.basicHide.indexOf(e.name)<0},this).filter(function(e){return e.name.match(/^image_/)}).value();this.$el.html(i({basic:t})),this.initSourceList(),this.renderRestrictions()}},getOptionValue:function(e){return e.is(".element-list")?this.sourceListView.getData():a.prototype.getOptionValue.apply(this,arguments)},_renderRestrictions:function(e,t){"source"==t&&e[t]&&_(e[t].list).each(this.sourceListView.addElement),a.prototype._renderRestrictions.apply(this,arguments)},persistOptionRestriction:function(e){var t=e.closest(".restrictions.group").data("name")||"basic",n=e.attr("name")||e.closest(".restrictions.group[data-field]").data("field");if("basic"===t&&"image_content"===n){var i=this.getOptionValue(e);i&&this.checkRepositionPermission()}a.prototype.persistOptionRestriction.call(this,e)},checkRepositionPermission:function(){s.getElementPermissions().then(_.bind(function(e){var t=_(e).findWhere({page_number:INKIVE.Tool._current_page_number,element_id:this.selection.id}),n=t?JSON.parse(t.restrictions):{},i=!n.basic||"undefined"==typeof n.basic.image_crop,a=s.getTemplatePermissionsCollection().any(function(e){return e.image_crop});i&&!a&&(n.basic=n.basic||{},n.basic.image_crop=!0,INKIVE.Tool.getInstance().editor.canvas.call("advice.show","crop-restriction-applied"),this.$el.find("#template-restriction-image_crop").prop("checked",!0),s.setGlobalElementRestriction(this.selection.id,JSON.stringify(n)))},this))},initSourceList:function(){this.sourceListView&&this.sourceListView.remove(),this.sourceListView=new o({el:this.$el.find('.restrictions.group[data-name="source"] li'),type:"image"}),this.sourceListView.on("change",_.bind(function(){var e=this.sourceListView.$el.find("input");this.persistOptionRestriction(e),this.toggleRestrictionsGroup(e.closest(".restrictions.group"),!0)},this)),this.sourceListView.on("apply",function(e){r.set({source:{url:e},keep_box_size:!0})})}})},{"../../../../facade/design/design":34,"../../../../factory/restrictions":122,"./abstract-type":401,"./element-list/view":413,"./image-type.hbs":416}],418:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({1:function(e,t,n,i,a){var o,r=null!=t?t:e.nullContext||{},s=n.helperMissing,l="function",c=e.escapeExpression;return'        <li>\n          <input tabindex="-1" type="checkbox" name="'+c((o=null!=(o=n.name||(null!=t?t.name:t))?o:s,typeof o===l?o.call(r,{name:"name",hash:{},data:a}):o))+'" id="template-restriction-'+c((o=null!=(o=n.name||(null!=t?t.name:t))?o:s,typeof o===l?o.call(r,{name:"name",hash:{},data:a}):o))+'" />\n          <label for="template-restriction-'+c((o=null!=(o=n.name||(null!=t?t.name:t))?o:s,typeof o===l?o.call(r,{name:"name",hash:{},data:a}):o))+'">'+c((n.t||t&&t.t||s).call(r,null!=t?t.tag:t,{name:"t",hash:{},data:a}))+"</label>\n        </li>\n"},compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){var o,r,s=null!=t?t:e.nullContext||{},l=n.helperMissing,c=e.escapeExpression;return'<div class="wrapper">\n\n  <div class="restrictions group" data-field="logo_replace">\n    <input tabindex="-1" type="checkbox" id="element-restrictions-logo-replace" />\n    <label for="element-restrictions-logo-replace">'+c((n.t||t&&t.t||l).call(s,"tool.restrictions.template.permission.logo_replace",{name:"t",hash:{},data:a}))+'</label>\n    <ul class="options">\n      <li>\n        <div class="restrictions group" data-name="source">\n          <input tabindex="-1" type="checkbox" id="element-restrictions-source" />\n          <label for="element-restrictions-source">'+c((n.t||t&&t.t||l).call(s,"tool.restrictions.element.common.logo_list",{name:"t",hash:{},data:a}))+'</label>\n          <ul class="options"><li></li></ul>\n        </div>\n      </li>\n    </ul>\n  </div>\n\n  <div class="restrictions group" data-field="logo_position">\n    <input tabindex="-1" type="checkbox" id="element-restrictions-logo-position" />\n    <label for="element-restrictions-logo-position">'+c((n.t||t&&t.t||l).call(s,"tool.restrictions.template.permission.logo_position",{name:"t",hash:{},data:a}))+'</label>\n    <ul class="options">\n      <li>\n        <div class="restrictions group" data-name="margin">\n          <input tabindex="-1" type="checkbox" id="element-restrictions-margin" />\n          <label for="element-restrictions-margin">'+c((n.t||t&&t.t||l).call(s,"tool.restrictions.element.common.margin",{name:"t",hash:{},data:a}))+'</label>\n          <ul class="options">\n            <li>\n              <div class="slider"></div>\n              <input tabindex="-1" name="size" value="0" type="number" min="0" max="'+c((r=null!=(r=n.max_margin||(null!=t?t.max_margin:t))?r:l,"function"==typeof r?r.call(s,{name:"max_margin",hash:{},data:a}):r))+'">\n            </li>\n          </ul>\n        </div>\n      </li>\n\n      <li>\n        <div class="restrictions group" data-name="movement">\n          <input tabindex="-1" type="checkbox" id="element-restrictions-movement" />\n          <label for="element-restrictions-movement">'+c((n.t||t&&t.t||l).call(s,"tool.restrictions.element.common.movement",{name:"t",hash:{},data:a}))+'</label>\n          <ul class="options">\n            <li>\n              <input tabindex="-1" name="horizontal" type="checkbox" id="element-restrictions-horizontal-move" checked />\n              <label for="element-restrictions-horizontal-move">'+c((n.t||t&&t.t||l).call(s,"tool.restrictions.element.common.movement_h",{name:"t",hash:{},data:a}))+'</label>\n            </li>\n            <li>\n              <input tabindex="-1" name="vertical" type="checkbox" id="element-restrictions-vertical-move" checked />\n              <label for="element-restrictions-vertical-move">'+c((n.t||t&&t.t||l).call(s,"tool.restrictions.element.common.movement_v",{name:"t",hash:{},data:a}))+'</label>\n            </li>\n          </ul>\n        </div>\n      </li>\n    </ul>\n  </div>\n\n  <div class="restrictions group" data-name="basic">\n    <label for="element-restrictions-basic">'+c((n.t||t&&t.t||l).call(s,"tool.restrictions.element.basic",{name:"t",hash:{},data:a}))+'</label>\n    <ul class="options">\n'+(null!=(o=n.each.call(s,null!=t?t.basic:t,{name:"each",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a}))?o:"")+"    </ul>\n  </div>\n\n</div>\n"},useData:!0})},{"hbsfy/runtime":535}],419:[function(e,t,n){var i=e("./abstract-type"),a=e("../../../../facade/design/design");t.exports=i.extend({type:"logo",template:e("./logo-type.hbs"),ElementListView:e("./element-list/logos-view"),basicHide:["logo_add","logo_replace","logo_position"],events:_.extend({"slide .slider":"slideEvent",'change input[name="size"]':"resizeMarginEvent",'change input[name="vertical"]':"verticalMoveEvent",'change input[name="horizontal"]':"horizontalMoveEvent"},i.prototype.events),toggleSectionEvent:function(e){var t=$(e.currentTarget),n=t.closest(".restrictions.group").data("name");t.is(":checked")||("margin"==n?$("#margin-box").remove():"movement"==n&&$("#horizontal-line, #vertical-line").remove()),$(e.currentTarget).is("#element-restrictions-source:checked")&&!this.logosListView.getData().length&&this.logosListView.addElement({thumb_src:this.selection.thumb_src,is_vector:this.selection.is_vector}),i.prototype.toggleSectionEvent.apply(this,arguments)},slideEvent:function(e,t){var n=this.$el.find('input[name="size"]');n.val(t.value),this.setMarginUI(t.value),this.persistOptionRestriction(n)},resizeMarginEvent:function(e){var t=$(e.currentTarget),n=parseFloat(t.val());this.marginSlider.slider("value",n),this.setMarginUI(n),this.persistOptionRestriction(t)},setMarginUI:function(e){var t=svgedit.utilities.getBBox($("#selectedBox0")[0]),n=document.createElementNS(svgedit.NS.SVG,"rect");$("#margin-box").remove(),this.canvas.assignAttributes(n,{id:"margin-box",width:t.width+e,height:t.height+e,x:t.x-e/2,y:t.y-e/2,"stroke-width":e,fill:"none","stroke-opacity":.3,stroke:"#ED3636"});var i=$("#selectorGroup0")[0];i.insertBefore(n,i.firstChild)},horizontalMoveEvent:function(e){this.setMoveUI("horizontal",$(e.currentTarget).is(":checked"))},verticalMoveEvent:function(e){this.setMoveUI("vertical",$(e.currentTarget).is(":checked"))},setMoveUI:function(e,t){var n=svgedit.utilities.getBBox($("#selectedBox0")[0]),i=document.createElementNS(svgedit.NS.SVG,"line"),a="vertical"===e;$("#"+e+"-line").remove(),this.canvas.assignAttributes(i,{id:e+"-line",x1:a?n.x+n.width/2:n.x,y1:a?n.y:n.y+n.height/2,x2:a?n.x+n.width/2:n.x+n.width,y2:a?n.y+n.height:n.y+n.height/2,"stroke-width":2,"stroke-dasharray":5,stroke:t?"#01ADB6":"#ED3636"});var o=document.getElementById("selectorGroup0");o.appendChild(i)},initialize:function(){this.canvas=INKIVE.Tool.getInstance().editor.canvas,i.prototype.initialize.apply(this,arguments)},getOptionValue:function(e){return e.is(".element-list")?this.logosListView.getData():i.prototype.getOptionValue.apply(this,arguments)},render:function(){var e=_(this.groups).find(function(e){return e.permissions&&e.permissions.template});if(e){var t=this.getTypeFilterRegex(),n=_.chain(e.permissions.template).map(function(e,t){return{name:t,tag:"tool.restrictions.template.permission."+t}}).filter(function(e){return this.basicHide.indexOf(e.name)<0},this).filter(function(e){return e.name.match(t)}).value(),i=this.canvas.contentW<this.canvas.contentH?this.canvas.contentW/8:this.canvas.contentH/8;this.$el.html(this.template({basic:n,max_margin:i})),this.initSlider(i),this.initSourceList(),this.renderRestrictions()}},_renderRestrictions:function(e,t){"margin"==t&&e.margin&&(this.marginSlider.slider("value",e.margin.size),this.setMarginUI(e.margin.size)),"source"==t&&e[t]&&_(e[t].list).each(this.logosListView.addElement),i.prototype._renderRestrictions.apply(this,arguments)},initSlider:function(e){var t=this.$el.find('.restrictions[data-name="margin"] .slider');this.marginSlider=t.slider({max:e,min:0,value:0})},initSourceList:function(){this.logosListView&&this.logosListView.remove(),this.logosListView=new this.ElementListView({el:this.$el.find('.restrictions.group[data-name="source"] li'),type:"logo"}),this.logosListView.on("change",_.bind(function(){var e=this.logosListView.$el.find("input");this.persistOptionRestriction(e),this.toggleRestrictionsGroup(e.closest(".restrictions.group"),!0)},this)),this.logosListView.on("apply",_.bind(function(e){a.set(this.selection.id,e)},this))},getTypeFilterRegex:function(){return/^logo_/}})},{"../../../../facade/design/design":34,"./abstract-type":401,"./element-list/logos-view":409,"./logo-type.hbs":418}],420:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({1:function(e,t,n,i,a){var o,r=null!=t?t:e.nullContext||{},s=n.helperMissing,l="function",c=e.escapeExpression;return'              <li>\n                <input tabindex="-1" type="checkbox" name="'+c((o=null!=(o=n.id||(null!=t?t.id:t))?o:s,typeof o===l?o.call(r,{name:"id",hash:{},data:a}):o))+'" id="element-restrictions-swearing-'+c((o=null!=(o=n.id||(null!=t?t.id:t))?o:s,typeof o===l?o.call(r,{name:"id",hash:{},data:a}):o))+'" />\n                <label for="element-restrictions-swearing-'+c((o=null!=(o=n.id||(null!=t?t.id:t))?o:s,typeof o===l?o.call(r,{name:"id",hash:{},data:a}):o))+'">'+c((o=null!=(o=n.name||(null!=t?t.name:t))?o:s,typeof o===l?o.call(r,{name:"name",hash:{},data:a}):o))+"</label>\n              </li>\n"},3:function(e,t,n,i,a){var o,r=null!=t?t:e.nullContext||{},s=n.helperMissing,l="function",c=e.escapeExpression;return'        <li>\n          <input tabindex="-1" type="checkbox" name="'+c((o=null!=(o=n.name||(null!=t?t.name:t))?o:s,typeof o===l?o.call(r,{name:"name",hash:{},data:a}):o))+'" id="template-restriction-'+c((o=null!=(o=n.name||(null!=t?t.name:t))?o:s,typeof o===l?o.call(r,{name:"name",hash:{},data:a}):o))+'" />\n          <label for="template-restriction-'+c((o=null!=(o=n.name||(null!=t?t.name:t))?o:s,typeof o===l?o.call(r,{name:"name",hash:{},data:a}):o))+'">'+c((n.t||t&&t.t||s).call(r,null!=t?t.tag:t,{name:"t",hash:{},data:a}))+"</label>\n        </li>\n"},compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){var o,r=null!=t?t:e.nullContext||{},s=n.helperMissing,l=e.escapeExpression;return'<div class="wrapper">\n\n  <div class="restrictions group" data-field="text_change_content">\n    <input tabindex="-1" type="checkbox" id="element-restrictions-text-content" />\n    <label for="element-restrictions-text-content">'+l((n.t||t&&t.t||s).call(r,"tool.restrictions.template.permission.text_change_content",{name:"t",hash:{},data:a}))+'</label>\n    <ul class="options">\n      <li>\n        <div class="restrictions group" data-name="" data-radiogroup="content-restriction">\n          <input tabindex="-1" type="checkbox" id="element-restrictions-any" checked />\n          <label for="element-restrictions-any">'+l((n.t||t&&t.t||s).call(r,"tool.restrictions.element.text.any",{name:"t",hash:{},data:a}))+'</label>\n        </div>\n      </li>\n       <li>\n        <div class="restrictions group" data-name="character_number" data-radiogroup="content-restriction">\n          <input tabindex="-1" type="checkbox" id="element-restrictions-character_number" />\n          <label for="element-restrictions-character_number">'+l((n.t||t&&t.t||s).call(r,"tool.restrictions.element.text.character_number",{name:"t",hash:{},data:a}))+'</label>\n          <ul class="options">\n            <div class="clean-margin">\n             <li class="col-half">\n                <input tabindex="-1" name="min" type="number" min="0" placeholder="'+l((n.t||t&&t.t||s).call(r,"tool.restrictions.element.text.min_placeholder",{name:"t",hash:{},data:a}))+'">\n              </li><li class="col-half">\n                <input tabindex="-1" name="max" type="number" min="0" placeholder="'+l((n.t||t&&t.t||s).call(r,"tool.restrictions.element.text.max_placeholder",{name:"t",hash:{},data:a}))+'">\n              </li>\n            </div>\n          </ul>\n        </div>\n      </li>\n      <li>\n        <div class="restrictions group" data-name="numeric" data-radiogroup="content-restriction">\n          <input tabindex="-1" type="checkbox" id="element-restrictions-numeric" />\n          <label for="element-restrictions-numeric">'+l((n.t||t&&t.t||s).call(r,"tool.restrictions.element.text.numeric",{name:"t",hash:{},data:a}))+'</label>\n          <ul class="options">\n            <div class="clean-margin">\n              <li class="col-half">\n                <input tabindex="-1" name="min" type="number" placeholder="'+l((n.t||t&&t.t||s).call(r,"tool.restrictions.element.text.min_placeholder",{name:"t",hash:{},data:a}))+'">\n              </li><li class="col-half">\n                <input tabindex="-1" name="max" type="number" placeholder="'+l((n.t||t&&t.t||s).call(r,"tool.restrictions.element.text.max_placeholder",{name:"t",hash:{},data:a}))+'">\n              </li>\n            </div>\n          </ul>\n        </div>\n      </li>\n\n      <li>\n        <div class="restrictions group" data-name="dictionary" data-radiogroup="content-restriction">\n          <input tabindex="-1" type="checkbox" id="element-restrictions-dictionary" />\n          <label for="element-restrictions-dictionary">'+l((n.t||t&&t.t||s).call(r,"tool.restrictions.element.text.dictionary",{name:"t",hash:{},data:a}))+'</label>\n          <ul class="options">\n            <li>\n              <input tabindex="-1" class="dictionary" type="text" name="list" placeholder="'+l((n.t||t&&t.t||s).call(r,"tool.restrictions.element.text.dictionary_placeholder",{name:"t",hash:{},data:a}))+'">\n            </li>\n          </ul>\n        </div>\n      </li>\n\n      <li>\n        <div class="restrictions group" data-name="date" data-radiogroup="content-restriction">\n          <input tabindex="-1" type="checkbox" id="element-restrictions-date" />\n          <label for="element-restrictions-date">'+l((n.t||t&&t.t||s).call(r,"tool.restrictions.element.text.date",{name:"t",hash:{},data:a}))+'</label>\n          <ul class="options">\n            <li>\n              <input tabindex="-1" name="dateformat" type="text" placeholder="'+l((n.t||t&&t.t||s).call(r,"tool.restrictions.element.text.date_format_placeholder",{name:"t",hash:{},data:a}))+'">\n            </li>\n            <li>\n              <input tabindex="-1" name="daterange" type="text" placeholder="'+l((n.t||t&&t.t||s).call(r,"tool.restrictions.element.text.date_availability_placeholder",{name:"t",hash:{},data:a}))+'">\n            </li>\n          </ul>\n        </div>\n      </li>\n\n      <li>\n        <div class="restrictions group" data-name="currencies" data-radiogroup="content-restriction">\n          <input tabindex="-1" type="checkbox" id="element-restrictions-currencies" />\n          <label for="element-restrictions-currencies">'+l((n.t||t&&t.t||s).call(r,"tool.restrictions.element.text.currencies",{name:"t",hash:{},data:a}))+'</label>\n\n          <ul class="options">\n            <div class="clean-margin">\n              <li class="number">\n                <input tabindex="-1" name="min" type="number" placeholder="'+l((n.t||t&&t.t||s).call(r,"tool.restrictions.element.text.min_placeholder",{name:"t",hash:{},data:a}))+'">\n              </li><li class="number">\n                <input tabindex="-1" name="max" type="number" placeholder="'+l((n.t||t&&t.t||s).call(r,"tool.restrictions.element.text.max_placeholder",{name:"t",hash:{},data:a}))+'">\n              </li><li class="currency">\n                <div class="select-wrapper">\n                  <select tabindex="-1" name="currency" class="options">\n                    <option value="$">Dollar $</option>\n                    <option value="€">Euro €</option>\n                    <option value="¥">Yen / Yuan ¥</option>\n                    <option value="£">Pound £</option>\n                    <option value="₩">Won ₩</option>\n                  </select>\n                </div>\n              </li>\n            </div>\n          </ul>\n        </div>\n      </li>\n\n      <li>\n        <div class="restrictions group" data-name="email" data-radiogroup="content-restriction">\n          <input tabindex="-1" type="checkbox" id="element-restrictions-email" />\n          <label for="element-restrictions-email">'+l((n.t||t&&t.t||s).call(r,"tool.restrictions.element.text.email",{name:"t",hash:{},data:a}))+'</label>\n        </div>\n      </li>\n\n      <li>\n        <div class="restrictions group" data-name="swearing" data-radiogroup="content-restriction" data-field="filter">\n          <input tabindex="-1" type="checkbox" id="element-restrictions-swearing" />\n          <label for="element-restrictions-swearing">'+l((n.t||t&&t.t||s).call(r,"tool.restrictions.element.text.swearing",{name:"t",hash:{},data:a}))+'</label>\n          <ul class="options">\n'+(null!=(o=n.each.call(r,null!=t?t.swearing:t,{name:"each",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a}))?o:"")+'          </ul>\n        </div>\n      </li>\n    </ul>\n  </div>\n\n  <div class="restrictions group" data-name="basic">\n    <label for="element-restrictions-basic">'+l((n.t||t&&t.t||s).call(r,"tool.restrictions.element.basic",{name:"t",hash:{},data:a}))+'</label>\n    <ul class="options">\n'+(null!=(o=n.each.call(r,null!=t?t.basic:t,{name:"each",hash:{},fn:e.program(3,a,0),inverse:e.noop,data:a}))?o:"")+"    </ul>\n  </div>\n\n</div>\n"},useData:!0})},{"hbsfy/runtime":535}],421:[function(e,t,n){var i=e("./text-type.hbs"),a=e("./abstract-type"),o=[{id:"en",name:"English"},{id:"es",name:"español"},{id:"ru",name:"Русский"},{id:"pt",name:"português"},{id:"de",name:"Deutsch"},{id:"nl",name:"Nederlands"},{id:"fr",name:"français"},{id:"it",name:"Italiano"}];t.exports=a.extend({type:"text",basicHide:["text_add","text_change_content"],storedDateFormat:"MM/DD/YY",events:_.extend({'change input[name="list"]':"resizeListEvent",'keyup .restrictions.group[data-name="numeric"] input':"toggleRestrictionEvent",'keyup .restrictions.group[data-name="currencies"] input':"toggleRestrictionEvent",'change input[name="dateformat"]':"changeFormatEvent",'apply.daterangepicker input[name="daterange"]':"selectDateRangeEvent",'cancel.daterangepicker input[name="daterange"]':"clearDateRangeEvent"},a.prototype.events),resizeListEvent:function(e){var t=$(e.currentTarget);this.toggleRestrictionsGroup(t.closest(".restrictions.group"),!0)},changeFormatEvent:function(){this.applyDateFormat()},selectDateRangeEvent:function(){this.applyDateFormat().trigger("change")},clearDateRangeEvent:function(){this.$el.find('input[name="daterange"]').val("").trigger("change")},applyDateFormat:function(){var e=this.$el.find('input[name="dateformat"]').val()||this.storedDateFormat,t=this.$el.find('input[name="daterange"]'),n=t.data("daterangepicker"),i=n.endDate.format(e),a=n.startDate.format(e);return n.locale.format=e,t.val(a+" ~ "+i),t},render:function(){var e=_(this.groups).find(function(e){return e.permissions&&e.permissions.template});if(e){var t=_.chain(e.permissions.template).map(function(e,t){return{name:t,tag:"tool.restrictions.template.permission."+t}}).filter(function(e){return this.basicHide.indexOf(e.name)<0},this).filter(function(e){return e.name.match(/^text_/)}).value();this.$el.html(i({basic:t,swearing:o})),this.initDictionary(),this.initDateFormat(),this.initDateRange(),this.renderRestrictions()}},initDictionary:function(){var e=this.$el.find('input[name="list"]'),t=e.closest(".restrictions.group");e.tagsinput(),e.tagsinput("input").attr("tabindex",e.attr("tabindex")).on("keydown",function(t){var n=9;t.which===n&&_.defer(function(){e.tagsinput("focus")})}),e.on("change",_.bind(this.toggleRestrictionsGroup,this,t,!0)),t.children("input").is(":checked")&&this.toggleRestrictionsGroup(t,!0)},initDateFormat:function(){this.$el.find('input[name="dateformat"]').typeahead({highlight:!0,minLength:0,source:["LL","DD-MM-YYYY","DD/MM/YY","MM/DD/YYYY","YYYY-MM-DD","YY-MM-DD"]})},initDateRange:function(){this.$el.find('input[name="daterange"]').daterangepicker({autoUpdateInput:!1})},_renderRestrictions:function(e,t){return"date"===t?this.renderDateRestrictions(e):"dictionary"===t?this.renderDictionaryRestrictions(e):"swearing"===t?this.renderSwearingRestrictions(e):a.prototype._renderRestrictions.apply(this,arguments)},renderSwearingRestrictions:function(e){if(e.swearing){var t=e.swearing&&e.swearing.filter,n=this.$el.find('.restrictions.group[data-name="swearing"]');n.children('input[type="checkbox"]').prop("checked",!0),_.each(t,function(e){n.find('input[name="'+e+'"]').prop("checked",!0)})}},renderDictionaryRestrictions:function(e){if(e.dictionary){var t=e.dictionary&&e.dictionary.list,n=this.$el.find('.restrictions.group[data-name="dictionary"]'),i=n.find('input[name="list"]');n.children('input[type="checkbox"]').prop("checked",!0),_.each(t,function(e){i.tagsinput("add",e)})}},renderDateRestrictions:function(e){var t=e.date;if(t){var n=this.$el.find('.restrictions.group[data-name="date"]'),i=n.find('input[name="daterange"]').data("daterangepicker");n.children('input[type="checkbox"]').prop("checked",t),n.find('input[name="dateformat"]').val(t.dateformat),t.daterange&&(i.locale.format=this.storedDateFormat,i.setStartDate(t.daterange.start),i.setEndDate(t.daterange.end),this.applyDateFormat())}},toggleRestrictionEvent:function(e){var t=$(e.currentTarget),n=t.attr("name");if(t.is('[type="number"]')&&("min"==n||"max"==n)){var i=this.isValidRangeNumber(t.closest("ul.options"));if(t.closest("ul.options").toggleClass("not-valid",!i),!i)return}t.closest(".restrictions.group").is('[data-name="swearing"]')?this.persistOptionRestriction(t.closest(".restrictions.group").children("input")):a.prototype.toggleRestrictionEvent.call(this,e)},getOptionValue:function(e){if(e.is('input[name="daterange"]'))return e.val()?{end:e.data("daterangepicker").endDate.format(this.storedDateFormat),start:e.data("daterangepicker").startDate.format(this.storedDateFormat)}:null;if(e.is('input[name="list"]'))return e.tagsinput("items");if(e.is('input[name="filter"]'))return _.pluck(e.tagsinput("items"),"id");if(e.closest(".restrictions.group").is('[data-name="swearing"]')){var t=e.closest(".restrictions.group").find("ul.options input");return _.compact(_.map(t,function(e){return $(e).is(":checked")&&$(e).attr("name")}))}return a.prototype.getOptionValue.apply(this,arguments)},isValidRangeNumber:function(e){var t=e.find('input[name="min"]'),n=e.find('input[name="max"]');return""===n.val()||""===t.val()||parseFloat(n.val())>parseFloat(t.val())},closeRestrictionsGroup:function(e){if(a.prototype.closeRestrictionsGroup.apply(this,arguments),e.data("radiogroup")){var t=this.$el.find('.restrictions.group[data-radiogroup="'+e.data("radiogroup")+'"] > input:checked');t.length||this.$el.find("#element-restrictions-any").prop("checked",!0)}}})},{"./abstract-type":401,"./text-type.hbs":420}],422:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({1:function(e,t,n,i,a){var o,r=null!=t?t:e.nullContext||{},s=n.helperMissing,l="function",c=e.escapeExpression;return'        <li>\n          <input tabindex="-1" type="checkbox" name="'+c((o=null!=(o=n.name||(null!=t?t.name:t))?o:s,typeof o===l?o.call(r,{name:"name",hash:{},data:a}):o))+'" id="template-restriction-'+c((o=null!=(o=n.name||(null!=t?t.name:t))?o:s,typeof o===l?o.call(r,{name:"name",hash:{},data:a}):o))+'" />\n          <label for="template-restriction-'+c((o=null!=(o=n.name||(null!=t?t.name:t))?o:s,typeof o===l?o.call(r,{name:"name",hash:{},data:a}):o))+'">'+c((n.t||t&&t.t||s).call(r,null!=t?t.tag:t,{name:"t",hash:{},data:a}))+"</label>\n        </li>\n"},compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){var o,r,s=null!=t?t:e.nullContext||{},l=n.helperMissing,c=e.escapeExpression;return'<div class="wrapper">\n\n  <div class="restrictions group" data-field="vector_position">\n    <input tabindex="-1" type="checkbox" id="element-restrictions-vector-position" />\n    <label for="element-restrictions-vector-position">'+c((n.t||t&&t.t||l).call(s,"tool.restrictions.template.permission.vector_position",{name:"t",hash:{},data:a}))+'</label>\n    <ul class="options">\n      <li>\n        <div class="restrictions group" data-name="margin">\n          <input tabindex="-1" type="checkbox" id="element-restrictions-margin" />\n          <label for="element-restrictions-margin">'+c((n.t||t&&t.t||l).call(s,"tool.restrictions.element.common.margin",{name:"t",hash:{},data:a}))+'</label>\n          <ul class="options">\n            <li>\n              <div class="slider"></div>\n              <input tabindex="-1" name="size" value="0" type="number" min="0" max="'+c((r=null!=(r=n.max_margin||(null!=t?t.max_margin:t))?r:l,"function"==typeof r?r.call(s,{name:"max_margin",hash:{},data:a}):r))+'">\n            </li>\n          </ul>\n        </div>\n      </li>\n\n      <li>\n        <div class="restrictions group" data-name="movement">\n          <input tabindex="-1" type="checkbox" id="element-restrictions-movement" />\n          <label for="element-restrictions-movement">'+c((n.t||t&&t.t||l).call(s,"tool.restrictions.element.common.movement",{name:"t",hash:{},data:a}))+'</label>\n          <ul class="options">\n            <li>\n              <input tabindex="-1" name="horizontal" type="checkbox" id="element-restrictions-horizontal-move" checked />\n              <label for="element-restrictions-horizontal-move">'+c((n.t||t&&t.t||l).call(s,"tool.restrictions.element.common.movement_h",{name:"t",hash:{},data:a}))+'</label>\n            </li>\n            <li>\n              <input tabindex="-1" name="vertical" type="checkbox" id="element-restrictions-vertical-move" checked />\n              <label for="element-restrictions-vertical-move">'+c((n.t||t&&t.t||l).call(s,"tool.restrictions.element.common.movement_v",{name:"t",hash:{},data:a
}))+'</label>\n            </li>\n          </ul>\n        </div>\n      </li>\n    </ul>\n  </div>\n\n  <div class="restrictions group" data-name="basic">\n    <label for="element-restrictions-basic">'+c((n.t||t&&t.t||l).call(s,"tool.restrictions.element.basic",{name:"t",hash:{},data:a}))+'</label>\n    <ul class="options">\n'+(null!=(o=n.each.call(s,null!=t?t.basic:t,{name:"each",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a}))?o:"")+"    </ul>\n  </div>\n\n</div>\n"},useData:!0})},{"hbsfy/runtime":535}],423:[function(e,t,n){var i=e("./vector-type.hbs"),a=e("./abstract-type");t.exports=a.extend({type:"vector",basicHide:["vector_add","vector_position"],events:_.extend({"slide .slider":"slideEvent",'change input[name="size"]':"resizeMarginEvent",'change input[name="vertical"]':"verticalMoveEvent",'change input[name="horizontal"]':"horizontalMoveEvent"},a.prototype.events),toggleSectionEvent:function(e){var t=$(e.currentTarget),n=t.closest(".restrictions.group").data("name");t.is(":checked")||("margin"==n?$("#margin-box").remove():"movement"==n&&$("#horizontal-line, #vertical-line").remove()),a.prototype.toggleSectionEvent.apply(this,arguments)},slideEvent:function(e,t){var n=this.$el.find('input[name="size"]');n.val(t.value),this.setMarginUI(t.value),this.persistOptionRestriction(n)},resizeMarginEvent:function(e){var t=$(e.currentTarget),n=parseFloat(t.val());this.marginSlider.slider("value",n),this.setMarginUI(n),this.persistOptionRestriction(t)},setMarginUI:function(e){var t=svgedit.utilities.getBBox($("#selectedBox0")[0]),n=document.createElementNS(svgedit.NS.SVG,"rect");$("#margin-box").remove(),this.canvas.assignAttributes(n,{id:"margin-box",width:t.width+e,height:t.height+e,x:t.x-e/2,y:t.y-e/2,"stroke-width":e,fill:"none","stroke-opacity":.3,stroke:"#ED3636"});var i=$("#selectorGroup0")[0];i.insertBefore(n,i.firstChild)},horizontalMoveEvent:function(e){this.setMoveUI("horizontal",$(e.currentTarget).is(":checked"))},verticalMoveEvent:function(e){this.setMoveUI("vertical",$(e.currentTarget).is(":checked"))},setMoveUI:function(e,t){var n=svgedit.utilities.getBBox($("#selectedBox0")[0]),i=document.createElementNS(svgedit.NS.SVG,"line"),a="vertical"===e;$("#"+e+"-line").remove(),this.canvas.assignAttributes(i,{id:e+"-line",x1:a?n.x+n.width/2:n.x,y1:a?n.y:n.y+n.height/2,x2:a?n.x+n.width/2:n.x+n.width,y2:a?n.y+n.height:n.y+n.height/2,"stroke-width":2,"stroke-dasharray":5,stroke:t?"#01ADB6":"#ED3636"});var o=document.getElementById("selectorGroup0");o.appendChild(i)},initialize:function(){this.canvas=INKIVE.Tool.getInstance().editor.canvas,a.prototype.initialize.apply(this,arguments)},render:function(){var e=_(this.groups).find(function(e){return e.permissions&&e.permissions.template});if(e){var t=_.chain(e.permissions.template).map(function(e,t){return{name:t,tag:"tool.restrictions.template.permission."+t}}).filter(function(e){return this.basicHide.indexOf(e.name)<0},this).filter(function(e){return e.name.match(/^vector_/)}).value(),n=this.canvas.contentW<this.canvas.contentH?this.canvas.contentW/8:this.canvas.contentH/8;this.$el.html(i({basic:t,max_margin:n})),this.initSlider(n),this.renderRestrictions()}},_renderRestrictions:function(e,t){"margin"==t&&e.margin&&(this.marginSlider.slider("value",e.margin.size),this.setMarginUI(e.margin.size)),a.prototype._renderRestrictions.apply(this,arguments)},initSlider:function(e){var t=this.$el.find('.restrictions[data-name="margin"] .slider');this.marginSlider=t.slider({max:e,min:0,value:0})}})},{"./abstract-type":401,"./vector-type.hbs":422}],424:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({1:function(e,t,n,i,a){var o,r=null!=t?t:e.nullContext||{},s=n.helperMissing,l="function",c=e.escapeExpression;return'        <li>\n          <input tabindex="-1" type="checkbox" name="'+c((o=null!=(o=n.name||(null!=t?t.name:t))?o:s,typeof o===l?o.call(r,{name:"name",hash:{},data:a}):o))+'" id="template-restriction-'+c((o=null!=(o=n.name||(null!=t?t.name:t))?o:s,typeof o===l?o.call(r,{name:"name",hash:{},data:a}):o))+'" />\n          <label for="template-restriction-'+c((o=null!=(o=n.name||(null!=t?t.name:t))?o:s,typeof o===l?o.call(r,{name:"name",hash:{},data:a}):o))+'">'+c((n.t||t&&t.t||s).call(r,null!=t?t.tag:t,{name:"t",hash:{},data:a}))+"</label>\n        </li>\n"},compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){var o,r=null!=t?t:e.nullContext||{},s=n.helperMissing,l=e.escapeExpression;return'<div class="wrapper">\n\n  <div class="restrictions group" data-field="video_replace">\n    <input tabindex="-1" type="checkbox" id="element-restrictions-video-replace" />\n    <label for="element-restrictions-video-replace">'+l((n.t||t&&t.t||s).call(r,"tool.restrictions.template.permission.video_replace",{name:"t",hash:{},data:a}))+'</label>\n    <ul class="options">\n      <li>\n        <div class="restrictions group" data-name="source">\n          <input tabindex="-1" type="checkbox" id="element-restrictions-source" />\n          <label for="element-restrictions-source">'+l((n.t||t&&t.t||s).call(r,"tool.restrictions.element.common.video_list",{name:"t",hash:{},data:a}))+'</label>\n          <ul class="options"><li></li></ul>\n        </div>\n      </li>\n    </ul>\n  </div>\n\n  <div class="restrictions group" data-name="basic">\n    <label>'+l((n.t||t&&t.t||s).call(r,"tool.restrictions.element.basic",{name:"t",hash:{},data:a}))+'</label>\n    <ul class="options">\n'+(null!=(o=n.each.call(r,null!=t?t.basic:t,{name:"each",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a}))?o:"")+"    </ul>\n  </div>\n\n</div>\n"},useData:!0})},{"hbsfy/runtime":535}],425:[function(e,t,n){var i=e("./video-type.hbs"),a=e("./abstract-type"),o=e("./element-list/videos-view"),r=e("../../../../facade/design/design");e("../../../../factory/restrictions");t.exports=a.extend({type:"video",basicHide:["video_add","video_replace"],toggleSectionEvent:function(e){$(e.currentTarget).is("#element-restrictions-source:checked")&&!this.sourceListView.getData().length&&this.sourceListView.addElement({source:this.selection.source,thumb_src:this.selection.thumb_src}),a.prototype.toggleSectionEvent.apply(this,arguments)},render:function(){var e=_(this.groups).find(function(e){return e.permissions&&e.permissions.template});if(e){var t=_.chain(e.permissions.template).map(function(e,t){return{name:t,tag:"tool.restrictions.template.permission."+t}}).filter(function(e){return this.basicHide.indexOf(e.name)<0},this).filter(function(e){return e.name.match(/^video_/)}).value();this.$el.html(i({basic:t})),this.initSourceList(),this.renderRestrictions()}},getOptionValue:function(e){return e.is(".element-list")?this.sourceListView.getData():a.prototype.getOptionValue.apply(this,arguments)},_renderRestrictions:function(e,t){"source"==t&&e[t]&&_(e[t].list).each(this.sourceListView.addElement),a.prototype._renderRestrictions.apply(this,arguments)},initSourceList:function(){this.sourceListView&&this.sourceListView.remove(),this.sourceListView=new o({el:this.$el.find('.restrictions.group[data-name="source"] li'),type:"video"}),this.sourceListView.on("change",_.bind(function(){var e=this.sourceListView.$el.find("input");this.persistOptionRestriction(e),this.toggleRestrictionsGroup(e.closest(".restrictions.group"),!0)},this)),this.sourceListView.on("apply",function(e){r.set(e)})}})},{"../../../../facade/design/design":34,"../../../../factory/restrictions":122,"./abstract-type":401,"./element-list/videos-view":411,"./video-type.hbs":424}],426:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({1:function(e,t,n,i,a){var o,r,s=null!=t?t:e.nullContext||{},l=n.helperMissing,c="function",d=e.escapeExpression;return'    <dt>\n      <a class="btn btn-accordion '+d((r=null!=(r=n.key||(null!=t?t.key:t))?r:l,typeof r===c?r.call(s,{name:"key",hash:{},data:a}):r))+'" data-key="'+d((r=null!=(r=n.key||(null!=t?t.key:t))?r:l,typeof r===c?r.call(s,{name:"key",hash:{},data:a}):r))+'" data-type="'+d((r=null!=(r=n.type||(null!=t?t.type:t))?r:l,typeof r===c?r.call(s,{name:"type",hash:{},data:a}):r))+'">\n        <i class="fa fa-ellipsis-v main main"></i>\n        <span class="name">'+d((n.t||t&&t.t||l).call(s,null!=t?t.tag:t,{name:"t",hash:{},data:a}))+'</span>\n      </a>\n\n      <ul class="restrictions-list">\n'+(null!=(o=n.each.call(s,null!=t?t.permissions:t,{name:"each",hash:{},fn:e.program(2,a,0),inverse:e.noop,data:a}))?o:"")+"      </ul>\n    </dt>\n"},2:function(e,t,n,i,a){var o,r=null!=t?t:e.nullContext||{},s=n.helperMissing,l="function",c=e.escapeExpression;return'          <li>\n            <input type="checkbox" name="'+c((o=null!=(o=n.name||(null!=t?t.name:t))?o:s,typeof o===l?o.call(r,{name:"name",hash:{},data:a}):o))+'" id="template-restriction-'+c((o=null!=(o=n.name||(null!=t?t.name:t))?o:s,typeof o===l?o.call(r,{name:"name",hash:{},data:a}):o))+'" />\n            <label for="template-restriction-'+c((o=null!=(o=n.name||(null!=t?t.name:t))?o:s,typeof o===l?o.call(r,{name:"name",hash:{},data:a}):o))+'">'+c((n.t||t&&t.t||s).call(r,null!=t?t.tag:t,{name:"t",hash:{},data:a}))+"</label>\n          </li>\n"},compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){var o,r=null!=t?t:e.nullContext||{},s=n.helperMissing,l=e.escapeExpression;return'<div class="group">\n  <h4>'+l((n.t||t&&t.t||s).call(r,"tool.restrictions.template.title",{name:"t",hash:{},data:a}))+"</h4>\n  <p>\n    "+l((n.t||t&&t.t||s).call(r,"tool.restrictions.template.description",{name:"t",hash:{},data:a}))+'\n    <br><i class="fa fa-check-circle-o" /> '+l((n.t||t&&t.t||s).call(r,"tool.restrictions.template.can",{name:"t",hash:{},data:a}))+'\n    <br><i class="fa fa-ban" /> '+l((n.t||t&&t.t||s).call(r,"tool.restrictions.template.cannot",{name:"t",hash:{},data:a}))+'\n  </p>\n</div>\n\n<div class="wrapper">\n'+(null!=(o=n.each.call(r,null!=t?t.categories:t,{name:"each",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a}))?o:"")+"</div>\n"},useData:!0})},{"hbsfy/runtime":535}],427:[function(e,t,n){var i=e("./template-restrictions.hbs"),a=e("../../../factory/company").instance,o=e("../../../factory/restrictions");t.exports=Backbone.mixin(Backbone.View.extend({events:{"click dt > a":"categoryToggleEvent","change input":"changePermissionEvent"},categoryToggleEvent:function(e){function t(e){e.removeClass("active").removeAttr("style")}function n(){var e=0;a.contents().each(function(){1===this.nodeType&&(e+=$(this).outerHeight(!0))}),a.addClass("active").height(e),a.siblings(".active").each(function(){t($(this))})}var i=$(e.currentTarget),a=i.closest("dt"),o=a.hasClass("active");o&&t(a),o||n(),this.trigger("update")},changePermissionEvent:function(e){var t=$(e.currentTarget);o.setGlobalTemplateRestriction(t.attr("name"),t.is(":checked"))},initialize:function(){$.when(a.get("templates",INKIVE.C.BOOK.encodedId),a.get("groups")).then(_.bind(this.processGroups,this))},processGroups:function(e,t){var n=[];this.groups=t;var i=_(this.groups).find(function(e){return e.permissions&&e.permissions.template});i&&(this.permissionsList=_(i.permissions.template).map(function(e,t){return{name:t,tag:"tool.restrictions.template.permission."+t}}),n.push({key:"usage",tag:"tool.restrictions.template.categories.usage",permissions:this.getSpecificPermissions(/^function_[^_]*_file$/)}),n.push({key:"web_content",tag:"tool.restrictions.template.categories.web_content",permissions:this.getSpecificPermissions(/function_use_own_images|function_use_desygner_background|function_use_desygner_font|function_use_desygner_vector|function_use_web_images/)}),n.push({key:"adding",tag:"tool.restrictions.template.categories.adding",permissions:this.getSpecificPermissions(/text_add|image_add|vector_add|logo_add|icon_add|video_add|function_draw/)}),e.is_multipage&&n.push({key:"pages",tag:"tool.restrictions.template.categories.pages",permissions:this.getSpecificPermissions(/function_add_page|function_change_page_order/)}),_.each(["text","image","vector","logo","icon","video"],function(e){n.push({key:e,tag:"tool.restrictions.template.categories."+e,permissions:this.getSpecificPermissions(new RegExp("^"+e+"_(?!add).*"))})},this)),this.render(n)},getSpecificPermissions:function(e){return this.permissionsList.filter(function(t){return t.name.match(e)})},render:function(e){var t=_(this.groups).filter(function(e){return e.permissions});this.$el.html(i({groups:t,categories:e})),this.renderRestrictions(),this.trigger("update")},renderRestrictions:function(){var e=$.Deferred();return o.getTemplatePermissions().then(_.bind(function(t){t=_(t).find(function(e){return!e.group}),_.each(t,function(e,t){this.$el.find('input[name="'+t+'"]').prop("checked",e)},this),e.resolve()},this)),e.promise()}}),Backbone.Events)},{"../../../factory/company":98,"../../../factory/restrictions":122,"./template-restrictions.hbs":426}],428:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){var o=null!=t?t:e.nullContext||{},r=n.helperMissing,s=e.escapeExpression;return'<div class="antiscroll-wrap">\n  <div class="antiscroll-inner">\n    <div class="accordion tab-content restrictions active sub-category">\n\n      <div class="simplified-restrictions hidden">\n        <h2>'+s((n.t||t&&t.t||r).call(o,"editor.controller",{name:"t",hash:{},data:a}))+'</h2>\n\n        <div class="types">\n          <p>'+s((n.t||t&&t.t||r).call(o,"tool.restrictions.simplified.description",{name:"t",hash:{},data:a}))+'</p>\n\n          <ul>\n            <li>\n              <button class="webrand" data-type="tight" data-popover="tooltip" data-title="'+s((n.t||t&&t.t||r).call(o,"tool.restrictions.simplified.tight.tooltip",{name:"t",hash:{},data:a}))+'">\n                <i class="fa fa-hand-rock-o"></i>\n                <span>'+s((n.t||t&&t.t||r).call(o,"tool.restrictions.simplified.tight.button",{name:"t",hash:{},data:a}))+'</span>\n              </button>\n            </li>\n\n            <li>\n              <button class="webrand" data-type="moderate" data-popover="tooltip" data-title="'+s((n.t||t&&t.t||r).call(o,"tool.restrictions.simplified.moderate.tooltip",{name:"t",hash:{},data:a}))+'">\n                <i class="fa fa-hand-stop-o"></i>\n                <span>'+s((n.t||t&&t.t||r).call(o,"tool.restrictions.simplified.moderate.button",{name:"t",hash:{},data:a}))+'</span>\n              </button>\n            </li>\n\n            <li>\n              <button class="webrand" data-type="loose" data-popover="tooltip" data-title="'+s((n.t||t&&t.t||r).call(o,"tool.restrictions.simplified.loose.tooltip",{name:"t",hash:{},data:a}))+'">\n                <i class="fa fa-hand-peace-o"></i>\n                <span>'+s((n.t||t&&t.t||r).call(o,"tool.restrictions.simplified.loose.button",{name:"t",hash:{},data:a}))+'</span>\n              </button>\n            </li>\n          </ul>\n        </div>\n\n        <div class="description out">\n          <h4></h4>\n          <p class="base"></p>\n          <p>'+s((n.t||t&&t.t||r).call(o,"tool.restrictions.simplified.defaults",{name:"t",hash:{},data:a}))+'</p>\n\n          <button class="webrand apply">'+s((n.t||t&&t.t||r).call(o,"tool.restrictions.simplified.apply",{name:"t",hash:{},data:a}))+'</button>\n          <button class="webrand back">'+s((n.t||t&&t.t||r).call(o,"tool.restrictions.simplified.back",{name:"t",hash:{},data:a}))+'</button>\n        </div>\n      </div>\n\n      <div class="element-restrictions hidden"></div>\n      <div class="template-restrictions hidden"></div>\n      <div class="reset-restrictions hidden">\n        <button class="webrand">'+s((n.t||t&&t.t||r).call(o,"tool.restrictions.reset",{name:"t",hash:{},data:a}))+"</button>\n      </div>\n    </div>\n  </div>\n</div>\n"},useData:!0})},{"hbsfy/runtime":535}],429:[function(e,t,n){var i=e("./template.hbs"),a=e("../components/mixins/scrollable"),o=e("../../../facade/editor/editor"),r=e("./element-restrictions"),s=e("./template-restrictions"),l=e("../../../factory/restrictions"),c=e("../../../factory/company").instance;t.exports=Backbone.mixin(Backbone.View.extend({events:{"click .reset-restrictions button":"resetRestrictionsEvent","click .simplified-restrictions .types button":"showDescriptionEvent","click .simplified-restrictions .description button.back":"showTypesEvent","click .simplified-restrictions .description button.apply":"applyRestrictionsEvent"},resetRestrictionsEvent:function(){INKIVE.Modal.alertMessage(INKIVE.TemplatesHelper("alert_span",{text:INKIVE.TranslateHelper.translate("modal.alert.reset_restrictions")}),{callback:[_.bind(function(){l.removeAll();var e=this.$el.find(".simplified-restrictions");e.find(".description").addClass("out"),e.find(".types").removeClass("out"),this.toggleAdvancedRestrictions(!1)},this),$.noop]})},showDescriptionEvent:function(e){var t=INKIVE.TranslateHelper.translate,n="tool.restrictions.simplified.",i=$(e.currentTarget).data("type"),a=this.$el.find(".simplified-restrictions");this.selectedRestrictions=i,a.find(".description h4").text(t(n+i+".title")),a.find(".description p.base").html(t(n+i+".description")),a.find(".types, .description").toggleClass("out")},showTypesEvent:function(e){var t=this.$el.find(".simplified-restrictions");t.find(".types, .description").toggleClass("out")},applyRestrictionsEvent:function(){INKIVE.Modal.loader(this.$el.find(".tab-content")),this.$el.find(".simplified-restrictions").addClass("hidden"),l.createGlobalTemplateRestriction(this.selectedRestrictions).then(_.bind(function(){INKIVE.Modal.loaderClose(this.$el.find(".tab-content")),this.toggleAdvancedRestrictions(!0),this.templateRestrictionsView.renderRestrictions().then(this.elementRestrictionsView.refresh)},this))},initialize:function(){_.bindAll(this,"setSelection","onInnerViewUpdate"),this.scrollRefresh=_.debounce(_.bind(this.initScroll,this),1e3)},show:function(){var e=this.$el.find(".template-restrictions").length;e?this.templateRestrictionsView.renderRestrictions().then(this.elementRestrictionsView.refresh).then(_.bind(this.refreshElementSelection,this)):c.initialize().then(_.bind(this.render,this))},refreshElementSelection:function(){var e=o.get("selection");e.length&&(this.setSelection(e),this.elementRestrictionsView.setSelection(e))},render:function(){this.$el.html(i()),INKIVE.Helpers.initTooltips(this.$el),INKIVE.Modal.loader(this.$el.find(".tab-content")),this.afterLoading=_.after(2,_.once(_.bind(this.afterLoadingAll,this))),this.initElementRestrictions(),this.initTemplateRestrictions(),o.on("select",this.setSelection)},initTemplateRestrictions:function(){this.templateRestrictionsView=new s({el:this.$el.find(".template-restrictions")}),this.templateRestrictionsView.on("update",this.onInnerViewUpdate)},initElementRestrictions:function(){this.elementRestrictionsView=new r({el:this.$el.find(".element-restrictions")}),this.elementRestrictionsView.on("update",this.onInnerViewUpdate),o.on("page.move_to",this.elementRestrictionsView.refresh)},setSelection:function(e){this.$el.find(".simplified-restrictions").is(".hidden")&&this.$el.find(".template-restrictions").toggleClass("hidden",1===e.length)},onInnerViewUpdate:function(){this.afterLoading(),this.scrollRefresh()},afterLoadingAll:function(){l.getTemplatePermissions().then(_.bind(function(e){INKIVE.Modal.loaderClose(this.$el.find(".tab-content")),e=_(e).find(function(e){return!e.group}),this.toggleAdvancedRestrictions(e),e&&this.templateRestrictionsView.renderRestrictions().then(this.elementRestrictionsView.refresh)},this))},toggleAdvancedRestrictions:function(e){this.$el.find(".element-restrictions, .template-restrictions, .reset-restrictions").toggleClass("hidden",!e),this.$el.find(".simplified-restrictions").toggleClass("hidden",!!e)}}),a)},{"../../../facade/editor/editor":76,"../../../factory/company":98,"../../../factory/restrictions":122,"../components/mixins/scrollable":269,"./element-restrictions":400,"./template-restrictions":427,"./template.hbs":428}],430:[function(e,t,n){t.exports={eventCategory:"Editor UI | Tool Menu | search",show:{eventAction:"show"}}},{}],431:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){var o=null!=t?t:e.nullContext||{},r=n.helperMissing,s=e.escapeExpression;return'<div class="search-options">\n  <div data-key="this">\n    '+s((n.t||t&&t.t||r).call(o,"tool.search.same_format",{name:"t",hash:{},data:a}))+'\n  </div>\n\n  <div data-key="prop" class="selected">\n    '+s((n.t||t&&t.t||r).call(o,"tool.search.proportional_format",{name:"t",hash:{},data:a}))+'\n    <i class="desygner-icon-check"></i>\n  </div>\n  <div data-key="any">\n    '+s((n.t||t&&t.t||r).call(o,"tool.search.any_format",{name:"t",hash:{},data:a}))+"\n  </div>\n</div>\n"},useData:!0})},{"hbsfy/runtime":535}],432:[function(e,t,n){var i=e("./search-options.hbs"),a=e("../components/common/stock-component");t.exports=a.extend({selectSearchOptionEvent:function(e){var t=$(e.target),n=this.$searchOptions.find("> div");t.is(n)&&(n.removeClass("selected"),n.find(".desygner-icon-check").appendTo(t),t.addClass("selected")),n.closest(".search-container").children("input").focus()},search:function(e){var t=this.$el.find(".thumbnail-wrapper");t.removeClass("thumbnail-wrapper").addClass("tab-content"),t.empty().css("height",""),this.$el.find(".search-title").removeClass("hidden"),this.$el.find(".antiscroll-scrollbar").remove();var n=this.$searchOptions.find(".selected").data("key");this.tool.initSearch(this.$el,{query:e.val(),type:"layout"+("any"===n?"":" "+n),callback:this.refreshAntiscroll})},loadButtons:function(){var e=$.Deferred();return e.resolve(),e.promise()},getSearchOptions:function(e){return this.$searchOptions||(this.$searchOptions=$(i()),INKIVE.Helpers.initPopover(this.$searchOptions)),this.$searchOptions}})},{"../components/common/stock-component":260,"./search-options.hbs":431}],433:[function(e,t,n){var i=e("../components/common/common-component"),a=e("../../../analytics/decorate"),o=e("../images/stock"),r=e("../icons/stock");e("./templates");t.exports=a(e("./analytics/view"),i.extend({type:"search",show:function(){var e=this.$el.find(".tab-content.search").length;e?this.refresh():this.render()},render:function(){i.prototype.render.call(this),this.$headerLinks.filter("[data-key=images]").trigger("click")},initImagesView:function(){this.registerTabView("images",new o({el:this.$el.find(".tab-content > .images"),simplified:!0}))},initIconsView:function(){this.registerTabView("icons",new r({el:this.$el.find(".tab-content > .icons"),simplified:!0}))}}))},{"../../../analytics/decorate":5,"../components/common/common-component":257,"../icons/stock":363,"../images/stock":378,"./analytics/view":430,"./templates":432}],434:[function(e,t,n){t.exports={eventCategory:"Editor UI | Tool Menu | settings",show:{eventAction:"show"},lockEvent:function(){this.trackEvent({eventAction:"lock",eventLabel:!this.globalLock})},autoSaveEvent:function(){this.trackEvent({eventAction:"auto_save",eventLabel:!INKIVE.C.IS_AUTO_SAVE})}}},{}],435:[function(e,t,n){var i=e("../../../analytics/decorate");t.exports=i(e("./analytics/view"),Backbone.View.extend({events:{"click a.btn.autosave":"autoSaveEvent","click a.btn.lock":"lockEvent"},autoSaveEvent:function(){INKIVE.C.IS_AUTO_SAVE=!INKIVE.C.IS_AUTO_SAVE,localStorage.setItem("autosave",INKIVE.C.IS_AUTO_SAVE),INKIVE.Tool.autoSave(),this.toggle()},lockEvent:function(){var e=this.globalLock=!this.globalLock;localStorage.setItem("lock_elements",e),$("#svgcontent .element").each(function(){$(this).toggleClass("locked",e)});var t=svgedit.select.getSelectorManager();t.releaseAllSelectors(),this.toggle()},initialize:function(){_.bindAll(this,"toggle"),INKIVE.C.IS_AUTO_SAVE="false"!==localStorage.getItem("autosave"),this.globalLock="true"===localStorage.getItem("lock_elements")},toggle:function(){var e=this.$el.find("a.btn.autosave");e.find("i.check").toggleClass("hidden",!INKIVE.C.IS_AUTO_SAVE),e.find("i.uncheck").toggleClass("hidden",INKIVE.C.IS_AUTO_SAVE),e=this.$el.find("a.btn.lock"),e.find("i.check").toggleClass("hidden",!this.globalLock),e.find("i.uncheck").toggleClass("hidden",this.globalLock)},show:function(){this.toggle()}}))},{"../../../analytics/decorate":5,"./analytics/view":434}],436:[function(e,t,n){var i=e("../../../../factory/formats");t.exports={eventCategory:"Editor UI | Tool Menu | templates",thumbnailClickEvent:function(e){var t=$(e.currentTarget);i.getFormat(t.data("key")).then(_.bind(function(e){this.trackEvent({eventAction:"show_format",eventLabel:e.string_id+" "+e.id})},this))}}},{"../../../../factory/formats":101}],437:[function(e,t,n){t.exports={eventCategory:"Editor UI | Tool Menu | templates",show:{eventAction:"show"},listContentToggleEvent:function(e){var t=$(e.currentTarget),n=t.closest("dt");n.hasClass("active")||this.trackEvent({eventAction:"content_toggle",eventLabel:t.data("key")})}}},{}],438:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){return'<div class="antiscroll-wrap">\n  <div class="antiscroll-inner">\n    <ul class="thumbnail-wrapper"></ul>\n  </div>\n</div>\n'},useData:!0})},{"hbsfy/runtime":535}],439:[function(e,t,n){var i=e("../templates-base"),a=e("../../../../factory/formats"),o=e("../../../../factory/company").instance,r=e("../../../../factory/desygner-company"),s=e("../../components/thumbnail/restricted");t.exports=i.extend({fetchType:"brand",initialize:function(e){this.tool=INKIVE.Tool.getInstance(),this.canvas=this.tool.editor.canvas,e.format&&i.prototype.initialize.call(this,e),e.format||a.getCurrentFormat().then(_.bind(function(t){this.getSimilarFormat({format:t}).then(_.bind(function(t){e.format=t,i.prototype.initialize.call(this,e)},this))},this))},getSimilarFormat:function(e){function t(e){function t(e){var t=INKIVE.Helpers.convertUnitsToPixels(e.width,e.unit),n=INKIVE.Helpers.convertUnitsToPixels(e.height,e.unit);return _.extend(e,{width:t,height:n,ratio:t/n})}var n,i=1/0,a=1/0,o=this.canvas.contentW,r=this.canvas.contentH,s=o/r;return _.each(e,function(e){var l,c=t(e),d=Math.abs(s-c.ratio);d<a&&(l=Math.abs(o-c.width)+Math.abs(r-c.height),l<i&&(n=e,i=l,a=d))}),n}var n=$.Deferred(),i=_.bind(t,this);return e.format&&n.resolve(e.format),e.format||(this.isCustomFormat=!0,a.getFormats().then(function(e){n.resolve(i(e))})),n.promise()},loadData:function(e,t){function n(){var e="brand"===this.fetchType;INKIVE.Modal.loader(this.$el.find(".antiscroll-inner")),e&&this.fetchBrandTemplates(),e||this.fetchDesygnerTemplates()}this.end=t,this.repeat=e,this.templateData&&n.call(this),this.templateData||this.preloadData().then(_.bind(function(e){this.format=this.format||e,n.call(this)},this))},preloadData:function(){function e(){return o.get("designs",INKIVE.C.BOOK.encodedId)}function t(e){return o.get("templates",e.template)}function n(e){return this.templateData=e,o.get("formats",e.format)}return e().then(t).then(_.bind(n,this))},fetchBrandTemplates:function(){o.get("formats",this.format.id,"templates").then(_.bind(function(e){this.fetchType="desygner",this.appendBrandThumbnails(e),this.repeat()},this))},fetchDesygnerTemplates:function(){function e(){INKIVE.Modal.loaderClose(this.$el.find(".antiscroll-inner")),this.scrollRefresh(),this.end()}this.format.parent_format||e.call(this),this.format.parent_format&&r.get("formats",this.format.parent_format,"templates").then(_.bind(function(t){this.appendBrandThumbnails(t),e.call(this)},this))},appendBrandThumbnails:function(e){var t=this.$el.find(".thumbnail-wrapper .scrollDetect");e=_(e).sortBy(function(e){return this.templateData.id===e.id?-1:e.id},this),_.each(e,function(e){var n=$("<li>").addClass("thumbnail image loading").data("key","brand-"+e.id).insertBefore(t);new s({el:n,width:this.columnWidth,format:this.format,baseTemplate:e,openSet:this.templateData.id===e.id})},this)}})},{"../../../../factory/company":98,"../../../../factory/desygner-company":99,"../../../../factory/formats":101,"../../components/thumbnail/restricted":303,"../templates-base":444}],440:[function(e,t,n){var i=e("../templates-base"),a=e("../../../../factory/formats"),o=e("../../components/thumbnail/grid");t.exports=i.extend({columnWidth:255,initialize:function(e){this.tool=INKIVE.Tool.getInstance(),this.canvas=this.tool.editor.canvas,this.getFormat(e).then(_.bind(function(t){e.format=t,i.prototype.initialize.call(this,e)},this))},getFormat:function(e){function t(e){function t(e){var t=INKIVE.Helpers.convertUnitsToPixels(e.width,e.unit),n=INKIVE.Helpers.convertUnitsToPixels(e.height,e.unit);return _.extend(e,{width:t,height:n,ratio:t/n})}var n,i=1/0,a=1/0,o=this.canvas.contentW,r=this.canvas.contentH,s=o/r;return _.each(e,function(e){var l,c=t(e),d=Math.abs(s-c.ratio);d<a&&(l=Math.abs(o-c.width)+Math.abs(r-c.height),l<i&&(n=e,i=l,a=d))}),n}var n=$.Deferred(),i=_.bind(t,this);return e.format&&n.resolve(e.format),e.format||(this.isCustomFormat=!0,a.getFormats().then(function(e){n.resolve(i(e))})),n.promise()},initDataLoading:function(){this.loadDataType="default",i.prototype.initDataLoading.call(this)},loadData:function(e,t){var n=_.partial(this.onMoreData,this.filterActionId),i="default"===this.loadDataType;this.end=t,this.repeat=e,INKIVE.Modal.loader(this.$el.find(".antiscroll-inner")),i&&INKIVE.Helpers.api(this.apiCall,"GET",this.getParams(),n),i||INKIVE.Helpers.sendCmd(INKIVE.C.BASE_URL+"grid/fetch",this.getParams(),n)},getParams:function(){return"default"!==this.loadDataType?_.extend({number_of_photos:++this.numberOfPhotos},this.size):i.prototype.getParams.call(this)},onMoreData:function(e,t){if(e===this.filterActionId){var n="default"===this.loadDataType;t=n?t:JSON.parse(t);var i=n?t.data.length>0:"SUCCESS"===t.STATUS;i?(n&&this.appendThumbnails(t.data),n||this.appendGridThumbnails(t.MESSAGE),this.repeat()):"default"===this.loadDataType?(this.numberOfPhotos=0,this.loadDataType="grid",this.from=0,this.setGridTemplateFormat(),this.repeat()):(this.end(),INKIVE.Modal.loaderClose(this.$el.find(".antiscroll-inner"))),INKIVE.Helpers.initTooltips(this.$el),this.scrollRefresh()}},setGridTemplateFormat:function(){var e=INKIVE.Helpers.convertUnitsToPixels,t=this.$el.find(".thumbnail-wrapper .thumbnail ").first(),n=t.width()||this.columnWidth,i=this.tool.editor.canvas;this.callFormat=this.isCustomFormat?{width:i.contentW,height:i.contentH}:{width:e(this.format.width,this.format.unit),height:e(this.format.height,this.format.unit)},this.size={width:n,height:n*(this.callFormat.height/this.callFormat.width)}},appendGridThumbnails:function(e){var t=this.$el.find(".thumbnail-wrapper .scrollDetect");t.height();_.each(e,function(e){var n=$("<li>").addClass("thumbnail grid").insertBefore(t);new o({el:n,size:this.size,format:this.callFormat,data:e,numberOfPhotos:this.numberOfPhotos})},this)}})},{"../../../../factory/formats":101,"../../components/thumbnail/grid":289,"../templates-base":444}],441:[function(e,t,n){var i=e("../templates-base"),a=e("../../../../factory/formats"),o=e("../../../../factory/company").instance,r=e("../../../../facade/restrictions/restrictions"),s=e("../../components/thumbnail/template-page");t.exports=i.extend({fetchType:"brand",initialize:function(){},columnWidth:255,show:function(){this.$el.find(".thumbnail-wrapper li").length||(this.tool=INKIVE.Tool.getInstance(),this.canvas=this.tool.editor.canvas,a.getCurrentFormat().then(_.bind(function(e){this.format=e,i.prototype.initialize.call(this,{format:e})},this)))},loadData:function(e,t){this.end=t,this.repeat=e,this.getDesign().then(this.getTemplate).then(this.onMoreData)},getDesign:function(){return o.get("designs",INKIVE.C.BOOK.encodedId)},getTemplate:function(e){return o.get("templates",e.template)},onMoreData:function(e){this.template=e,this.$scrollDetect=this.$el.find(".thumbnail-wrapper .scrollDetect"),this.canChangePageOrder=r.isFunctionalityAllowed("function_change_page_order"),_.each(e.pages,this.appendTemplatePageThumbnails,this),this.end(),INKIVE.Helpers.initTooltips(this.$el),INKIVE.Modal.loaderClose(this.$el.find(".antiscroll-inner")),this.scrollRefresh()},appendTemplatePageThumbnails:function(e,t){var n=$("<li>").addClass("thumbnail image loading").insertBefore(this.$scrollDetect);
new s({el:n,width:this.columnWidth,format:this.format,template:this.template,pageNumber:t,canChangePageOrder:this.canChangePageOrder})}})},{"../../../../facade/restrictions/restrictions":94,"../../../../factory/company":98,"../../../../factory/formats":101,"../../components/thumbnail/template-page":305,"../templates-base":444}],442:[function(e,t,n){var i=e("../templates-base"),a=e("../../../../factory/formats"),o=e("../../../../factory/company").instance,r=e("../../../../factory/desygner-company"),s=e("../../components/thumbnail/restricted");t.exports=i.extend({fetchType:"brand",columnWidth:255,numberOfTemplates:0,initialize:function(){},show:function(){this.$el.find(".thumbnail-wrapper li").length||(this.tool=INKIVE.Tool.getInstance(),this.canvas=this.tool.editor.canvas,a.getCurrentFormat().then(_.bind(function(e){this.getSimilarFormat({format:e}).then(_.bind(function(e){var t={format:e};i.prototype.initialize.call(this,t)},this))},this)))},getSimilarFormat:function(e){function t(e){function t(e){var t=INKIVE.Helpers.convertUnitsToPixels(e.width,e.unit),n=INKIVE.Helpers.convertUnitsToPixels(e.height,e.unit);return _.extend(e,{width:t,height:n,ratio:t/n})}var n,i=1/0,a=1/0,o=this.canvas.contentW,r=this.canvas.contentH,s=o/r;return _.each(e,function(e){var l,c=t(e),d=Math.abs(s-c.ratio);d<a&&(l=Math.abs(o-c.width)+Math.abs(r-c.height),l<i&&(n=e,i=l,a=d))}),n}var n=$.Deferred(),i=_.bind(t,this);return e.format&&n.resolve(e.format),e.format||(this.isCustomFormat=!0,a.getFormats().then(function(e){n.resolve(i(e))})),n.promise()},loadData:function(e,t){function n(){var e="brand"===this.fetchType;INKIVE.Modal.loader(this.$el.find(".antiscroll-inner")),e&&this.fetchBrandTemplates(),e||this.fetchDesygnerTemplates()}this.end=t,this.repeat=e,this.templateData&&n.call(this),this.templateData||this.preloadData().then(_.bind(function(e){this.format=this.format||e,n.call(this)},this))},preloadData:function(){function e(){return o.get("templates",INKIVE.C.BOOK.encodedId)}function t(e){return this.templateData=e,o.get("formats",e.format)}return e().then(_.bind(t,this))},fetchBrandTemplates:function(){o.get("formats",this.format.id,"templates").then(_.bind(function(e){this.fetchType="desygner",this.appendBrandThumbnails(e),this.repeat()},this))},fetchDesygnerTemplates:function(){var e=_.bind(function(e){e&&this.appendBrandThumbnails(e),INKIVE.Modal.loaderClose(this.$el.find(".antiscroll-inner")),this.scrollRefresh(),this.end(),this.numberOfTemplates||this.$el.prepend('<div class="info">'+INKIVE.TranslateHelper.translate("tool.templates.no_similar_formats")+"</div>")},this);this.format.parent_format?r.get("formats",this.format.parent_format,"templates").then(function(t){e(t)}):e()},appendBrandThumbnails:function(e){var t=this.$el.find(".thumbnail-wrapper .scrollDetect");_.each(e,function(e){if(this.templateData.id!==e.id){var n=$("<li>").addClass("thumbnail image loading").data("key","brand-"+e.id).insertBefore(t);new s({el:n,width:this.columnWidth,format:this.format,baseTemplate:e}),this.numberOfTemplates++}},this)}})},{"../../../../factory/company":98,"../../../../factory/desygner-company":99,"../../../../factory/formats":101,"../../components/thumbnail/restricted":303,"../templates-base":444}],443:[function(e,t,n){var i=e("../components/accordion-list/content"),a=e("../../../factory/formats"),o=e("../components/thumbnail/format"),r=e("../../../analytics/decorate");t.exports=r(e("./analytics/sub-categories"),i.extend({views:{},template:e("./content.hbs"),TemplatesView:e(INKIVE.C.BOOK.book_type==INKIVE.C.BOOK_TYPE.DESYGNER_DESIGN?"./mode-view/designs":"./mode-view/layouts"),events:{"click .thumbnail-wrapper .thumbnail":"thumbnailClickEvent"},thumbnailClickEvent:function(e){var t=$(e.currentTarget);a.getFormat(t.data("key")).then(_.bind(function(e){this.openNewView(t.data("key"),this.TemplatesView,{format:e})},this))},initialize:function(e){_.bindAll(this,"render","initScroll","thumbnailClickEvent"),this.tool=INKIVE.Tool.getInstance(),a.getGroup(e.key).then(this.render)},render:function(e){this.$el.html(this.template()),this.appendThumbnails(e.data),_.delay(this.initScroll,1e3)},appendThumbnails:function(e){var t=60,n=this.$el.width()-t,i=this.$el.find(".thumbnail-wrapper");_.each(e,function(e){var t=$("<li>").addClass("thumbnail image loading dark").data("key",e.id).appendTo(i);new o({el:t,width:n,format:e})})},getScrollHeight:function(e){var t=100;return e.closest(".tab-content.inner-tabs").height()-t}}))},{"../../../analytics/decorate":5,"../../../factory/formats":101,"../components/accordion-list/content":252,"../components/thumbnail/format":288,"./analytics/sub-categories":436,"./content.hbs":438,"./mode-view/designs":439,"./mode-view/layouts":440}],444:[function(e,t,n){var i=e("../components/accordion-list/content"),a=e("../components/thumbnail/designed");t.exports=i.extend({apiCall:"search/layouts",template:e("./content.hbs"),columnWidth:255,initialize:function(e){this.format=e.format,this.formats=e.formats,i.prototype.initialize.call(this)},getParams:function(){var e={from:this.from,limit:this.limit,where:{format:this.format?this.format.id:_.pluck(this.formats,"id"),active:INKIVE.C.USER.IS_SUPER?0:1}};return this.from+=this.limit,e},render:function(){this.$el.html(this.template()),this.format&&this.$el.data("key",this.format.string_id)},appendThumbnails:function(e){var t=this.$el.find(".thumbnail-wrapper .scrollDetect");_.each(e,function(e){var n=$("<li>").addClass("thumbnail image loading").data("key",e.id).insertBefore(t);new a({el:n,width:this.columnWidth,design:e,isCustomFormat:this.isCustomFormat})},this)},getScrollHeight:function(e){var t=INKIVE.C.BOOK.book_type===INKIVE.C.BOOK_TYPE.DESIGN?100:0;return e.height()-t}})},{"../components/accordion-list/content":252,"../components/thumbnail/designed":287,"./content.hbs":438}],445:[function(e,t,n){var i=e("./view-base"),a=e("../components/accordion-list/director"),o=e("../../../factory/formats"),r=e("../../../facade/design/design"),s=e("../../../facade/editor/editor"),l=e("./sub-categories"),c=e("../../../analytics/decorate");t.exports=c(e("./analytics/view"),i.extend({"class":"sub-category template",CategoriesView:l,views:{},Views:{custom:e("./templates")},loadListContent:function(e){var t="custom"==e;t||i.prototype.loadListContent.call(this,e),t&&a.prototype.loadListContent.call(this,e)},initialize:function(){_.bindAll(this,"refresh","goToFormat","goToCustom"),i.prototype.initialize.call(this),this.debouncedRefresh=_.debounce(this.refresh,600),s.on("page.move_to",this.debouncedRefresh),r.on("template.update.size",this.debouncedRefresh)},refresh:function(){var e=this.$el.find(".tab-content."+this["class"].split(" ").join(".")).length;e&&(this.initScroll(),this.scrollRefresh(),o.getCurrentFormat().then(_.bind(function(e){var t=this.$el.find("dt.active .image-list:not(.out)").data("key");e&&t===e.string_id||(_.each(this.views,function(e){for(;!e.closeView(););e.remove()}),this.views={},this.render())},this)))},render:function(){INKIVE.Modal.loader(this.$el),o.getCurrentFormat().then(_.bind(function(e){var t=this.$el.is(".tab.active")||this.$el.closest(".tab-content").is(".active");this.format=e,i.prototype.render.call(this),this.updateCustomFormatCategory(),t&&(this.format&&_.defer(this.goToFormat),this.format||_.defer(this.goToCustom))},this))},goToFormat:function(){var e=this.format;o.getGroups().then(_.bind(function(t){var n=_.find(t,function(t){return _.findWhere(t.data,{id:e.id})});this.$el.find('dt > a.btn[data-key="'+n.key+'"]').trigger("click")},this))},goToCustom:function(){this.$el.find('dt > a.btn[data-key="custom"]').trigger("click")},loadButtons:function(){var e=$.Deferred();return o.getGroups().then(function(t){var n=_.map(t,function(e){return{key:e.key,tag:e.name,icon:"fa fa-ellipsis-v"}}),i="Custom";n.push({key:"custom",tag:i,icon:"fa fa-ellipsis-v"}),e.resolve(n)}),e.promise()},updateCustomFormatCategory:function(){this.format&&this.$el.find('dt > a.btn[data-key="custom"]').hide(),this.format||this.$el.find('dt > a.btn[data-key="custom"]').show()},getScrollHeight:function(){return this.$el.height()},initScroll:function(){i.prototype.initScroll.call(this),this.$el.find(".antiscroll-scrollbar").remove()}}))},{"../../../analytics/decorate":5,"../../../facade/design/design":34,"../../../facade/editor/editor":76,"../../../factory/formats":101,"../components/accordion-list/director":254,"./analytics/view":437,"./sub-categories":443,"./templates":446,"./view-base":447}],446:[function(e,t,n){var i=e("./templates-base"),a=e("../components/accordion-list/content"),o=e("../components/thumbnail/designed");t.exports=i.extend({callbackName:"callbackLayouts",appendThumbnails:a.prototype.appendThumbnails,appendThumbnails:function(e){var t=this.$el.find(".thumbnail-wrapper .scrollDetect");_.each(e,function(e){var n=$("<li>").addClass("thumbnail image loading").data("key",e.id).insertBefore(t);new o({el:n,width:this.columnWidth,design:e,isCustomFormat:!0})},this)},extractData:function(e){var t=255;return _.compact(_.map(e,function(e){var n=parseInt(e.format_width),i=parseInt(e.format_height),a=i/n*t;if(e.id)return{id:"layout-"+e.id,src:e.url,width:t,height:a,isNocover:INKIVE.C.USER.IS_SUPER,cls:parseInt(e.active)?"":"grayscale",data:{count:e.count,set:e.set,num:e.num,orientation:e.orientation,text:e.text,active:e.active}}}))}})},{"../components/accordion-list/content":252,"../components/thumbnail/designed":287,"./templates-base":444}],447:[function(e,t,n){var i=e("../components/accordion-list/categories-director"),a=e("../../../factory/formats"),o=e("./sub-categories");t.exports=i.extend({"class":"sub-category template",CategoriesView:o,initialize:function(){i.prototype.initialize.call(this),this.tool=INKIVE.Tool.getInstance()},loadListContent:function(e){i.prototype.loadListContent.call(this,e),this.format&&_.delay(_.bind(function(){_.each(this.$el.find(".thumbnail"),function(e){$(e).data("key")==this.format.id&&$(e).trigger("click")},this),this.format=null},this),600)},loadButtons:function(){var e=$.Deferred();return a.getGroups().then(function(t){e.resolve(_.map(t,function(e){return{key:e.key,tag:e.name,icon:"fa fa-ellipsis-v"}}))}),e.promise()},closeAccordion:function(){var e=this.$el.find("dt");_.each(this.views,function(t,n){e.find('a[data-key="'+n+'"] .category').remove()}),i.prototype.closeAccordion.call(this)},_render:function(e){INKIVE.Modal.loaderClose(this.$el),this.$el.html(this.template({"class":this["class"],buttons:e,add_button:this.addButtonText}))},getCategoryName:function(e){return e.format.name}})},{"../../../factory/formats":101,"../components/accordion-list/categories-director":250,"./sub-categories":443}],448:[function(e,t,n){var i=e("../components/common/common-component"),a=e("./templates-view"),o=e("../customize/contents/grids/view"),r=e("../../../analytics/decorate");INKIVE.C.BOOK.book_type===INKIVE.C.BOOK_TYPE.TEMPLATE?t.exports=e("./mode-view/templates"):INKIVE.C.BOOK.book_type===INKIVE.C.BOOK_TYPE.RESTRICTED_DESIGN?t.exports=e("./mode-view/restricted"):INKIVE.Helpers.isDesygnerProject()&&(t.exports=r(e("./analytics/view"),i.extend({type:"template",updateSearchContainer:$.noop,isAlreadyThere:function(){return!!this.$el.find(".tab-content.template").length},render:function(){i.prototype.render.call(this),this.$headerLinks.filter("[data-key=add]").trigger("click")},initAddView:function(){var e=new a({el:this.$el.find("div.add")});this.registerTabView("add",e),e.render()},initGridView:function(){var e=new o({el:this.$el.find("div.grid")});this.registerTabView("grid",e),this.$el.find(".thumbnail-wrapper").append('<div class="scrollDetect hide"/>'),e.render()}})))},{"../../../analytics/decorate":5,"../components/common/common-component":257,"../customize/contents/grids/view":332,"./analytics/view":437,"./mode-view/restricted":441,"./mode-view/templates":442,"./templates-view":445}],449:[function(e,t,n){t.exports={eventCategory:"Editor UI | Tool Menu | text banners",loadData:{eventAction:"load_more"}}},{}],450:[function(e,t,n){t.exports={eventCategory:"Editor UI | Tool Menu | text",show:{eventAction:"show"}}},{}],451:[function(e,t,n){var i=e("../components/accordion-list/content"),a=e("../../../analytics/decorate"),o=e("../components/thumbnail/text-banner");t.exports=a(e("./analytics/banners"),i.extend({apiCall:"search/stickers",limit:30,thumbnailViews:[],callbackName:"callbackStickers",initialize:function(){INKIVE.C.IS_MOBILE&&this.show(),this.debouncedMasonryReload=_.debounce(_.bind(this.masonryReload,this),800)},show:function(){this.isAlreadyThere||i.prototype.initialize.call(this),this.isAlreadyThere=!0},refresh:function(){_.invoke(this.thumbnailViews,"resize")},render:function(){i.prototype.render.call(this),this.$el.find(".thumbnail-wrapper").masonry()},getParams:function(){var e={from:this.from,limit:this.limit,where:{active:INKIVE.C.USER.IS_SUPER?0:1,isText:1}};return this.from+=this.limit,e},getScrollHeight:function(e){var t=e.closest(".tab-content"),n=t.height();return n-=t.find(".header-links").height()},appendThumbnails:function(e){var t=this.$el.find(".thumbnail-wrapper"),n=t.find(".scrollDetect");_.each(e,function(e){if(e.url){var i=$("<div>").addClass("thumbnail svg").data("key",e.id).insertBefore(n),a=new o({el:i,svg:e});t.masonry("appended",i),a.on("resize",this.debouncedMasonryReload),this.thumbnailViews.push(a)}},this)}}))},{"../../../analytics/decorate":5,"../components/accordion-list/content":252,"../components/thumbnail/text-banner":324,"./analytics/banners":449}],452:[function(e,t,n){var i=e("./banners"),a=e("../components/thumbnail/text"),o=e("../../../utils/humps"),r=e("../components/common/common-component"),s=e("../../../analytics/decorate");t.exports=s(e("./analytics/view"),r.extend({type:"text",uploadViewKey:"text-import",searchKeyupEvent:function(e){var t=$(e.target).val(),n=this.$el.find("."+this.selectedTab.key).find(".antiscroll-wrap");n.find("li, .thumbnail").each(function(){var e=$(this),n=e.find("span.name").html()||e.find("a.folder-name").html()||e.find(".text span").html()||"";n&&e.css("display",""),n.toLowerCase().indexOf(t.toLowerCase())===-1&&e.hide()}),this.embededImportView.views[this.type].masonryReload()},isAlreadyThere:function(){return!!this.$el.find(".tab-content.text").length},refresh:function(){r.prototype.refresh.call(this),this.$headerLinks.filter("[data-key=add]").is(".active")&&this.initAddView(),this.$headerLinks.filter("[data-key=banners]").is(".active")&&this.bannersView.refresh()},render:function(){r.prototype.render.call(this),this.$headerLinks.filter("[data-key=add]").trigger("click")},initAddView:function(){r.prototype.initAddView.call(this),this.renderDefaultText(),this.initDefaultText()},renderDefaultText:function(){var e=this.$el.find(".add > .thumbnail-wrapper");this.defaultTextViews=_.map(INKIVE.C.TextDefault,function(t,n){var i=$("<div>").addClass("thumbnail").appendTo(e),r=localStorage.getItem("default_text_"+n);return new a({el:i,data:_.extend(o.decamelizeKeys(t),JSON.parse(r))})},this)},initDefaultText:function(){function e(){_.each(n,function(e){e.type().then(function(){e.$el.find("a.toggle-options").addClass("show"),e.endTyping()})})}function t(){_.each(n,function(e){var t=_.bind(this.textChangeEvent,this,e);e.on("change",t)},this)}var n=this.defaultTextViews,i=_.last(this.defaultTextViews),a=INKIVE.TranslateHelper.translate("tool.text.click"),o=!localStorage.getItem("text_hint");localStorage.setItem("text_hint",!0),t.call(this),o||e(),o&&i.type(a).then(function(){i.erase().then(e)})},textChangeEvent:function(e){var t=e.getTextData("_"),n=_.findIndex(this.defaultTextViews,e);localStorage.setItem("default_text_"+n,JSON.stringify(t))},initBannersView:function(){var e=$("<div></div>").addClass("image-list");this.$el.find(".tab-content > .banners").append(e),this.bannersView=new i({el:e}),this.registerTabView("banners",this.bannersView),this.bannersView.show()},updateSearchContainer:function(){var e=this.selectedTab.searchable;"add"===this.selectedTab.key?e=this.$el.find(".imported-elements .thumbnail-wrapper").children().length>1:"library"===this.selectedTab.key&&(e=!0),e&&this.displaySearchContainer(this.$el.find(".search-container"))}}))},{"../../../analytics/decorate":5,"../../../utils/humps":482,"../components/common/common-component":257,"../components/thumbnail/text":325,"./analytics/view":450,"./banners":451}],453:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){return'<div class="import-button">\n  <div class="button">\n    '+e.escapeExpression((n.t||t&&t.t||n.helperMissing).call(null!=t?t:e.nullContext||{},"tool.customize.add_video",{name:"t",hash:{},data:a}))+'\n  </div>\n</div>\n\n<div class="thumbnail-wrapper"></div>'},useData:!0})},{"hbsfy/runtime":535}],454:[function(e,t,n){t.exports={eventCategory:"Editor UI | Tool Menu | videos",show:{eventAction:"show"}}},{}],455:[function(e,t,n){var i=e("../components/common/common-component"),a=e("./add-template.hbs"),o=e("../../../facade/design/design"),r=e("../../../modal/prompt"),s=e("../../../analytics/decorate");t.exports=s(e("./analytics/view"),i.extend({type:"video",updateSearchContainer:$.noop,events:_.extend({"click .tab-content > .add .button":"addVideoEvent"},i.prototype.events),addVideoEvent:function(){this.displayAddVideoModal()},isAlreadyThere:function(){return!!this.$el.find(".tab-content.video").length},render:function(){i.prototype.render.call(this),this.$headerLinks.filter("[data-key=library]").trigger("click")},initAddView:function(){this.$el.find(".tab-content > .add").html(a),this.delegateEvents()},displayAddVideoModal:function(){this.prompt=new r({label:INKIVE.TranslateHelper.translate("modal.prompt.add_video")}),this.modal=INKIVE.Modal.modalWindow(this.prompt.getFormHtml(),{width:400,headerIcon:"fa fa-film",headerTitle:"tool.customize.add_video",buttons:[{title:INKIVE.TranslateHelper.translate("modal.buttons.add_video"),onClick:_.bind(this._addVideo,this)}]})},_addVideo:function(){this.modal.close();var e=this.prompt.getValue();if(e){var t=INKIVE.Tool.getInstance().editor.canvas,n=t.contentW>t.contentH?.8*t.contentH:.8*t.contentW,i=Math.min(t.contentW,t.contentH);i/=n,o.create("video",{source:e,position:{x:(t.contentW-n*(i/2))/2,y:(t.contentH-n*(i/2))/2},size:{width:n*(i/2),height:n*(i/2)}})}}}))},{"../../../analytics/decorate":5,"../../../facade/design/design":34,"../../../modal/prompt":139,"../components/common/common-component":257,"./add-template.hbs":453,"./analytics/view":454}],456:[function(e,t,n){t.exports={eventCategory:"Editor UI | Top Menu",eventAction:"share",shareProjectByEmbedEvent:{eventLabel:"project_embed"},shareProjectByEmailEvent:{eventLabel:"project_email"},shareDesignEvent:function(e){var t=$(e.currentTarget).attr("class");this.trackEvent({eventLabel:"design_"+t})},shareProjectEvent:function(e){var t=$(e.currentTarget).attr("class");this.trackEvent({eventLabel:"project_"+t})},changeTabEvent:function(e){var t=$(e.currentTarget),n=t.data("target");this.trackEvent({eventLabel:"show_"+n+"_tab"})}}},{}],457:[function(e,t,n){t.exports={eventCategory:"Editor UI | Top Menu",eventAction:"versions",loadVersion:function(e){var t=$(e.currentTarget).attr("data-versionId");this.trackEvent({eventLabel:"versionId_"+t})}}},{}],458:[function(e,t,n){t.exports={eventCategory:"Editor UI | Top Menu",saveEvent:{eventAction:"save"},shareEvent:{eventAction:"share",eventLabel:"show"},versionsEvent:{eventAction:"versions",eventLabel:"show"},downloadEvent:{eventAction:"download",eventLabel:"show"},printEvent:{eventAction:"print"},closeEvent:{eventAction:"close"},redoEvent:function(e){this.trackEvent({eventAction:"redo"})},undoEvent:function(e){this.trackEvent({eventAction:"undo"})}}},{}],459:[function(e,t,n){var i=e("../../status");t.exports={initialize:function(){_.bindAll(this,"execute","reques")},execute:function(e,t,n){n=n||$.noop,t=$.extend({format:null,contentW:null,contentH:null,baseUrl:INKIVE.C.BASE_URL,staticUrl:INKIVE.C.STATIC_URL},t),this.notification(!0);var a={book_id:INKIVE.C.BOOK.id,forced_transparency:e.find("[name=isForcedTransparency]").is(":checked")?"y":"n",bleed:e.find("[name=isBleed]").is(":checked")?"y":"n",is_zip:e.find("[name=isZip]").is(":checked")||INKIVE.C.IS_MOBILE_APP&&!window.Android?"y":"n",format:t.format,cmyk:e.find("[name=isCMYK]").is(":checked")?"y":"n"};e.find("a.quality.active").length?a.quality=e.find("a.quality.active").attr("data-value"):e.find(".quality-slider").length?a.quality=e.find(".quality-slider").slider("option","value"):a.quality=100,a.width=e.find('.rangeCurrentDimensions[data-type="width"]').val()||t.contentW,a.height=e.find('.rangeCurrentDimensions[data-type="height"]').val()||t.contentH,a.has_filter=$("#svgcontent").find("image[filter]").length>0?"y":"n","pdf"===t.format?(a.quality=e.find('input[name="pdf-quality"]:checked').val(),e.find('input[id="isRangeCurrent"]:checked').length?(a.start_page=INKIVE.Tool._current_page_number,a.end_page=INKIVE.Tool._current_page_number):(a.start_page=e.find('input[name="page_from"]').val()||1,a.end_page=e.find('input[name="page_to"]').val()||INKIVE.C.BOOK.num_pages)):a.start_page=a.end_page=INKIVE.Tool._current_page_number,_.each(["thumb","web","mobile"],function(t){e.find("[name=is"+t.charAt(0).toUpperCase()+t.slice(1)+"]").is(":checked")&&(a[t+"_width"]=e.find("."+t+'Dimensions[data-type="width"]').val(),a[t+"_height"]=e.find("."+t+'Dimensions[data-type="height"]').val())});var o=this.reques;$('body > header > .options button[data-action="download"]').addClass("disabled"),INKIVE.FormatFactory.getCurrentFormat().then(function(e){function r(e){var i=e?e:INKIVE.TranslateHelper.translate("modal.alert.can_not_prepare_file",{format:t.format});INKIVE.Modal.alertMessage(INKIVE.TemplatesHelper("alert_default",{message:i,try_again:!e})),n(!1)}e=e||INKIVE.FormatFactory.getCurrentSize(),e.unit&&(a.initial=e),$.post(t.baseUrl+"submitorder/downloadfromeditor",a,function(e){i.display(INKIVE.TranslateHelper.translate("general.preparing_download"),null,!0);var t=$.parseJSON(e);t?(_.each(t,function(e){INKIVE.Helpers.isUrlValid(e)&&_.delay(_.partial(o,e),3e3)}),n(!0)):r()}).fail(r)})},notification:function(e){$("#ik-download-notification").toggle(e),$('a[data-id="download"]').toggle(!e)},reques:function(e){var t=0,n=setInterval(_.bind(function(){INKIVE.Helpers.api("inkive/fileexists","GET",{url:e},_.bind(function(t){t&&"success"===t.status&&t.exists&&(this.notification(),clearInterval(n),INKIVE.C.IS_MOBILE_APP?AppBridge.callBoth("catch_file",{url:e,page:INKIVE.Tool._current_page_number}):(i.display(INKIVE.TranslateHelper.translate("general.download_ready")),$('body > header > .options button[data-action="download"]').removeClass("disabled"),INKIVE.Helpers.saveToDisk(e)))},this)),t>30&&(this.notification(),INKIVE.Modal.alertMessage(INKIVE.TemplatesHelper("alert_default",{message:"modal.alert.network",check_network:!0})),clearInterval(n)),t++},this),5e3)}}},{"../../status":475}],460:[function(e,t,n){function i(e,t,n){INKIVE.Modal.togglePageLoader(!0),n&&o(t,_.findWhere(e,{id:n})),n||FB.api("/me/albums",function(e){e&&!e.error?_.any(e.data,function(e){if(e.name===d)return r(t,e.id),!0})||a():s()})}function a(){var e={name:d,message:INKIVE.TranslateHelper.translate("top_submenu.share.album_title")};FB.api("/me/albums","post",e,function(e){r(e.id)})}function o(e,t){var n={message:e,url:c,access_token:t.access_token};FB.api("/"+t.id+"/photos","post",n,function(e){!e||e.error?s():(l.call("advice.show","share-success"),INKIVE.Modal.togglePageLoader(!1))})}function r(e,t){var n={message:e,url:c};FB.api("/"+t+"/photos","post",n,function(e){!e||e.error?s():(l.call("advice.show","share-success"),INKIVE.Modal.togglePageLoader(!1))})}function s(){l.call("advice.show","share-error"),INKIVE.Modal.togglePageLoader(!1)}var l,c,d="Desygner",u=e("./modal.hbs");t.exports=function(e){function t(e){return _.contains(e.perms,"CREATE_CONTENT")}FB.login(function(n){n.authResponse||s(),n.authResponse&&FB.api("/me/accounts",function(n){var a=_.map(_.filter(n.data,t),function(e){var t=INKIVE.TranslateHelper.translate("modal.share_design.facebook_options.page",{page_name:e.name});return{value:e.id,name:t}});a.unshift({name:INKIVE.TranslateHelper.translate("modal.share_design.facebook_options.timeline")}),c=e,l=INKIVE.Tool.getInstance().editor.canvas;var o=u({default_text:"modal.share_design.default_facebook",options:a.length>1&&a}),r=INKIVE.Modal.modalWindow(o,{width:500,headerIcon:"fa fa-facebook",headerTitle:"modal.title.share_facebook",buttons:[{title:INKIVE.TranslateHelper.translate("modal.buttons.share"),onClick:function(){i(n.data,$(r.getWrapper).find('[name="share-text"]').val(),$(r.getWrapper).find('select[name="share-option"]').val()),r.close()}}]})})},{scope:"publish_actions, user_photos, manage_pages, publish_pages"})}},{"./modal.hbs":462}],461:[function(e,t,n){t.exports=function(e){window.open("https://plus.google.com/share?url="+encodeURI(e),"_blank","top=0,right=0,width=750,height=320")}},{}],462:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({1:function(e,t,n,i,a){var o;return'    <select name="share-option">\n      '+(null!=(o=n.each.call(null!=t?t:e.nullContext||{},null!=t?t.options:t,{name:"each",hash:{},fn:e.program(2,a,0),inverse:e.noop,data:a}))?o:"")+"\n    </select>\n"},2:function(e,t,n,i,a){var o,r=null!=t?t:e.nullContext||{},s=n.helperMissing,l="function",c=e.escapeExpression;return'<option value="'+c((o=null!=(o=n.value||(null!=t?t.value:t))?o:s,typeof o===l?o.call(r,{name:"value",hash:{},data:a}):o))+'">'+c((o=null!=(o=n.name||(null!=t?t.name:t))?o:s,typeof o===l?o.call(r,{name:"name",hash:{},data:a}):o))+"</option>"},compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){var o,r=null!=t?t:e.nullContext||{},s=n.helperMissing,l=e.escapeExpression;return'<div class="tool-content">\n  <section>\n    <label for="share-text">'+l((n.t||t&&t.t||s).call(r,"common.share_message",{name:"t",hash:{},data:a}))+'</label>\n    <textarea name="share-text" class="form-control" placeholder="'+l((n.t||t&&t.t||s).call(r,"editor.add_message_optional",{name:"t",hash:{},data:a}))+'">'+l((n.t||t&&t.t||s).call(r,null!=t?t.default_text:t,{name:"t",hash:{},data:a}))+"</textarea>\n"+(null!=(o=n["if"].call(r,null!=t?t.options:t,{name:"if",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a}))?o:"")+"  </section>\n</div>\n"},useData:!0})},{"hbsfy/runtime":535}],463:[function(e,t,n){t.exports=function(e){window.open("//www.pinterest.com/pin/create/button/?url="+encodeURI(INKIVE.C.BASE_URL)+"&media="+encodeURI(e)+"&description="+Base64.decode(INKIVE.C.BOOK.name),"_blank","top=0,right=0,width=750,height=320")}},{}],464:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){var o,r,s=null!=t?t:e.nullContext||{},l=n.helperMissing,c=e.escapeExpression;return'<div class="tabs ui-widget">\n  <ul class="ui-tabs-nav">\n    <li class="ui-state-default" style="width: 45%;" data-target="shr-project">\n      <a href="#"><i class="icon-photo_library"></i><span>The Project</span></a>\n    </li>\n  </ul>\n\n  <div class="ui-tabs-panel shr-project">\n    <h3>'+(null!=(o=(n.t||t&&t.t||l).call(s,"top_submenu.share.share_project",null!=t?t.project_name:t,{name:"t",hash:{},data:a}))?o:"")+'</h3>\n\n    <section>\n      <div class="buttons row">\n        <a class="facebook"><i class="fa fa-facebook"></i></a>\n        <a class="linkedin"><i class="icon-linkedin"></i></a>\n        <a class="twitter"><i class="icon-twitter"></i></a>\n        <a class="google"><i class="icon-google-plus"></i></a>\n      </div>\n\n      <div class="link row">\n        <span class="link-label">'+c((n.t||t&&t.t||l).call(s,"top_submenu.share.project_link",{name:"t",hash:{},data:a}))+'</span>\n        <input type="text" class="project-link" value="'+c((r=null!=(r=n.view_link||(null!=t?t.view_link:t))?r:l,"function"==typeof r?r.call(s,{name:"view_link",hash:{},data:a}):r))+'" />\n      </div>\n    </section>\n  </div>\n</div>\n'},useData:!0})},{"hbsfy/runtime":535}],465:[function(e,t,n){var i=e("./template.hbs");t.exports={render:function(){this.linkRefresh(),this.$el.html(i({project_name:Base64.decode(INKIVE.C.BOOK.name),image_link:this.link,view_link:INKIVE.C.VIEWER+(INKIVE.C.BOOK.book_type==INKIVE.C.BOOK_TYPE.TEMPLATE?"template/":"")+INKIVE.C.BOOK.encodedId})),this.thumbnailRefresh()}}},{"./template.hbs":464}],466:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){var o,r,s=null!=t?t:e.nullContext||{},l=n.helperMissing,c=e.escapeExpression,d="function";return'<div class="tabs ui-widget">\n  <ul class="ui-tabs-nav">\n    <li class="ui-state-default ui-tabs-active ui-state-active" style="width: 45%;" data-target="shr-design">\n      <a href="#"><i class="icon-filter"></i><span>This Design</span></a>\n    </li>\n\n    <li class="ui-state-default" style="width: 45%;" data-target="shr-project">\n      <a href="#"><i class="icon-photo_library"></i><span>The Project</span></a>\n    </li>\n  </ul>\n\n  <div class="ui-tabs-panel shr-project hidden">\n    <h3>'+(null!=(o=(n.t||t&&t.t||l).call(s,"top_submenu.share.share_project",null!=t?t.project_name:t,{name:"t",hash:{},data:a}))?o:"")+'</h3>\n\n    <section>\n      <div class="buttons row">\n        <a class="facebook"><i class="fa fa-facebook"></i></a>\n        <a class="linkedin"><i class="icon-linkedin"></i></a>\n        <a class="twitter"><i class="icon-twitter"></i></a>\n        <a class="google"><i class="icon-google-plus"></i></a>\n        <a class="email"><i class="fa fa-envelope"></i></a>\n        <a class="embed"><i class="icon-code"></i></a>\n      </div>\n\n      <div class="link row">\n        <span class="link-label">'+c((n.t||t&&t.t||l).call(s,"top_submenu.share.project_link",{name:"t",hash:{},data:a}))+'</span>\n        <input type="text" class="project-link" value="'+c((r=null!=(r=n.view_link||(null!=t?t.view_link:t))?r:l,typeof r===d?r.call(s,{name:"view_link",hash:{},data:a}):r))+'" />\n      </div>\n    </section>\n  </div>\n\n  <div class="ui-tabs-panel shr-design">\n    <h3>'+c((n.t||t&&t.t||l).call(s,"top_submenu.share.share_design",{name:"t",hash:{},data:a}))+'</h3>\n\n    <div class="image-container"><img class="empty"/></div>\n\n    <section>\n      <div class="buttons row">\n        <a class="facebook"><i class="fa fa-facebook"></i></a>\n        <a class="twitter"><i class="icon-twitter"></i></a>\n        <a class="pinterest"><i class="fa fa-pinterest"></i></a>\n        <a class="google"><i class="icon-google-plus"></i></a>\n      </div>\n\n      <div class="link row">\n        <span class="link-label">'+c((n.t||t&&t.t||l).call(s,"top_submenu.share.design_link",{name:"t",hash:{},data:a}))+'</span>\n        <input type="text" class="design-link" value="'+c((r=null!=(r=n.image_link||(null!=t?t.image_link:t))?r:l,typeof r===d?r.call(s,{name:"image_link",hash:{},data:a}):r))+'" />\n      </div>\n    </section>\n  </div>\n</div>\n'},useData:!0})},{"hbsfy/runtime":535}],467:[function(e,t,n){function i(){window.open(INKIVE.C.BASE_URL+"share/uploadtosocialnetwork?project_id="+INKIVE.C.BOOK.id+"&design_number="+INKIVE.Tool._current_page_number+"&text="+encodeURIComponent(a)+"&social_network=twitter","_blank","top=0,right=0,width=750,height=320")}var a,o=e("./modal.hbs");t.exports=function(e){var t=o({default_text:"modal.share_design.default_twitter"}),n=INKIVE.Modal.modalWindow(t,{width:500,headerIcon:"fa fa-twitter",headerTitle:"modal.title.share_twitter",buttons:[{title:INKIVE.TranslateHelper.translate("modal.buttons.share"),onClick:function(){a=$(n.getWrapper).find('[name="share-text"]').val(),n.close(),i()}}]})}},{"./modal.hbs":462}],468:[function(e,t,n){var i=e("./template.hbs"),a=e("../../../../utils/md5"),o=e("../../../../factory/settings"),r=e("../../../editor-mode-manager"),s=e("../../../../analytics/decorate"),l=e("../../../../facade/restrictions/webrand-decorate"),c=e("../../../../factory/page-thumbnail"),d={twitter:e("./twitter"),
facebook:e("./facebook"),pinterest:e("./pinterest"),google:e("./google-plus")};t.exports=s(e("../../analytics/share"),l(e("./restrict/view"),Backbone.View.extend({events:{"click input[type=text]":"selectEvent","click ul.ui-tabs-nav li":"changeTabEvent","click .shr-design .buttons > a":"shareDesignEvent","click .shr-project .buttons > a.embed":"shareProjectByEmbedEvent","click .shr-project .buttons > a.email":"shareProjectByEmailEvent","click .shr-project .buttons > a:not(.email):not(.embed)":"shareProjectEvent"},selectEvent:function(e){$(e.currentTarget).select()},changeTabEvent:function(e){var t=$(e.currentTarget),n=t.siblings("li"),i=t.data("target");n.removeClass("ui-tabs-active ui-state-active"),t.addClass("ui-tabs-active ui-state-active"),this.$el.find(".ui-tabs-panel."+i).removeClass("hidden").siblings(".ui-tabs-panel").addClass("hidden")},shareDesignEvent:function(e){var t=$(e.currentTarget).attr("class");d[t](this.link),this.trackShare({content_format:"design",network:t})},shareProjectEvent:function(e){var t=$(e.currentTarget),n=INKIVE.Helpers.getShareNetworkUrl(t.attr("class")),i=$(e.currentTarget).attr("class");this.makePublic(function(){var e=window.open(n,"Share","height=500,width=500,location=0");window.focus&&e.focus()}),this.trackShare({content_format:"project",network:i,link:n})},trackShare:function(e){e=$.extend({project_id:INKIVE.C.BOOK.id,design_number:INKIVE.Tool._current_page_number},e),$.api(INKIVE.C.BASE_URL+"inkive/trackShare","POST",e,function(t){INKIVE.C.IS_DEV&&console.log(e,t)})},shareProjectByEmbedEvent:function(e){var t=new INKIVE.ModalShareEmbed({}),n=INKIVE.Modal.modalWindow(t.getFormHtml(),{width:600,headerIcon:"icon-code",headerTitle:"editor.embed",buttons:[{title:INKIVE.TranslateHelper.translate("general.close"),onClick:_.bind(function(){this.makePublic(function(){t.saveForm(function(){n.close()})})},this)}]})},shareProjectByEmailEvent:function(e){var t=this,n=new INKIVE.ModalShareEmail,i=INKIVE.Modal.modalWindow(n.getFormHtml(),{width:500,headerIcon:"icon-mail-forward",headerTitle:"modal.title.share_email",buttons:[{title:INKIVE.TranslateHelper.translate("general.send"),onClick:_.bind(function(){t.makePublic(function(){n.saveForm(function(){i.close()})})},this)}]})},initialize:function(){_.bindAll(this,"makePublic"),this.tool=INKIVE.Tool.getInstance()},makePublic:function(e){function t(){e(),INKIVE.Modal.togglePageLoader(!1)}var n=90==INKIVE.C.BOOK.security;n?e():(t=_.after(2,t),_.delay(t,3e3),INKIVE.Modal.togglePageLoader(!0,"modal.wait_public"),o.set({security:90}).then(t))},show:function(){var e=!this.$el.is(":empty");e||this.render(),e&&this.thumbnailRefresh(),this.$el.find('ul.ui-tabs-nav [data-target="shr-project"]').toggle(!r.isMode("logo"))},render:function(){this.linkRefresh(),this.$el.html(i({project_name:Base64.decode(INKIVE.C.BOOK.name),view_link:INKIVE.C.VIEWER_URL,image_link:this.link})),this.thumbnailRefresh()},linkRefresh:function(){this.link=INKIVE.C.BASE_URL+"design/displaypage/"+INKIVE.C.BOOK.id+"/"+INKIVE.Tool._current_page_number+"/"+a(INKIVE.Tool._current_page_number)+"/1754"},thumbnailRefresh:function(){this.linkRefresh(),this.$el.find(".image-container img").attr("src",c.get())}})))},{"../../../../analytics/decorate":5,"../../../../facade/restrictions/webrand-decorate":95,"../../../../factory/page-thumbnail":121,"../../../../factory/settings":129,"../../../../utils/md5":485,"../../../editor-mode-manager":162,"../../analytics/share":456,"./facebook":460,"./google-plus":461,"./pinterest":463,"./restrict/view":465,"./template.hbs":466,"./twitter":467}],469:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){var o=null!=t?t:e.nullContext||{},r=n.helperMissing,s=e.escapeExpression;return'<div class="big-icon"><img src="../assets/img/restrictions/restriction_monitor.svg"/></div>\n\n<p>'+s((n.t||t&&t.t||r).call(o,"tool.versions.helper.description",{name:"t",hash:{},data:a}))+'</p>\n\n<div class="video-camera-icon-container"><a class="video"  href="#"><i class="icon-restriction_video"></i></a></div>\n\n<a href="'+s((n.route||t&&t.route||r).call(o,"library?r=upgrade",{name:"route",hash:{},data:a}))+'" target="_blank" class="btn btn-primary go-premium">'+s((n.t||t&&t.t||r).call(o,"general.upgrade_account",{name:"t",hash:{},data:a}))+'</a>\n<!--<a class="learnmore" target="_blank" href="/">'+s((n.t||t&&t.t||r).call(o,"general.learn_more",{name:"t",hash:{},data:a}))+"</a>-->\n"},useData:!0})},{"hbsfy/runtime":535}],470:[function(e,t,n){var i=e("../../../../ui/tool-menu/components/helper/view"),a=e("./helper.hbs"),o="vbTSmlfiYiA";t.exports=i.extend({events:_.extend({},i.prototype.events,{"click a.video":function(){this.openVideoContent(o)}}),initialize:function(e){i.prototype.initialize.call(this),this.data.title="tool.versions.helper.title",this.data.content=a(),this.render(this.data)},render:function(e){this.$el.html(this.template(e))}})},{"../../../../ui/tool-menu/components/helper/view":264,"./helper.hbs":469}],471:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){return"<label>"+e.escapeExpression((n.t||t&&t.t||n.helperMissing).call(null!=t?t:e.nullContext||{},"top_submenu.versions.noyet",{name:"t",hash:{},data:a}))+"</label>\n"},useData:!0})},{"hbsfy/runtime":535}],472:[function(e,t,n){var i=e("hbsfy/runtime");t.exports=i.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,a){var o,r,s=e.escapeExpression,l=null!=t?t:e.nullContext||{},c=n.helperMissing;return'<div class="version-item">\n    <div class="image-container"><img class="empty"></div>\n    <div class="info">\n        <a href="#" class="btn btn-yellow action" data-action="loadversion" data-version="'+s(e.lambda(null!=(o=null!=t?t.version:t)?o.versionId:o,t))+'">'+s((n.t||t&&t.t||c).call(l,"top_submenu.versions.load",{name:"t",hash:{},data:a}))+"</a>\n        <div>"+s((r=null!=(r=n.time_since||(null!=t?t.time_since:t))?r:c,"function"==typeof r?r.call(l,{name:"time_since",hash:{},data:a}):r))+"</div>\n    </div>\n</div>\n"},useData:!0})},{"hbsfy/runtime":535}],473:[function(e,t,n){var i=e("./helper.js"),a=e("../../../../analytics/decorate"),o=e("../../../../factory/user-info"),r=e("../../../../factory/page-thumbnail"),s=e("../../../../facade/editor/editor"),l=e("./template.hbs"),c=e("./nocontent-template.hbs");t.exports=a(e("../../analytics/versions"),Backbone.View.extend({events:{'click a[data-action="loadversion"]':"loadVersionEvent"},loadVersionEvent:function(e){s.handle("page","load_version",{version_id:$(e.currentTarget).attr("data-version")})},initialize:function(){_.bindAll(this,"onVersions"),this.tool=INKIVE.Tool.getInstance(),o.get().then(_.bind(function(e){function t(t){return _(e.roles).contains(t)}this.canUse=t("ROLE_PREMIUM")||INKIVE.Helpers.projectIsLinkedToRestrictions(),this.canUse||this.initHelper()},this))},show:function(){this.$el.find(".antiscroll-inner").css("height","auto"),this.$el.find(".tab-content").empty(),this.canUse||this.helperView.toggle(!0),INKIVE.Modal.loader(this.$el.find(".tab-content")),INKIVE.Helpers.api("page/versions","GET",{scrapbook_id:INKIVE.C.BOOK.id,design:INKIVE.Tool._current_design_id},this.onVersions)},onVersions:function(e){var t=this.$el.find(".tab-content");e&&e.length>0?(this.replaceClientRenderedImages(e),_.each(e,_.bind(this.appendVersion,this,t))):t.append(c()),INKIVE.Modal.loaderClose(t),this.$el.find(".antiscroll-wrap").antiscroll({autoHide:!1,height:this.$el.height()-40})},replaceClientRenderedImages:function(e){_.each(r.versions,function(t){var n;t.designId===INKIVE.Tool._current_design_id&&_.each(e,function(e){var i=Math.abs(t.timeStamp-e.creationTime);(!n||i<n)&&(e.base64=t.base64,n=i)})})},appendVersion:function(e,t){var n=$(l({version:t,time_since:this.timeSince(t.secondsAgo)}));e.append(n);var i=INKIVE.C.IS_DEV?"singapore.inkive.com":"virginia.inkive.com",a="singapore.inkive.com"===i?"http":"https",o=n.find("img"),r="http"===a?"http://"+i+"/"+t.previewName:"https://s3.amazonaws.com/"+i+"/"+t.previewName;r=t.base64?t.base64:r,INKIVE.Helpers.imageLoader(r,function(e,t){o.attr("src",e===INKIVE.C.Status.success?t.src:INKIVE.C.THUMB_NOCOVER),o.removeClass("empty")})},initHelper:function(){var e=$("<div>");this.$el.append(e),this.helperView=new i({el:e}),this.helperView.on("toggle",_.bind(function(e){this.$el.find(".content").toggleClass("blur",e)},this))},timeSince:function(e){var t=INKIVE.TranslateHelper.translate,n=e/60,i=n/60,a=i/24,o=a/365;return t("time_ago.prefix")+" "+(e<45&&t("time_ago.seconds")||e<90&&t("time_ago.minute")||n<45&&t("time_ago.minutes",{time:Math.round(n)})||n<90&&t("time_ago.hour")||i<24&&t("time_ago.hours",{time:Math.round(i)})||i<42&&t("time_ago.day")||a<30&&t("time_ago.days",{time:Math.round(a)})||a<45&&t("time_ago.month")||a<365&&t("time_ago.months",{time:Math.round(a/30)})||o<1.5&&t("time_ago.year")||l("years",t("time_ago.months",{time:Math.round(o)})))+" "+t("time_ago.suffix")}}))},{"../../../../analytics/decorate":5,"../../../../facade/editor/editor":76,"../../../../factory/page-thumbnail":121,"../../../../factory/user-info":132,"../../analytics/versions":457,"./helper.js":470,"./nocontent-template.hbs":471,"./template.hbs":472}],474:[function(e,t,n){var i=e("../../../core/history/history");t.exports={initialize:function(){this.tool=INKIVE.Tool.getInstance(),this.editor=this.tool.editor,_.bindAll(this,"displayNoActionsLeftError"),this.initSubView(),this.initProjectName(),i.on("reload",_.bind(this.refreshHistoryUI,this)),i.on("change",_.bind(this.refreshHistoryUI,this)),i.on("undo",_.bind(this.refreshHistoryUI,this)),i.on("redo",_.bind(this.refreshHistoryUI,this));var t=e("../../../facade/restrictions/restrictions"),n=_.bind(t.isFunctionalityAllowed,t),a=this.$el.children(".options");a.children('button[data-action="print"]').addClass("hidden"),a.children('button[data-action="share"]').addClass("hidden"),a.children('button[data-action="download"]').addClass("hidden"),t.initialize().then(_.bind(function(){a.children('button[data-action="print"]').toggleClass("hidden",!n("function_print_file")),a.children('button[data-action="share"]').toggleClass("hidden",!n("function_share_file")),a.children('button[data-action="download"]').toggleClass("hidden",!n("function_download_file"))},this))}}},{"../../../core/history/history":13,"../../../facade/restrictions/restrictions":94}],475:[function(e,t,n){function i(){this.dataQueue=[],_.bindAll(this,"setElement","_finishDisplaying")}i.prototype.setElement=function(e){this.$el=e},i.prototype.display=function(e,t,n){function i(){this.dataQueue=[],this._finishDisplaying()}n="undefined"!=typeof n&&n,t="undefined"==typeof t?3e3:t,n&&i.call(this),this.dataQueue.push({message:e,timeout:t}),this.displayingTimeout||this._displayNext()},i.prototype._displayNext=function(){var e=this.dataQueue.shift();this.$el.addClass("new-content").find(".message").text(e.message),this.$el.addClass("new-content").find("i").toggleClass("hidden",!!e.timeout),e.timeout&&(this.displayingTimeout=setTimeout(this._finishDisplaying,e.timeout))},i.prototype._finishDisplaying=function(){this.$el.removeClass("new-content"),this.displayingTimeout&&(clearTimeout(this.displayingTimeout),this.displayingTimeout=null),this.dataQueue.length&&this._displayNext()},t.exports=new i},{}],476:[function(e,t,n){var i=e("./status"),a=e("./contents/share/view"),o=e("./contents/versions/view"),r=e("../../facade/editor/editor"),s=e("../../analytics/decorate"),l=e("../../factory/user-info"),c=e("../../core/history/history"),d=e("../../facade/restrictions/decorate");t.exports=s(e("./analytics/view"),d(e("./restrict/view"),Backbone.View.extend({events:{'click .menus button[data-action="save"]':"saveEvent",'click .menus button[data-action="undo"]':"undoEvent",'click .menus button[data-action="redo"]':"redoEvent",'click .info button[data-action="versions"]':"versionsEvent",'click .options > button[data-action="download"]':"downloadEvent",'click .options > button[data-action="share"]':"shareEvent",'click .options > button[data-action="print"]':"printEvent",'click .options button[data-action="exit"]':"closeEvent",'keydown [data-value="project-name"] span':"preNameChangeEvent",'keyup [data-value="project-name"] span':"postNameChangeEvent",'blur [data-value="project-name"] span':"nameInputBlurEvent",'click [data-value="project-name"] span':"nameInputClickEvent"},preNameChangeEvent:function(e){13===e.which&&(e.preventDefault(),$(e.currentTarget).blur())},postNameChangeEvent:function(e){this.bindedSaveProjectName($(e.currentTarget))},toggleSelection:function(e,t){var n=document.createRange();n.selectNodeContents(e[0]);var i=window.getSelection();i.removeAllRanges(),t&&i.addRange(n)},nameInputBlurEvent:function(e){var t=$(e.currentTarget),n=!t.text();r.isSavingProjectName=!n,n||this.saveProjectName(t),n&&t.text(Base64.decode(INKIVE.C.BOOK.name)),this.toggleSelection(t,!1)},nameInputClickEvent:function(e){var t=$(e.currentTarget),n=["new project","new template","new design",""];_.includes(n,t.html().toLowerCase())&&this.toggleSelection(t,!0)},undoEvent:function(e){r.handle("history","undo")},redoEvent:function(e){r.handle("history","redo")},closeEvent:function(e){r.handle("close",{confirm_draft:!0})},downloadEvent:function(e){var t=this.$el.find('.ui-dropdown-content[data-id="download"]');t.children(".tabs").hide(),INKIVE.Modal.loader(t),l.canConsume("download").then(function(){t.children(".tabs").show(),INKIVE.Modal.loaderClose(t)},_.partial(this.displayNoActionsLeftError,"download"))},shareEvent:function(e){var t=this.$el.find('.ui-dropdown-content[data-id="share"]');t.children(".tabs").hide(),INKIVE.Modal.loader(t),l.canConsume("share").then(_.bind(function(){t.children(".tabs").show(),INKIVE.Modal.loaderClose(t),this.shareView.show()},this),_.partial(this.displayNoActionsLeftError,"share"))},versionsEvent:function(e){$(e.currentTarget).is(".active")&&this.versionsView.show()},saveEvent:function(e){var t=$(e.currentTarget),n=INKIVE.TranslateHelper.translate;t.addClass("disabled"),i.display(n("general.saving"),null,!0),r.handle("page","save",{confirm_draft:!0}).always(function(){t.removeClass("disabled"),i.display(n("advice.content.nothing_to_save"))})},printEvent:function(e){l.canConsume("print").then(_.bind(function(){function e(){o=window.open(INKIVE.C.BASE_URL+"design/print?id="+INKIVE.C.BOOK.id+"&page_number="+INKIVE.Tool._current_page_number),INKIVE.Modal.togglePageLoader(!0),_.delay(t,1e3)}function t(){a()?(s--,s>0&&_.delay(t,1e3),s>0||n()):i()}function n(){INKIVE.Modal.togglePageLoader(!1),INKIVE.Modal.alertMessage(INKIVE.TemplatesHelper("alert_default",{message:"modal.alert.popup_blocker"}))}function i(){INKIVE.Modal.togglePageLoader(!1),INKIVE.Modal.togglePageLoader(!0,"modal.wait_printing"),localStorage.setItem("printing",!0),$(window).one("storage",function(e){"printing"===e.originalEvent.key&&INKIVE.Modal.togglePageLoader(!1)})}function a(){try{return"undefined"==typeof o||(!o||!o.closed)&&(!o||!o.tryLoad)}catch(e){}return!1}var o,s=20,l=this.editor.getSvgString(),c=!INKIVE.Helpers.areEqual(l,INKIVE.EditorFacade.handle("cache","get"));c||e(),c&&r.handle("page","save").then(e)},this),_.partial(this.displayNoActionsLeftError,"print"))},displayNoActionsLeftError:function(e){INKIVE.Modal.alertMessage(INKIVE.TemplatesHelper("alert_default",{message:"modal.alert.no_actions_left"}))},initialize:function(){this.tool=INKIVE.Tool.getInstance(),this.editor=this.tool.editor,_.bindAll(this,"displayNoActionsLeftError"),this.initSubView(),this.initProjectName(),INKIVE.C.BOOK.book_type==INKIVE.C.BOOK_TYPE.TEMPLATE&&this.$el.children(".options").children('button[data-action="share"]').addClass("hidden"),c.on("reload",_.bind(this.refreshHistoryUI,this)),c.on("change",_.bind(this.refreshHistoryUI,this)),c.on("undo",_.bind(this.refreshHistoryUI,this)),c.on("redo",_.bind(this.refreshHistoryUI,this))},initProjectName:function(){this.$el.find('[data-value="project-name"] span').text(Base64.decode(INKIVE.C.BOOK.name)),this.bindedSaveProjectName=_.debounce(_.bind(this.saveProjectName,this),3e3)},saveProjectName:function(e){var t=e.text().trim(),n=INKIVE.TranslateHelper.translate;t&&Base64.decode(INKIVE.C.BOOK.name)!=t?(e.addClass("disabled"),i.display(n("general.saving"),null,!0),INKIVE.SettingsFactory.set({name:t}).then(_.bind(function(){i.display(n("advice.content.nothing_to_save")),e.removeClass("disabled"),r.isSavingProjectName=!1,r.trigger("project.name.saved")},this))):r.isSavingProjectName=!1},refreshHistoryUI:function(e){var t=e.history[e.current]&&"undefined"!=typeof e.history[e.current].parent,n=e.history[e.current]&&e.history[e.current].children.length;this.$el.find('.menus button[data-action="undo"]').toggleClass("disabled",!t),this.$el.find('.menus button[data-action="redo"]').toggleClass("disabled",!n)},initSubView:function(){i.setElement(this.$el.find(".info > .status")),this.shareView=new a({el:this.$el.find('.ui-dropdown-content[data-id="share"]')}),this.versionsView=new o({el:this.$el.find('.ui-dropdown-content[data-id="versions"]')})}})))},{"../../analytics/decorate":5,"../../core/history/history":13,"../../facade/editor/editor":76,"../../facade/restrictions/decorate":90,"../../factory/user-info":132,"./analytics/view":458,"./contents/share/view":468,"./contents/versions/view":473,"./restrict/view":474,"./status":475}],477:[function(e,t,n){function i(){this.shown=[]}var a=e("../app/decorate"),o=e("../facade/restrictions/decorate"),r=INKIVE.C.IS_MOBILE?"advice.event_name.tap":"advice.event_name.click";e("../facade/design/design"),e("../facade/editor/editor"),e("../../../bower_components/tinycolor/tinycolor");i.prototype=_.extend({messages:[{id:"imported-results",type:"warning"},{id:"share-error",type:"error"},{id:"add-to-library-error",type:"error"},{id:"add-to-library-duplicity",type:"warning"},{id:"add-to-library-success",type:"success"},{id:"upload-error",type:"error"},{id:"pick-template",type:"info"},{id:"template-back",type:"info"},{id:"upload-cancel",type:"info"},{id:"project-name",type:"warning"},{id:"share-success",type:"success"},{id:"already-saved",type:"success"},{id:"thumb-not-load",type:"warning"},{id:"image-replacement-selection",type:"error"},{id:"restriction-logo-replace",type:"error"},{id:"restriction-icon-replace",type:"error"},{id:"nothing-to-save",type:"success"},{id:"crop",type:"warning",once:!0},{id:"pdf-text",type:"warning",once:!0},{id:"convert-to-layout-box",type:"success"},{id:"text-partial-edit",type:"warning",once:!1},{id:"crop-restriction-applied",type:"success"},{id:"color-restriction-applied",type:"warning"},{id:"source-restriction-applied",type:"warning"},{id:"dropbox-view",type:"warning",once:!0},{id:"long-time-no-save",type:"warning"},{id:"clipper-rotation-limit",type:"info"},{id:"spacing-and-underline",type:"warning"},{id:"uploading-images-save",type:"warning"},{id:"undo-unlocked-layout-image",type:"info"},{id:"add-item-to-library",type:"success"},{id:"error-adding-item-to-library",type:"error"},{id:"image-flip-disabled",type:"error"},{id:"choose-restriction-option",type:"warning"},{id:"long-text",type:"info",onShow:function(){this.blinkingHint($('a.btn.btn-onmenu[data-action="on_textTyping"]'))}},{id:"locked-layout-image",type:"warning",onShow:function(){this.blinkingHint($('a.btn.btn-onmenu[data-action="on_unlockImage"]'))}},{id:"locked-element",type:"error",onShow:function(){this.blinkingHint($('a.btn.btn-onmenu[data-action="on_unlockElement"]'))}},{id:"template-placeholders",type:"info",onShow:function(){this.blinkingHint($('.tool-menu li a[href="#tabImages"]').parent())}},{id:"text-edit",type:"info",onShow:function(){this.blinkingHint($('a.btn.btn-onmenu[data-action="on_textBeginEdit"]'))}},{id:"saved",type:"success",content:function(e){var t=new Date,n=t.getHours(),i=t.getMinutes();return e("advice.content.saved",{H:n<10?"0"+n:n,i:i<10?"0"+i:i})}}],blinkingHint:function(e){function t(){e.removeClass("blink")}var n=5e3;e.addClass("blink"),e.one("click",t),_.delay(t,n)},initialize:function(e){this.initialized||(this.initialized=!0,this.initEventListeners(e),toastr.options={debug:!1,timeOut:5e3,showEasing:"easeOutBack",hideEasing:"easeInBack",showMethod:"slideDown",hideMethod:"slideUp",closeButton:!1,newestOnTop:!0,showDuration:300,hideDuration:300,extendedTimeOut:1e3,preventDuplicates:!0,positionClass:INKIVE.C.IS_MOBILE?window.innerHeight>window.innerWidth?"mobile portrait toast-top-right":"mobile landscape toast-top-left":"desktop toast-top-left"})},initEventListeners:function(e){e.bind("advice.show",_.bind(function(e,t){this.show(t)},this))},show:function(e,t){var n=_.find(this.messages,{id:e});if(n){var i=_.contains(this.shown,e);(!i||!n.once)&&this.showMessage(n,t),i||this.shown.push(e)}n||console.warn("Message "+e+" is not defined")},showMessage:function(e,t){var n,i=toastr[e.type],a=toastr.options.timeOut,o=toastr.options.extendedTimeOut;if(e=this.translateFullMessage(e,t),_.isFunction(i)){if(e.more){var s=this;toastr.options.onclick=function(){s.showMoreInfo(e)},n=INKIVE.TranslateHelper.translate("advice.more_info",{event_name:r})}else t&&t.callback?(toastr.options.timeOut=0,toastr.options.extendedTimeOut=0,toastr.options.onclick=function(){t.callback()}):toastr.options.onclick=null,n="";e.content&&(i(e.content+n),e.onShow&&e.onShow.call(this)),toastr.options.timeOut=a,toastr.options.extendedTimeOut=o,toastr.options.onclick=null}},translateFullMessage:function(e,t){function n(){var t=e.id.split("-").join("_");return{title:"advice.title."+t,more:"advice.more."+t,content:"advice.content."+t}}function i(e){s[e]=s[e](o)}function a(e,n){var i=o(n,t);i!==n&&(s[e]=i)}t=_.extend({event_name:INKIVE.TranslateHelper.translate(r)},t||{});var o=INKIVE.TranslateHelper.translate,s=_.clone(e),l=n();return _.each(l,function(e,t){s[t]&&i(t),s[t]||a(t,e)}),s},showMoreInfo:function(e){var t='<p class="advice">'+e.more+"</p>",n=INKIVE.Modal.modalWindow(t,{headerIcon:"icon-info",headerTitle:e.title,buttons:[{title:"Got it!",onClick:function(){n.close()}}]})}},Backbone.Events),t.exports=o(e("./restrictions/advice"),a(e("./app/advice"),new i))},{"../../../bower_components/tinycolor/tinycolor":3,"../app/decorate":8,"../facade/design/design":34,"../facade/editor/editor":76,"../facade/restrictions/decorate":90,"./app/advice":478,"./restrictions/advice":486}],478:[function(e,t,n){t.exports={showMessageCheckOnce:function(){return!window.Android&&(this.appBridge.version.isApp("webrand")||this.appBridge.version.isApp("pdf")||this.appBridge.version.isGreaterThan("1.2"))},showMessage:function(e,t){e=this.translateFullMessage(e,t),this.trigger("show",e)},messages:[{id:"text-edit",type:"info"},{id:"pdf-text",type:"warning"},{id:"share-error",type:"error"},{id:"upload-error",type:"error"},{id:"template-back",type:"info"},{id:"upload-cancel",type:"info"},{id:"locked-element",type:"error"},{id:"share-success",type:"success"},{id:"convert-to-layout-box",type:"success"},{id:"thumb-not-load",type:"warning"},{id:"already-saved",type:"success"},{id:"nothing-to-save",type:"success"},{id:"crop",type:"warning",once:!0},{id:"long-time-no-save",type:"warning"},{id:"locked-layout-image",type:"warning"},{id:"clipper-rotation-limit",type:"info"},{id:"uploading-images-save",type:"warning"},{id:"spacing-and-underline",type:"warning"},{id:"undo-unlocked-layout-image",type:"info"},{id:"image-flip-disabled",type:"warning"},{id:"restriction-text-email",type:"error"},{id:"restriction-image-content",type:"error"},{id:"restriction-text-swearing",type:"error"},{id:"restriction-text-date-range",type:"error"},{id:"restriction-text-number-nan",type:"error"},{id:"restriction-text-date-format",type:"error"},{id:"restriction-text-currency-range",type:"error"},{id:"restriction-text-currency-format",type:"error"},{id:"restriction-text-number-out-of-range",type:"error"},{id:"restriction-text-dictionary-not-found",type:"error"},{id:"saved",type:"success",content:function(e){var t=new Date,n=t.getHours(),i=t.getMinutes();return e("advice.content.saved",{H:n<10?"0"+n:n,i:i<10?"0"+i:i})}}]}},{}],479:[function(e,t,n){Backbone.mixin=function(e,t){return _.defaults(e.prototype,t),_.defaults(e.prototype.events,t.events),e}},{}],480:[function(e,t,n){t.exports={set:function(e,t,n){if(n){var i=new Date;i.setTime(i.getTime()+24*n*60*60*1e3);var a="; expires="+i.toGMTString()}else var a="";document.cookie=e+"="+t+a+"; path=/"},get:function(e){for(var t=e+"=",n=document.cookie.split(";"),i=0;i<n.length;i++){for(var a=n[i];" "==a.charAt(0);)a=a.substring(1,a.length);if(0==a.indexOf(t))return a.substring(t.length,a.length)}return null},"delete":function(e){this.set(e,"",-1)}}},{}],481:[function(e,t,n){function i(e,t){function n(){var t=e.attr("tag");return t&&t.trim()}function i(){var n=a.substring(0,t-s)+r;return e.attr("tag",n),!0}var a=n();return a&&a.length>t&&i()&&o(e,a),""!=a}function a(e,t){function n(){var t=e.contents().last().text();return t&&t.trim()}function i(){var n=a.substring(0,t-s)+r;return e.contents().last().replaceWith(n),!0}var a=n();return a&&a.length>t&&i()&&o(e,a),""!=a}function o(e,t){e.attr("title")||e.attr("title",t)}var r="...",s=r.length;t.exports=function(e){e=e||$("body"),e.find("[data-charlimit]").each(function(){var e=$(this),t=!1,n=e.data("charlimit");t|=i(e,n),t|=a(e,n),t||console.warn("Can't trim",this)})}},{}],482:[function(e,t,n){!function(e){var n=function(e,t,i){if(!l(t)||d(t)||u(t)||p(t))return t;var a,o=0,r=0;if(c(t))for(a=[],r=t.length;o<r;o++)a.push(n(e,t[o],i));else{a={};for(var s in t)t.hasOwnProperty(s)&&(a[e(s,i)]=n(e,t[s],i))}return a},i=function(e,t){t=t||{};var n=t.separator||"_",i=t.split||/(?=[A-Z])/;return e.split(i).join(n)},a=function(e){return h(e)?e:(e=e.replace(/[\-_\s]+(.)?/g,function(e,t){return t?t.toUpperCase():""}),e.substr(0,1).toLowerCase()+e.substr(1))},o=function(e){var t=a(e);return t.substr(0,1).toUpperCase()+t.substr(1)},r=function(e,t){return i(e,t).toLowerCase()},s=Object.prototype.toString,l=function(e){return e===Object(e)},c=function(e){return"[object Array]"==s.call(e)},d=function(e){return"[object Date]"==s.call(e)},u=function(e){return"[object RegExp]"==s.call(e)},p=function(e){return"[object Boolean]"==s.call(e)},h=function(e){return e-=0,e===e},m={camelize:a,decamelize:r,pascalize:o,depascalize:r,camelizeKeys:function(e){return n(a,e)},decamelizeKeys:function(e,t){return n(r,e,t)},pascalizeKeys:function(e){return n(o,e)},depascalizeKeys:function(){return this.decamelizeKeys.apply(this,arguments)}};"function"==typeof define&&define.amd?define(m):"undefined"!=typeof t&&t.exports?t.exports=m:e.humps=m}(this)},{}],483:[function(e,t,n){function i(e,t){return _.uniq([r.getRightSizeUrl(e,t),e,r.getOriginalUrl(e)])}function a(e,t){function n(){i.src=e.shift()}var i=new Image;n(),i.onload=function(){t(i)},i.onerror=function(){e.length&&n()}}function o(e){var t=e.match(/id="([^"]*)"/);return t&&t[1]}var r=e("../factory/images"),s=(e("../facade/editor/editor"),e("../facade/design/design")),l=e("./images-sanitize/clip-path-sanitize");t.exports={base64Sanitize:function(e){var t=/(<image[^>]*xlink:href=")(data:[^;]*;base64[^"]*)("[^>]*)/gi;return e.replace(t,function(e,t,n,i){var a=o(e);return t+r.getImageHash(a,n)+i})},base64Load:function(e){var t=/(<image[^>]*xlink:href=")([^"]*)("[^>]*)/gi;return e.replace(t,function(e,t,n,i){var a=r.getBase64(n);return a?t+a+i:e})},preLoadImagesSanitize:function(e){function t(e,t,n,i,a){return r.isBlacklisted(o(e),n)?"":INKIVE.Helpers.isDataURL(n)&&"undefined"==typeof r.getImageUrl(o(e),n)?"":t.indexOf("data-url=")>-1||i.indexOf("data-url=")>-1||INKIVE.Helpers.isDataURL(n)?e:(n&&r.setImageUrl(o(e),n),a?"<image"+t+'data-url="'+n+'"'+i+">"+a+"</image>":"<image"+t+'data-url="'+n+'"'+i+"/>")}var n=/<image([^>]*)xlink:href="([^"]*)"([^>]*)>([^<]*)<\/image>/g,i=/<image([^>]*)xlink:href="([^"]*)"([^>]*)\/>/g;return e=e.replace(n,function(e,n,i,a,o){return t(e,n,i,a,o)}),e.replace(i,function(e,n,i,a){return t(e,n,i,a)})},postLoadBackgroundSanitize:function(e){function t(){var e=n[0].getAttribute("width")&&n[0].getAttribute("height");if(!e)return void n.remove();var t={x:n.attr("x"),y:n.attr("y"),width:n.attr("width"),height:n.attr("height"),"class":n.attr("class")},i=r.getImageUrl(n.get(0));return i?(n.removeAttr("data-url"),void s.set("background",{attrs:t,source:i,smart_load:!0,is_initial_load:!0})):(i=n.attr("xlink:href"),void(i||n.remove()))}var n=$(e).find("svg > g.background image");return n.length&&t(),e},postLoadImagesSanitize:function(e){var t=INKIVE.Tool.getInstance(),n=t.editor.canvas;return $(e).find("image").each(function(){var t=this,o=$(this),c=t.getAttribute("xlink:href")||o.parent().is(".background")||"0"===o[0].getAttribute("opacity");if(!c){var d=r.getImageUrl(t);if(!d)return void(t.getAttribute("xlink:href")||o.remove());var u=i(d,{width:t.getAttribute("width"),height:t.getAttribute("height")});o.removeAttr("data-url"),a(u,function(e){var n=!(o.is(".logo")||o.parent().is(".logo")||o.is(".icon")||o.parent().is(".icon")),i=n?t.getAttribute("id"):o.closest(".element")[0].getAttribute("id"),a=n?{source:{url:e.src,smart_load:!1}}:{thumb_src:e.src,smart_load:!1};s.set(i,a)}),l(n,e,t)}}),e}}},{"../facade/design/design":34,"../facade/editor/editor":76,"../factory/images":102,"./images-sanitize/clip-path-sanitize":484}],484:[function(e,t,n){function i(e,t,n){var i="clip_"+n.id,s=a(e,t,n),l=o(t),c=window.document.createElementNS(svgedit.NS.SVG,"clipPath");r(t,i),n.setAttribute("clip-path",'url("#'+i+'")'),$(n).addClass("layoutBox").removeClass("image"),s.setAttribute("class","layoutClipper"),c.setAttribute("id",i),c.appendChild(s),l.appendChild(c),t.insertBefore(l,t.firstChild)}function a(e,t,n){function i(e){n.textContent=e.x+" "+e.y+" "+e.width+" "+e.height}function a(){var e=n.textContent.split(/[^-|\d\.]/);return e&&4===e.length&&{x:Math.floor4(e[0]),y:Math.floor4(e[1]),width:Math.floor4(e[2]),height:Math.floor4(e[3])}}function o(){return{x:n.getAttribute("x"),y:n.getAttribute("y"),width:n.getAttribute("width"),height:n.getAttribute("height")}}var r=a()||o();return i(r),e.addSvgElementFromJson({element:"rect",curStyles:!1,attr:_.extend(r,{id:INKIVE.Helpers.getUnusedId(t)})})}function o(e){var t=$(e).find("defs").get(0);return t||(t=window.document.createElementNS(svgedit.NS.SVG,"defs"),t.setAttribute("id","layout_defs")),t}function r(e,t){var n=$(e).find("#"+t);n[0]&&n.remove()}t.exports=function(e,t,n){var a=t.firstChild,o=n.getAttribute("clip-path"),r=INKIVE.Tool.getInstance(),s=!($(n).is(".logo")||$(n).parent().is(".logo")||$(n).is(".icon")||$(n).parent().is(".icon")||$(n).parent().is(".video")),l=!o||0===$(t).find(r.editor.canvas.getClipPathId(o)).length;s&&l&&i(e,a,n)}},{}],485:[function(e,t,n){t.exports=function(){function e(e,t){var r=e[0],s=e[1],l=e[2],c=e[3];r=n(r,s,l,c,t[0],7,-680876936),c=n(c,r,s,l,t[1],12,-389564586),l=n(l,c,r,s,t[2],17,606105819),s=n(s,l,c,r,t[3],22,-1044525330),r=n(r,s,l,c,t[4],7,-176418897),c=n(c,r,s,l,t[5],12,1200080426),l=n(l,c,r,s,t[6],17,-1473231341),s=n(s,l,c,r,t[7],22,-45705983),r=n(r,s,l,c,t[8],7,1770035416),c=n(c,r,s,l,t[9],12,-1958414417),l=n(l,c,r,s,t[10],17,-42063),s=n(s,l,c,r,t[11],22,-1990404162),r=n(r,s,l,c,t[12],7,1804603682),c=n(c,r,s,l,t[13],12,-40341101),l=n(l,c,r,s,t[14],17,-1502002290),s=n(s,l,c,r,t[15],22,1236535329),r=i(r,s,l,c,t[1],5,-165796510),c=i(c,r,s,l,t[6],9,-1069501632),l=i(l,c,r,s,t[11],14,643717713),s=i(s,l,c,r,t[0],20,-373897302),r=i(r,s,l,c,t[5],5,-701558691),c=i(c,r,s,l,t[10],9,38016083),l=i(l,c,r,s,t[15],14,-660478335),s=i(s,l,c,r,t[4],20,-405537848),r=i(r,s,l,c,t[9],5,568446438),c=i(c,r,s,l,t[14],9,-1019803690),l=i(l,c,r,s,t[3],14,-187363961),s=i(s,l,c,r,t[8],20,1163531501),r=i(r,s,l,c,t[13],5,-1444681467),c=i(c,r,s,l,t[2],9,-51403784),l=i(l,c,r,s,t[7],14,1735328473),s=i(s,l,c,r,t[12],20,-1926607734),r=a(r,s,l,c,t[5],4,-378558),c=a(c,r,s,l,t[8],11,-2022574463),l=a(l,c,r,s,t[11],16,1839030562),s=a(s,l,c,r,t[14],23,-35309556),r=a(r,s,l,c,t[1],4,-1530992060),c=a(c,r,s,l,t[4],11,1272893353),l=a(l,c,r,s,t[7],16,-155497632),s=a(s,l,c,r,t[10],23,-1094730640),
r=a(r,s,l,c,t[13],4,681279174),c=a(c,r,s,l,t[0],11,-358537222),l=a(l,c,r,s,t[3],16,-722521979),s=a(s,l,c,r,t[6],23,76029189),r=a(r,s,l,c,t[9],4,-640364487),c=a(c,r,s,l,t[12],11,-421815835),l=a(l,c,r,s,t[15],16,530742520),s=a(s,l,c,r,t[2],23,-995338651),r=o(r,s,l,c,t[0],6,-198630844),c=o(c,r,s,l,t[7],10,1126891415),l=o(l,c,r,s,t[14],15,-1416354905),s=o(s,l,c,r,t[5],21,-57434055),r=o(r,s,l,c,t[12],6,1700485571),c=o(c,r,s,l,t[3],10,-1894986606),l=o(l,c,r,s,t[10],15,-1051523),s=o(s,l,c,r,t[1],21,-2054922799),r=o(r,s,l,c,t[8],6,1873313359),c=o(c,r,s,l,t[15],10,-30611744),l=o(l,c,r,s,t[6],15,-1560198380),s=o(s,l,c,r,t[13],21,1309151649),r=o(r,s,l,c,t[4],6,-145523070),c=o(c,r,s,l,t[11],10,-1120210379),l=o(l,c,r,s,t[2],15,718787259),s=o(s,l,c,r,t[9],21,-343485551),e[0]=u(r,e[0]),e[1]=u(s,e[1]),e[2]=u(l,e[2]),e[3]=u(c,e[3])}function t(e,t,n,i,a,o){return t=u(u(t,e),u(i,o)),u(t<<a|t>>>32-a,n)}function n(e,n,i,a,o,r,s){return t(n&i|~n&a,e,n,o,r,s)}function i(e,n,i,a,o,r,s){return t(n&a|i&~a,e,n,o,r,s)}function a(e,n,i,a,o,r,s){return t(n^i^a,e,n,o,r,s)}function o(e,n,i,a,o,r,s){return t(i^(n|~a),e,n,o,r,s)}function r(t){var n,i=t.length,a=[1732584193,-271733879,-1732584194,271733878];for(n=64;n<=t.length;n+=64)e(a,s(t.substring(n-64,n)));t=t.substring(n-64);var o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(n=0;n<t.length;n++)o[n>>2]|=t.charCodeAt(n)<<(n%4<<3);if(o[n>>2]|=128<<(n%4<<3),n>55)for(e(a,o),n=0;n<16;n++)o[n]=0;return o[14]=8*i,e(a,o),a}function s(e){var t,n=[];for(t=0;t<64;t+=4)n[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return n}function l(e){for(var t="",n=0;n<4;n++)t+=p[e>>8*n+4&15]+p[e>>8*n&15];return t}function c(e){for(var t=0;t<e.length;t++)e[t]=l(e[t]);return e.join("")}function d(e){return c(r(unescape(encodeURIComponent(e))))}function u(e,t){return e+t&4294967295}var p="0123456789abcdef".split("");return d}()},{}],486:[function(e,t,n){t.exports={messages:[{id:"restriction-text-email",type:"error"},{id:"restriction-image-content",type:"error"},{id:"restriction-text-character-number-range",type:"error"},{id:"restriction-text-swearing",type:"error"},{id:"restriction-text-date-range",type:"error"},{id:"restriction-text-number-nan",type:"error"},{id:"restriction-text-date-format",type:"error"},{id:"restriction-text-currency-range",type:"error"},{id:"restriction-text-currency-format",type:"error"},{id:"restriction-text-number-out-of-range",type:"error"},{id:"restriction-text-dictionary-not-found",type:"error"}]}},{}],487:[function(e,t,n){t.exports=function(e){INKIVE.C.DEFAULT_FINEUPLOADER.messages.typeError="{file} has an invalid extension. Valid extension(s): {extensions}.",INKIVE.C.TextDefault=[{text:e("text.option_title"),fontFamily:"Lato",fontSize:"45",size:.18},{text:e("text.option_subtitle"),fontFamily:"Lato",fontSize:"30",size:.1},{text:e("text.option_body"),fontFamily:"Lato",fontSize:"20",size:.04}],INKIVE.C.HTML={breadcrumbWrapper:'<ul class="breadcrumb"><li></li></ul>',breadcrumbElement:function(e,t,n){return'<a data-toggle="tab" href="#'+e+'" class="'+t+'">'+n+" </a>&gt "},progressBar:function(e){return e||console.error("INKIVE.C.HTML.progressBar: id is not defined"),$.parseHTML('<div class="progress-wrapper" id="'+e+'"><div class="progress"><div class="progress-bar" role="progressbar" style="width: 0%;">0%</div></div><a class="btn progress-cancel"><i class="icon-remove"></i></a></div>')}}}},{}],488:[function(e,t,n){function i(){_.each(u,d.appendUser),_.defer(o)}function a(){function e(){function e(e){var t=$.parseJSON(e);t.result&&_.each(_.filter(t.result,r),l),i()}$.post(d.baseUrl+"friends/list",d.friendsListParameters,e)}function t(){var e="/me/friends?fields=id,name,installed,picture.redirect(false).type(square)";e+="&access_token="+d.facebookToken,FB.api(e,function(e){e&&!e.error&&_.each(e.data,function(e){var t={username:e.name,social_user_id:e.id,profile_picture:e.picture.data.url};r(t)&&l(t,"Facebook")}),i()})}var n=[{load:e},{load:t}],i=_.after(n.length,o);_.invoke(n,"load")}function o(){d.updateFriendScroll(),c()}function r(e){return!u[s(e)]}function s(e){return e.social_user_id>0?e.social_user_id:e.user_id}function l(e,t){var n=s(e),i=e.profile_picture?e.profile_picture.replace("344x344","42x42"):d.noProfilePicture;u[n]={user_id:n,user_name:e.username,profile_pic:i},"string"==typeof t&&(u[n].source=t),d.appendUser(u[n])}function c(){function e(){var e=d.$searchInput.tagsinput("input").val().trim();e.length>2&&i({q:e},function(n){var i=_.filter(n,r);_.each(i,l),t(!1,e)})}function t(e,t){t="undefined"==typeof t?d.$searchInput.tagsinput("input").val().trim():t,d.filter(t,e)}var n=_.debounce(e,800),i=_.partial(d.api,"search/user","GET");d.$searchInput.tagsinput({itemValue:"id",itemText:"name"}),d.$searchInput.tagsinput("input").keyup(function(e){var i=(d.$searchInput.tagsinput("input").val().trim(),e.keyCode?e.keyCode:e.which);13==i?d.enter():(n(),t(!0))})}var d,u={};t.exports=function(e){d=_.extend({$searchInput:$("<input>"),api:$.noop,baseUrl:"",friendsListParameters:{},facebookToken:FB.getAccessToken(),noProfilePicture:"",enter:$.noop,filter:$.noop,appendUser:$.noop,updateFriendScroll:$.noop},e);var t=!_.isEmpty(u);t&&i(),t||a()}},{}],489:[function(e,t,n){t.exports=function(e){switch(e){case"tool.library.video":return"tool.library.videos";case"popupmenu.tooltip.text_align_left":return"popupmenu.tooltip.align_left";case"popupmenu.tooltip.text_align_right":return"popupmenu.tooltip.align_right";case"popupmenu.tooltip.background_opacity":return"popupmenu.tooltip.opacity";case"tool.restrictions.template.permission.icon_deletion":return"editor.delete";case"tool.restrictions.template.permission.image_deletion":return"editor.delete";case"tool.restrictions.template.permission.logo_deletion":return"editor.delete";case"tool.restrictions.template.permission.text_deletion":return"editor.delete";case"tool.restrictions.template.permission.vector_deletion":return"editor.delete";case"tool.restrictions.template.permission.video_deletion":return"editor.delete";case"tool.restrictions.template.permission.icon_position":return"editor.move";case"tool.restrictions.template.permission.image_position":return"editor.move";case"tool.restrictions.template.permission.logo_position":return"editor.move";case"tool.restrictions.template.permission.text_position":return"editor.move";case"tool.restrictions.template.permission.vector_position":return"editor.move";case"tool.restrictions.template.permission.video_position":return"editor.move";case"tool.restrictions.template.permission.image_duplication":return"editor.duplicate";case"tool.restrictions.template.permission.logo_duplication":return"editor.duplicate";case"tool.restrictions.template.permission.text_duplication":return"editor.duplicate";case"tool.restrictions.template.permission.vector_duplication":return"editor.duplicate";case"tool.restrictions.template.permission.icon_duplication":return"editor.duplicate";case"tool.restrictions.template.permission.video_duplication":return"editor.duplicate";case"tool.restrictions.template.permission.icon_opacity":return"tool.restrictions.template.permission.common.opacity";case"tool.restrictions.template.permission.image_opacity":return"tool.restrictions.template.permission.common.opacity";case"tool.restrictions.template.permission.logo_opacity":return"tool.restrictions.template.permission.common.opacity";case"tool.restrictions.template.permission.text_opacity":return"tool.restrictions.template.permission.common.opacity";case"tool.restrictions.template.permission.vector_opacity":return"tool.restrictions.template.permission.common.opacity";case"tool.restrictions.template.permission.icon_rotation":return"tool.restrictions.template.permission.common.rotate";case"tool.restrictions.template.permission.image_rotation":return"tool.restrictions.template.permission.common.rotate";case"tool.restrictions.template.permission.logo_rotation":return"tool.restrictions.template.permission.common.rotate";case"tool.restrictions.template.permission.text_rotation":return"tool.restrictions.template.permission.common.rotate";case"tool.restrictions.template.permission.vector_rotation":return"tool.restrictions.template.permission.common.rotate";case"tool.restrictions.template.permission.icon_size":return"tool.restrictions.template.permission.common.size";case"tool.restrictions.template.permission.logo_size":return"tool.restrictions.template.permission.common.size";case"tool.restrictions.template.permission.vector_size":return"tool.restrictions.template.permission.common.size";case"tool.restrictions.template.permission.video_size":return"tool.restrictions.template.permission.common.size";case"tool.restrictions.template.permission.icon_z_index":return"tool.restrictions.template.permission.common.z_index";case"tool.restrictions.template.permission.image_z_index":return"tool.restrictions.template.permission.common.z_index";case"tool.restrictions.template.permission.logo_z_index":return"tool.restrictions.template.permission.common.z_index";case"tool.restrictions.template.permission.text_z_index":return"tool.restrictions.template.permission.common.z_index";case"tool.restrictions.template.permission.vector_z_index":return"tool.restrictions.template.permission.common.z_index";case"tool.restrictions.template.permission.icon_stroke":return"tool.restrictions.template.permission.common.stroke";case"tool.restrictions.template.permission.logo_stroke":return"tool.restrictions.template.permission.common.stroke";case"tool.restrictions.template.permission.icon_colour":return"tool.restrictions.template.permission.common.colour";case"tool.restrictions.template.permission.text_colour":return"tool.restrictions.template.permission.common.colour";case"tool.restrictions.template.permission.vector_colour":return"tool.restrictions.template.permission.common.colour";case"tool.restrictions.template.permission.image_content":return"tool.restrictions.template.permission.image_replace";case"tool.restrictions.template.permission.function_download_file":return"editor.download_file";case"tool.restrictions.template.permission.function_draw":return"editor.draw";case"tool.restrictions.template.permission.icon_colour":return"tool.restrictions.template.permission.common.fill_colourdelete";case"tool.restrictions.template.permission.logo_colour":return"tool.restrictions.template.permission.common.fill_colour";case"tool.restricted.add.function_draw":return"editor.drawing";case"tool.restricted.add.image_add":return"editor.images";case"tool.restricted.add.logo_add":return"editor.logos";case"tool.restricted.do.function_download_file":return"editor.download_file";case"shapes.names.basic.circle":return"editor.circle";case"shapes.names.basic.ellipse":return"editor.ellipse";case"shapes.names.basic.line":return"editor.line";case"shapes.names.basic.rectangle":return"editor.rectangle";case"shapes.names.basic.square":return"editor.square";case"shapes.names.web.raph_download":return"general.download";case"shapes.names.web.raph_flickr":return"social.flickr";case"shapes.names.web.raph_home":return"general.home";case"shapes.names.web.raph_linkedin":return"social.linkedin";case"shapes.names.web.raph_pen":return"editor.pen";case"shapes.names.web.raph_search":return"general.search";case"shapes.names.web.raph_settings":return"general.settings";case"shapes.names.web.raph_tag":return"social.tag";case"shapes.names.web.raph_twitter":return"social.twitter";case"shapes.names.web.raph_undo":return"editor.undo";case"shapes.names.web.raph_unlock":return"editor.unlock";case"shapes.names.web.raph_view":return"editor.view"}return e}},{}],490:[function(e,t,n){function i(e,t,n,i){this.baseUrl=t,this.version=i,this.namespace=e,this.translationsPath=n,this.setLocale(o.get("locale")||"en"),this.initHandlebarsHelper()}var a,o=e("../js/editor/utils/cookie-storage"),r={editor:e("./exceptions/editor")};i.prototype.load=function(e){if(a)return a.promise();a=$.Deferred(),e&&this.setLocale(e);var t=this.version?"https://static.inkive.com/assets/build/"+this.version+"/":this.baseUrl+"assets/build/";return t+=this.translationsPath+this.namespace+"."+this.locale+".json?"+this.version,$.ajax({url:t,type:"GET",beforeSend:function(e){e.setRequestHeader("X-Requested-With",{toString:function(){return""}})}}).done(_.bind(function(e){this.data=e,"string"==typeof e&&(this.data=JSON.parse(e)),a.resolve()},this)).fail(function(){a.reject()}),a.promise()},i.prototype.setLocale=function(e){this.locale=e,o.set("locale",e)},i.prototype.lookup=function(e){function t(n,i){var a;return i=i||"",_.any(n,function(t,n){if(_.isString(t)&&e==t.trim().toLowerCase())return a=(i?i+".":"")+n}),a||_.any(n,function(e,n){if(_.isObject(e))return a=t(e,(i?i+".":"")+n)}),a}return e=e.trim().toLowerCase(),t(this.data)},i.prototype.translate=function(t,n){function i(t,n){var i=e("handlebars"),o=e("hbsfy/runtime");i.helpers=o.helpers;var r=i.compile(t);return n=_.isArray(n)?a(n,t):n,r(n)}function a(e,t){function n(e,t){for(var n,i=1,a=[];n=t.exec(e);)a.push(n[i]);return a}for(var i={},a=/{{{?[\s]*([^#|}|\/|\s]+)[\s]*}?}}/g,o=n(t,a);o.length&&e.length;)i[o.pop()]=e.pop();return i}function o(){var e=BASE_URL||INKIVE.C.BASE_URL,n=e.indexOf(".xyz")>-1,i=0===t.indexOf("popupmenu")||0===t.indexOf("advice.more")||0===t.indexOf("advice.title");!i&&n&&(window.translationsLogs||(window.translationsLogs={}),window.translationsLogs[t]||(window.translationsLogs[t]=new Date,$.post(e+"api/error/log",{data:"[TranslateHelper] "+t,is_critical:!0})))}if(t){var r,s=this._map(t),l=this.data;for(s=s?s.split("."):[];s.length&&l;)r=s.shift(),l=l[r];return l?n||l.indexOf("{{#")>-1?i(l,n):l:(o(),t)}},i.prototype.initHandlebarsHelper=function(){var t=this,n=e("hbsfy/runtime");n.registerHelper("t",function(e){var n=_.rest(_.initial(arguments));return t.translate(e,n.length&&n)})},i.prototype._map=function(e){return r[this.namespace]?r[this.namespace](e):e},t.exports=i},{"../js/editor/utils/cookie-storage":480,"./exceptions/editor":489,handlebars:522,"hbsfy/runtime":535}],491:[function(e,t,n){(function(n,i){"use strict";function a(t,a){function o(e){var t,n;for(t=0;e[t];t+=1)if(n=e[t],"."===n)e.splice(t,1),t-=1;else if(".."===n){if(1===t&&(".."===e[2]||".."===e[0]))break;t>0&&(e.splice(t-1,2),t-=2)}}function r(e,t){var n;return e&&"."===e.charAt(0)&&t&&(n=t.split("/"),n=n.slice(0,n.length-1),n=n.concat(e.split("/")),o(n),e=n.join("/")),e}function s(e){return function(t){return r(t,e)}}function l(e){function t(t){m[e]=t}return t.fromText=function(e,t){throw new Error("amdefine does not implement load.fromText")},t}function c(e,n,o){var r,s,l,c;if(e)s=m[e]={},l={id:e,uri:i,exports:s},r=u(a,s,l,e);else{if(f)throw new Error("amdefine with no module ID cannot be called more than once per file.");f=!0,s=t.exports,l=t,r=u(a,s,l,t.id)}n&&(n=n.map(function(e){return r(e)})),c="function"==typeof o?o.apply(l.exports,n):o,void 0!==c&&(l.exports=c,e&&(m[e]=l.exports))}function d(e,t,n){Array.isArray(e)?(n=t,t=e,e=void 0):"string"!=typeof e&&(n=e,e=t=void 0),t&&!Array.isArray(t)&&(n=t,t=void 0),t||(t=["require","exports","module"]),e?h[e]=[e,t,n]:c(e,t,n)}var u,p,h={},m={},f=!1,g=e("path");return u=function(e,t,i,a){function o(o,r){return"string"==typeof o?p(e,t,i,o,a):(o=o.map(function(n){return p(e,t,i,n,a)}),void(r&&n.nextTick(function(){r.apply(null,o)})))}return o.toUrl=function(e){return 0===e.indexOf(".")?r(e,g.dirname(i.filename)):e},o},a=a||function(){return t.require.apply(t,arguments)},p=function(e,t,n,i,a){var o,d,f=i.indexOf("!"),g=i;if(f===-1){if(i=r(i,a),"require"===i)return u(e,t,n,a);if("exports"===i)return t;if("module"===i)return n;if(m.hasOwnProperty(i))return m[i];if(h[i])return c.apply(null,h[i]),m[i];if(e)return e(g);throw new Error("No module with ID: "+i)}return o=i.substring(0,f),i=i.substring(f+1,i.length),d=p(e,t,n,o,a),i=d.normalize?d.normalize(i,s(a)):r(i,a),m[i]?m[i]:(d.load(i,u(e,t,n,a),l(i),{}),m[i])},d.require=function(e){return m[e]?m[e]:h[e]?(c.apply(null,h[e]),m[e]):void 0},d.amd={},d}t.exports=a}).call(this,e("_process"),"/../../node_modules/amdefine/amdefine.js")},{_process:537,path:536}],492:[function(e,t,n){},{}],493:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(){var e=v();return e.compile=function(t,n){return d.compile(t,n,e)},e.precompile=function(t,n){return d.precompile(t,n,e)},e.AST=l["default"],e.Compiler=d.Compiler,e.JavaScriptCompiler=p["default"],e.Parser=c.parser,e.parse=c.parse,e}n.__esModule=!0;var o=e("./handlebars.runtime"),r=i(o),s=e("./handlebars/compiler/ast"),l=i(s),c=e("./handlebars/compiler/base"),d=e("./handlebars/compiler/compiler"),u=e("./handlebars/compiler/javascript-compiler"),p=i(u),h=e("./handlebars/compiler/visitor"),m=i(h),f=e("./handlebars/no-conflict"),g=i(f),v=r["default"].create,b=a();b.create=a,g["default"](b),b.Visitor=m["default"],b["default"]=b,n["default"]=b,t.exports=n["default"]},{"./handlebars.runtime":494,"./handlebars/compiler/ast":496,"./handlebars/compiler/base":497,"./handlebars/compiler/compiler":499,"./handlebars/compiler/javascript-compiler":501,"./handlebars/compiler/visitor":504,"./handlebars/no-conflict":518}],494:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function o(){var e=new s.HandlebarsEnvironment;return h.extend(e,s),e.SafeString=c["default"],e.Exception=u["default"],e.Utils=h,e.escapeExpression=h.escapeExpression,e.VM=f,e.template=function(t){return f.template(t,e)},e}n.__esModule=!0;var r=e("./handlebars/base"),s=a(r),l=e("./handlebars/safe-string"),c=i(l),d=e("./handlebars/exception"),u=i(d),p=e("./handlebars/utils"),h=a(p),m=e("./handlebars/runtime"),f=a(m),g=e("./handlebars/no-conflict"),v=i(g),b=o();b.create=o,v["default"](b),b["default"]=b,n["default"]=b,t.exports=n["default"]},{"./handlebars/base":495,"./handlebars/exception":508,"./handlebars/no-conflict":518,"./handlebars/runtime":519,"./handlebars/safe-string":520,"./handlebars/utils":521}],495:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e,t,n){this.helpers=e||{},this.partials=t||{},this.decorators=n||{},l.registerDefaultHelpers(this),c.registerDefaultDecorators(this)}n.__esModule=!0,n.HandlebarsEnvironment=a;var o=e("./utils"),r=e("./exception"),s=i(r),l=e("./helpers"),c=e("./decorators"),d=e("./logger"),u=i(d),p="4.0.11";n.VERSION=p;var h=7;n.COMPILER_REVISION=h;var m={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:"== 1.x.x",5:"== 2.0.0-alpha.x",6:">= 2.0.0-beta.1",7:">= 4.0.0"};n.REVISION_CHANGES=m;var f="[object Object]";a.prototype={constructor:a,logger:u["default"],log:u["default"].log,registerHelper:function(e,t){if(o.toString.call(e)===f){if(t)throw new s["default"]("Arg not supported with multiple helpers");o.extend(this.helpers,e)}else this.helpers[e]=t},unregisterHelper:function(e){delete this.helpers[e]},registerPartial:function(e,t){if(o.toString.call(e)===f)o.extend(this.partials,e);else{if("undefined"==typeof t)throw new s["default"]('Attempting to register a partial called "'+e+'" as undefined');this.partials[e]=t}},unregisterPartial:function(e){delete this.partials[e]},registerDecorator:function(e,t){if(o.toString.call(e)===f){if(t)throw new s["default"]("Arg not supported with multiple decorators");o.extend(this.decorators,e)}else this.decorators[e]=t},unregisterDecorator:function(e){delete this.decorators[e]}};var g=u["default"].log;n.log=g,n.createFrame=o.createFrame,n.logger=u["default"]},{"./decorators":506,"./exception":508,"./helpers":509,"./logger":517,"./utils":521}],496:[function(e,t,n){"use strict";n.__esModule=!0;var i={helpers:{helperExpression:function(e){return"SubExpression"===e.type||("MustacheStatement"===e.type||"BlockStatement"===e.type)&&!!(e.params&&e.params.length||e.hash)},scopedId:function(e){return/^\.|this\b/.test(e.original)},simpleId:function(e){return 1===e.parts.length&&!i.helpers.scopedId(e)&&!e.depth}}};n["default"]=i,t.exports=n["default"]},{}],497:[function(e,t,n){"use strict";function i(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function a(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if("Program"===e.type)return e;s["default"].yy=h,h.locInfo=function(e){return new h.SourceLocation(t&&t.srcName,e)};var n=new c["default"](t);return n.accept(s["default"].parse(e))}n.__esModule=!0,n.parse=o;var r=e("./parser"),s=a(r),l=e("./whitespace-control"),c=a(l),d=e("./helpers"),u=i(d),p=e("../utils");n.parser=s["default"];var h={};p.extend(h,u)},{"../utils":521,"./helpers":500,"./parser":502,"./whitespace-control":505}],498:[function(e,t,n){"use strict";function i(e,t,n){if(o.isArray(e)){for(var i=[],a=0,r=e.length;a<r;a++)i.push(t.wrap(e[a],n));return i}return"boolean"==typeof e||"number"==typeof e?e+"":e}function a(e){this.srcFile=e,this.source=[]}n.__esModule=!0;var o=e("../utils"),r=void 0;try{if("function"!=typeof define||!define.amd){var s=e("source-map");r=s.SourceNode}}catch(l){}r||(r=function(e,t,n,i){this.src="",i&&this.add(i)},r.prototype={add:function(e){o.isArray(e)&&(e=e.join("")),this.src+=e},prepend:function(e){o.isArray(e)&&(e=e.join("")),this.src=e+this.src},toStringWithSourceMap:function(){return{code:this.toString()}},toString:function(){return this.src}}),a.prototype={isEmpty:function(){return!this.source.length},prepend:function(e,t){this.source.unshift(this.wrap(e,t))},push:function(e,t){this.source.push(this.wrap(e,t))},merge:function(){var e=this.empty();return this.each(function(t){e.add(["  ",t,"\n"])}),e},each:function(e){for(var t=0,n=this.source.length;t<n;t++)e(this.source[t])},empty:function(){var e=this.currentLocation||{start:{}};return new r(e.start.line,e.start.column,this.srcFile)},wrap:function(e){var t=arguments.length<=1||void 0===arguments[1]?this.currentLocation||{start:{}}:arguments[1];return e instanceof r?e:(e=i(e,this,t),new r(t.start.line,t.start.column,this.srcFile,e))},functionCall:function(e,t,n){return n=this.generateList(n),this.wrap([e,t?"."+t+"(":"(",n,")"])},quotedString:function(e){return'"'+(e+"").replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")+'"'},objectLiteral:function(e){var t=[];for(var n in e)if(e.hasOwnProperty(n)){var a=i(e[n],this);"undefined"!==a&&t.push([this.quotedString(n),":",a])}var o=this.generateList(t);return o.prepend("{"),o.add("}"),o},generateList:function(e){for(var t=this.empty(),n=0,a=e.length;n<a;n++)n&&t.add(","),t.add(i(e[n],this));return t},generateArray:function(e){var t=this.generateList(e);return t.prepend("["),t.add("]"),t}},n["default"]=a,t.exports=n["default"]},{"../utils":521,"source-map":523}],499:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(){}function o(e,t,n){if(null==e||"string"!=typeof e&&"Program"!==e.type)throw new d["default"]("You must pass a string or Handlebars AST to Handlebars.precompile. You passed "+e);t=t||{},"data"in t||(t.data=!0),t.compat&&(t.useDepths=!0);var i=n.parse(e,t),a=(new n.Compiler).compile(i,t);return(new n.JavaScriptCompiler).compile(a,t)}function r(e,t,n){function i(){var i=n.parse(e,t),a=(new n.Compiler).compile(i,t),o=(new n.JavaScriptCompiler).compile(a,t,void 0,!0);return n.template(o)}function a(e,t){return o||(o=i()),o.call(this,e,t)}if(void 0===t&&(t={}),null==e||"string"!=typeof e&&"Program"!==e.type)throw new d["default"]("You must pass a string or Handlebars AST to Handlebars.compile. You passed "+e);t=u.extend({},t),"data"in t||(t.data=!0),t.compat&&(t.useDepths=!0);var o=void 0;return a._setup=function(e){return o||(o=i()),o._setup(e)},a._child=function(e,t,n,a){return o||(o=i()),o._child(e,t,n,a)},a}function s(e,t){if(e===t)return!0;if(u.isArray(e)&&u.isArray(t)&&e.length===t.length){for(var n=0;n<e.length;n++)if(!s(e[n],t[n]))return!1;return!0}}function l(e){if(!e.path.parts){var t=e.path;e.path={type:"PathExpression",data:!1,depth:0,parts:[t.original+""],original:t.original+"",loc:t.loc}}}n.__esModule=!0,n.Compiler=a,n.precompile=o,n.compile=r;var c=e("../exception"),d=i(c),u=e("../utils"),p=e("./ast"),h=i(p),m=[].slice;a.prototype={compiler:a,equals:function(e){var t=this.opcodes.length;if(e.opcodes.length!==t)return!1;for(var n=0;n<t;n++){var i=this.opcodes[n],a=e.opcodes[n];if(i.opcode!==a.opcode||!s(i.args,a.args))return!1}t=this.children.length;for(var n=0;n<t;n++)if(!this.children[n].equals(e.children[n]))return!1;return!0},guid:0,compile:function(e,t){this.sourceNode=[],this.opcodes=[],this.children=[],this.options=t,this.stringParams=t.stringParams,this.trackIds=t.trackIds,t.blockParams=t.blockParams||[];var n=t.knownHelpers;if(t.knownHelpers={helperMissing:!0,blockHelperMissing:!0,each:!0,"if":!0,unless:!0,"with":!0,log:!0,lookup:!0},n)for(var i in n)i in n&&(this.options.knownHelpers[i]=n[i]);return this.accept(e)},compileProgram:function(e){var t=new this.compiler,n=t.compile(e,this.options),i=this.guid++;return this.usePartial=this.usePartial||n.usePartial,this.children[i]=n,this.useDepths=this.useDepths||n.useDepths,i},accept:function(e){if(!this[e.type])throw new d["default"]("Unknown type: "+e.type,e);this.sourceNode.unshift(e);var t=this[e.type](e);return this.sourceNode.shift(),t},Program:function(e){this.options.blockParams.unshift(e.blockParams);for(var t=e.body,n=t.length,i=0;i<n;i++)this.accept(t[i]);return this.options.blockParams.shift(),this.isSimple=1===n,this.blockParams=e.blockParams?e.blockParams.length:0,this},BlockStatement:function(e){l(e);var t=e.program,n=e.inverse;t=t&&this.compileProgram(t),n=n&&this.compileProgram(n);var i=this.classifySexpr(e);"helper"===i?this.helperSexpr(e,t,n):"simple"===i?(this.simpleSexpr(e),this.opcode("pushProgram",t),this.opcode("pushProgram",n),this.opcode("emptyHash"),this.opcode("blockValue",e.path.original)):(this.ambiguousSexpr(e,t,n),this.opcode("pushProgram",t),this.opcode("pushProgram",n),this.opcode("emptyHash"),this.opcode("ambiguousBlockValue")),this.opcode("append")},DecoratorBlock:function(e){var t=e.program&&this.compileProgram(e.program),n=this.setupFullMustacheParams(e,t,void 0),i=e.path;this.useDecorators=!0,this.opcode("registerDecorator",n.length,i.original)},PartialStatement:function(e){this.usePartial=!0;var t=e.program;t&&(t=this.compileProgram(e.program));var n=e.params;if(n.length>1)throw new d["default"]("Unsupported number of partial arguments: "+n.length,e);n.length||(this.options.explicitPartialContext?this.opcode("pushLiteral","undefined"):n.push({type:"PathExpression",parts:[],depth:0}));var i=e.name.original,a="SubExpression"===e.name.type;a&&this.accept(e.name),this.setupFullMustacheParams(e,t,void 0,!0);var o=e.indent||"";this.options.preventIndent&&o&&(this.opcode("appendContent",o),o=""),this.opcode("invokePartial",a,i,o),this.opcode("append")},PartialBlockStatement:function(e){this.PartialStatement(e)},MustacheStatement:function(e){this.SubExpression(e),e.escaped&&!this.options.noEscape?this.opcode("appendEscaped"):this.opcode("append")},Decorator:function(e){this.DecoratorBlock(e)},ContentStatement:function(e){e.value&&this.opcode("appendContent",e.value)},CommentStatement:function(){},SubExpression:function(e){l(e);var t=this.classifySexpr(e);"simple"===t?this.simpleSexpr(e):"helper"===t?this.helperSexpr(e):this.ambiguousSexpr(e)},ambiguousSexpr:function(e,t,n){var i=e.path,a=i.parts[0],o=null!=t||null!=n;this.opcode("getContext",i.depth),this.opcode("pushProgram",t),this.opcode("pushProgram",n),i.strict=!0,this.accept(i),this.opcode("invokeAmbiguous",a,o)},simpleSexpr:function(e){var t=e.path;t.strict=!0,this.accept(t),this.opcode("resolvePossibleLambda")},helperSexpr:function(e,t,n){var i=this.setupFullMustacheParams(e,t,n),a=e.path,o=a.parts[0];if(this.options.knownHelpers[o])this.opcode("invokeKnownHelper",i.length,o);else{if(this.options.knownHelpersOnly)throw new d["default"]("You specified knownHelpersOnly, but used the unknown helper "+o,e);a.strict=!0,a.falsy=!0,this.accept(a),this.opcode("invokeHelper",i.length,a.original,h["default"].helpers.simpleId(a))}},PathExpression:function(e){this.addDepth(e.depth),this.opcode("getContext",e.depth);var t=e.parts[0],n=h["default"].helpers.scopedId(e),i=!e.depth&&!n&&this.blockParamIndex(t);i?this.opcode("lookupBlockParam",i,e.parts):t?e.data?(this.options.data=!0,this.opcode("lookupData",e.depth,e.parts,e.strict)):this.opcode("lookupOnContext",e.parts,e.falsy,e.strict,n):this.opcode("pushContext")},StringLiteral:function(e){this.opcode("pushString",e.value)},NumberLiteral:function(e){this.opcode("pushLiteral",e.value)},BooleanLiteral:function(e){this.opcode("pushLiteral",e.value)},UndefinedLiteral:function(){this.opcode("pushLiteral","undefined")},NullLiteral:function(){this.opcode("pushLiteral","null")},Hash:function(e){var t=e.pairs,n=0,i=t.length;for(this.opcode("pushHash");n<i;n++)this.pushParam(t[n].value);for(;n--;)this.opcode("assignToHash",t[n].key);this.opcode("popHash")},opcode:function(e){this.opcodes.push({opcode:e,args:m.call(arguments,1),loc:this.sourceNode[0].loc})},addDepth:function(e){e&&(this.useDepths=!0)},classifySexpr:function(e){var t=h["default"].helpers.simpleId(e.path),n=t&&!!this.blockParamIndex(e.path.parts[0]),i=!n&&h["default"].helpers.helperExpression(e),a=!n&&(i||t);if(a&&!i){var o=e.path.parts[0],r=this.options;r.knownHelpers[o]?i=!0:r.knownHelpersOnly&&(a=!1)}return i?"helper":a?"ambiguous":"simple"},pushParams:function(e){for(var t=0,n=e.length;t<n;t++)this.pushParam(e[t])},pushParam:function(e){var t=null!=e.value?e.value:e.original||"";if(this.stringParams)t.replace&&(t=t.replace(/^(\.?\.\/)*/g,"").replace(/\//g,".")),e.depth&&this.addDepth(e.depth),this.opcode("getContext",e.depth||0),this.opcode("pushStringParam",t,e.type),"SubExpression"===e.type&&this.accept(e);else{if(this.trackIds){var n=void 0;if(!e.parts||h["default"].helpers.scopedId(e)||e.depth||(n=this.blockParamIndex(e.parts[0])),n){var i=e.parts.slice(1).join(".");this.opcode("pushId","BlockParam",n,i)}else t=e.original||t,t.replace&&(t=t.replace(/^this(?:\.|$)/,"").replace(/^\.\//,"").replace(/^\.$/,"")),this.opcode("pushId",e.type,t)}this.accept(e)}},setupFullMustacheParams:function(e,t,n,i){var a=e.params;return this.pushParams(a),this.opcode("pushProgram",t),this.opcode("pushProgram",n),e.hash?this.accept(e.hash):this.opcode("emptyHash",i),a},blockParamIndex:function(e){for(var t=0,n=this.options.blockParams.length;t<n;t++){var i=this.options.blockParams[t],a=i&&u.indexOf(i,e);if(i&&a>=0)return[t,a]}}}},{"../exception":508,"../utils":521,"./ast":496}],500:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(t=t.path?t.path.original:t,e.path.original!==t){var n={loc:e.path.loc};throw new g["default"](e.path.original+" doesn't match "+t,n)}}function o(e,t){this.source=e,this.start={line:t.first_line,column:t.first_column},this.end={line:t.last_line,column:t.last_column}}function r(e){return/^\[.*\]$/.test(e)?e.substr(1,e.length-2):e}function s(e,t){return{open:"~"===e.charAt(2),close:"~"===t.charAt(t.length-3)}}function l(e){return e.replace(/^\{\{~?\!-?-?/,"").replace(/-?-?~?\}\}$/,"")}function c(e,t,n){n=this.locInfo(n);for(var i=e?"@":"",a=[],o=0,r="",s=0,l=t.length;s<l;s++){var c=t[s].part,d=t[s].original!==c;if(i+=(t[s].separator||"")+c,d||".."!==c&&"."!==c&&"this"!==c)a.push(c);else{if(a.length>0)throw new g["default"]("Invalid path: "+i,{loc:n});".."===c&&(o++,r+="../")}}return{type:"PathExpression",data:e,depth:o,parts:a,original:i,loc:n}}function d(e,t,n,i,a,o){var r=i.charAt(3)||i.charAt(2),s="{"!==r&&"&"!==r,l=/\*/.test(i);return{type:l?"Decorator":"MustacheStatement",path:e,params:t,hash:n,escaped:s,strip:a,loc:this.locInfo(o)}}function u(e,t,n,i){a(e,n),i=this.locInfo(i);var o={type:"Program",body:t,strip:{},loc:i};return{type:"BlockStatement",path:e.path,
params:e.params,hash:e.hash,program:o,openStrip:{},inverseStrip:{},closeStrip:{},loc:i}}function p(e,t,n,i,o,r){i&&i.path&&a(e,i);var s=/\*/.test(e.open);t.blockParams=e.blockParams;var l=void 0,c=void 0;if(n){if(s)throw new g["default"]("Unexpected inverse block on decorator",n);n.chain&&(n.program.body[0].closeStrip=i.strip),c=n.strip,l=n.program}return o&&(o=l,l=t,t=o),{type:s?"DecoratorBlock":"BlockStatement",path:e.path,params:e.params,hash:e.hash,program:t,inverse:l,openStrip:e.strip,inverseStrip:c,closeStrip:i&&i.strip,loc:this.locInfo(r)}}function h(e,t){if(!t&&e.length){var n=e[0].loc,i=e[e.length-1].loc;n&&i&&(t={source:n.source,start:{line:n.start.line,column:n.start.column},end:{line:i.end.line,column:i.end.column}})}return{type:"Program",body:e,strip:{},loc:t}}function m(e,t,n,i){return a(e,n),{type:"PartialBlockStatement",name:e.path,params:e.params,hash:e.hash,program:t,openStrip:e.strip,closeStrip:n&&n.strip,loc:this.locInfo(i)}}n.__esModule=!0,n.SourceLocation=o,n.id=r,n.stripFlags=s,n.stripComment=l,n.preparePath=c,n.prepareMustache=d,n.prepareRawBlock=u,n.prepareBlock=p,n.prepareProgram=h,n.preparePartialBlock=m;var f=e("../exception"),g=i(f)},{"../exception":508}],501:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e){this.value=e}function o(){}function r(e,t,n,i){var a=t.popStack(),o=0,r=n.length;for(e&&r--;o<r;o++)a=t.nameLookup(a,n[o],i);return e?[t.aliasable("container.strict"),"(",a,", ",t.quotedString(n[o]),")"]:a}n.__esModule=!0;var s=e("../base"),l=e("../exception"),c=i(l),d=e("../utils"),u=e("./code-gen"),p=i(u);o.prototype={nameLookup:function(e,t){return o.isValidJavaScriptVariableName(t)?[e,".",t]:[e,"[",JSON.stringify(t),"]"]},depthedLookup:function(e){return[this.aliasable("container.lookup"),'(depths, "',e,'")']},compilerInfo:function(){var e=s.COMPILER_REVISION,t=s.REVISION_CHANGES[e];return[e,t]},appendToBuffer:function(e,t,n){return d.isArray(e)||(e=[e]),e=this.source.wrap(e,t),this.environment.isSimple?["return ",e,";"]:n?["buffer += ",e,";"]:(e.appendToBuffer=!0,e)},initializeBuffer:function(){return this.quotedString("")},compile:function(e,t,n,i){this.environment=e,this.options=t,this.stringParams=this.options.stringParams,this.trackIds=this.options.trackIds,this.precompile=!i,this.name=this.environment.name,this.isChild=!!n,this.context=n||{decorators:[],programs:[],environments:[]},this.preamble(),this.stackSlot=0,this.stackVars=[],this.aliases={},this.registers={list:[]},this.hashes=[],this.compileStack=[],this.inlineStack=[],this.blockParams=[],this.compileChildren(e,t),this.useDepths=this.useDepths||e.useDepths||e.useDecorators||this.options.compat,this.useBlockParams=this.useBlockParams||e.useBlockParams;var a=e.opcodes,o=void 0,r=void 0,s=void 0,l=void 0;for(s=0,l=a.length;s<l;s++)o=a[s],this.source.currentLocation=o.loc,r=r||o.loc,this[o.opcode].apply(this,o.args);if(this.source.currentLocation=r,this.pushSource(""),this.stackSlot||this.inlineStack.length||this.compileStack.length)throw new c["default"]("Compile completed with content left on stack");this.decorators.isEmpty()?this.decorators=void 0:(this.useDecorators=!0,this.decorators.prepend("var decorators = container.decorators;\n"),this.decorators.push("return fn;"),i?this.decorators=Function.apply(this,["fn","props","container","depth0","data","blockParams","depths",this.decorators.merge()]):(this.decorators.prepend("function(fn, props, container, depth0, data, blockParams, depths) {\n"),this.decorators.push("}\n"),this.decorators=this.decorators.merge()));var d=this.createFunctionContext(i);if(this.isChild)return d;var u={compiler:this.compilerInfo(),main:d};this.decorators&&(u.main_d=this.decorators,u.useDecorators=!0);var p=this.context,h=p.programs,m=p.decorators;for(s=0,l=h.length;s<l;s++)h[s]&&(u[s]=h[s],m[s]&&(u[s+"_d"]=m[s],u.useDecorators=!0));return this.environment.usePartial&&(u.usePartial=!0),this.options.data&&(u.useData=!0),this.useDepths&&(u.useDepths=!0),this.useBlockParams&&(u.useBlockParams=!0),this.options.compat&&(u.compat=!0),i?u.compilerOptions=this.options:(u.compiler=JSON.stringify(u.compiler),this.source.currentLocation={start:{line:1,column:0}},u=this.objectLiteral(u),t.srcName?(u=u.toStringWithSourceMap({file:t.destName}),u.map=u.map&&u.map.toString()):u=u.toString()),u},preamble:function(){this.lastContext=0,this.source=new p["default"](this.options.srcName),this.decorators=new p["default"](this.options.srcName)},createFunctionContext:function(e){var t="",n=this.stackVars.concat(this.registers.list);n.length>0&&(t+=", "+n.join(", "));var i=0;for(var a in this.aliases){var o=this.aliases[a];this.aliases.hasOwnProperty(a)&&o.children&&o.referenceCount>1&&(t+=", alias"+ ++i+"="+a,o.children[0]="alias"+i)}var r=["container","depth0","helpers","partials","data"];(this.useBlockParams||this.useDepths)&&r.push("blockParams"),this.useDepths&&r.push("depths");var s=this.mergeSource(t);return e?(r.push(s),Function.apply(this,r)):this.source.wrap(["function(",r.join(","),") {\n  ",s,"}"])},mergeSource:function(e){var t=this.environment.isSimple,n=!this.forceBuffer,i=void 0,a=void 0,o=void 0,r=void 0;return this.source.each(function(e){e.appendToBuffer?(o?e.prepend("  + "):o=e,r=e):(o&&(a?o.prepend("buffer += "):i=!0,r.add(";"),o=r=void 0),a=!0,t||(n=!1))}),n?o?(o.prepend("return "),r.add(";")):a||this.source.push('return "";'):(e+=", buffer = "+(i?"":this.initializeBuffer()),o?(o.prepend("return buffer + "),r.add(";")):this.source.push("return buffer;")),e&&this.source.prepend("var "+e.substring(2)+(i?"":";\n")),this.source.merge()},blockValue:function(e){var t=this.aliasable("helpers.blockHelperMissing"),n=[this.contextName(0)];this.setupHelperArgs(e,0,n);var i=this.popStack();n.splice(1,0,i),this.push(this.source.functionCall(t,"call",n))},ambiguousBlockValue:function(){var e=this.aliasable("helpers.blockHelperMissing"),t=[this.contextName(0)];this.setupHelperArgs("",0,t,!0),this.flushInline();var n=this.topStack();t.splice(1,0,n),this.pushSource(["if (!",this.lastHelper,") { ",n," = ",this.source.functionCall(e,"call",t),"}"])},appendContent:function(e){this.pendingContent?e=this.pendingContent+e:this.pendingLocation=this.source.currentLocation,this.pendingContent=e},append:function(){if(this.isInline())this.replaceStack(function(e){return[" != null ? ",e,' : ""']}),this.pushSource(this.appendToBuffer(this.popStack()));else{var e=this.popStack();this.pushSource(["if (",e," != null) { ",this.appendToBuffer(e,void 0,!0)," }"]),this.environment.isSimple&&this.pushSource(["else { ",this.appendToBuffer("''",void 0,!0)," }"])}},appendEscaped:function(){this.pushSource(this.appendToBuffer([this.aliasable("container.escapeExpression"),"(",this.popStack(),")"]))},getContext:function(e){this.lastContext=e},pushContext:function(){this.pushStackLiteral(this.contextName(this.lastContext))},lookupOnContext:function(e,t,n,i){var a=0;i||!this.options.compat||this.lastContext?this.pushContext():this.push(this.depthedLookup(e[a++])),this.resolvePath("context",e,a,t,n)},lookupBlockParam:function(e,t){this.useBlockParams=!0,this.push(["blockParams[",e[0],"][",e[1],"]"]),this.resolvePath("context",t,1)},lookupData:function(e,t,n){e?this.pushStackLiteral("container.data(data, "+e+")"):this.pushStackLiteral("data"),this.resolvePath("data",t,0,!0,n)},resolvePath:function(e,t,n,i,a){var o=this;if(this.options.strict||this.options.assumeObjects)return void this.push(r(this.options.strict&&a,this,t,e));for(var s=t.length;n<s;n++)this.replaceStack(function(a){var r=o.nameLookup(a,t[n],e);return i?[" && ",r]:[" != null ? ",r," : ",a]})},resolvePossibleLambda:function(){this.push([this.aliasable("container.lambda"),"(",this.popStack(),", ",this.contextName(0),")"])},pushStringParam:function(e,t){this.pushContext(),this.pushString(t),"SubExpression"!==t&&("string"==typeof e?this.pushString(e):this.pushStackLiteral(e))},emptyHash:function(e){this.trackIds&&this.push("{}"),this.stringParams&&(this.push("{}"),this.push("{}")),this.pushStackLiteral(e?"undefined":"{}")},pushHash:function(){this.hash&&this.hashes.push(this.hash),this.hash={values:[],types:[],contexts:[],ids:[]}},popHash:function(){var e=this.hash;this.hash=this.hashes.pop(),this.trackIds&&this.push(this.objectLiteral(e.ids)),this.stringParams&&(this.push(this.objectLiteral(e.contexts)),this.push(this.objectLiteral(e.types))),this.push(this.objectLiteral(e.values))},pushString:function(e){this.pushStackLiteral(this.quotedString(e))},pushLiteral:function(e){this.pushStackLiteral(e)},pushProgram:function(e){null!=e?this.pushStackLiteral(this.programExpression(e)):this.pushStackLiteral(null)},registerDecorator:function(e,t){var n=this.nameLookup("decorators",t,"decorator"),i=this.setupHelperArgs(t,e);this.decorators.push(["fn = ",this.decorators.functionCall(n,"",["fn","props","container",i])," || fn;"])},invokeHelper:function(e,t,n){var i=this.popStack(),a=this.setupHelper(e,t),o=n?[a.name," || "]:"",r=["("].concat(o,i);this.options.strict||r.push(" || ",this.aliasable("helpers.helperMissing")),r.push(")"),this.push(this.source.functionCall(r,"call",a.callParams))},invokeKnownHelper:function(e,t){var n=this.setupHelper(e,t);this.push(this.source.functionCall(n.name,"call",n.callParams))},invokeAmbiguous:function(e,t){this.useRegister("helper");var n=this.popStack();this.emptyHash();var i=this.setupHelper(0,e,t),a=this.lastHelper=this.nameLookup("helpers",e,"helper"),o=["(","(helper = ",a," || ",n,")"];this.options.strict||(o[0]="(helper = ",o.push(" != null ? helper : ",this.aliasable("helpers.helperMissing"))),this.push(["(",o,i.paramsInit?["),(",i.paramsInit]:[],"),","(typeof helper === ",this.aliasable('"function"')," ? ",this.source.functionCall("helper","call",i.callParams)," : helper))"])},invokePartial:function(e,t,n){var i=[],a=this.setupParams(t,1,i);e&&(t=this.popStack(),delete a.name),n&&(a.indent=JSON.stringify(n)),a.helpers="helpers",a.partials="partials",a.decorators="container.decorators",e?i.unshift(t):i.unshift(this.nameLookup("partials",t,"partial")),this.options.compat&&(a.depths="depths"),a=this.objectLiteral(a),i.push(a),this.push(this.source.functionCall("container.invokePartial","",i))},assignToHash:function(e){var t=this.popStack(),n=void 0,i=void 0,a=void 0;this.trackIds&&(a=this.popStack()),this.stringParams&&(i=this.popStack(),n=this.popStack());var o=this.hash;n&&(o.contexts[e]=n),i&&(o.types[e]=i),a&&(o.ids[e]=a),o.values[e]=t},pushId:function(e,t,n){"BlockParam"===e?this.pushStackLiteral("blockParams["+t[0]+"].path["+t[1]+"]"+(n?" + "+JSON.stringify("."+n):"")):"PathExpression"===e?this.pushString(t):"SubExpression"===e?this.pushStackLiteral("true"):this.pushStackLiteral("null")},compiler:o,compileChildren:function(e,t){for(var n=e.children,i=void 0,a=void 0,o=0,r=n.length;o<r;o++){i=n[o],a=new this.compiler;var s=this.matchExistingProgram(i);if(null==s){this.context.programs.push("");var l=this.context.programs.length;i.index=l,i.name="program"+l,this.context.programs[l]=a.compile(i,t,this.context,!this.precompile),this.context.decorators[l]=a.decorators,this.context.environments[l]=i,this.useDepths=this.useDepths||a.useDepths,this.useBlockParams=this.useBlockParams||a.useBlockParams,i.useDepths=this.useDepths,i.useBlockParams=this.useBlockParams}else i.index=s.index,i.name="program"+s.index,this.useDepths=this.useDepths||s.useDepths,this.useBlockParams=this.useBlockParams||s.useBlockParams}},matchExistingProgram:function(e){for(var t=0,n=this.context.environments.length;t<n;t++){var i=this.context.environments[t];if(i&&i.equals(e))return i}},programExpression:function(e){var t=this.environment.children[e],n=[t.index,"data",t.blockParams];return(this.useBlockParams||this.useDepths)&&n.push("blockParams"),this.useDepths&&n.push("depths"),"container.program("+n.join(", ")+")"},useRegister:function(e){this.registers[e]||(this.registers[e]=!0,this.registers.list.push(e))},push:function(e){return e instanceof a||(e=this.source.wrap(e)),this.inlineStack.push(e),e},pushStackLiteral:function(e){this.push(new a(e))},pushSource:function(e){this.pendingContent&&(this.source.push(this.appendToBuffer(this.source.quotedString(this.pendingContent),this.pendingLocation)),this.pendingContent=void 0),e&&this.source.push(e)},replaceStack:function(e){var t=["("],n=void 0,i=void 0,o=void 0;if(!this.isInline())throw new c["default"]("replaceStack on non-inline");var r=this.popStack(!0);if(r instanceof a)n=[r.value],t=["(",n],o=!0;else{i=!0;var s=this.incrStack();t=["((",this.push(s)," = ",r,")"],n=this.topStack()}var l=e.call(this,n);o||this.popStack(),i&&this.stackSlot--,this.push(t.concat(l,")"))},incrStack:function(){return this.stackSlot++,this.stackSlot>this.stackVars.length&&this.stackVars.push("stack"+this.stackSlot),this.topStackName()},topStackName:function(){return"stack"+this.stackSlot},flushInline:function(){var e=this.inlineStack;this.inlineStack=[];for(var t=0,n=e.length;t<n;t++){var i=e[t];if(i instanceof a)this.compileStack.push(i);else{var o=this.incrStack();this.pushSource([o," = ",i,";"]),this.compileStack.push(o)}}},isInline:function(){return this.inlineStack.length},popStack:function(e){var t=this.isInline(),n=(t?this.inlineStack:this.compileStack).pop();if(!e&&n instanceof a)return n.value;if(!t){if(!this.stackSlot)throw new c["default"]("Invalid stack pop");this.stackSlot--}return n},topStack:function(){var e=this.isInline()?this.inlineStack:this.compileStack,t=e[e.length-1];return t instanceof a?t.value:t},contextName:function(e){return this.useDepths&&e?"depths["+e+"]":"depth"+e},quotedString:function(e){return this.source.quotedString(e)},objectLiteral:function(e){return this.source.objectLiteral(e)},aliasable:function(e){var t=this.aliases[e];return t?(t.referenceCount++,t):(t=this.aliases[e]=this.source.wrap(e),t.aliasable=!0,t.referenceCount=1,t)},setupHelper:function(e,t,n){var i=[],a=this.setupHelperArgs(t,e,i,n),o=this.nameLookup("helpers",t,"helper"),r=this.aliasable(this.contextName(0)+" != null ? "+this.contextName(0)+" : (container.nullContext || {})");return{params:i,paramsInit:a,name:o,callParams:[r].concat(i)}},setupParams:function(e,t,n){var i={},a=[],o=[],r=[],s=!n,l=void 0;s&&(n=[]),i.name=this.quotedString(e),i.hash=this.popStack(),this.trackIds&&(i.hashIds=this.popStack()),this.stringParams&&(i.hashTypes=this.popStack(),i.hashContexts=this.popStack());var c=this.popStack(),d=this.popStack();(d||c)&&(i.fn=d||"container.noop",i.inverse=c||"container.noop");for(var u=t;u--;)l=this.popStack(),n[u]=l,this.trackIds&&(r[u]=this.popStack()),this.stringParams&&(o[u]=this.popStack(),a[u]=this.popStack());return s&&(i.args=this.source.generateArray(n)),this.trackIds&&(i.ids=this.source.generateArray(r)),this.stringParams&&(i.types=this.source.generateArray(o),i.contexts=this.source.generateArray(a)),this.options.data&&(i.data="data"),this.useBlockParams&&(i.blockParams="blockParams"),i},setupHelperArgs:function(e,t,n,i){var a=this.setupParams(e,t,n);return a=this.objectLiteral(a),i?(this.useRegister("options"),n.push("options"),["options=",a]):n?(n.push(a),""):a}},function(){for(var e="break else new var case finally return void catch for switch while continue function this with default if throw delete in try do instanceof typeof abstract enum int short boolean export interface static byte extends long super char final native synchronized class float package throws const goto private transient debugger implements protected volatile double import public let yield await null true false".split(" "),t=o.RESERVED_WORDS={},n=0,i=e.length;n<i;n++)t[e[n]]=!0}(),o.isValidJavaScriptVariableName=function(e){return!o.RESERVED_WORDS[e]&&/^[a-zA-Z_$][0-9a-zA-Z_$]*$/.test(e)},n["default"]=o,t.exports=n["default"]},{"../base":495,"../exception":508,"../utils":521,"./code-gen":498}],502:[function(e,t,n){"use strict";n.__esModule=!0;var i=function(){function e(){this.yy={}}var t={trace:function(){},yy:{},symbols_:{error:2,root:3,program:4,EOF:5,program_repetition0:6,statement:7,mustache:8,block:9,rawBlock:10,partial:11,partialBlock:12,content:13,COMMENT:14,CONTENT:15,openRawBlock:16,rawBlock_repetition_plus0:17,END_RAW_BLOCK:18,OPEN_RAW_BLOCK:19,helperName:20,openRawBlock_repetition0:21,openRawBlock_option0:22,CLOSE_RAW_BLOCK:23,openBlock:24,block_option0:25,closeBlock:26,openInverse:27,block_option1:28,OPEN_BLOCK:29,openBlock_repetition0:30,openBlock_option0:31,openBlock_option1:32,CLOSE:33,OPEN_INVERSE:34,openInverse_repetition0:35,openInverse_option0:36,openInverse_option1:37,openInverseChain:38,OPEN_INVERSE_CHAIN:39,openInverseChain_repetition0:40,openInverseChain_option0:41,openInverseChain_option1:42,inverseAndProgram:43,INVERSE:44,inverseChain:45,inverseChain_option0:46,OPEN_ENDBLOCK:47,OPEN:48,mustache_repetition0:49,mustache_option0:50,OPEN_UNESCAPED:51,mustache_repetition1:52,mustache_option1:53,CLOSE_UNESCAPED:54,OPEN_PARTIAL:55,partialName:56,partial_repetition0:57,partial_option0:58,openPartialBlock:59,OPEN_PARTIAL_BLOCK:60,openPartialBlock_repetition0:61,openPartialBlock_option0:62,param:63,sexpr:64,OPEN_SEXPR:65,sexpr_repetition0:66,sexpr_option0:67,CLOSE_SEXPR:68,hash:69,hash_repetition_plus0:70,hashSegment:71,ID:72,EQUALS:73,blockParams:74,OPEN_BLOCK_PARAMS:75,blockParams_repetition_plus0:76,CLOSE_BLOCK_PARAMS:77,path:78,dataName:79,STRING:80,NUMBER:81,BOOLEAN:82,UNDEFINED:83,NULL:84,DATA:85,pathSegments:86,SEP:87,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",14:"COMMENT",15:"CONTENT",18:"END_RAW_BLOCK",19:"OPEN_RAW_BLOCK",23:"CLOSE_RAW_BLOCK",29:"OPEN_BLOCK",33:"CLOSE",34:"OPEN_INVERSE",39:"OPEN_INVERSE_CHAIN",44:"INVERSE",47:"OPEN_ENDBLOCK",48:"OPEN",51:"OPEN_UNESCAPED",54:"CLOSE_UNESCAPED",55:"OPEN_PARTIAL",60:"OPEN_PARTIAL_BLOCK",65:"OPEN_SEXPR",68:"CLOSE_SEXPR",72:"ID",73:"EQUALS",75:"OPEN_BLOCK_PARAMS",77:"CLOSE_BLOCK_PARAMS",80:"STRING",81:"NUMBER",82:"BOOLEAN",83:"UNDEFINED",84:"NULL",85:"DATA",87:"SEP"},productions_:[0,[3,2],[4,1],[7,1],[7,1],[7,1],[7,1],[7,1],[7,1],[7,1],[13,1],[10,3],[16,5],[9,4],[9,4],[24,6],[27,6],[38,6],[43,2],[45,3],[45,1],[26,3],[8,5],[8,5],[11,5],[12,3],[59,5],[63,1],[63,1],[64,5],[69,1],[71,3],[74,3],[20,1],[20,1],[20,1],[20,1],[20,1],[20,1],[20,1],[56,1],[56,1],[79,2],[78,1],[86,3],[86,1],[6,0],[6,2],[17,1],[17,2],[21,0],[21,2],[22,0],[22,1],[25,0],[25,1],[28,0],[28,1],[30,0],[30,2],[31,0],[31,1],[32,0],[32,1],[35,0],[35,2],[36,0],[36,1],[37,0],[37,1],[40,0],[40,2],[41,0],[41,1],[42,0],[42,1],[46,0],[46,1],[49,0],[49,2],[50,0],[50,1],[52,0],[52,2],[53,0],[53,1],[57,0],[57,2],[58,0],[58,1],[61,0],[61,2],[62,0],[62,1],[66,0],[66,2],[67,0],[67,1],[70,1],[70,2],[76,1],[76,2]],performAction:function(e,t,n,i,a,o,r){var s=o.length-1;switch(a){case 1:return o[s-1];case 2:this.$=i.prepareProgram(o[s]);break;case 3:this.$=o[s];break;case 4:this.$=o[s];break;case 5:this.$=o[s];break;case 6:this.$=o[s];break;case 7:this.$=o[s];break;case 8:this.$=o[s];break;case 9:this.$={type:"CommentStatement",value:i.stripComment(o[s]),strip:i.stripFlags(o[s],o[s]),loc:i.locInfo(this._$)};break;case 10:this.$={type:"ContentStatement",original:o[s],value:o[s],loc:i.locInfo(this._$)};break;case 11:this.$=i.prepareRawBlock(o[s-2],o[s-1],o[s],this._$);break;case 12:this.$={path:o[s-3],params:o[s-2],hash:o[s-1]};break;case 13:this.$=i.prepareBlock(o[s-3],o[s-2],o[s-1],o[s],!1,this._$);break;case 14:this.$=i.prepareBlock(o[s-3],o[s-2],o[s-1],o[s],!0,this._$);break;case 15:this.$={open:o[s-5],path:o[s-4],params:o[s-3],hash:o[s-2],blockParams:o[s-1],strip:i.stripFlags(o[s-5],o[s])};break;case 16:this.$={path:o[s-4],params:o[s-3],hash:o[s-2],blockParams:o[s-1],strip:i.stripFlags(o[s-5],o[s])};break;case 17:this.$={path:o[s-4],params:o[s-3],hash:o[s-2],blockParams:o[s-1],strip:i.stripFlags(o[s-5],o[s])};break;case 18:this.$={strip:i.stripFlags(o[s-1],o[s-1]),program:o[s]};break;case 19:var l=i.prepareBlock(o[s-2],o[s-1],o[s],o[s],!1,this._$),c=i.prepareProgram([l],o[s-1].loc);c.chained=!0,this.$={strip:o[s-2].strip,program:c,chain:!0};break;case 20:this.$=o[s];break;case 21:this.$={path:o[s-1],strip:i.stripFlags(o[s-2],o[s])};break;case 22:this.$=i.prepareMustache(o[s-3],o[s-2],o[s-1],o[s-4],i.stripFlags(o[s-4],o[s]),this._$);break;case 23:this.$=i.prepareMustache(o[s-3],o[s-2],o[s-1],o[s-4],i.stripFlags(o[s-4],o[s]),this._$);break;case 24:this.$={type:"PartialStatement",name:o[s-3],params:o[s-2],hash:o[s-1],indent:"",strip:i.stripFlags(o[s-4],o[s]),loc:i.locInfo(this._$)};break;case 25:this.$=i.preparePartialBlock(o[s-2],o[s-1],o[s],this._$);break;case 26:this.$={path:o[s-3],params:o[s-2],hash:o[s-1],strip:i.stripFlags(o[s-4],o[s])};break;case 27:this.$=o[s];break;case 28:this.$=o[s];break;case 29:this.$={type:"SubExpression",path:o[s-3],params:o[s-2],hash:o[s-1],loc:i.locInfo(this._$)};break;case 30:this.$={type:"Hash",pairs:o[s],loc:i.locInfo(this._$)};break;case 31:this.$={type:"HashPair",key:i.id(o[s-2]),value:o[s],loc:i.locInfo(this._$)};break;case 32:this.$=i.id(o[s-1]);break;case 33:this.$=o[s];break;case 34:this.$=o[s];break;case 35:this.$={type:"StringLiteral",value:o[s],original:o[s],loc:i.locInfo(this._$)};break;case 36:this.$={type:"NumberLiteral",value:Number(o[s]),original:Number(o[s]),loc:i.locInfo(this._$)};break;case 37:this.$={type:"BooleanLiteral",value:"true"===o[s],original:"true"===o[s],loc:i.locInfo(this._$)};break;case 38:this.$={type:"UndefinedLiteral",original:void 0,value:void 0,loc:i.locInfo(this._$)};break;case 39:this.$={type:"NullLiteral",original:null,value:null,loc:i.locInfo(this._$)};break;case 40:this.$=o[s];break;case 41:this.$=o[s];break;case 42:this.$=i.preparePath(!0,o[s],this._$);break;case 43:this.$=i.preparePath(!1,o[s],this._$);break;case 44:o[s-2].push({part:i.id(o[s]),original:o[s],separator:o[s-1]}),this.$=o[s-2];break;case 45:this.$=[{part:i.id(o[s]),original:o[s]}];break;case 46:this.$=[];break;case 47:o[s-1].push(o[s]);break;case 48:this.$=[o[s]];break;case 49:o[s-1].push(o[s]);break;case 50:this.$=[];break;case 51:o[s-1].push(o[s]);break;case 58:this.$=[];break;case 59:o[s-1].push(o[s]);break;case 64:this.$=[];break;case 65:o[s-1].push(o[s]);break;case 70:this.$=[];break;case 71:o[s-1].push(o[s]);break;case 78:this.$=[];break;case 79:o[s-1].push(o[s]);break;case 82:this.$=[];break;case 83:o[s-1].push(o[s]);break;case 86:this.$=[];break;case 87:o[s-1].push(o[s]);break;case 90:this.$=[];break;case 91:o[s-1].push(o[s]);break;case 94:this.$=[];break;case 95:o[s-1].push(o[s]);break;case 98:this.$=[o[s]];break;case 99:o[s-1].push(o[s]);break;case 100:this.$=[o[s]];break;case 101:o[s-1].push(o[s])}},table:[{3:1,4:2,5:[2,46],6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{1:[3]},{5:[1,4]},{5:[2,2],7:5,8:6,9:7,10:8,11:9,12:10,13:11,14:[1,12],15:[1,20],16:17,19:[1,23],24:15,27:16,29:[1,21],34:[1,22],39:[2,2],44:[2,2],47:[2,2],48:[1,13],51:[1,14],55:[1,18],59:19,60:[1,24]},{1:[2,1]},{5:[2,47],14:[2,47],15:[2,47],19:[2,47],29:[2,47],34:[2,47],39:[2,47],44:[2,47],47:[2,47],48:[2,47],51:[2,47],55:[2,47],60:[2,47]},{5:[2,3],14:[2,3],15:[2,3],19:[2,3],29:[2,3],34:[2,3],39:[2,3],44:[2,3],47:[2,3],48:[2,3],51:[2,3],55:[2,3],60:[2,3]},{5:[2,4],14:[2,4],15:[2,4],19:[2,4],29:[2,4],34:[2,4],39:[2,4],44:[2,4],47:[2,4],48:[2,4],51:[2,4],55:[2,4],60:[2,4]},{5:[2,5],14:[2,5],15:[2,5],19:[2,5],29:[2,5],34:[2,5],39:[2,5],44:[2,5],47:[2,5],48:[2,5],51:[2,5],55:[2,5],60:[2,5]},{5:[2,6],14:[2,6],15:[2,6],19:[2,6],29:[2,6],34:[2,6],39:[2,6],44:[2,6],47:[2,6],48:[2,6],51:[2,6],55:[2,6],60:[2,6]},{5:[2,7],14:[2,7],15:[2,7],19:[2,7],29:[2,7],34:[2,7],39:[2,7],44:[2,7],47:[2,7],48:[2,7],51:[2,7],55:[2,7],60:[2,7]},{5:[2,8],14:[2,8],15:[2,8],19:[2,8],29:[2,8],34:[2,8],39:[2,8],44:[2,8],47:[2,8],48:[2,8],51:[2,8],55:[2,8],60:[2,8]},{5:[2,9],14:[2,9],15:[2,9],19:[2,9],29:[2,9],34:[2,9],39:[2,9],44:[2,9],47:[2,9],48:[2,9],51:[2,9],55:[2,9],60:[2,9]},{20:25,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:36,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{4:37,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],39:[2,46],44:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{4:38,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],44:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{13:40,15:[1,20],17:39},{20:42,56:41,64:43,65:[1,44],72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{4:45,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{5:[2,10],14:[2,10],15:[2,10],18:[2,10],19:[2,10],29:[2,10],34:[2,10],39:[2,10],44:[2,10],47:[2,10],48:[2,10],51:[2,10],55:[2,10],60:[2,10]},{20:46,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:47,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:48,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:42,56:49,64:43,65:[1,44],72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{33:[2,78],49:50,65:[2,78],72:[2,78],80:[2,78],81:[2,78],82:[2,78],83:[2,78],84:[2,78],85:[2,78]},{23:[2,33],33:[2,33],54:[2,33],65:[2,33],68:[2,33],72:[2,33],75:[2,33],80:[2,33],81:[2,33],82:[2,33],83:[2,33],84:[2,33],85:[2,33]},{23:[2,34],33:[2,34],54:[2,34],65:[2,34],68:[2,34],72:[2,34],75:[2,34],80:[2,34],81:[2,34],82:[2,34],83:[2,34],84:[2,34],85:[2,34]},{23:[2,35],33:[2,35],54:[2,35],65:[2,35],68:[2,35],72:[2,35],75:[2,35],80:[2,35],81:[2,35],82:[2,35],83:[2,35],84:[2,35],85:[2,35]},{23:[2,36],33:[2,36],54:[2,36],65:[2,36],68:[2,36],72:[2,36],75:[2,36],80:[2,36],81:[2,36],82:[2,36],83:[2,36],84:[2,36],85:[2,36]},{23:[2,37],33:[2,37],54:[2,37],65:[2,37],68:[2,37],72:[2,37],75:[2,37],80:[2,37],81:[2,37],82:[2,37],83:[2,37],84:[2,37],85:[2,37]},{23:[2,38],33:[2,38],54:[2,38],65:[2,38],68:[2,38],72:[2,38],75:[2,38],80:[2,38],81:[2,38],82:[2,38],83:[2,38],84:[2,38],85:[2,38]},{23:[2,39],33:[2,39],54:[2,39],65:[2,39],68:[2,39],72:[2,39],75:[2,39],80:[2,39],81:[2,39],82:[2,39],83:[2,39],84:[2,39],85:[2,39]},{23:[2,43],33:[2,43],54:[2,43],65:[2,43],68:[2,43],72:[2,43],75:[2,43],80:[2,43],81:[2,43],82:[2,43],83:[2,43],84:[2,43],85:[2,43],87:[1,51]},{72:[1,35],86:52},{23:[2,45],33:[2,45],54:[2,45],65:[2,45],68:[2,45],72:[2,45],75:[2,45],80:[2,45],81:[2,45],82:[2,45],83:[2,45],84:[2,45],85:[2,45],87:[2,45]},{52:53,54:[2,82],65:[2,82],72:[2,82],80:[2,82],81:[2,82],82:[2,82],83:[2,82],84:[2,82],85:[2,82]},{25:54,38:56,39:[1,58],43:57,44:[1,59],45:55,47:[2,54]},{28:60,43:61,44:[1,59],47:[2,56]},{13:63,15:[1,20],18:[1,62]},{15:[2,48],18:[2,48]},{33:[2,86],57:64,65:[2,86],72:[2,86],80:[2,86],81:[2,86],82:[2,86],83:[2,86],84:[2,86],85:[2,86]},{33:[2,40],65:[2,40],72:[2,40],80:[2,40],81:[2,40],82:[2,40],83:[2,40],84:[2,40],85:[2,40]},{33:[2,41],65:[2,41],72:[2,41],80:[2,41],81:[2,41],82:[2,41],83:[2,41],84:[2,41],85:[2,41]},{20:65,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{26:66,47:[1,67]},{30:68,33:[2,58],65:[2,58],72:[2,58],75:[2,58],80:[2,58],81:[2,58],82:[2,58],83:[2,58],84:[2,58],85:[2,58]},{33:[2,64],35:69,65:[2,64],72:[2,64],75:[2,64],80:[2,64],81:[2,64],82:[2,64],83:[2,64],84:[2,64],85:[2,64]},{21:70,23:[2,50],65:[2,50],72:[2,50],80:[2,50],81:[2,50],82:[2,50],83:[2,50],84:[2,50],85:[2,50]},{33:[2,90],61:71,65:[2,90],72:[2,90],80:[2,90],81:[2,90],82:[2,90],83:[2,90],84:[2,90],85:[2,90]},{20:75,33:[2,80],50:72,63:73,64:76,65:[1,44],69:74,70:77,71:78,72:[1,79],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{72:[1,80]},{23:[2,42],33:[2,42],54:[2,42],65:[2,42],68:[2,42],72:[2,42],75:[2,42],80:[2,42],81:[2,42],82:[2,42],83:[2,42],84:[2,42],85:[2,42],87:[1,51]},{20:75,53:81,54:[2,84],63:82,64:76,65:[1,44],69:83,70:77,71:78,72:[1,79],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{26:84,47:[1,67]},{47:[2,55]},{4:85,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],39:[2,46],44:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{47:[2,20]},{20:86,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{4:87,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{26:88,47:[1,67]},{47:[2,57]},{5:[2,11],14:[2,11],15:[2,11],19:[2,11],29:[2,11],34:[2,11],39:[2,11],44:[2,11],47:[2,11],48:[2,11],51:[2,11],55:[2,11],60:[2,11]},{15:[2,49],18:[2,49]},{20:75,33:[2,88],58:89,63:90,64:76,65:[1,44],69:91,70:77,71:78,72:[1,79],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{65:[2,94],66:92,68:[2,94],72:[2,94],80:[2,94],81:[2,94],82:[2,94],83:[2,94],84:[2,94],85:[2,94]},{5:[2,25],14:[2,25],15:[2,25],19:[2,25],29:[2,25],34:[2,25],39:[2,25],44:[2,25],47:[2,25],48:[2,25],51:[2,25],55:[2,25],60:[2,25]},{20:93,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:75,31:94,33:[2,60],63:95,64:76,65:[1,44],69:96,70:77,71:78,72:[1,79],75:[2,60],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:75,33:[2,66],36:97,63:98,64:76,65:[1,44],69:99,70:77,71:78,72:[1,79],75:[2,66],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:75,22:100,23:[2,52],63:101,64:76,65:[1,44],69:102,70:77,71:78,72:[1,79],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:75,33:[2,92],62:103,63:104,64:76,65:[1,44],69:105,70:77,71:78,72:[1,79],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{33:[1,106]},{33:[2,79],65:[2,79],72:[2,79],80:[2,79],81:[2,79],82:[2,79],83:[2,79],84:[2,79],85:[2,79]},{33:[2,81]},{23:[2,27],33:[2,27],54:[2,27],65:[2,27],68:[2,27],72:[2,27],75:[2,27],80:[2,27],81:[2,27],82:[2,27],83:[2,27],84:[2,27],85:[2,27]},{23:[2,28],33:[2,28],54:[2,28],65:[2,28],68:[2,28],72:[2,28],75:[2,28],80:[2,28],81:[2,28],82:[2,28],83:[2,28],84:[2,28],85:[2,28]},{23:[2,30],33:[2,30],54:[2,30],68:[2,30],71:107,72:[1,108],75:[2,30]},{23:[2,98],33:[2,98],54:[2,98],68:[2,98],72:[2,98],75:[2,98]},{23:[2,45],33:[2,45],54:[2,45],65:[2,45],68:[2,45],72:[2,45],73:[1,109],75:[2,45],80:[2,45],81:[2,45],82:[2,45],83:[2,45],84:[2,45],85:[2,45],87:[2,45]},{23:[2,44],33:[2,44],54:[2,44],65:[2,44],68:[2,44],72:[2,44],75:[2,44],80:[2,44],81:[2,44],82:[2,44],83:[2,44],84:[2,44],85:[2,44],87:[2,44]},{54:[1,110]},{54:[2,83],65:[2,83],72:[2,83],80:[2,83],81:[2,83],82:[2,83],83:[2,83],84:[2,83],85:[2,83]},{54:[2,85]},{5:[2,13],14:[2,13],15:[2,13],19:[2,13],29:[2,13],34:[2,13],39:[2,13],44:[2,13],47:[2,13],48:[2,13],51:[2,13],55:[2,13],60:[2,13]},{38:56,39:[1,58],43:57,44:[1,59],45:112,46:111,47:[2,76]},{33:[2,70],40:113,65:[2,70],72:[2,70],75:[2,70],80:[2,70],81:[2,70],82:[2,70],83:[2,70],84:[2,70],85:[2,70]},{47:[2,18]},{5:[2,14],14:[2,14],15:[2,14],19:[2,14],29:[2,14],34:[2,14],39:[2,14],44:[2,14],47:[2,14],48:[2,14],51:[2,14],55:[2,14],60:[2,14]},{33:[1,114]},{33:[2,87],65:[2,87],72:[2,87],80:[2,87],81:[2,87],82:[2,87],83:[2,87],84:[2,87],85:[2,87]},{33:[2,89]},{20:75,63:116,64:76,65:[1,44],67:115,68:[2,96],69:117,70:77,71:78,72:[1,79],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{33:[1,118]},{32:119,33:[2,62],74:120,75:[1,121]},{33:[2,59],65:[2,59],72:[2,59],75:[2,59],80:[2,59],81:[2,59],82:[2,59],83:[2,59],84:[2,59],85:[2,59]},{33:[2,61],75:[2,61]},{33:[2,68],37:122,74:123,75:[1,121]},{33:[2,65],65:[2,65],72:[2,65],75:[2,65],80:[2,65],81:[2,65],82:[2,65],83:[2,65],84:[2,65],85:[2,65]},{33:[2,67],75:[2,67]},{23:[1,124]},{23:[2,51],65:[2,51],72:[2,51],80:[2,51],81:[2,51],82:[2,51],83:[2,51],84:[2,51],85:[2,51]},{23:[2,53]},{33:[1,125]},{33:[2,91],65:[2,91],72:[2,91],80:[2,91],81:[2,91],82:[2,91],83:[2,91],84:[2,91],85:[2,91]},{33:[2,93]},{5:[2,22],14:[2,22],15:[2,22],19:[2,22],29:[2,22],34:[2,22],39:[2,22],44:[2,22],47:[2,22],48:[2,22],51:[2,22],55:[2,22],60:[2,22]},{23:[2,99],33:[2,99],54:[2,99],68:[2,99],72:[2,99],75:[2,99]},{73:[1,109]},{20:75,63:126,64:76,65:[1,44],72:[1,35],
78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{5:[2,23],14:[2,23],15:[2,23],19:[2,23],29:[2,23],34:[2,23],39:[2,23],44:[2,23],47:[2,23],48:[2,23],51:[2,23],55:[2,23],60:[2,23]},{47:[2,19]},{47:[2,77]},{20:75,33:[2,72],41:127,63:128,64:76,65:[1,44],69:129,70:77,71:78,72:[1,79],75:[2,72],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{5:[2,24],14:[2,24],15:[2,24],19:[2,24],29:[2,24],34:[2,24],39:[2,24],44:[2,24],47:[2,24],48:[2,24],51:[2,24],55:[2,24],60:[2,24]},{68:[1,130]},{65:[2,95],68:[2,95],72:[2,95],80:[2,95],81:[2,95],82:[2,95],83:[2,95],84:[2,95],85:[2,95]},{68:[2,97]},{5:[2,21],14:[2,21],15:[2,21],19:[2,21],29:[2,21],34:[2,21],39:[2,21],44:[2,21],47:[2,21],48:[2,21],51:[2,21],55:[2,21],60:[2,21]},{33:[1,131]},{33:[2,63]},{72:[1,133],76:132},{33:[1,134]},{33:[2,69]},{15:[2,12]},{14:[2,26],15:[2,26],19:[2,26],29:[2,26],34:[2,26],47:[2,26],48:[2,26],51:[2,26],55:[2,26],60:[2,26]},{23:[2,31],33:[2,31],54:[2,31],68:[2,31],72:[2,31],75:[2,31]},{33:[2,74],42:135,74:136,75:[1,121]},{33:[2,71],65:[2,71],72:[2,71],75:[2,71],80:[2,71],81:[2,71],82:[2,71],83:[2,71],84:[2,71],85:[2,71]},{33:[2,73],75:[2,73]},{23:[2,29],33:[2,29],54:[2,29],65:[2,29],68:[2,29],72:[2,29],75:[2,29],80:[2,29],81:[2,29],82:[2,29],83:[2,29],84:[2,29],85:[2,29]},{14:[2,15],15:[2,15],19:[2,15],29:[2,15],34:[2,15],39:[2,15],44:[2,15],47:[2,15],48:[2,15],51:[2,15],55:[2,15],60:[2,15]},{72:[1,138],77:[1,137]},{72:[2,100],77:[2,100]},{14:[2,16],15:[2,16],19:[2,16],29:[2,16],34:[2,16],44:[2,16],47:[2,16],48:[2,16],51:[2,16],55:[2,16],60:[2,16]},{33:[1,139]},{33:[2,75]},{33:[2,32]},{72:[2,101],77:[2,101]},{14:[2,17],15:[2,17],19:[2,17],29:[2,17],34:[2,17],39:[2,17],44:[2,17],47:[2,17],48:[2,17],51:[2,17],55:[2,17],60:[2,17]}],defaultActions:{4:[2,1],55:[2,55],57:[2,20],61:[2,57],74:[2,81],83:[2,85],87:[2,18],91:[2,89],102:[2,53],105:[2,93],111:[2,19],112:[2,77],117:[2,97],120:[2,63],123:[2,69],124:[2,12],136:[2,75],137:[2,32]},parseError:function(e,t){throw new Error(e)},parse:function(e){function t(){var e;return e=n.lexer.lex()||1,"number"!=typeof e&&(e=n.symbols_[e]||e),e}var n=this,i=[0],a=[null],o=[],r=this.table,s="",l=0,c=0,d=0;this.lexer.setInput(e),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,this.yy.parser=this,"undefined"==typeof this.lexer.yylloc&&(this.lexer.yylloc={});var u=this.lexer.yylloc;o.push(u);var p=this.lexer.options&&this.lexer.options.ranges;"function"==typeof this.yy.parseError&&(this.parseError=this.yy.parseError);for(var h,m,f,g,v,b,_,y,I,E={};;){if(f=i[i.length-1],this.defaultActions[f]?g=this.defaultActions[f]:(null!==h&&"undefined"!=typeof h||(h=t()),g=r[f]&&r[f][h]),"undefined"==typeof g||!g.length||!g[0]){var w="";if(!d){I=[];for(b in r[f])this.terminals_[b]&&b>2&&I.push("'"+this.terminals_[b]+"'");w=this.lexer.showPosition?"Parse error on line "+(l+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+I.join(", ")+", got '"+(this.terminals_[h]||h)+"'":"Parse error on line "+(l+1)+": Unexpected "+(1==h?"end of input":"'"+(this.terminals_[h]||h)+"'"),this.parseError(w,{text:this.lexer.match,token:this.terminals_[h]||h,line:this.lexer.yylineno,loc:u,expected:I})}}if(g[0]instanceof Array&&g.length>1)throw new Error("Parse Error: multiple actions possible at state: "+f+", token: "+h);switch(g[0]){case 1:i.push(h),a.push(this.lexer.yytext),o.push(this.lexer.yylloc),i.push(g[1]),h=null,m?(h=m,m=null):(c=this.lexer.yyleng,s=this.lexer.yytext,l=this.lexer.yylineno,u=this.lexer.yylloc,d>0&&d--);break;case 2:if(_=this.productions_[g[1]][1],E.$=a[a.length-_],E._$={first_line:o[o.length-(_||1)].first_line,last_line:o[o.length-1].last_line,first_column:o[o.length-(_||1)].first_column,last_column:o[o.length-1].last_column},p&&(E._$.range=[o[o.length-(_||1)].range[0],o[o.length-1].range[1]]),v=this.performAction.call(E,s,c,l,this.yy,g[1],a,o),"undefined"!=typeof v)return v;_&&(i=i.slice(0,-1*_*2),a=a.slice(0,-1*_),o=o.slice(0,-1*_)),i.push(this.productions_[g[1]][0]),a.push(E.$),o.push(E._$),y=r[i[i.length-2]][i[i.length-1]],i.push(y);break;case 3:return!0}}return!0}},n=function(){var e={EOF:1,parseError:function(e,t){if(!this.yy.parser)throw new Error(e);this.yy.parser.parseError(e,t)},setInput:function(e){return this._input=e,this._more=this._less=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var e=this._input[0];this.yytext+=e,this.yyleng++,this.offset++,this.match+=e,this.matched+=e;var t=e.match(/(?:\r\n?|\n).*/g);return t?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),e},unput:function(e){var t=e.length,n=e.split(/(?:\r\n?|\n)/g);this._input=e+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-t-1),this.offset-=t;var i=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),n.length-1&&(this.yylineno-=n.length-1);var a=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:n?(n.length===i.length?this.yylloc.first_column:0)+i[i.length-n.length].length-n[0].length:this.yylloc.first_column-t},this.options.ranges&&(this.yylloc.range=[a[0],a[0]+this.yyleng-t]),this},more:function(){return this._more=!0,this},less:function(e){this.unput(this.match.slice(e))},pastInput:function(){var e=this.matched.substr(0,this.matched.length-this.match.length);return(e.length>20?"...":"")+e.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var e=this.match;return e.length<20&&(e+=this._input.substr(0,20-e.length)),(e.substr(0,20)+(e.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var e=this.pastInput(),t=new Array(e.length+1).join("-");return e+this.upcomingInput()+"\n"+t+"^"},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var e,t,n,i,a;this._more||(this.yytext="",this.match="");for(var o=this._currentRules(),r=0;r<o.length&&(n=this._input.match(this.rules[o[r]]),!n||t&&!(n[0].length>t[0].length)||(t=n,i=r,this.options.flex));r++);return t?(a=t[0].match(/(?:\r\n?|\n).*/g),a&&(this.yylineno+=a.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:a?a[a.length-1].length-a[a.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+t[0].length},this.yytext+=t[0],this.match+=t[0],this.matches=t,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._input=this._input.slice(t[0].length),this.matched+=t[0],e=this.performAction.call(this,this.yy,this,o[i],this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),e?e:void 0):""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var e=this.next();return"undefined"!=typeof e?e:this.lex()},begin:function(e){this.conditionStack.push(e)},popState:function(){return this.conditionStack.pop()},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function(e){this.begin(e)}};return e.options={},e.performAction=function(e,t,n,i){function a(e,n){return t.yytext=t.yytext.substr(e,t.yyleng-n)}switch(n){case 0:if("\\\\"===t.yytext.slice(-2)?(a(0,1),this.begin("mu")):"\\"===t.yytext.slice(-1)?(a(0,1),this.begin("emu")):this.begin("mu"),t.yytext)return 15;break;case 1:return 15;case 2:return this.popState(),15;case 3:return this.begin("raw"),15;case 4:return this.popState(),"raw"===this.conditionStack[this.conditionStack.length-1]?15:(t.yytext=t.yytext.substr(5,t.yyleng-9),"END_RAW_BLOCK");case 5:return 15;case 6:return this.popState(),14;case 7:return 65;case 8:return 68;case 9:return 19;case 10:return this.popState(),this.begin("raw"),23;case 11:return 55;case 12:return 60;case 13:return 29;case 14:return 47;case 15:return this.popState(),44;case 16:return this.popState(),44;case 17:return 34;case 18:return 39;case 19:return 51;case 20:return 48;case 21:this.unput(t.yytext),this.popState(),this.begin("com");break;case 22:return this.popState(),14;case 23:return 48;case 24:return 73;case 25:return 72;case 26:return 72;case 27:return 87;case 28:break;case 29:return this.popState(),54;case 30:return this.popState(),33;case 31:return t.yytext=a(1,2).replace(/\\"/g,'"'),80;case 32:return t.yytext=a(1,2).replace(/\\'/g,"'"),80;case 33:return 85;case 34:return 82;case 35:return 82;case 36:return 83;case 37:return 84;case 38:return 81;case 39:return 75;case 40:return 77;case 41:return 72;case 42:return t.yytext=t.yytext.replace(/\\([\\\]])/g,"$1"),72;case 43:return"INVALID";case 44:return 5}},e.rules=[/^(?:[^\x00]*?(?=(\{\{)))/,/^(?:[^\x00]+)/,/^(?:[^\x00]{2,}?(?=(\{\{|\\\{\{|\\\\\{\{|$)))/,/^(?:\{\{\{\{(?=[^\/]))/,/^(?:\{\{\{\{\/[^\s!"#%-,\.\/;->@\[-\^`\{-~]+(?=[=}\s\/.])\}\}\}\})/,/^(?:[^\x00]*?(?=(\{\{\{\{)))/,/^(?:[\s\S]*?--(~)?\}\})/,/^(?:\()/,/^(?:\))/,/^(?:\{\{\{\{)/,/^(?:\}\}\}\})/,/^(?:\{\{(~)?>)/,/^(?:\{\{(~)?#>)/,/^(?:\{\{(~)?#\*?)/,/^(?:\{\{(~)?\/)/,/^(?:\{\{(~)?\^\s*(~)?\}\})/,/^(?:\{\{(~)?\s*else\s*(~)?\}\})/,/^(?:\{\{(~)?\^)/,/^(?:\{\{(~)?\s*else\b)/,/^(?:\{\{(~)?\{)/,/^(?:\{\{(~)?&)/,/^(?:\{\{(~)?!--)/,/^(?:\{\{(~)?![\s\S]*?\}\})/,/^(?:\{\{(~)?\*?)/,/^(?:=)/,/^(?:\.\.)/,/^(?:\.(?=([=~}\s\/.)|])))/,/^(?:[\/.])/,/^(?:\s+)/,/^(?:\}(~)?\}\})/,/^(?:(~)?\}\})/,/^(?:"(\\["]|[^"])*")/,/^(?:'(\\[']|[^'])*')/,/^(?:@)/,/^(?:true(?=([~}\s)])))/,/^(?:false(?=([~}\s)])))/,/^(?:undefined(?=([~}\s)])))/,/^(?:null(?=([~}\s)])))/,/^(?:-?[0-9]+(?:\.[0-9]+)?(?=([~}\s)])))/,/^(?:as\s+\|)/,/^(?:\|)/,/^(?:([^\s!"#%-,\.\/;->@\[-\^`\{-~]+(?=([=~}\s\/.)|]))))/,/^(?:\[(\\\]|[^\]])*\])/,/^(?:.)/,/^(?:$)/],e.conditions={mu:{rules:[7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44],inclusive:!1},emu:{rules:[2],inclusive:!1},com:{rules:[6],inclusive:!1},raw:{rules:[3,4,5],inclusive:!1},INITIAL:{rules:[0,1,44],inclusive:!0}},e}();return t.lexer=n,e.prototype=t,t.Parser=e,new e}();n["default"]=i,t.exports=n["default"]},{}],503:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e){return(new o).accept(e)}function o(){this.padding=0}n.__esModule=!0,n.print=a,n.PrintVisitor=o;var r=e("./visitor"),s=i(r);o.prototype=new s["default"],o.prototype.pad=function(e){for(var t="",n=0,i=this.padding;n<i;n++)t+="  ";return t+=e+"\n"},o.prototype.Program=function(e){var t="",n=e.body,i=void 0,a=void 0;if(e.blockParams){var o="BLOCK PARAMS: [";for(i=0,a=e.blockParams.length;i<a;i++)o+=" "+e.blockParams[i];o+=" ]",t+=this.pad(o)}for(i=0,a=n.length;i<a;i++)t+=this.accept(n[i]);return this.padding--,t},o.prototype.MustacheStatement=function(e){return this.pad("{{ "+this.SubExpression(e)+" }}")},o.prototype.Decorator=function(e){return this.pad("{{ DIRECTIVE "+this.SubExpression(e)+" }}")},o.prototype.BlockStatement=o.prototype.DecoratorBlock=function(e){var t="";return t+=this.pad(("DecoratorBlock"===e.type?"DIRECTIVE ":"")+"BLOCK:"),this.padding++,t+=this.pad(this.SubExpression(e)),e.program&&(t+=this.pad("PROGRAM:"),this.padding++,t+=this.accept(e.program),this.padding--),e.inverse&&(e.program&&this.padding++,t+=this.pad("{{^}}"),this.padding++,t+=this.accept(e.inverse),this.padding--,e.program&&this.padding--),this.padding--,t},o.prototype.PartialStatement=function(e){var t="PARTIAL:"+e.name.original;return e.params[0]&&(t+=" "+this.accept(e.params[0])),e.hash&&(t+=" "+this.accept(e.hash)),this.pad("{{> "+t+" }}")},o.prototype.PartialBlockStatement=function(e){var t="PARTIAL BLOCK:"+e.name.original;return e.params[0]&&(t+=" "+this.accept(e.params[0])),e.hash&&(t+=" "+this.accept(e.hash)),t+=" "+this.pad("PROGRAM:"),this.padding++,t+=this.accept(e.program),this.padding--,this.pad("{{> "+t+" }}")},o.prototype.ContentStatement=function(e){return this.pad("CONTENT[ '"+e.value+"' ]")},o.prototype.CommentStatement=function(e){return this.pad("{{! '"+e.value+"' }}")},o.prototype.SubExpression=function(e){for(var t=e.params,n=[],i=void 0,a=0,o=t.length;a<o;a++)n.push(this.accept(t[a]));return t="["+n.join(", ")+"]",i=e.hash?" "+this.accept(e.hash):"",this.accept(e.path)+" "+t+i},o.prototype.PathExpression=function(e){var t=e.parts.join("/");return(e.data?"@":"")+"PATH:"+t},o.prototype.StringLiteral=function(e){return'"'+e.value+'"'},o.prototype.NumberLiteral=function(e){return"NUMBER{"+e.value+"}"},o.prototype.BooleanLiteral=function(e){return"BOOLEAN{"+e.value+"}"},o.prototype.UndefinedLiteral=function(){return"UNDEFINED"},o.prototype.NullLiteral=function(){return"NULL"},o.prototype.Hash=function(e){for(var t=e.pairs,n=[],i=0,a=t.length;i<a;i++)n.push(this.accept(t[i]));return"HASH{"+n.join(", ")+"}"},o.prototype.HashPair=function(e){return e.key+"="+this.accept(e.value)}},{"./visitor":504}],504:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(){this.parents=[]}function o(e){this.acceptRequired(e,"path"),this.acceptArray(e.params),this.acceptKey(e,"hash")}function r(e){o.call(this,e),this.acceptKey(e,"program"),this.acceptKey(e,"inverse")}function s(e){this.acceptRequired(e,"name"),this.acceptArray(e.params),this.acceptKey(e,"hash")}n.__esModule=!0;var l=e("../exception"),c=i(l);a.prototype={constructor:a,mutating:!1,acceptKey:function(e,t){var n=this.accept(e[t]);if(this.mutating){if(n&&!a.prototype[n.type])throw new c["default"]('Unexpected node type "'+n.type+'" found when accepting '+t+" on "+e.type);e[t]=n}},acceptRequired:function(e,t){if(this.acceptKey(e,t),!e[t])throw new c["default"](e.type+" requires "+t)},acceptArray:function(e){for(var t=0,n=e.length;t<n;t++)this.acceptKey(e,t),e[t]||(e.splice(t,1),t--,n--)},accept:function(e){if(e){if(!this[e.type])throw new c["default"]("Unknown type: "+e.type,e);this.current&&this.parents.unshift(this.current),this.current=e;var t=this[e.type](e);return this.current=this.parents.shift(),!this.mutating||t?t:t!==!1?e:void 0}},Program:function(e){this.acceptArray(e.body)},MustacheStatement:o,Decorator:o,BlockStatement:r,DecoratorBlock:r,PartialStatement:s,PartialBlockStatement:function(e){s.call(this,e),this.acceptKey(e,"program")},ContentStatement:function(){},CommentStatement:function(){},SubExpression:o,PathExpression:function(){},StringLiteral:function(){},NumberLiteral:function(){},BooleanLiteral:function(){},UndefinedLiteral:function(){},NullLiteral:function(){},Hash:function(e){this.acceptArray(e.pairs)},HashPair:function(e){this.acceptRequired(e,"value")}},n["default"]=a,t.exports=n["default"]},{"../exception":508}],505:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];this.options=e}function o(e,t,n){void 0===t&&(t=e.length);var i=e[t-1],a=e[t-2];return i?"ContentStatement"===i.type?(a||!n?/\r?\n\s*?$/:/(^|\r?\n)\s*?$/).test(i.original):void 0:n}function r(e,t,n){void 0===t&&(t=-1);var i=e[t+1],a=e[t+2];return i?"ContentStatement"===i.type?(a||!n?/^\s*?\r?\n/:/^\s*?(\r?\n|$)/).test(i.original):void 0:n}function s(e,t,n){var i=e[null==t?0:t+1];if(i&&"ContentStatement"===i.type&&(n||!i.rightStripped)){var a=i.value;i.value=i.value.replace(n?/^\s+/:/^[ \t]*\r?\n?/,""),i.rightStripped=i.value!==a}}function l(e,t,n){var i=e[null==t?e.length-1:t-1];if(i&&"ContentStatement"===i.type&&(n||!i.leftStripped)){var a=i.value;return i.value=i.value.replace(n?/\s+$/:/[ \t]+$/,""),i.leftStripped=i.value!==a,i.leftStripped}}n.__esModule=!0;var c=e("./visitor"),d=i(c);a.prototype=new d["default"],a.prototype.Program=function(e){var t=!this.options.ignoreStandalone,n=!this.isRootSeen;this.isRootSeen=!0;for(var i=e.body,a=0,c=i.length;a<c;a++){var d=i[a],u=this.accept(d);if(u){var p=o(i,a,n),h=r(i,a,n),m=u.openStandalone&&p,f=u.closeStandalone&&h,g=u.inlineStandalone&&p&&h;u.close&&s(i,a,!0),u.open&&l(i,a,!0),t&&g&&(s(i,a),l(i,a)&&"PartialStatement"===d.type&&(d.indent=/([ \t]+$)/.exec(i[a-1].original)[1])),t&&m&&(s((d.program||d.inverse).body),l(i,a)),t&&f&&(s(i,a),l((d.inverse||d.program).body))}}return e},a.prototype.BlockStatement=a.prototype.DecoratorBlock=a.prototype.PartialBlockStatement=function(e){this.accept(e.program),this.accept(e.inverse);var t=e.program||e.inverse,n=e.program&&e.inverse,i=n,a=n;if(n&&n.chained)for(i=n.body[0].program;a.chained;)a=a.body[a.body.length-1].program;var c={open:e.openStrip.open,close:e.closeStrip.close,openStandalone:r(t.body),closeStandalone:o((i||t).body)};if(e.openStrip.close&&s(t.body,null,!0),n){var d=e.inverseStrip;d.open&&l(t.body,null,!0),d.close&&s(i.body,null,!0),e.closeStrip.open&&l(a.body,null,!0),!this.options.ignoreStandalone&&o(t.body)&&r(i.body)&&(l(t.body),s(i.body))}else e.closeStrip.open&&l(t.body,null,!0);return c},a.prototype.Decorator=a.prototype.MustacheStatement=function(e){return e.strip},a.prototype.PartialStatement=a.prototype.CommentStatement=function(e){var t=e.strip||{};return{inlineStandalone:!0,open:t.open,close:t.close}},n["default"]=a,t.exports=n["default"]},{"./visitor":504}],506:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e){r["default"](e)}n.__esModule=!0,n.registerDefaultDecorators=a;var o=e("./decorators/inline"),r=i(o)},{"./decorators/inline":507}],507:[function(e,t,n){"use strict";n.__esModule=!0;var i=e("../utils");n["default"]=function(e){e.registerDecorator("inline",function(e,t,n,a){var o=e;return t.partials||(t.partials={},o=function(a,o){var r=n.partials;n.partials=i.extend({},r,t.partials);var s=e(a,o);return n.partials=r,s}),t.partials[a.args[0]]=a.fn,o})},t.exports=n["default"]},{"../utils":521}],508:[function(e,t,n){"use strict";function i(e,t){var n=t&&t.loc,o=void 0,r=void 0;n&&(o=n.start.line,r=n.start.column,e+=" - "+o+":"+r);for(var s=Error.prototype.constructor.call(this,e),l=0;l<a.length;l++)this[a[l]]=s[a[l]];Error.captureStackTrace&&Error.captureStackTrace(this,i);try{n&&(this.lineNumber=o,Object.defineProperty?Object.defineProperty(this,"column",{value:r,enumerable:!0}):this.column=r)}catch(c){}}n.__esModule=!0;var a=["description","fileName","lineNumber","message","name","number","stack"];i.prototype=new Error,n["default"]=i,t.exports=n["default"]},{}],509:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e){r["default"](e),l["default"](e),d["default"](e),p["default"](e),m["default"](e),g["default"](e),b["default"](e)}n.__esModule=!0,n.registerDefaultHelpers=a;var o=e("./helpers/block-helper-missing"),r=i(o),s=e("./helpers/each"),l=i(s),c=e("./helpers/helper-missing"),d=i(c),u=e("./helpers/if"),p=i(u),h=e("./helpers/log"),m=i(h),f=e("./helpers/lookup"),g=i(f),v=e("./helpers/with"),b=i(v)},{"./helpers/block-helper-missing":510,"./helpers/each":511,"./helpers/helper-missing":512,"./helpers/if":513,"./helpers/log":514,"./helpers/lookup":515,"./helpers/with":516}],510:[function(e,t,n){"use strict";n.__esModule=!0;var i=e("../utils");n["default"]=function(e){e.registerHelper("blockHelperMissing",function(t,n){var a=n.inverse,o=n.fn;if(t===!0)return o(this);if(t===!1||null==t)return a(this);if(i.isArray(t))return t.length>0?(n.ids&&(n.ids=[n.name]),e.helpers.each(t,n)):a(this);if(n.data&&n.ids){var r=i.createFrame(n.data);r.contextPath=i.appendContextPath(n.data.contextPath,n.name),n={data:r}}return o(t,n)})},t.exports=n["default"]},{"../utils":521}],511:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}n.__esModule=!0;var a=e("../utils"),o=e("../exception"),r=i(o);n["default"]=function(e){e.registerHelper("each",function(e,t){function n(t,n,o){c&&(c.key=t,c.index=n,c.first=0===n,c.last=!!o,d&&(c.contextPath=d+t)),l+=i(e[t],{data:c,blockParams:a.blockParams([e[t],t],[d+t,null])})}if(!t)throw new r["default"]("Must pass iterator to #each");var i=t.fn,o=t.inverse,s=0,l="",c=void 0,d=void 0;if(t.data&&t.ids&&(d=a.appendContextPath(t.data.contextPath,t.ids[0])+"."),a.isFunction(e)&&(e=e.call(this)),t.data&&(c=a.createFrame(t.data)),e&&"object"==typeof e)if(a.isArray(e))for(var u=e.length;s<u;s++)s in e&&n(s,s,s===e.length-1);else{var p=void 0;for(var h in e)e.hasOwnProperty(h)&&(void 0!==p&&n(p,s-1),p=h,s++);void 0!==p&&n(p,s-1,!0)}return 0===s&&(l=o(this)),l})},t.exports=n["default"]},{"../exception":508,"../utils":521}],512:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}n.__esModule=!0;var a=e("../exception"),o=i(a);n["default"]=function(e){e.registerHelper("helperMissing",function(){if(1!==arguments.length)throw new o["default"]('Missing helper: "'+arguments[arguments.length-1].name+'"')})},t.exports=n["default"]},{"../exception":508}],513:[function(e,t,n){"use strict";n.__esModule=!0;var i=e("../utils");n["default"]=function(e){e.registerHelper("if",function(e,t){return i.isFunction(e)&&(e=e.call(this)),!t.hash.includeZero&&!e||i.isEmpty(e)?t.inverse(this):t.fn(this)}),e.registerHelper("unless",function(t,n){return e.helpers["if"].call(this,t,{fn:n.inverse,inverse:n.fn,hash:n.hash})})},t.exports=n["default"]},{"../utils":521}],514:[function(e,t,n){"use strict";n.__esModule=!0,n["default"]=function(e){e.registerHelper("log",function(){for(var t=[void 0],n=arguments[arguments.length-1],i=0;i<arguments.length-1;i++)t.push(arguments[i]);var a=1;null!=n.hash.level?a=n.hash.level:n.data&&null!=n.data.level&&(a=n.data.level),t[0]=a,e.log.apply(e,t)})},t.exports=n["default"]},{}],515:[function(e,t,n){"use strict";n.__esModule=!0,n["default"]=function(e){e.registerHelper("lookup",function(e,t){return e&&e[t]})},t.exports=n["default"]},{}],516:[function(e,t,n){"use strict";n.__esModule=!0;var i=e("../utils");n["default"]=function(e){e.registerHelper("with",function(e,t){i.isFunction(e)&&(e=e.call(this));var n=t.fn;if(i.isEmpty(e))return t.inverse(this);var a=t.data;return t.data&&t.ids&&(a=i.createFrame(t.data),a.contextPath=i.appendContextPath(t.data.contextPath,t.ids[0])),n(e,{data:a,blockParams:i.blockParams([e],[a&&a.contextPath])})})},t.exports=n["default"]},{"../utils":521}],517:[function(e,t,n){"use strict";n.__esModule=!0;var i=e("./utils"),a={methodMap:["debug","info","warn","error"],level:"info",lookupLevel:function(e){if("string"==typeof e){var t=i.indexOf(a.methodMap,e.toLowerCase());e=t>=0?t:parseInt(e,10)}return e},log:function(e){if(e=a.lookupLevel(e),"undefined"!=typeof console&&a.lookupLevel(a.level)<=e){var t=a.methodMap[e];console[t]||(t="log");for(var n=arguments.length,i=Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];console[t].apply(console,i)}}};n["default"]=a,t.exports=n["default"]},{"./utils":521}],518:[function(e,t,n){(function(e){"use strict";n.__esModule=!0,n["default"]=function(t){var n="undefined"!=typeof e?e:window,i=n.Handlebars;t.noConflict=function(){return n.Handlebars===t&&(n.Handlebars=i),t}},t.exports=n["default"]}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],519:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function o(e){var t=e&&e[0]||1,n=v.COMPILER_REVISION;if(t!==n){if(t<n){var i=v.REVISION_CHANGES[n],a=v.REVISION_CHANGES[t];throw new g["default"]("Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version ("+i+") or downgrade your runtime to an older version ("+a+").")}throw new g["default"]("Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version ("+e[1]+").")}}function r(e,t){function n(n,i,a){a.hash&&(i=m.extend({},i,a.hash),a.ids&&(a.ids[0]=!0)),n=t.VM.resolvePartial.call(this,n,i,a);var o=t.VM.invokePartial.call(this,n,i,a);if(null==o&&t.compile&&(a.partials[a.name]=t.compile(n,e.compilerOptions,t),o=a.partials[a.name](i,a)),null!=o){if(a.indent){for(var r=o.split("\n"),s=0,l=r.length;s<l&&(r[s]||s+1!==l);s++)r[s]=a.indent+r[s];o=r.join("\n")}return o}throw new g["default"]("The partial "+a.name+" could not be compiled when running in runtime-only mode")}function i(t){function n(t){return""+e.main(a,t,a.helpers,a.partials,r,l,s)}var o=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],r=o.data;i._setup(o),!o.partial&&e.useData&&(r=u(t,r));var s=void 0,l=e.useBlockParams?[]:void 0;return e.useDepths&&(s=o.depths?t!=o.depths[0]?[t].concat(o.depths):o.depths:[t]),(n=p(e.main,n,a,o.depths||[],r,l))(t,o)}if(!t)throw new g["default"]("No environment passed to template");if(!e||!e.main)throw new g["default"]("Unknown template object: "+typeof e);e.main.decorator=e.main_d,t.VM.checkRevision(e.compiler);var a={strict:function(e,t){if(!(t in e))throw new g["default"]('"'+t+'" not defined in '+e);return e[t]},lookup:function(e,t){for(var n=e.length,i=0;i<n;i++)if(e[i]&&null!=e[i][t])return e[i][t]},lambda:function(e,t){return"function"==typeof e?e.call(t):e},escapeExpression:m.escapeExpression,invokePartial:n,fn:function(t){var n=e[t];return n.decorator=e[t+"_d"],n},programs:[],program:function(e,t,n,i,a){var o=this.programs[e],r=this.fn(e);return t||a||i||n?o=s(this,e,r,t,n,i,a):o||(o=this.programs[e]=s(this,e,r)),o},data:function(e,t){for(;e&&t--;)e=e._parent;return e},merge:function(e,t){var n=e||t;return e&&t&&e!==t&&(n=m.extend({},t,e)),n},nullContext:Object.seal({}),noop:t.VM.noop,compilerInfo:e.compiler};return i.isTop=!0,i._setup=function(n){n.partial?(a.helpers=n.helpers,a.partials=n.partials,a.decorators=n.decorators):(a.helpers=a.merge(n.helpers,t.helpers),e.usePartial&&(a.partials=a.merge(n.partials,t.partials)),(e.usePartial||e.useDecorators)&&(a.decorators=a.merge(n.decorators,t.decorators)))},i._child=function(t,n,i,o){if(e.useBlockParams&&!i)throw new g["default"]("must pass block params");if(e.useDepths&&!o)throw new g["default"]("must pass parent depths");return s(a,t,e[t],n,0,i,o)},i}function s(e,t,n,i,a,o,r){function s(t){var a=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],s=r;return!r||t==r[0]||t===e.nullContext&&null===r[0]||(s=[t].concat(r)),n(e,t,e.helpers,e.partials,a.data||i,o&&[a.blockParams].concat(o),s)}return s=p(n,s,e,r,i,o),s.program=t,s.depth=r?r.length:0,s.blockParams=a||0,s}function l(e,t,n){return e?e.call||n.name||(n.name=e,e=n.partials[e]):e="@partial-block"===n.name?n.data["partial-block"]:n.partials[n.name],e}function c(e,t,n){var i=n.data&&n.data["partial-block"];n.partial=!0,n.ids&&(n.data.contextPath=n.ids[0]||n.data.contextPath);var a=void 0;if(n.fn&&n.fn!==d&&!function(){n.data=v.createFrame(n.data);var e=n.fn;a=n.data["partial-block"]=function(t){var n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return n.data=v.createFrame(n.data),n.data["partial-block"]=i,e(t,n)},e.partials&&(n.partials=m.extend({},n.partials,e.partials))}(),void 0===e&&a&&(e=a),void 0===e)throw new g["default"]("The partial "+n.name+" could not be found");if(e instanceof Function)return e(t,n)}function d(){return""}function u(e,t){return t&&"root"in t||(t=t?v.createFrame(t):{},t.root=e),t}function p(e,t,n,i,a,o){if(e.decorator){var r={};t=e.decorator(t,r,n,i&&i[0],a,o,i),m.extend(t,r)}return t}n.__esModule=!0,n.checkRevision=o,n.template=r,n.wrapProgram=s,n.resolvePartial=l,n.invokePartial=c,n.noop=d;var h=e("./utils"),m=a(h),f=e("./exception"),g=i(f),v=e("./base")},{"./base":495,"./exception":508,"./utils":521}],520:[function(e,t,n){"use strict";function i(e){this.string=e}n.__esModule=!0,i.prototype.toString=i.prototype.toHTML=function(){return""+this.string},n["default"]=i,t.exports=n["default"]},{}],521:[function(e,t,n){"use strict";function i(e){return u[e]}function a(e){for(var t=1;t<arguments.length;t++)for(var n in arguments[t])Object.prototype.hasOwnProperty.call(arguments[t],n)&&(e[n]=arguments[t][n]);return e}function o(e,t){for(var n=0,i=e.length;n<i;n++)if(e[n]===t)return n;return-1}function r(e){if("string"!=typeof e){if(e&&e.toHTML)return e.toHTML();if(null==e)return"";if(!e)return e+"";e=""+e}return h.test(e)?e.replace(p,i):e}function s(e){return!e&&0!==e||!(!g(e)||0!==e.length)}function l(e){var t=a({},e);return t._parent=e,t}function c(e,t){return e.path=t,e}function d(e,t){return(e?e+".":"")+t}n.__esModule=!0,n.extend=a,n.indexOf=o,n.escapeExpression=r,n.isEmpty=s,n.createFrame=l,n.blockParams=c,n.appendContextPath=d;var u={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;","=":"&#x3D;"},p=/[&<>"'`=]/g,h=/[&<>"'`=]/,m=Object.prototype.toString;n.toString=m;var f=function(e){return"function"==typeof e};f(/x/)&&(n.isFunction=f=function(e){return"function"==typeof e&&"[object Function]"===m.call(e)}),n.isFunction=f;var g=Array.isArray||function(e){return!(!e||"object"!=typeof e)&&"[object Array]"===m.call(e)};n.isArray=g},{}],522:[function(e,t,n){function i(t,n){var i=e("fs"),o=i.readFileSync(n,"utf8");t.exports=a.compile(o)}var a=e("../dist/cjs/handlebars")["default"],o=e("../dist/cjs/handlebars/compiler/printer");a.PrintVisitor=o.PrintVisitor,a.print=o.print,t.exports=a,"undefined"!=typeof e&&e.extensions&&(e.extensions[".handlebars"]=i,e.extensions[".hbs"]=i)},{"../dist/cjs/handlebars":493,"../dist/cjs/handlebars/compiler/printer":503,fs:492}],523:[function(e,t,n){n.SourceMapGenerator=e("./source-map/source-map-generator").SourceMapGenerator,n.SourceMapConsumer=e("./source-map/source-map-consumer").SourceMapConsumer,n.SourceNode=e("./source-map/source-node").SourceNode},{"./source-map/source-map-consumer":530,"./source-map/source-map-generator":531,"./source-map/source-node":532}],524:[function(e,t,n){if("function"!=typeof i)var i=e("amdefine")(t,e);i(function(e,t,n){function i(){this._array=[],this._set={}}var a=e("./util");i.fromArray=function(e,t){for(var n=new i,a=0,o=e.length;a<o;a++)n.add(e[a],t);return n},i.prototype.size=function(){return Object.getOwnPropertyNames(this._set).length},i.prototype.add=function(e,t){var n=this.has(e),i=this._array.length;n&&!t||this._array.push(e),n||(this._set[a.toSetString(e)]=i)},i.prototype.has=function(e){return Object.prototype.hasOwnProperty.call(this._set,a.toSetString(e))},i.prototype.indexOf=function(e){if(this.has(e))return this._set[a.toSetString(e)];throw new Error('"'+e+'" is not in the set.')},i.prototype.at=function(e){if(e>=0&&e<this._array.length)return this._array[e];throw new Error("No element indexed by "+e)},i.prototype.toArray=function(){return this._array.slice()},t.ArraySet=i})},{"./util":533,amdefine:491}],525:[function(e,t,n){if("function"!=typeof i)var i=e("amdefine")(t,e);i(function(e,t,n){function i(e){return e<0?(-e<<1)+1:(e<<1)+0}function a(e){var t=1===(1&e),n=e>>1;return t?-n:n}var o=e("./base64"),r=5,s=1<<r,l=s-1,c=s;t.encode=function(e){var t,n="",a=i(e);do t=a&l,a>>>=r,a>0&&(t|=c),n+=o.encode(t);while(a>0);return n},t.decode=function(e,t,n){var i,s,d=e.length,u=0,p=0;do{if(t>=d)throw new Error("Expected more digits in base 64 VLQ value.");if(s=o.decode(e.charCodeAt(t++)),s===-1)throw new Error("Invalid base64 digit: "+e.charAt(t-1));i=!!(s&c),s&=l,u+=s<<p,p+=r}while(i);n.value=a(u),n.rest=t}})},{"./base64":526,amdefine:491}],526:[function(e,t,n){if("function"!=typeof i)var i=e("amdefine")(t,e);i(function(e,t,n){var i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");t.encode=function(e){if(0<=e&&e<i.length)return i[e];throw new TypeError("Must be between 0 and 63: "+aNumber)},t.decode=function(e){var t=65,n=90,i=97,a=122,o=48,r=57,s=43,l=47,c=26,d=52;return t<=e&&e<=n?e-t:i<=e&&e<=a?e-i+c:o<=e&&e<=r?e-o+d:e==s?62:e==l?63:-1;
}})},{amdefine:491}],527:[function(e,t,n){if("function"!=typeof i)var i=e("amdefine")(t,e);i(function(e,t,n){function i(e,n,a,o,r,s){var l=Math.floor((n-e)/2)+e,c=r(a,o[l],!0);return 0===c?l:c>0?n-l>1?i(l,n,a,o,r,s):s==t.LEAST_UPPER_BOUND?n<o.length?n:-1:l:l-e>1?i(e,l,a,o,r,s):s==t.LEAST_UPPER_BOUND?l:e<0?-1:e}t.GREATEST_LOWER_BOUND=1,t.LEAST_UPPER_BOUND=2,t.search=function(e,n,a,o){if(0===n.length)return-1;var r=i(-1,n.length,e,n,a,o||t.GREATEST_LOWER_BOUND);if(r<0)return-1;for(;r-1>=0&&0===a(n[r],n[r-1],!0);)--r;return r}})},{amdefine:491}],528:[function(e,t,n){if("function"!=typeof i)var i=e("amdefine")(t,e);i(function(e,t,n){function i(e,t){var n=e.generatedLine,i=t.generatedLine,a=e.generatedColumn,r=t.generatedColumn;return i>n||i==n&&r>=a||o.compareByGeneratedPositionsInflated(e,t)<=0}function a(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}var o=e("./util");a.prototype.unsortedForEach=function(e,t){this._array.forEach(e,t)},a.prototype.add=function(e){i(this._last,e)?(this._last=e,this._array.push(e)):(this._sorted=!1,this._array.push(e))},a.prototype.toArray=function(){return this._sorted||(this._array.sort(o.compareByGeneratedPositionsInflated),this._sorted=!0),this._array},t.MappingList=a})},{"./util":533,amdefine:491}],529:[function(e,t,n){if("function"!=typeof i)var i=e("amdefine")(t,e);i(function(e,t,n){function i(e,t,n){var i=e[t];e[t]=e[n],e[n]=i}function a(e,t){return Math.round(e+Math.random()*(t-e))}function o(e,t,n,r){if(n<r){var s=a(n,r),l=n-1;i(e,s,r);for(var c=e[r],d=n;d<r;d++)t(e[d],c)<=0&&(l+=1,i(e,l,d));i(e,l+1,d);var u=l+1;o(e,t,n,u-1),o(e,t,u+1,r)}}t.quickSort=function(e,t){o(e,t,0,e.length-1)}})},{amdefine:491}],530:[function(e,t,n){if("function"!=typeof i)var i=e("amdefine")(t,e);i(function(e,t,n){function i(e){var t=e;return"string"==typeof e&&(t=JSON.parse(e.replace(/^\)\]\}'/,""))),null!=t.sections?new r(t):new a(t)}function a(e){var t=e;"string"==typeof e&&(t=JSON.parse(e.replace(/^\)\]\}'/,"")));var n=s.getArg(t,"version"),i=s.getArg(t,"sources"),a=s.getArg(t,"names",[]),o=s.getArg(t,"sourceRoot",null),r=s.getArg(t,"sourcesContent",null),l=s.getArg(t,"mappings"),d=s.getArg(t,"file",null);if(n!=this._version)throw new Error("Unsupported version: "+n);i=i.map(s.normalize),this._names=c.fromArray(a,!0),this._sources=c.fromArray(i,!0),this.sourceRoot=o,this.sourcesContent=r,this._mappings=l,this.file=d}function o(){this.generatedLine=0,this.generatedColumn=0,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}function r(e){var t=e;"string"==typeof e&&(t=JSON.parse(e.replace(/^\)\]\}'/,"")));var n=s.getArg(t,"version"),a=s.getArg(t,"sections");if(n!=this._version)throw new Error("Unsupported version: "+n);this._sources=new c,this._names=new c;var o={line:-1,column:0};this._sections=a.map(function(e){if(e.url)throw new Error("Support for url field in sections not implemented.");var t=s.getArg(e,"offset"),n=s.getArg(t,"line"),a=s.getArg(t,"column");if(n<o.line||n===o.line&&a<o.column)throw new Error("Section offsets must be ordered and non-overlapping.");return o=t,{generatedOffset:{generatedLine:n+1,generatedColumn:a+1},consumer:new i(s.getArg(e,"map"))}})}var s=e("./util"),l=e("./binary-search"),c=e("./array-set").ArraySet,d=e("./base64-vlq"),u=e("./quick-sort").quickSort;i.fromSourceMap=function(e){return a.fromSourceMap(e)},i.prototype._version=3,i.prototype.__generatedMappings=null,Object.defineProperty(i.prototype,"_generatedMappings",{get:function(){return this.__generatedMappings||this._parseMappings(this._mappings,this.sourceRoot),this.__generatedMappings}}),i.prototype.__originalMappings=null,Object.defineProperty(i.prototype,"_originalMappings",{get:function(){return this.__originalMappings||this._parseMappings(this._mappings,this.sourceRoot),this.__originalMappings}}),i.prototype._charIsMappingSeparator=function(e,t){var n=e.charAt(t);return";"===n||","===n},i.prototype._parseMappings=function(e,t){throw new Error("Subclasses must implement _parseMappings")},i.GENERATED_ORDER=1,i.ORIGINAL_ORDER=2,i.GREATEST_LOWER_BOUND=1,i.LEAST_UPPER_BOUND=2,i.prototype.eachMapping=function(e,t,n){var a,o=t||null,r=n||i.GENERATED_ORDER;switch(r){case i.GENERATED_ORDER:a=this._generatedMappings;break;case i.ORIGINAL_ORDER:a=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}var l=this.sourceRoot;a.map(function(e){var t=null===e.source?null:this._sources.at(e.source);return null!=t&&null!=l&&(t=s.join(l,t)),{source:t,generatedLine:e.generatedLine,generatedColumn:e.generatedColumn,originalLine:e.originalLine,originalColumn:e.originalColumn,name:null===e.name?null:this._names.at(e.name)}},this).forEach(e,o)},i.prototype.allGeneratedPositionsFor=function(e){var t=s.getArg(e,"line"),n={source:s.getArg(e,"source"),originalLine:t,originalColumn:s.getArg(e,"column",0)};if(null!=this.sourceRoot&&(n.source=s.relative(this.sourceRoot,n.source)),!this._sources.has(n.source))return[];n.source=this._sources.indexOf(n.source);var i=[],a=this._findMapping(n,this._originalMappings,"originalLine","originalColumn",s.compareByOriginalPositions,l.LEAST_UPPER_BOUND);if(a>=0){var o=this._originalMappings[a];if(void 0===e.column)for(var r=o.originalLine;o&&o.originalLine===r;)i.push({line:s.getArg(o,"generatedLine",null),column:s.getArg(o,"generatedColumn",null),lastColumn:s.getArg(o,"lastGeneratedColumn",null)}),o=this._originalMappings[++a];else for(var c=o.originalColumn;o&&o.originalLine===t&&o.originalColumn==c;)i.push({line:s.getArg(o,"generatedLine",null),column:s.getArg(o,"generatedColumn",null),lastColumn:s.getArg(o,"lastGeneratedColumn",null)}),o=this._originalMappings[++a]}return i},t.SourceMapConsumer=i,a.prototype=Object.create(i.prototype),a.prototype.consumer=i,a.fromSourceMap=function(e){var t=Object.create(a.prototype),n=t._names=c.fromArray(e._names.toArray(),!0),i=t._sources=c.fromArray(e._sources.toArray(),!0);t.sourceRoot=e._sourceRoot,t.sourcesContent=e._generateSourcesContent(t._sources.toArray(),t.sourceRoot),t.file=e._file;for(var r=e._mappings.toArray().slice(),l=t.__generatedMappings=[],d=t.__originalMappings=[],p=0,h=r.length;p<h;p++){var m=r[p],f=new o;f.generatedLine=m.generatedLine,f.generatedColumn=m.generatedColumn,m.source&&(f.source=i.indexOf(m.source),f.originalLine=m.originalLine,f.originalColumn=m.originalColumn,m.name&&(f.name=n.indexOf(m.name)),d.push(f)),l.push(f)}return u(t.__originalMappings,s.compareByOriginalPositions),t},a.prototype._version=3,Object.defineProperty(a.prototype,"sources",{get:function(){return this._sources.toArray().map(function(e){return null!=this.sourceRoot?s.join(this.sourceRoot,e):e},this)}}),a.prototype._parseMappings=function(e,t){for(var n,i,a,r,l,c=1,p=0,h=0,m=0,f=0,g=0,v=e.length,b=0,_={},y={},I=[],E=[];b<v;)if(";"===e.charAt(b))c++,b++,p=0;else if(","===e.charAt(b))b++;else{for(n=new o,n.generatedLine=c,r=b;r<v&&!this._charIsMappingSeparator(e,r);r++);if(i=e.slice(b,r),a=_[i])b+=i.length;else{for(a=[];b<r;)d.decode(e,b,y),l=y.value,b=y.rest,a.push(l);if(2===a.length)throw new Error("Found a source, but no line and column");if(3===a.length)throw new Error("Found a source and line, but no column");_[i]=a}n.generatedColumn=p+a[0],p=n.generatedColumn,a.length>1&&(n.source=f+a[1],f+=a[1],n.originalLine=h+a[2],h=n.originalLine,n.originalLine+=1,n.originalColumn=m+a[3],m=n.originalColumn,a.length>4&&(n.name=g+a[4],g+=a[4])),E.push(n),"number"==typeof n.originalLine&&I.push(n)}u(E,s.compareByGeneratedPositionsDeflated),this.__generatedMappings=E,u(I,s.compareByOriginalPositions),this.__originalMappings=I},a.prototype._findMapping=function(e,t,n,i,a,o){if(e[n]<=0)throw new TypeError("Line must be greater than or equal to 1, got "+e[n]);if(e[i]<0)throw new TypeError("Column must be greater than or equal to 0, got "+e[i]);return l.search(e,t,a,o)},a.prototype.computeColumnSpans=function(){for(var e=0;e<this._generatedMappings.length;++e){var t=this._generatedMappings[e];if(e+1<this._generatedMappings.length){var n=this._generatedMappings[e+1];if(t.generatedLine===n.generatedLine){t.lastGeneratedColumn=n.generatedColumn-1;continue}}t.lastGeneratedColumn=1/0}},a.prototype.originalPositionFor=function(e){var t={generatedLine:s.getArg(e,"line"),generatedColumn:s.getArg(e,"column")},n=this._findMapping(t,this._generatedMappings,"generatedLine","generatedColumn",s.compareByGeneratedPositionsDeflated,s.getArg(e,"bias",i.GREATEST_LOWER_BOUND));if(n>=0){var a=this._generatedMappings[n];if(a.generatedLine===t.generatedLine){var o=s.getArg(a,"source",null);null!==o&&(o=this._sources.at(o),null!=this.sourceRoot&&(o=s.join(this.sourceRoot,o)));var r=s.getArg(a,"name",null);return null!==r&&(r=this._names.at(r)),{source:o,line:s.getArg(a,"originalLine",null),column:s.getArg(a,"originalColumn",null),name:r}}}return{source:null,line:null,column:null,name:null}},a.prototype.hasContentsOfAllSources=function(){return!!this.sourcesContent&&(this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some(function(e){return null==e}))},a.prototype.sourceContentFor=function(e,t){if(!this.sourcesContent)return null;if(null!=this.sourceRoot&&(e=s.relative(this.sourceRoot,e)),this._sources.has(e))return this.sourcesContent[this._sources.indexOf(e)];var n;if(null!=this.sourceRoot&&(n=s.urlParse(this.sourceRoot))){var i=e.replace(/^file:\/\//,"");if("file"==n.scheme&&this._sources.has(i))return this.sourcesContent[this._sources.indexOf(i)];if((!n.path||"/"==n.path)&&this._sources.has("/"+e))return this.sourcesContent[this._sources.indexOf("/"+e)]}if(t)return null;throw new Error('"'+e+'" is not in the SourceMap.')},a.prototype.generatedPositionFor=function(e){var t=s.getArg(e,"source");if(null!=this.sourceRoot&&(t=s.relative(this.sourceRoot,t)),!this._sources.has(t))return{line:null,column:null,lastColumn:null};t=this._sources.indexOf(t);var n={source:t,originalLine:s.getArg(e,"line"),originalColumn:s.getArg(e,"column")},a=this._findMapping(n,this._originalMappings,"originalLine","originalColumn",s.compareByOriginalPositions,s.getArg(e,"bias",i.GREATEST_LOWER_BOUND));if(a>=0){var o=this._originalMappings[a];if(o.source===n.source)return{line:s.getArg(o,"generatedLine",null),column:s.getArg(o,"generatedColumn",null),lastColumn:s.getArg(o,"lastGeneratedColumn",null)}}return{line:null,column:null,lastColumn:null}},t.BasicSourceMapConsumer=a,r.prototype=Object.create(i.prototype),r.prototype.constructor=i,r.prototype._version=3,Object.defineProperty(r.prototype,"sources",{get:function(){for(var e=[],t=0;t<this._sections.length;t++)for(var n=0;n<this._sections[t].consumer.sources.length;n++)e.push(this._sections[t].consumer.sources[n]);return e}}),r.prototype.originalPositionFor=function(e){var t={generatedLine:s.getArg(e,"line"),generatedColumn:s.getArg(e,"column")},n=l.search(t,this._sections,function(e,t){var n=e.generatedLine-t.generatedOffset.generatedLine;return n?n:e.generatedColumn-t.generatedOffset.generatedColumn}),i=this._sections[n];return i?i.consumer.originalPositionFor({line:t.generatedLine-(i.generatedOffset.generatedLine-1),column:t.generatedColumn-(i.generatedOffset.generatedLine===t.generatedLine?i.generatedOffset.generatedColumn-1:0),bias:e.bias}):{source:null,line:null,column:null,name:null}},r.prototype.hasContentsOfAllSources=function(){return this._sections.every(function(e){return e.consumer.hasContentsOfAllSources()})},r.prototype.sourceContentFor=function(e,t){for(var n=0;n<this._sections.length;n++){var i=this._sections[n],a=i.consumer.sourceContentFor(e,!0);if(a)return a}if(t)return null;throw new Error('"'+e+'" is not in the SourceMap.')},r.prototype.generatedPositionFor=function(e){for(var t=0;t<this._sections.length;t++){var n=this._sections[t];if(n.consumer.sources.indexOf(s.getArg(e,"source"))!==-1){var i=n.consumer.generatedPositionFor(e);if(i){var a={line:i.line+(n.generatedOffset.generatedLine-1),column:i.column+(n.generatedOffset.generatedLine===i.line?n.generatedOffset.generatedColumn-1:0)};return a}}}return{line:null,column:null}},r.prototype._parseMappings=function(e,t){this.__generatedMappings=[],this.__originalMappings=[];for(var n=0;n<this._sections.length;n++)for(var i=this._sections[n],a=i.consumer._generatedMappings,o=0;o<a.length;o++){var r=a[n],l=i.consumer._sources.at(r.source);null!==i.consumer.sourceRoot&&(l=s.join(i.consumer.sourceRoot,l)),this._sources.add(l),l=this._sources.indexOf(l);var c=i.consumer._names.at(r.name);this._names.add(c),c=this._names.indexOf(c);var d={source:l,generatedLine:r.generatedLine+(i.generatedOffset.generatedLine-1),generatedColumn:r.column+(i.generatedOffset.generatedLine===r.generatedLine)?i.generatedOffset.generatedColumn-1:0,originalLine:r.originalLine,originalColumn:r.originalColumn,name:c};this.__generatedMappings.push(d),"number"==typeof d.originalLine&&this.__originalMappings.push(d)}u(this.__generatedMappings,s.compareByGeneratedPositionsDeflated),u(this.__originalMappings,s.compareByOriginalPositions)},t.IndexedSourceMapConsumer=r})},{"./array-set":524,"./base64-vlq":525,"./binary-search":527,"./quick-sort":529,"./util":533,amdefine:491}],531:[function(e,t,n){if("function"!=typeof i)var i=e("amdefine")(t,e);i(function(e,t,n){function i(e){e||(e={}),this._file=o.getArg(e,"file",null),this._sourceRoot=o.getArg(e,"sourceRoot",null),this._skipValidation=o.getArg(e,"skipValidation",!1),this._sources=new r,this._names=new r,this._mappings=new s,this._sourcesContents=null}var a=e("./base64-vlq"),o=e("./util"),r=e("./array-set").ArraySet,s=e("./mapping-list").MappingList;i.prototype._version=3,i.fromSourceMap=function(e){var t=e.sourceRoot,n=new i({file:e.file,sourceRoot:t});return e.eachMapping(function(e){var i={generated:{line:e.generatedLine,column:e.generatedColumn}};null!=e.source&&(i.source=e.source,null!=t&&(i.source=o.relative(t,i.source)),i.original={line:e.originalLine,column:e.originalColumn},null!=e.name&&(i.name=e.name)),n.addMapping(i)}),e.sources.forEach(function(t){var i=e.sourceContentFor(t);null!=i&&n.setSourceContent(t,i)}),n},i.prototype.addMapping=function(e){var t=o.getArg(e,"generated"),n=o.getArg(e,"original",null),i=o.getArg(e,"source",null),a=o.getArg(e,"name",null);this._skipValidation||this._validateMapping(t,n,i,a),null==i||this._sources.has(i)||this._sources.add(i),null==a||this._names.has(a)||this._names.add(a),this._mappings.add({generatedLine:t.line,generatedColumn:t.column,originalLine:null!=n&&n.line,originalColumn:null!=n&&n.column,source:i,name:a})},i.prototype.setSourceContent=function(e,t){var n=e;null!=this._sourceRoot&&(n=o.relative(this._sourceRoot,n)),null!=t?(this._sourcesContents||(this._sourcesContents={}),this._sourcesContents[o.toSetString(n)]=t):this._sourcesContents&&(delete this._sourcesContents[o.toSetString(n)],0===Object.keys(this._sourcesContents).length&&(this._sourcesContents=null))},i.prototype.applySourceMap=function(e,t,n){var i=t;if(null==t){if(null==e.file)throw new Error('SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map\'s "file" property. Both were omitted.');i=e.file}var a=this._sourceRoot;null!=a&&(i=o.relative(a,i));var s=new r,l=new r;this._mappings.unsortedForEach(function(t){if(t.source===i&&null!=t.originalLine){var r=e.originalPositionFor({line:t.originalLine,column:t.originalColumn});null!=r.source&&(t.source=r.source,null!=n&&(t.source=o.join(n,t.source)),null!=a&&(t.source=o.relative(a,t.source)),t.originalLine=r.line,t.originalColumn=r.column,null!=r.name&&(t.name=r.name))}var c=t.source;null==c||s.has(c)||s.add(c);var d=t.name;null==d||l.has(d)||l.add(d)},this),this._sources=s,this._names=l,e.sources.forEach(function(t){var i=e.sourceContentFor(t);null!=i&&(null!=n&&(t=o.join(n,t)),null!=a&&(t=o.relative(a,t)),this.setSourceContent(t,i))},this)},i.prototype._validateMapping=function(e,t,n,i){if((!(e&&"line"in e&&"column"in e&&e.line>0&&e.column>=0)||t||n||i)&&!(e&&"line"in e&&"column"in e&&t&&"line"in t&&"column"in t&&e.line>0&&e.column>=0&&t.line>0&&t.column>=0&&n))throw new Error("Invalid mapping: "+JSON.stringify({generated:e,source:n,original:t,name:i}))},i.prototype._serializeMappings=function(){for(var e,t=0,n=1,i=0,r=0,s=0,l=0,c="",d=this._mappings.toArray(),u=0,p=d.length;u<p;u++){if(e=d[u],e.generatedLine!==n)for(t=0;e.generatedLine!==n;)c+=";",n++;else if(u>0){if(!o.compareByGeneratedPositionsInflated(e,d[u-1]))continue;c+=","}c+=a.encode(e.generatedColumn-t),t=e.generatedColumn,null!=e.source&&(c+=a.encode(this._sources.indexOf(e.source)-l),l=this._sources.indexOf(e.source),c+=a.encode(e.originalLine-1-r),r=e.originalLine-1,c+=a.encode(e.originalColumn-i),i=e.originalColumn,null!=e.name&&(c+=a.encode(this._names.indexOf(e.name)-s),s=this._names.indexOf(e.name)))}return c},i.prototype._generateSourcesContent=function(e,t){return e.map(function(e){if(!this._sourcesContents)return null;null!=t&&(e=o.relative(t,e));var n=o.toSetString(e);return Object.prototype.hasOwnProperty.call(this._sourcesContents,n)?this._sourcesContents[n]:null},this)},i.prototype.toJSON=function(){var e={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return null!=this._file&&(e.file=this._file),null!=this._sourceRoot&&(e.sourceRoot=this._sourceRoot),this._sourcesContents&&(e.sourcesContent=this._generateSourcesContent(e.sources,e.sourceRoot)),e},i.prototype.toString=function(){return JSON.stringify(this.toJSON())},t.SourceMapGenerator=i})},{"./array-set":524,"./base64-vlq":525,"./mapping-list":528,"./util":533,amdefine:491}],532:[function(e,t,n){if("function"!=typeof i)var i=e("amdefine")(t,e);i(function(e,t,n){function i(e,t,n,i,a){this.children=[],this.sourceContents={},this.line=null==e?null:e,this.column=null==t?null:t,this.source=null==n?null:n,this.name=null==a?null:a,this[l]=!0,null!=i&&this.add(i)}var a=e("./source-map-generator").SourceMapGenerator,o=e("./util"),r=/(\r?\n)/,s=10,l="$$$isSourceNode$$$";i.fromStringWithSourceMap=function(e,t,n){function a(e,t){if(null===e||void 0===e.source)s.add(t);else{var a=n?o.join(n,e.source):e.source;s.add(new i(e.originalLine,e.originalColumn,a,t,e.name))}}var s=new i,l=e.split(r),c=function(){var e=l.shift(),t=l.shift()||"";return e+t},d=1,u=0,p=null;return t.eachMapping(function(e){if(null!==p){if(!(d<e.generatedLine)){var t=l[0],n=t.substr(0,e.generatedColumn-u);return l[0]=t.substr(e.generatedColumn-u),u=e.generatedColumn,a(p,n),void(p=e)}var n="";a(p,c()),d++,u=0}for(;d<e.generatedLine;)s.add(c()),d++;if(u<e.generatedColumn){var t=l[0];s.add(t.substr(0,e.generatedColumn)),l[0]=t.substr(e.generatedColumn),u=e.generatedColumn}p=e},this),l.length>0&&(p&&a(p,c()),s.add(l.join(""))),t.sources.forEach(function(e){var i=t.sourceContentFor(e);null!=i&&(null!=n&&(e=o.join(n,e)),s.setSourceContent(e,i))}),s},i.prototype.add=function(e){if(Array.isArray(e))e.forEach(function(e){this.add(e)},this);else{if(!e[l]&&"string"!=typeof e)throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);e&&this.children.push(e)}return this},i.prototype.prepend=function(e){if(Array.isArray(e))for(var t=e.length-1;t>=0;t--)this.prepend(e[t]);else{if(!e[l]&&"string"!=typeof e)throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);this.children.unshift(e)}return this},i.prototype.walk=function(e){for(var t,n=0,i=this.children.length;n<i;n++)t=this.children[n],t[l]?t.walk(e):""!==t&&e(t,{source:this.source,line:this.line,column:this.column,name:this.name})},i.prototype.join=function(e){var t,n,i=this.children.length;if(i>0){for(t=[],n=0;n<i-1;n++)t.push(this.children[n]),t.push(e);t.push(this.children[n]),this.children=t}return this},i.prototype.replaceRight=function(e,t){var n=this.children[this.children.length-1];return n[l]?n.replaceRight(e,t):"string"==typeof n?this.children[this.children.length-1]=n.replace(e,t):this.children.push("".replace(e,t)),this},i.prototype.setSourceContent=function(e,t){this.sourceContents[o.toSetString(e)]=t},i.prototype.walkSourceContents=function(e){for(var t=0,n=this.children.length;t<n;t++)this.children[t][l]&&this.children[t].walkSourceContents(e);for(var i=Object.keys(this.sourceContents),t=0,n=i.length;t<n;t++)e(o.fromSetString(i[t]),this.sourceContents[i[t]])},i.prototype.toString=function(){var e="";return this.walk(function(t){e+=t}),e},i.prototype.toStringWithSourceMap=function(e){var t={code:"",line:1,column:0},n=new a(e),i=!1,o=null,r=null,l=null,c=null;return this.walk(function(e,a){t.code+=e,null!==a.source&&null!==a.line&&null!==a.column?(o===a.source&&r===a.line&&l===a.column&&c===a.name||n.addMapping({source:a.source,original:{line:a.line,column:a.column},generated:{line:t.line,column:t.column},name:a.name}),o=a.source,r=a.line,l=a.column,c=a.name,i=!0):i&&(n.addMapping({generated:{line:t.line,column:t.column}}),o=null,i=!1);for(var d=0,u=e.length;d<u;d++)e.charCodeAt(d)===s?(t.line++,t.column=0,d+1===u?(o=null,i=!1):i&&n.addMapping({source:a.source,original:{line:a.line,column:a.column},generated:{line:t.line,column:t.column},name:a.name})):t.column++}),this.walkSourceContents(function(e,t){n.setSourceContent(e,t)}),{code:t.code,map:n}},t.SourceNode=i})},{"./source-map-generator":531,"./util":533,amdefine:491}],533:[function(e,t,n){if("function"!=typeof i)var i=e("amdefine")(t,e);i(function(e,t,n){function i(e,t,n){if(t in e)return e[t];if(3===arguments.length)return n;throw new Error('"'+t+'" is a required argument.')}function a(e){var t=e.match(f);return t?{scheme:t[1],auth:t[2],host:t[3],port:t[4],path:t[5]}:null}function o(e){var t="";return e.scheme&&(t+=e.scheme+":"),t+="//",e.auth&&(t+=e.auth+"@"),e.host&&(t+=e.host),e.port&&(t+=":"+e.port),e.path&&(t+=e.path),t}function r(e){var t=e,n=a(e);if(n){if(!n.path)return e;t=n.path}for(var i,r="/"===t.charAt(0),s=t.split(/\/+/),l=0,c=s.length-1;c>=0;c--)i=s[c],"."===i?s.splice(c,1):".."===i?l++:l>0&&(""===i?(s.splice(c+1,l),l=0):(s.splice(c,2),l--));return t=s.join("/"),""===t&&(t=r?"/":"."),n?(n.path=t,o(n)):t}function s(e,t){""===e&&(e="."),""===t&&(t=".");var n=a(t),i=a(e);if(i&&(e=i.path||"/"),n&&!n.scheme)return i&&(n.scheme=i.scheme),o(n);if(n||t.match(g))return t;if(i&&!i.host&&!i.path)return i.host=t,o(i);var s="/"===t.charAt(0)?t:r(e.replace(/\/+$/,"")+"/"+t);return i?(i.path=s,o(i)):s}function l(e,t){""===e&&(e="."),e=e.replace(/\/$/,"");for(var n=0;0!==t.indexOf(e+"/");){var i=e.lastIndexOf("/");if(i<0)return t;if(e=e.slice(0,i),e.match(/^([^\/]+:\/)?\/*$/))return t;++n}return Array(n+1).join("../")+t.substr(e.length+1)}function c(e){return"$"+e}function d(e){return e.substr(1)}function u(e,t,n){var i=e.source-t.source;return 0!==i?i:(i=e.originalLine-t.originalLine,0!==i?i:(i=e.originalColumn-t.originalColumn,0!==i||n?i:(i=e.generatedColumn-t.generatedColumn,0!==i?i:(i=e.generatedLine-t.generatedLine,0!==i?i:e.name-t.name))))}function p(e,t,n){var i=e.generatedLine-t.generatedLine;return 0!==i?i:(i=e.generatedColumn-t.generatedColumn,0!==i||n?i:(i=e.source-t.source,0!==i?i:(i=e.originalLine-t.originalLine,0!==i?i:(i=e.originalColumn-t.originalColumn,0!==i?i:e.name-t.name))))}function h(e,t){return e===t?0:e>t?1:-1}function m(e,t){var n=e.generatedLine-t.generatedLine;return 0!==n?n:(n=e.generatedColumn-t.generatedColumn,0!==n?n:(n=h(e.source,t.source),0!==n?n:(n=e.originalLine-t.originalLine,0!==n?n:(n=e.originalColumn-t.originalColumn,0!==n?n:h(e.name,t.name)))))}t.getArg=i;var f=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.]*)(?::(\d+))?(\S*)$/,g=/^data:.+\,.+$/;t.urlParse=a,t.urlGenerate=o,t.normalize=r,t.join=s,t.relative=l,t.toSetString=c,t.fromSetString=d,t.compareByOriginalPositions=u,t.compareByGeneratedPositionsDeflated=p,t.compareByGeneratedPositionsInflated=m})},{amdefine:491}],534:[function(e,t,n){t.exports=e("./dist/cjs/handlebars.runtime")["default"]},{"./dist/cjs/handlebars.runtime":494}],535:[function(e,t,n){t.exports=e("handlebars/runtime")["default"]},{"handlebars/runtime":534}],536:[function(e,t,n){(function(e){function t(e,t){for(var n=0,i=e.length-1;i>=0;i--){var a=e[i];"."===a?e.splice(i,1):".."===a?(e.splice(i,1),n++):n&&(e.splice(i,1),n--)}if(t)for(;n--;n)e.unshift("..");return e}function i(e,t){if(e.filter)return e.filter(t);for(var n=[],i=0;i<e.length;i++)t(e[i],i,e)&&n.push(e[i]);return n}var a=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,o=function(e){return a.exec(e).slice(1)};n.resolve=function(){for(var n="",a=!1,o=arguments.length-1;o>=-1&&!a;o--){var r=o>=0?arguments[o]:e.cwd();if("string"!=typeof r)throw new TypeError("Arguments to path.resolve must be strings");r&&(n=r+"/"+n,a="/"===r.charAt(0))}return n=t(i(n.split("/"),function(e){return!!e}),!a).join("/"),(a?"/":"")+n||"."},n.normalize=function(e){var a=n.isAbsolute(e),o="/"===r(e,-1);return e=t(i(e.split("/"),function(e){return!!e}),!a).join("/"),e||a||(e="."),e&&o&&(e+="/"),(a?"/":"")+e},n.isAbsolute=function(e){return"/"===e.charAt(0)},n.join=function(){var e=Array.prototype.slice.call(arguments,0);return n.normalize(i(e,function(e,t){if("string"!=typeof e)throw new TypeError("Arguments to path.join must be strings");return e}).join("/"))},n.relative=function(e,t){function i(e){for(var t=0;t<e.length&&""===e[t];t++);for(var n=e.length-1;n>=0&&""===e[n];n--);return t>n?[]:e.slice(t,n-t+1)}e=n.resolve(e).substr(1),t=n.resolve(t).substr(1);for(var a=i(e.split("/")),o=i(t.split("/")),r=Math.min(a.length,o.length),s=r,l=0;l<r;l++)if(a[l]!==o[l]){s=l;break}for(var c=[],l=s;l<a.length;l++)c.push("..");return c=c.concat(o.slice(s)),c.join("/")},n.sep="/",n.delimiter=":",n.dirname=function(e){var t=o(e),n=t[0],i=t[1];return n||i?(i&&(i=i.substr(0,i.length-1)),n+i):"."},n.basename=function(e,t){var n=o(e)[2];return t&&n.substr(-1*t.length)===t&&(n=n.substr(0,n.length-t.length)),n},n.extname=function(e){return o(e)[3]};var r="b"==="ab".substr(-1)?function(e,t,n){return e.substr(t,n)}:function(e,t,n){return t<0&&(t=e.length+t),e.substr(t,n)}}).call(this,e("_process"))},{_process:537}],537:[function(e,t,n){function i(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function o(e){if(u===setTimeout)return setTimeout(e,0);if((u===i||!u)&&setTimeout)return u=setTimeout,setTimeout(e,0);try{return u(e,0)}catch(t){try{return u.call(null,e,0)}catch(t){return u.call(this,e,0)}}}function r(e){if(p===clearTimeout)return clearTimeout(e);if((p===a||!p)&&clearTimeout)return p=clearTimeout,clearTimeout(e);try{return p(e)}catch(t){try{return p.call(null,e)}catch(t){return p.call(this,e)}}}function s(){g&&m&&(g=!1,m.length?f=m.concat(f):v=-1,f.length&&l())}function l(){if(!g){var e=o(s);g=!0;for(var t=f.length;t;){for(m=f,f=[];++v<t;)m&&m[v].run();v=-1,t=f.length}m=null,g=!1,r(e)}}function c(e,t){this.fun=e,this.array=t}function d(){}var u,p,h=t.exports={};!function(){try{u="function"==typeof setTimeout?setTimeout:i}catch(e){u=i}try{p="function"==typeof clearTimeout?clearTimeout:a}catch(e){p=a}}();var m,f=[],g=!1,v=-1;h.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];f.push(new c(e,t)),1!==f.length||g||o(l)},c.prototype.run=function(){this.fun.apply(null,this.array)},h.title="browser",h.browser=!0,h.env={},h.argv=[],h.version="",h.versions={},h.on=d,h.addListener=d,h.once=d,h.off=d,h.removeListener=d,h.removeAllListeners=d,h.emit=d,h.prependListener=d,h.prependOnceListener=d,h.listeners=function(e){return[]},h.binding=function(e){throw new Error("process.binding is not supported")},h.cwd=function(){return"/"},h.chdir=function(e){throw new Error("process.chdir is not supported")},h.umask=function(){return 0}},{}]},{},[133]);